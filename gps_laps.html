<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ECE/MAE 148 â€” GPS Laps: PointOneNav & DonkeyCar Guide</title>
<meta name="description" content="Complete setup guide for GPS-based autonomous laps using PointOneNav RTK GPS and DonkeyCar on the UCSD Robocar platform.">

<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  IMAGE REPLACEMENT GUIDE                                     â•‘
  â•‘  All images live in ./images/ as .png files.                 â•‘
  â•‘  To update a figure, drop a new .png with the SAME name      â•‘
  â•‘  into ./images/ and push to GitHub. Site rebuilds in <2 min. â•‘
  â•‘                                                              â•‘
  â•‘  FILE â†’ SECTION â†’ DESCRIPTION                                â•‘
  â•‘  fig_wifi_extender.png   â†’ Â§1  WiFi antenna on tripod        â•‘
  â•‘  fig_allwei_battery.png  â†’ Â§1  ALLWEI portable power station â•‘
  â•‘  fig_warren_mall_map.png â†’ Â§1  Warren Mall aerial map        â•‘
  â•‘  fig_gps_unit.png        â†’ Â§1  PointOneNav GPS unit          â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN: Industrial Technical â€” UCSD Blue/Gold
   Full viewport width, two-column fixed layout
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* Brand */
  --ucsd-navy:    #002E6D;
  --ucsd-blue:    #00629B;
  --ucsd-gold:    #C69214;
  --ucsd-gold-lt: #E8B931;
  /* Surfaces */
  --bg:           #09111E;
  --bg2:          #0D1A2D;
  --surface:      #111F35;
  --surface2:     #162643;
  --surface3:     #1C2F50;
  --border:       #1E3355;
  --border-lt:    #2A4670;
  /* Text */
  --text:         #DCE8F5;
  --text-muted:   #7A9EC4;
  --text-dim:     #4D6E96;
  /* Accents */
  --accent:       #00A8E8;
  --accent-glow:  rgba(0,168,232,0.15);
  --gold-glow:    rgba(198,146,20,0.18);
  --green:        #00C896;
  --yellow:       #F0B429;
  --red:          #F04E37;
  --purple:       #9B7FE8;
  /* Code */
  --code-bg:      #060E1A;
  --code-border:  #1A2E4A;
  /* Layout */
  --sidebar-w:    290px;
  --topbar-h:     60px;
  --r:            6px;
  --font-body:    'Sora', sans-serif;
  --font-mono:    'IBM Plex Mono', monospace;
  --ease:         cubic-bezier(0.4,0,0.2,1);
}

/* â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 15px; scroll-behavior: smooth; scroll-padding-top: calc(var(--topbar-h) + 20px); }
body { font-family: var(--font-body); background: var(--bg); color: var(--text); line-height: 1.7; min-height: 100vh; overflow-x: hidden; }

/* â”€â”€â”€ GRID BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    linear-gradient(rgba(0,98,155,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,98,155,0.04) 1px, transparent 1px);
  background-size: 40px 40px;
}

/* â”€â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 200;
  height: var(--topbar-h);
  background: rgba(9,17,30,0.95);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(16px);
  display: flex; align-items: center;
  padding: 0 0 0 var(--sidebar-w);
  gap: 0;
}
.topbar-inner {
  display: flex; align-items: center; gap: 16px;
  padding: 0 32px; width: 100%;
}
.topbar-brand {
  display: flex; align-items: center; gap: 12px; text-decoration: none;
  flex-shrink: 0;
}
.topbar-emblem {
  width: 36px; height: 36px;
  background: var(--ucsd-navy);
  border: 2px solid var(--ucsd-gold);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.topbar-emblem svg { width: 20px; height: 20px; }
.topbar-name { font-size: 15px; font-weight: 700; color: var(--text); letter-spacing: -0.3px; }
.topbar-course { font-size: 11px; color: var(--text-muted); font-family: var(--font-mono); }
.topbar-divider { width: 1px; height: 28px; background: var(--border); flex-shrink: 0; }
.topbar-breadcrumb { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }
.topbar-spacer { flex: 1; }
.topbar-status {
  display: flex; align-items: center; gap: 6px;
  font-family: var(--font-mono); font-size: 11px; color: var(--text-muted);
}
.status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse-dot 2s ease-in-out infinite; }
@keyframes pulse-dot { 0%,100%{ opacity:1; } 50%{ opacity:0.4; } }
.topbar-pill {
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  padding: 4px 12px; border-radius: 20px; letter-spacing: 0.5px;
  background: var(--surface2); border: 1px solid var(--border-lt); color: var(--text-muted);
}
#menu-toggle {
  display: none; background: none; border: 1px solid var(--border);
  color: var(--text-muted); padding: 6px 10px; border-radius: var(--r);
  cursor: pointer; font-size: 16px; flex-shrink: 0;
}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  position: fixed; top: 0; left: 0; bottom: 0; z-index: 150;
  width: var(--sidebar-w);
  background: var(--bg2);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  overflow: hidden;
}
.sidebar-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  background: var(--ucsd-navy);
  flex-shrink: 0;
}
.sidebar-logo-row { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
.sidebar-logo {
  width: 32px; height: 32px; border-radius: 6px;
  background: rgba(198,146,20,0.2); border: 1.5px solid var(--ucsd-gold);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono); font-size: 12px; font-weight: 600; color: var(--ucsd-gold);
}
.sidebar-title { font-size: 13px; font-weight: 700; color: #fff; }
.sidebar-sub { font-size: 10px; color: rgba(255,255,255,0.5); font-family: var(--font-mono); margin-top: 2px; }
.sidebar-search {
  margin: 12px 16px;
  position: relative; flex-shrink: 0;
}
.sidebar-search input {
  width: 100%; padding: 8px 12px 8px 32px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--r); color: var(--text); font-family: var(--font-body);
  font-size: 12px; outline: none;
}
.sidebar-search input::placeholder { color: var(--text-dim); }
.sidebar-search input:focus { border-color: var(--border-lt); }
.sidebar-search-icon {
  position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
  color: var(--text-dim); font-size: 13px; pointer-events: none;
}
.nav-scroll { overflow-y: auto; flex: 1; padding-bottom: 40px; }
.nav-scroll::-webkit-scrollbar { width: 3px; }
.nav-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

.nav-group-label {
  font-family: var(--font-mono); font-size: 9px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1.8px;
  color: var(--text-dim); padding: 16px 20px 6px;
  display: flex; align-items: center; gap: 8px;
}
.nav-group-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.nav-link {
  display: flex; align-items: center; gap: 10px;
  padding: 7px 20px;
  text-decoration: none; color: var(--text-muted); font-size: 12.5px;
  border-left: 2px solid transparent;
  transition: all 0.15s var(--ease);
  position: relative;
}
.nav-link .nl-num {
  font-family: var(--font-mono); font-size: 9px; color: var(--text-dim);
  background: var(--surface); border: 1px solid var(--border);
  padding: 1px 5px; border-radius: 3px; flex-shrink: 0;
}
.nav-link .nl-badge {
  margin-left: auto; font-family: var(--font-mono); font-size: 9px;
  background: rgba(198,146,20,0.2); color: var(--ucsd-gold);
  padding: 1px 5px; border-radius: 3px;
}
.nav-link:hover { color: var(--text); background: rgba(255,255,255,0.03); border-left-color: var(--border-lt); }
.nav-link.active { color: var(--ucsd-gold-lt); border-left-color: var(--ucsd-gold); background: var(--gold-glow); }
.nav-link.active .nl-num { background: rgba(198,146,20,0.2); border-color: rgba(198,146,20,0.3); color: var(--ucsd-gold); }
.nav-progress {
  padding: 12px 20px;
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}
.np-label { font-family: var(--font-mono); font-size: 10px; color: var(--text-dim); margin-bottom: 6px; display: flex; justify-content: space-between; }
.np-bar { height: 3px; background: var(--border); border-radius: 3px; overflow: hidden; }
.np-fill { height: 100%; background: linear-gradient(90deg, var(--ucsd-gold), var(--ucsd-gold-lt)); border-radius: 3px; width: 0%; transition: width 0.4s var(--ease); }

/* â”€â”€â”€ MAIN LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.layout { display: flex; padding-top: var(--topbar-h); min-height: 100vh; }
.main {
  margin-left: var(--sidebar-w);
  flex: 1;
  min-width: 0;
  position: relative; z-index: 1;
}

/* â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero {
  background:
    radial-gradient(ellipse 80% 100% at 100% 50%, rgba(0,98,155,0.25), transparent),
    radial-gradient(ellipse 50% 80% at 0% 0%, rgba(198,146,20,0.08), transparent),
    linear-gradient(180deg, var(--bg2) 0%, var(--bg) 100%);
  border-bottom: 1px solid var(--border);
  padding: 72px 80px 60px;
  position: relative; overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute; top: -40px; right: -40px;
  width: 400px; height: 400px; border-radius: 50%;
  background: radial-gradient(circle, rgba(0,168,232,0.07), transparent 70%);
  pointer-events: none;
}
.hero-eyebrow {
  display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px;
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); letter-spacing: 1px;
  background: var(--gold-glow); border: 1px solid rgba(198,146,20,0.3);
  padding: 5px 14px; border-radius: 20px;
}
.hero-eyebrow-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ucsd-gold); }
.hero h1 {
  font-size: clamp(32px, 4.5vw, 56px); font-weight: 800; line-height: 1.08;
  letter-spacing: -1.5px; margin-bottom: 20px;
  color: var(--text);
}
.hero h1 span { color: var(--ucsd-gold); }
.hero-desc {
  font-size: 16px; color: var(--text-muted); max-width: 640px;
  line-height: 1.65; margin-bottom: 36px;
}
.hero-chips { display: flex; flex-wrap: wrap; gap: 10px; }
.hero-chip {
  display: inline-flex; align-items: center; gap: 7px;
  background: var(--surface); border: 1px solid var(--border-lt);
  color: var(--text-muted); font-size: 12px; font-family: var(--font-mono);
  padding: 6px 14px; border-radius: 20px;
}
.hero-chip-icon { font-size: 14px; }

/* â”€â”€â”€ CONTENT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.content { padding: 0 80px 80px; }

/* â”€â”€â”€ SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section { padding-top: 64px; }
.section-anchor { display: block; margin-top: -80px; padding-top: 80px; }
.sec-header {
  display: flex; align-items: flex-start; gap: 20px;
  margin-bottom: 28px; padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}
.sec-num {
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); background: var(--gold-glow);
  border: 1px solid rgba(198,146,20,0.3);
  padding: 4px 12px; border-radius: 20px; flex-shrink: 0; margin-top: 4px;
}
.sec-title-block { flex: 1; }
.sec-title-block h2 { font-size: 24px; font-weight: 700; color: var(--text); letter-spacing: -0.5px; line-height: 1.2; }
.sec-title-block .sec-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
.sec-badges { display: flex; gap: 6px; margin-left: auto; flex-shrink: 0; align-items: center; }

h3 { font-size: 15px; font-weight: 600; color: var(--accent); margin: 28px 0 10px; letter-spacing: -0.2px; }
h4 { font-size: 13px; font-weight: 600; color: var(--text-muted); margin: 18px 0 8px; text-transform: uppercase; letter-spacing: 0.5px; }
p { color: var(--text-muted); margin-bottom: 14px; font-size: 14px; line-height: 1.75; }
p strong { color: var(--text); font-weight: 600; }
p code, li code {
  font-family: var(--font-mono); font-size: 12px;
  background: rgba(0,168,232,0.1); color: var(--accent);
  padding: 1px 5px; border-radius: 3px;
}

/* â”€â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge {
  font-family: var(--font-mono); font-size: 9px; font-weight: 700;
  padding: 3px 9px; border-radius: 3px; letter-spacing: 0.8px; text-transform: uppercase;
}
.badge-new    { background: rgba(155,127,232,0.2); color: var(--purple); border: 1px solid rgba(155,127,232,0.3); }
.badge-fix    { background: rgba(0,200,150,0.15); color: var(--green); border: 1px solid rgba(0,200,150,0.3); }
.badge-warn   { background: rgba(240,78,55,0.15); color: var(--red); border: 1px solid rgba(240,78,55,0.3); }
.badge-critical { background: rgba(240,78,55,0.2); color: #ff7b6e; border: 1px solid rgba(240,78,55,0.4); }

/* â”€â”€â”€ CALLOUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.callout {
  display: flex; gap: 14px; padding: 16px 18px;
  border-radius: var(--r); margin: 16px 0; border: 1px solid;
  font-size: 13.5px;
}
.callout-icon { font-size: 16px; flex-shrink: 0; line-height: 1.4; }
.callout-body { flex: 1; min-width: 0; }
.callout-title { font-size: 11px; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; margin-bottom: 5px; }
.callout-text { color: var(--text-muted); line-height: 1.65; }
.callout-text code { font-family: var(--font-mono); font-size: 11.5px; background: rgba(255,255,255,0.07); color: var(--text); padding: 1px 5px; border-radius: 3px; }

.callout.info   { background: rgba(0,168,232,0.07); border-color: rgba(0,168,232,0.25); }
.callout.info   .callout-title { color: var(--accent); }
.callout.warn   { background: rgba(240,180,41,0.07); border-color: rgba(240,180,41,0.28); }
.callout.warn   .callout-title { color: var(--yellow); }
.callout.tip    { background: rgba(0,200,150,0.07); border-color: rgba(0,200,150,0.25); }
.callout.tip    .callout-title { color: var(--green); }
.callout.error  { background: rgba(240,78,55,0.07); border-color: rgba(240,78,55,0.28); }
.callout.error  .callout-title { color: var(--red); }
.callout.new    { background: rgba(155,127,232,0.07); border-color: rgba(155,127,232,0.28); }
.callout.new    .callout-title { color: var(--purple); }

/* â”€â”€â”€ CODE BLOCKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cb {
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  border-radius: var(--r); margin: 12px 0; overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}
.cb-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 9px 14px;
  background: var(--surface); border-bottom: 1px solid var(--code-border);
}
.cb-label {
  font-family: var(--font-mono); font-size: 10.5px; color: var(--text-dim);
  display: flex; align-items: center; gap: 8px;
}
.cb-label::before {
  content: '';
  display: inline-block; width: 7px; height: 7px; border-radius: 50%;
  background: var(--ucsd-gold); opacity: 0.7;
}
.copy-btn {
  font-family: var(--font-mono); font-size: 9.5px; font-weight: 600;
  background: var(--surface2); border: 1px solid var(--border-lt);
  color: var(--text-dim); padding: 4px 12px; border-radius: 4px;
  cursor: pointer; transition: all 0.15s var(--ease); letter-spacing: 0.5px;
}
.copy-btn:hover { background: var(--border); color: var(--text); }
.copy-btn.ok { color: var(--green); border-color: rgba(0,200,150,0.4); }
pre {
  padding: 18px 20px; overflow-x: auto;
  font-family: var(--font-mono); font-size: 12.5px; line-height: 1.7; tab-size: 2;
  color: #C9D8EC;
}
pre::-webkit-scrollbar { height: 3px; }
pre::-webkit-scrollbar-thumb { background: var(--border); }
/* Syntax highlights */
.k  { color: #6BBFFF; } /* keywords/commands */
.s  { color: #A8D8B9; } /* strings */
.c  { color: #4D6E96; font-style: italic; } /* comments */
.f  { color: #BFA0F4; } /* flags */
.v  { color: #F0B429; } /* values */
.ok { color: #00C896; }
.er { color: #F04E37; }

/* â”€â”€â”€ STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.steps { display: flex; flex-direction: column; gap: 14px; margin: 16px 0; }
.step {
  display: flex; gap: 18px;
  padding: 20px; background: var(--surface);
  border: 1px solid var(--border); border-radius: var(--r);
  transition: border-color 0.15s var(--ease);
}
.step:hover { border-color: var(--border-lt); }
.step-num {
  width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0;
  background: var(--gold-glow); border: 1.5px solid rgba(198,146,20,0.45);
  color: var(--ucsd-gold); font-family: var(--font-mono);
  font-size: 11px; font-weight: 700;
  display: flex; align-items: center; justify-content: center;
}
.step-body { flex: 1; min-width: 0; }
.step-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.step-desc { font-size: 13px; color: var(--text-muted); line-height: 1.65; margin-bottom: 8px; }
.step-desc:last-child { margin-bottom: 0; }

/* â”€â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tw { overflow-x: auto; margin: 14px 0; border-radius: var(--r); border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead tr { background: var(--surface2); }
th {
  text-align: left; padding: 11px 16px;
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase;
  border-bottom: 1px solid var(--border);
}
td {
  padding: 11px 16px; border-bottom: 1px solid var(--border);
  color: var(--text-muted); vertical-align: top; font-size: 13px; line-height: 1.6;
}
td code { font-family: var(--font-mono); font-size: 11.5px; color: var(--accent); background: rgba(0,168,232,0.08); padding: 1px 6px; border-radius: 3px; }
td strong { color: var(--text); }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: rgba(255,255,255,0.015); }

/* â”€â”€â”€ FIGURES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
figure {
  margin: 20px 0; border-radius: var(--r); overflow: hidden;
  border: 1px solid var(--border);
  background: var(--surface);
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}
.fig-wrap {
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  padding: 16px; min-height: 100px;
}
.fig-wrap img {
  max-width: 100%; height: auto; display: block; border-radius: 4px;
}
figcaption {
  padding: 10px 16px;
  font-family: var(--font-mono); font-size: 11px; color: var(--text-dim);
  border-top: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
}
.fig-label { color: var(--ucsd-gold); font-weight: 600; }
.fig-key {
  margin-left: auto; background: var(--surface2); border: 1px solid var(--border);
  padding: 2px 8px; border-radius: 3px; font-size: 10px; color: var(--text-dim);
  white-space: nowrap;
}

/* â”€â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider { height: 1px; background: var(--border); margin: 48px 0; }

/* â”€â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#btt {
  position: fixed; bottom: 28px; right: 28px; z-index: 190;
  width: 42px; height: 42px; border-radius: 50%;
  background: var(--surface2); border: 1px solid var(--border-lt);
  color: var(--text-muted); font-size: 16px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: all 0.2s var(--ease); pointer-events: none;
  box-shadow: 0 4px 16px rgba(0,0,0,0.4);
}
#btt.show { opacity: 1; pointer-events: auto; }
#btt:hover { background: var(--ucsd-gold); color: var(--bg); border-color: var(--ucsd-gold); transform: translateY(-2px); }

/* â”€â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#read-progress {
  position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 2px; z-index: 300;
  background: transparent;
}
#read-progress-fill {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, var(--ucsd-navy), var(--ucsd-gold));
  transition: width 0.1s linear;
}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 1024px) {
  .hero { padding: 48px 40px 40px; }
  .content { padding: 0 40px 60px; }
}
@media (max-width: 768px) {
  #menu-toggle { display: flex; }
  .sidebar { transform: translateX(-100%); transition: transform 0.25s var(--ease); top: var(--topbar-h); }
  .sidebar.open { transform: translateX(0); }
  .topbar { padding-left: 0; }
  .main { margin-left: 0; }
  .hero { padding: 32px 20px 28px; }
  .content { padding: 0 20px 48px; }
  #read-progress { left: 0; }
}
</style>
</head>
<body>

<!-- READ PROGRESS -->
<div id="read-progress"><div id="read-progress-fill"></div></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOPBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="topbar">
  <div class="topbar-inner">
    <a href="#hero" class="topbar-brand">
      <div class="topbar-emblem">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="5" stroke="#C69214" stroke-width="2"/>
          <path d="M12 3v3M12 18v3M3 12h3M18 12h3" stroke="#C69214" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="12" r="2" fill="#C69214"/>
        </svg>
      </div>
      <div>
        <div class="topbar-name">UCSD Robocar</div>
        <div class="topbar-course">ECE / MAE 148</div>
      </div>
    </a>
    <div class="topbar-divider"></div>
    <span class="topbar-breadcrumb">GPS Laps: PointOneNav &amp; DonkeyCar Guide</span>
    <div class="topbar-spacer"></div>
    <span class="topbar-pill">GPS Â· RTK Â· DonkeyCar</span>
    <button id="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">&#9776;</button>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo-row">
      <div class="sidebar-logo">GPS</div>
      <div>
        <div class="sidebar-title">GPS Laps Docs</div>
        <div class="sidebar-sub">ECE/MAE 148 Â· UCSD</div>
      </div>
    </div>
  </div>

  <div class="sidebar-search">
    <span class="sidebar-search-icon">âŒ•</span>
    <input type="text" placeholder="Search sectionsâ€¦" id="nav-search" oninput="filterNav(this.value)">
  </div>

  <div class="nav-scroll" id="nav-scroll">
    <div class="nav-group-label">Hardware</div>
    <a class="nav-link" href="#s1"><span class="nl-num">01</span>Hardware Setup &amp; Location</a>

    <div class="nav-group-label">Software Setup</div>
    <a class="nav-link" href="#s2"><span class="nl-num">02</span>User Permissions &amp; Miniforge</a>
    <a class="nav-link" href="#s3"><span class="nl-num">03</span>Python Env &amp; GPS Config</a>

    <div class="nav-group-label">GPS Operation</div>
    <a class="nav-link" href="#s4"><span class="nl-num">04</span>Running RTK Corrections</a>
    <a class="nav-link" href="#s5"><span class="nl-num">05</span>DonkeyCar Setup</a>

    <div class="nav-group-label">Driving</div>
    <a class="nav-link" href="#s6"><span class="nl-num">06</span>Recording a Path</a>
    <a class="nav-link" href="#s7"><span class="nl-num">07</span>Autonomous Playback</a>

    <div class="nav-group-label">Tuning &amp; Debug</div>
    <a class="nav-link" href="#s8"><span class="nl-num">08</span>PID Tuning Guide</a>
    <a class="nav-link" href="#s9"><span class="nl-num">09</span>Troubleshooting</a>
  </div>

  <div class="nav-progress">
    <div class="np-label"><span>Reading Progress</span><span id="np-pct">0%</span></div>
    <div class="np-bar"><div class="np-fill" id="np-fill"></div></div>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="layout">
<div class="main">

<!-- â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="hero" id="hero">
  <div class="hero-eyebrow"><div class="hero-eyebrow-dot"></div>UCSD Jacobs School of Engineering</div>
  <h1>GPS Laps<br><span>PointOneNav &amp; DonkeyCar</span></h1>
  <p class="hero-desc">Complete reference for ECE/MAE 148 GPS-based autonomous laps â€” covering hardware placement, RTK corrections via PointOneNav Polaris, DonkeyCar follow-path configuration, manual path recording, and PID tuning for smooth autonomous playback.</p>
  <div class="hero-chips">
    <div class="hero-chip"><span class="hero-chip-icon">ğŸ“¡</span>PointOneNav RTK GPS</div>
    <div class="hero-chip"><span class="hero-chip-icon">ğŸš—</span>DonkeyCar</div>
    <div class="hero-chip"><span class="hero-chip-icon">ğŸ“</span>Raspberry Pi</div>
    <div class="hero-chip"><span class="hero-chip-icon">ğŸ”§</span>VESC Motor</div>
  </div>
</div>

<div class="content">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§1 â€” Hardware Setup & Location
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s1"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">01</span>
    <div class="sec-title-block">
      <h2>Hardware Setup &amp; Location</h2>
      <div class="sec-subtitle">Establish a strong GPS signal and WiFi connection for high-precision positioning</div>
    </div>
  </div>

  <p>Before any software configuration, the physical hardware must be correctly positioned. GPS accuracy depends heavily on clear sky view and a stable RTK correction data stream over WiFi. This section covers where to set up and how to connect all hardware components.</p>

  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">Testing Location</div><div class="callout-text">The recommended testing area is near <strong>Fallen Star</strong> (the crooked house) and <strong>Warren Mall</strong> at UCSD. These areas offer open sky for GPS reception and line-of-sight to EBU2 for the WiFi extender.</div></div></div>

  <h3>Step 1 â€” WiFi Extender Placement</h3>
  <p>The WiFi extender bridges the campus network to the car's Raspberry Pi, allowing RTK correction data to stream continuously from the Polaris network. Signal strength is the single most impactful factor for GPS accuracy.</p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Mount the White Antenna on the Tripod</div>
        <div class="step-desc">Place the white cylindrical antenna (Ubiquiti airMAX or similar) on the tripod and secure it firmly. <strong>Point the face of the antenna directly toward EBU2</strong> (the engineering building). The flat face, circled in the reference photo below, is the radiating element â€” it must face the signal source.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Power the Antenna with the ALLWEI Battery</div>
        <div class="step-desc">Connect the ALLWEI portable power station to the antenna using the provided cable. <strong>This battery is dedicated to the antenna only â€” do not use it to charge phones, laptops, or other devices.</strong></div>
      </div>
    </div>
  </div>

  <figure>
    <div class="fig-wrap">
      <img src="./images/fig_wifi_extender.png" alt="WiFi extender white antenna mounted on a black tripod inside EBU2 hallway">
    </div>
    <figcaption><span class="fig-label">Fig 1.1</span> WiFi extender (white cylindrical antenna, circled in red) mounted on tripod â€” the face must point toward EBU2 to receive the university WiFi signal <span class="fig-key">images/fig_wifi_extender.png</span></figcaption>
  </figure>

  <figure>
    <div class="fig-wrap">
      <img src="./images/fig_allwei_battery.png" alt="ALLWEI portable power station with blue tape label reading Only For Tower, No Batteries">
    </div>
    <figcaption><span class="fig-label">Fig 1.2</span> ALLWEI portable power station â€” labeled "ONLY FOR TOWER / NO BATTERIES" to prevent misuse. From Silberman's Lab, UCSD MAE EBU2 <span class="fig-key">images/fig_allwei_battery.png</span></figcaption>
  </figure>

  <h3>Step 2 â€” Testing Area Map</h3>
  <p>The two circled areas on the map below show the recommended driving loops in Warren Mall. Both loops provide open sky exposure and enough clear pavement for a smooth path-following run. Stay within these areas to maintain WiFi signal and avoid pedestrian hazards.</p>

  <figure>
    <div class="fig-wrap">
      <img src="./images/fig_warren_mall_map.png" alt="Google Maps aerial view of Warren Mall at UCSD with two driving loop areas circled in red">
    </div>
    <figcaption><span class="fig-label">Fig 1.3</span> Warren Mall aerial view â€” the two red-circled areas are the recommended GPS driving loops, located directly south of Fallen Star <span class="fig-key">images/fig_warren_mall_map.png</span></figcaption>
  </figure>

  <h3>Step 3 â€” GPS Unit (PointOneNav) Placement</h3>
  <p>The PointOneNav unit does <strong>not</strong> require any manual configuration on first use â€” it streams NMEA data immediately upon power-up. However, physical placement matters enormously for accuracy.</p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Mount the GPS Antenna on Top of the Car</div>
        <div class="step-desc">The black magnetic patch antenna (connected to the green PointOneNav board via the SMA coaxial cable) must have a clear, unobstructed view of the sky. Mount it flat on the highest point of the car. <strong>Do not place it inside the chassis or near metal objects</strong> that reflect or attenuate signals.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Connect USB to the Raspberry Pi</div>
        <div class="step-desc">Plug the PointOneNav board into the Pi via the white USB cable. The system will enumerate as <code>/dev/ttyUSB0</code> or <code>/dev/ttyUSB1</code> depending on what else is connected. You will configure the exact port in later steps.</div>
      </div>
    </div>
  </div>

  <figure>
    <div class="fig-wrap">
      <img src="./images/fig_gps_unit.png" alt="PointOneNav GPS board in pink enclosure connected to black magnetic patch antenna via coaxial SMA cable">
    </div>
    <figcaption><span class="fig-label">Fig 1.4</span> PointOneNav GPS unit (pink enclosure, S000018) with magnetic patch antenna and SMA coaxial cable. USB cable connects to Raspberry Pi <span class="fig-key">images/fig_gps_unit.png</span></figcaption>
  </figure>

  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Indoor Signal Warning</div><div class="callout-text">If you test indoors, the GPS will output <code>[LLA=nan, nan, nan]</code> â€” this is expected. Step outside to Warren Mall before expecting valid coordinate data. Allow 30â€“60 seconds after going outside for the RTK fix to converge.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§2 â€” User Permissions & Miniforge
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s2"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">02</span>
    <div class="sec-title-block">
      <h2>User Permissions &amp; Miniforge Install</h2>
      <div class="sec-subtitle">Grant USB device access and install a clean Python environment manager</div>
    </div>
    <div class="sec-badges"><span class="badge badge-warn">Terminal 1</span></div>
  </div>

  <p>The GPS software requires two things before it can run: (1) your Pi user must be in the <code>dialout</code> group so it can open serial/USB ports without <code>sudo</code>, and (2) a Miniforge-managed Python 3.7 environment to host the GPS drivers without polluting the system Python.</p>

  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">Two-Terminal Architecture</div><div class="callout-text">This entire setup requires <strong>two terminal sessions running simultaneously</strong>. Terminal 1 runs the GPS correction stream (must stay open forever). Terminal 2 runs DonkeyCar. This section covers Terminal 1 prerequisites.</div></div></div>

  <h3>Step 1 â€” Grant USB Device Permissions</h3>
  <p>Linux restricts access to serial ports (<code>/dev/ttyUSB*</code>) to members of the <code>dialout</code> group. Without this, you will get a <code>Permission denied</code> error when the GPS tries to open the port.</p>

  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” Terminal 1</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo adduser</span> pi dialout   <span class="c"># Add 'pi' user to the dialout group</span>
<span class="k">sudo reboot now</span>           <span class="c"># Group membership only takes effect after reboot</span></pre></div>

  <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Already in the Group?</div><div class="callout-text">Run <code>groups</code> to check. If <code>dialout</code> is listed, the reboot is optional â€” but rebooting is safer and ensures a clean state for the session ahead.</div></div></div>

  <h3>Step 2 â€” Clone the Quectel Repository</h3>
  <p>The PointOneNav runner lives inside the <code>quectel/p1_runner</code> directory. This repository contains the config tool, the runner script, and all supporting files.</p>

  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” after reboot</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">git clone</span> https://github.com/UCSD-ECEMAE-148/quectel
<span class="k">cd</span> quectel/p1_runner</pre></div>

  <h3>Step 3 â€” Install Miniforge</h3>
  <p>Miniforge provides <code>conda</code>/<code>mamba</code> â€” a fast, lightweight environment manager. We use it to create a sandboxed Python 3.7 environment for the GPS software so it never conflicts with DonkeyCar's Python 3 stack or system packages.</p>

  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” inside quectel/p1_runner</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Download Miniforge installer for the current architecture (ARM64 on Pi)</span>
<span class="k">wget</span> <span class="s">"https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh"</span>

<span class="c"># Run the installer (follow on-screen prompts â€” accept the license, confirm defaults)</span>
<span class="k">bash</span> Miniforge3-Linux-aarch64.sh

<span class="c"># Reboot so conda is added to your PATH</span>
<span class="k">sudo reboot now</span></pre></div>

  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Architecture Mismatch Bug</div><div class="callout-text">The <code>$(uname -m)</code> substitution produces <code>aarch64</code> on a 64-bit Pi. If you get a "file not found" error, your Pi may be running a 32-bit OS. Verify with <code>uname -m</code> â€” if it shows <code>armv7l</code>, download the <code>armv7l</code> installer manually from the Miniforge GitHub releases page.</div></div></div>

  <h3>Validation Test â€” Miniforge Installed Correctly</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” after reboot</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">conda</span> <span class="f">--version</span>   <span class="c"># Expected: conda 23.x.x or similar</span>
<span class="k">mamba</span> <span class="f">--version</span>   <span class="c"># Expected: mamba x.x.x</span>
<span class="c"># If both print version numbers, Miniforge is installed correctly.</span></pre></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§3 â€” Python Env & GPS Config
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s3"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">03</span>
    <div class="sec-title-block">
      <h2>Python Environment &amp; GPS Configuration</h2>
      <div class="sec-subtitle">Create the py37 sandbox and configure the GPS hardware output format</div>
    </div>
    <div class="sec-badges"><span class="badge badge-warn">Terminal 1</span></div>
  </div>

  <p>With Miniforge installed, we create an isolated Python 3.7 environment named <code>py37</code> and install the GPS client libraries. We then use the <code>config_tool.py</code> script to reset the GPS to factory defaults and configure it to output NMEA GGA sentences over USB â€” the format DonkeyCar reads.</p>

  <h3>Step 1 â€” Create the py37 Environment</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” SSH back in after reboot</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">mamba create</span> <span class="f">-n</span> py37 <span class="f">-c</span> conda-forge python=3.7 pip   <span class="c"># Create sandbox</span>
<span class="k">mamba activate</span> py37                                        <span class="c"># Enter the sandbox</span>

<span class="c"># Install GPS client libraries inside the py37 environment</span>
<span class="k">pip install</span> pyserial fusion_engine_client pynmea ntripstreams websockets</pre></div>

  <p><strong>Why Python 3.7?</strong> The <code>fusion_engine_client</code> library from PointOneNav uses type annotation syntax compatible with Python 3.7. Higher versions may work, but have caused silent import failures in testing on the Pi's ARM architecture.</p>

  <h3>Step 2 â€” Install Requirements and Configure the GPS Hardware</h3>
  <p>The GPS module ships with its firmware configured for a different output format. We must reset it to factory settings and then enable NMEA GGA output on UART2 (which maps to the USB connection). The <code>save</code> command writes these settings to non-volatile memory so they persist across power cycles.</p>

  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” inside py37 env, in quectel/p1_runner directory</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Deactivate everything to start clean</span>
<span class="k">conda deactivate</span>   <span class="c"># Repeat until prompt shows no (base) or (py37)</span>

<span class="c"># Re-enter the donkeycar venv first, then py37</span>
<span class="k">source</span> ~/env/bin/activate   <span class="c"># You should see (env) in your prompt</span>

<span class="k">cd</span> ~/quectel/p1_runner

<span class="c"># Install/upgrade build tools inside the venv</span>
<span class="k">python</span> <span class="f">-m pip install</span> <span class="f">-U</span> pip setuptools wheel
<span class="k">python</span> <span class="f">-m pip install</span> <span class="f">-r</span> requirements.txt
<span class="k">pip install</span> pyserial fusion_engine_client pynmea ntripstreams websockets

<span class="c"># â”€â”€ GPS HARDWARE CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c"># 1. Wipe old settings that may cause conflicts</span>
<span class="k">python3</span> bin/config_tool.py reset factory

<span class="c"># 2. Tell the GPS to send NMEA GGA sentences over USB (UART2)</span>
<span class="k">python3</span> bin/config_tool.py apply uart2_message_rate nmea gga on

<span class="c"># 3. Persist the settings to non-volatile memory</span>
<span class="k">python3</span> bin/config_tool.py save</pre></div>

  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">Why These Three Commands?</div><div class="callout-text"><strong>reset factory</strong> â€” clears any previous custom configuration that could interfere. <strong>uart2_message_rate nmea gga on</strong> â€” enables GGA sentences (latitude, longitude, fix quality, altitude) at default rate on the USB output. <strong>save</strong> â€” writes the new config to flash; without this the GPS reverts to the old config on the next power cycle.</div></div></div>

  <h3>Step 3 â€” Activate Both Environments (Required for Running)</h3>
  <p>The runner must be able to see both the DonkeyCar venv libraries and the py37 GPS libraries. Activate in this exact order:</p>

  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” environment activation sequence</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Start clean</span>
<span class="k">deactivate</span>

<span class="c"># Re-activate â€” prompt should show (env)(py37) when complete</span>
<span class="k">conda activate</span> py37
<span class="k">source</span> ~/env/bin/activate

<span class="c"># Verify</span>
<span class="k">python</span> <span class="f">--version</span>   <span class="c"># Should print Python 3.7.x</span></pre></div>

  <h3>Validation Test â€” GPS Config Applied Correctly</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” quick sanity check</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># List available serial ports â€” GPS should appear as /dev/ttyUSB0 or /dev/ttyUSB1</span>
<span class="k">python3</span> <span class="f">-c</span> <span class="s">"import serial.tools.list_ports; print(list(serial.tools.list_ports.comports()))"</span>

<span class="c"># If the GPS port appears in the list above, the hardware is connected correctly.</span>
<span class="c"># Expected output example: [&lt;serial.tools.list_ports_linux.SysfsPort object&gt; - /dev/ttyUSB1 'CP2102 USB to UART Bridge']</span></pre></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§4 â€” Running RTK Corrections
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s4"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">04</span>
    <div class="sec-title-block">
      <h2>Running GPS RTK Corrections</h2>
      <div class="sec-subtitle">Connect to the Polaris network for centimeter-level accuracy â€” keep this terminal open</div>
    </div>
    <div class="sec-badges"><span class="badge badge-warn">Terminal 1</span><span class="badge badge-critical">Keep Open</span></div>
  </div>

  <p>Standard GPS has 2â€“5 meters of error â€” enough to miss a curb by a car width. RTK (Real-Time Kinematic) corrections bring this down to 1â€“3 <em>centimeters</em> by streaming differential correction data from a fixed base station. The PointOneNav Polaris service provides this correction stream over the internet.</p>

  <h3>Step 1 â€” Launch the Runner</h3>
  <p>Each robot has a unique <strong>Device ID</strong> and <strong>Polaris Password</strong> assigned for the class. Find yours in the credentials table below and substitute them into the command. The <code>--device-port</code> flag specifies which USB port the GPS is connected to.</p>

  <div class="cb"><div class="cb-header"><span class="cb-label">Terminal 1 â€” inside py37 env, quectel/p1_runner directory</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Primary command â€” use USB1 first</span>
<span class="k">python3</span> bin/runner.py \
  <span class="f">--device-id</span>   <span class="v">yZ952ezI</span> \
  <span class="f">--polaris</span>     <span class="v">3gGOrFMX</span> \
  <span class="f">--device-port</span> /dev/ttyUSB1

<span class="c"># If the above fails with "no such file" or "device busy", try USB0:</span>
<span class="k">python3</span> bin/runner.py \
  <span class="f">--device-id</span>   <span class="v">yZ952ezI</span> \
  <span class="f">--polaris</span>     <span class="v">3gGOrFMX</span> \
  <span class="f">--device-port</span> /dev/ttyUSB0</pre></div>

  <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Detecting the Correct USB Port</div><div class="callout-text">Run <code>ls /dev/ttyUSB*</code> before and after plugging in the GPS. The new entry that appears is the GPS port. If LiDAR is also plugged in, the GPS is usually on the higher-numbered port.</div></div></div>

  <h3>Step 2 â€” Verify Output</h3>
  <div class="tw"><table>
    <thead><tr><th>What You See</th><th>What It Means</th><th>Action</th></tr></thead>
    <tbody>
      <tr><td><code>Device reset complete. Starting data logging.</code></td><td>GPS is communicating correctly with the Pi</td><td>âœ“ Good â€” proceed</td></tr>
      <tr><td><code>[LLA=nan, nan, nan]</code></td><td>No satellite signal (indoors)</td><td>Step outside and wait 30â€“60 s</td></tr>
      <tr><td><code>[LLA=32.88xxx, -117.23xxx, xxx]</code></td><td>Valid fix â€” UCSD coordinates</td><td>âœ“ Excellent â€” RTK is working</td></tr>
      <tr><td><code>Connection refused</code> or timeout</td><td>No internet / WiFi extender not connected</td><td>Check WiFi extender is on and facing EBU2</td></tr>
    </tbody>
  </table></div>

  <div class="callout error"><div class="callout-icon">ğŸš«</div><div class="callout-body"><div class="callout-title">Never Close Terminal 1</div><div class="callout-text">Terminal 1 must stay running for the entire session. If it closes, the GPS loses RTK corrections and degrades to meter-level accuracy within seconds. Open all other work in Terminal 2 or new SSH sessions.</div></div></div>

  <h3>Class Credentials Reference</h3>
  <div class="tw"><table>
    <thead><tr><th>Robot #</th><th>Username (--device-id)</th><th>Password (--polaris)</th></tr></thead>
    <tbody>
      <tr><td>1</td><td><code>yZ952ezI</code></td><td><code>3gGOrFMX</code></td></tr>
      <tr><td>2</td><td><code>Ghhiex3O</code></td><td><code>keH10zzC</code></td></tr>
      <tr><td>3</td><td><code>M3Xs2msm</code></td><td><code>LLmh1ADV</code></td></tr>
      <tr><td>4</td><td><code>cgHZsEcU</code></td><td><code>3Eo2z0GE</code></td></tr>
      <tr><td>5</td><td><code>0Tm0Qj1L</code></td><td><code>g8k5Folx</code></td></tr>
      <tr><td>6</td><td><code>rQ2gKIc6</code></td><td><code>Li48DbiF</code></td></tr>
      <tr><td>7</td><td><code>gbUv1nO2</code></td><td><code>zZLxzLpJ</code></td></tr>
    </tbody>
  </table></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§5 â€” DonkeyCar Setup
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s5"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">05</span>
    <div class="sec-title-block">
      <h2>DonkeyCar Setup</h2>
      <div class="sec-subtitle">Configure the follow-path template and myconfig.py for GPS + VESC operation</div>
    </div>
    <div class="sec-badges"><span class="badge badge-new">Terminal 2</span></div>
  </div>

  <p>With Terminal 1 running the GPS corrections, open a <strong>new terminal</strong> (Terminal 2). We will create a DonkeyCar application using the <code>follow-path</code> template â€” a specialized template built for GPS waypoint navigation â€” and configure it with the correct serial ports, motor settings, and controller button mappings.</p>

  <h3>Step 1 â€” Create the Car Directory</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Terminal 2 â€” new SSH session</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Ensure you are NOT in py37 â€” must be in the DonkeyCar venv only</span>
<span class="k">conda deactivate</span>   <span class="c"># Repeat until no (base)/(py37) in prompt</span>
<span class="k">source</span> ~/env/bin/activate   <span class="c"># Activate DonkeyCar venv â€” prompt shows (env)</span>

<span class="c"># Create the GPS car directory using the follow-path template</span>
<span class="k">donkey createcar</span> <span class="f">--template-path</span> follow-path <span class="f">--path</span> ~/gpscar</pre></div>

  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">Why follow-path?</div><div class="callout-text">DonkeyCar has multiple templates (camera-based lane following, imitation learning, etc.). The <code>follow-path</code> template is the only one with built-in GPS waypoint recording and playback parts. Using any other template will be missing the <code>PathFollower</code> and <code>GPSController</code> parts.</div></div></div>

  <h3>Step 2 â€” Edit myconfig.py</h3>
  <p>The <code>myconfig.py</code> file overrides default DonkeyCar settings. Open it and add or uncomment the following groups of settings. Every line commented with a <code>#</code> explanation describes <em>why</em> that value was chosen.</p>

  <div class="cb"><div class="cb-header"><span class="cb-label">Terminal 2</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> ~/gpscar/myconfig.py</pre></div>

  <h3>A â€” GPS Settings</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">~/gpscar/myconfig.py â€” GPS block</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># GPS_SERIAL: The port the PointOneNav streams NMEA GGA data on.
# Use USB0 if USB1 was used for the runner in Terminal 1, or vice versa.
# Rule: GPS_SERIAL must be the OPPOSITE port from --device-port in the runner.</span>
GPS_SERIAL = <span class="s">"/dev/ttyUSB0"</span>

<span class="c"># Baud rate required for PointOneNav. DO NOT change this value â€”
# 460800 is the fixed output rate set by config_tool.py in Â§3.</span>
GPS_SERIAL_BAUDRATE = <span class="v">460800</span>

<span class="c"># Enables verbose GPS output in the console for debugging.
# Set to False once everything is working to reduce terminal noise.</span>
GPS_DEBUG = True

<span class="c"># Master switch â€” must be True or DonkeyCar ignores all GPS settings above.</span>
HAVE_GPS = True

<span class="c"># NMEA_PATH: Only needed for file-based GPS replay. Leave as None for live GPS.</span>
GPS_NMEA_PATH = None</pre></div>

  <h3>B â€” VESC Motor Settings</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">~/gpscar/myconfig.py â€” VESC block</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Selects the VESC motor controller driver. Other options: SERVO, DC_STEER, etc.</span>
DRIVE_TRAIN_TYPE = <span class="s">"VESC"</span>

<span class="c"># Caps throttle at 50% of the VESC's maximum to prevent crashes during testing.
# Increase in small increments (0.55, 0.60â€¦) only after stable autonomous runs.</span>
VESC_MAX_SPEED_PERCENT = <span class="v">0.5</span>

<span class="c"># The USB-serial port the VESC enumerates as. Usually ttyACM0, sometimes ttyACM1.</span>
VESC_SERIAL_PORT = <span class="s">"/dev/ttyACM0"</span>
VESC_BAUDRATE = <span class="v">115200</span>

<span class="c"># Steering scale: maps the [-1, 1] steering command to actual servo PWM range.
# 0.5 means only the middle half of servo travel is used â€” reduces overcorrection.</span>
VESC_STEERING_SCALE = <span class="v">0.5</span>

<span class="c"># Steering offset: 0.5 is the mechanical center of the servo.
# Adjust by Â±0.02 increments if the car drifts straight ahead.</span>
VESC_STEERING_OFFSET = <span class="v">0.5</span></pre></div>

  <h3>C â€” Joystick / Controller Settings</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">~/gpscar/myconfig.py â€” Joystick block</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Enable joystick as the primary control source (required for recording laps).</span>
USE_JOYSTICK_AS_DEFAULT = True

<span class="c"># Limits manual throttle to 50% â€” match VESC_MAX_SPEED_PERCENT for consistency.</span>
JOYSTICK_MAX_THROTTLE = <span class="v">0.5</span>

<span class="c"># Controller type. Change to 'xbox', 'F710', or 'custom' if using a different gamepad.</span>
CONTROLLER_TYPE = <span class="s">'ps4'</span>

<span class="c"># The Linux input device file for the controller.
# Run: ls /dev/input/js* to confirm the correct device number.</span>
JOYSTICK_DEVICE_FILE = <span class="s">"/dev/input/js0"</span></pre></div>

  <h3>D â€” Button Mappings</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">~/gpscar/myconfig.py â€” Button mapping block</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># R1: Save the currently recorded waypoints to a CSV file on disk.</span>
SAVE_PATH_BTN = <span class="s">"R1"</span>

<span class="c"># X: Reload the saved path from disk â€” use at start of autonomous run.</span>
LOAD_PATH_BTN = <span class="s">"X"</span>

<span class="c"># B: Set the car's current GPS location as coordinate (0, 0) on the local map.
# Press this BEFORE recording and again at the start of autonomous playback.</span>
RESET_ORIGIN_BTN = <span class="s">"B"</span>

<span class="c"># Y: Clear all waypoints from memory without saving â€” useful for re-runs.</span>
ERASE_PATH_BTN = <span class="s">"Y"</span>

<span class="c"># L1: Toggle recording on/off. Press once to start recording, again to stop.</span>
TOGGLE_RECORDING_BTN = <span class="s">"L1"</span>

<span class="c"># PID buttons â€” set to None to disable runtime adjustments.</span>
INC_PID_D_BTN = None
DEC_PID_D_BTN = None
INC_PID_P_BTN = <span class="s">"None"</span>
DEC_PID_P_BTN = <span class="s">"None"</span></pre></div>

  <h3>E â€” Camera Type</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">~/gpscar/myconfig.py â€” Camera block</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># MOCK disables the camera pipeline entirely. GPS laps do not use camera input.
# Using MOCK prevents startup errors if no camera is physically connected.</span>
CAMERA_TYPE = <span class="s">"MOCK"</span></pre></div>

  <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Verify USB Port Assignments Before Saving</div><div class="callout-text">Run <code>ls /dev/ttyUSB* /dev/ttyACM*</code> and confirm: the GPS NMEA port goes into <code>GPS_SERIAL</code>, the VESC port into <code>VESC_SERIAL_PORT</code>. Mixing them up is the most common configuration mistake and causes a silent failure where neither device responds.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§6 â€” Recording a Path
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s6"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">06</span>
    <div class="sec-title-block">
      <h2>Driving &amp; Recording a Path</h2>
      <div class="sec-subtitle">Manually drive the car to teach it the track waypoints</div>
    </div>
    <div class="sec-badges"><span class="badge badge-new">Terminal 2</span></div>
  </div>

  <p>DonkeyCar's path-following system is driven by recorded GPS waypoints, not a pre-defined map. You physically drive the car around the loop once to "teach" it the route. The car samples its GPS position at regular intervals and saves each position as a waypoint. Autonomous playback then steers toward each waypoint in sequence.</p>

  <h3>Step 1 â€” Launch DonkeyCar</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Terminal 2</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cd</span> ~/gpscar
<span class="k">python</span> manage.py drive</pre></div>

  <h3>Step 2 â€” Recording Procedure</h3>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Drive to the Starting Line</div>
        <div class="step-desc">Physically position the car at the exact point on the loop where you want autonomous laps to begin and end. This point becomes coordinate (0, 0) in the local map.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Erase Old Data, Then Reset Origin</div>
        <div class="step-desc">Press <strong>Y</strong> (ERASE_PATH_BTN) to clear any previously recorded waypoints from memory, then press <strong>B</strong> (RESET_ORIGIN_BTN) to set your current GPS position as the local (0, 0) reference. Do both before every new recording session â€” skipping this causes the path to be offset from the actual loop.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Start Recording</div>
        <div class="step-desc">Press <strong>L1</strong> (TOGGLE_RECORDING_BTN). The terminal will log that recording has started. GPS waypoints are now being sampled continuously as you drive.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Drive the Loop Smoothly</div>
        <div class="step-desc">Drive the car manually around the full loop. Drive at a moderate, consistent speed â€” erratic speed changes create a high-density cluster of waypoints in some areas and sparse waypoints in others, which causes jerky autonomous behavior. Aim to stop exactly where you started to close the loop.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">5</div>
      <div class="step-body">
        <div class="step-title">Stop Recording and Save</div>
        <div class="step-desc">Press <strong>L1</strong> again to stop recording, then press <strong>R1</strong> (SAVE_PATH_BTN) to write the waypoints to the CSV file defined in your config. Confirm the file was written before proceeding.</div>
      </div>
    </div>
  </div>

  <h3>Validate the Saved Path</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” check path file exists and has data</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Default path file location â€” check it exists and is non-empty</span>
<span class="k">ls</span> <span class="f">-lh</span> ~/gpscar/path.csv

<span class="c"># Peek at the first few waypoints (columns: x, y or lat, lon depending on config)</span>
<span class="k">head</span> <span class="f">-5</span> ~/gpscar/path.csv

<span class="c"># Count total waypoints â€” a typical 100m loop at default sample rate has 200â€“600 points</span>
<span class="k">wc</span> <span class="f">-l</span> ~/gpscar/path.csv</pre></div>

  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Too Few Waypoints?</div><div class="callout-text">If <code>wc -l</code> returns fewer than 50, the GPS may have lost fix during recording (check Terminal 1 for nan values) or recording was not properly started. Re-run the entire recording procedure in a fresh session.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§7 â€” Autonomous Playback
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s7"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">07</span>
    <div class="sec-title-block">
      <h2>Autonomous Path Playback</h2>
      <div class="sec-subtitle">Have the car drive itself by following the recorded GPS waypoints</div>
    </div>
  </div>

  <p>Autonomous playback loads the saved CSV path and uses a PID controller to steer the car toward each successive waypoint. The car computes its cross-track error (lateral distance from the path) and heading error, then sends corrective steering commands to the VESC.</p>

  <div class="callout error"><div class="callout-icon">ğŸš«</div><div class="callout-body"><div class="callout-title">Pre-Flight Checklist</div><div class="callout-text">Before enabling autopilot: (1) Terminal 1 must be running and showing valid coordinates. (2) The area ahead must be clear of pedestrians. (3) Someone must have their hand near the controller to kill throttle immediately if the car drifts.</div></div></div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Position at Exact Start Point</div>
        <div class="step-desc">Place the car at the same physical starting line used during recording. Sub-meter positioning matters â€” even 50 cm of offset can cause the car to cut the first corner.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Reset Origin</div>
        <div class="step-desc">Press <strong>B</strong> (RESET_ORIGIN_BTN). This re-establishes (0,0) at your current location and aligns the saved waypoints with the real-world coordinate system for this session.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Load the Path</div>
        <div class="step-desc">Press <strong>X</strong> (LOAD_PATH_BTN) to read the waypoints from <code>path.csv</code> into memory. You should see a confirmation in the terminal showing how many waypoints were loaded.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Engage Autopilot</div>
        <div class="step-desc">Switch the controller to autopilot mode (typically the <strong>Start</strong> button or a mode-toggle button depending on your controller config). The car will immediately begin steering and applying throttle â€” stand clear and be ready to override.</div>
      </div>
    </div>
  </div>

  <h3>Improved: Detecting Autopilot Engagement</h3>
  <p>Add this snippet to monitor when autopilot is active by checking the terminal output â€” look for mode switches logged by the DonkeyCar framework:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Terminal 2 â€” monitor mode in a split terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># In a third SSH session, tail the DonkeyCar log for mode changes</span>
<span class="k">tail</span> <span class="f">-f</span> ~/gpscar/logs/donkey.log | <span class="k">grep</span> <span class="f">-i</span> <span class="s">"mode\|autopilot\|pilot"</span>

<span class="c"># Expected output when autopilot is engaged:</span>
<span class="c"># INFO:donkeycar.parts.controller:auto_pilot mode</span></pre></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§8 â€” PID Tuning Guide
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s8"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">08</span>
    <div class="sec-title-block">
      <h2>PID Tuning Guide</h2>
      <div class="sec-subtitle">Eliminate oscillation and corner-cutting with systematic gain tuning</div>
    </div>
  </div>

  <p>If the car oscillates side-to-side, cuts corners, or drifts wide, the PID gains in <code>myconfig.py</code> need adjustment. PID tuning is iterative â€” follow the strategy below in order and do not adjust multiple gains simultaneously.</p>

  <h3>Understanding the Gains</h3>
  <div class="tw"><table>
    <thead><tr><th>Gain</th><th>Role</th><th>Too Low</th><th>Too High</th></tr></thead>
    <tbody>
      <tr><td><strong>P (Proportional)</strong></td><td>Immediate correction force proportional to the current cross-track error</td><td>Car turns too slowly, misses corners (understeer)</td><td>Car weaves wildly, oscillates around the path</td></tr>
      <tr><td><strong>D (Derivative)</strong></td><td>Dampens corrections based on the rate of change of error â€” anticipates overshoot</td><td>No damping â€” P oscillations persist</td><td>Jerky, over-damped steering â€” car feels sluggish</td></tr>
      <tr><td><strong>I (Integral)</strong></td><td>Corrects for sustained long-term drift by accumulating error over time</td><td>Persistent one-side drift if wheel sizes differ</td><td>Slow, creeping oscillation that builds over many seconds</td></tr>
    </tbody>
  </table></div>

  <h3>Tuning Strategy (Follow In Order)</h3>
  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Zero Out D and I â€” Tune P Alone</div>
        <div class="step-desc">Set <code>PID_D = 0.0</code> and <code>PID_I = 0.0</code> in <code>myconfig.py</code>. Start with a small P (e.g., <code>PID_P = 0.1</code>). Run the car and increase P in increments of 0.05 until the car follows the path but has noticeable side-to-side oscillation. That oscillation point is your P reference.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Add D to Dampen Oscillations</div>
        <div class="step-desc">With P set, increase D from 0 in increments of 0.1. The oscillations should reduce. A good starting point: D is often 2â€“5Ã— the value of P. Continue until the car tracks smoothly without weaving.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Add I Only If There Is Persistent Drift</div>
        <div class="step-desc">If the car consistently drifts to one side even on a straight with P and D tuned, add a small I (e.g., <code>PID_I = 0.01</code>). For most applications on flat pavement with equal wheels, I can stay at 0.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Increase Speed and Re-Tune</div>
        <div class="step-desc">Once stable at 50% throttle, increase <code>VESC_MAX_SPEED_PERCENT</code> by 0.05. Higher speed means the car covers more distance per PID cycle, effectively increasing the impact of P â€” you may need to reduce P slightly at higher speeds and re-tune D.</div>
      </div>
    </div>
  </div>

  <h3>PID Values in myconfig.py</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">~/gpscar/myconfig.py â€” PID block</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Starting values for a typical UCSD Warren Mall loop at 50% throttle</span>
PID_P = <span class="v">0.15</span>   <span class="c"># Increase until car follows path but oscillates</span>
PID_D = <span class="v">0.6</span>    <span class="c"># Increase to dampen oscillations (aim for ~3-5Ã— P value)</span>
PID_I = <span class="v">0.0</span>    <span class="c"># Leave at 0 unless experiencing consistent lateral drift</span></pre></div>

  <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Rule of Thumb</div><div class="callout-text">In GPS path-following applications, D is almost always much larger than P. A ratio of D = 4 Ã— P is a common stable starting point. Do not tune to suppress oscillations purely by reducing P â€” that just makes the car slow to respond to curves.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§9 â€” Troubleshooting
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s9"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">09</span>
    <div class="sec-title-block">
      <h2>Troubleshooting &amp; Known Bugs</h2>
      <div class="sec-subtitle">Quick reference for the most common GPS and DonkeyCar failure modes</div>
    </div>
  </div>

  <h3>GPS &amp; Serial Port</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Root Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td><code>Permission denied: /dev/ttyUSB1</code></td><td>User not in <code>dialout</code> group</td><td><code>sudo adduser pi dialout &amp;&amp; sudo reboot</code></td></tr>
      <tr><td><code>[LLA=nan, nan, nan]</code> outdoors</td><td>GPS antenna obstructed or RTK stream dropped</td><td>Check Terminal 1 is connected to Polaris; re-seat SMA connector on antenna</td></tr>
      <tr><td><code>serial.SerialException: [Errno 2] No such file</code></td><td>Wrong port number (USB0 vs USB1)</td><td>Run <code>ls /dev/ttyUSB*</code> and update <code>--device-port</code> in runner or <code>GPS_SERIAL</code> in config</td></tr>
      <tr><td>GPS coordinates not updating (frozen)</td><td>Runner silently crashed</td><td>Check Terminal 1 for error messages; restart runner</td></tr>
      <tr><td>Polaris authentication fails</td><td>Wrong username/password pair</td><td>Cross-check credentials table in Â§4; each robot has a unique pair</td></tr>
    </tbody>
  </table></div>

  <h3>DonkeyCar &amp; Path Recording</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Root Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td><code>manage.py drive</code> exits immediately</td><td>Missing HAVE_GPS or wrong DRIVE_TRAIN_TYPE in myconfig.py</td><td>Verify all settings in Â§5; check for typos in variable names</td></tr>
      <tr><td>Path CSV is empty after recording</td><td>TOGGLE_RECORDING_BTN not pressed, or GPS had no fix</td><td>Confirm green "recording" output in terminal; ensure Terminal 1 shows valid LLA</td></tr>
      <tr><td>Car ignores path during autonomous mode</td><td>Origin not reset before playback; path loaded before reset</td><td>Always press B (Reset Origin) BEFORE pressing X (Load Path)</td></tr>
      <tr><td>VESC not responding â€” car doesn't move</td><td>Wrong serial port for VESC, or VESC not powered</td><td>Run <code>ls /dev/ttyACM*</code>; confirm VESC ESC LED is solid green</td></tr>
      <tr><td>Controller buttons don't work</td><td>Wrong CONTROLLER_TYPE or js device number</td><td>Run <code>ls /dev/input/js*</code> and test with <code>jstest /dev/input/js0</code></td></tr>
      <tr><td>Car drifts sideways even on straight path</td><td>Steering offset wrong or wheel sizes unequal</td><td>Adjust <code>VESC_STEERING_OFFSET</code> by Â±0.02; add small PID_I value</td></tr>
    </tbody>
  </table></div>

  <h3>Environment &amp; Python</h3>
  <div class="tw"><table>
    <thead><tr><th>Error</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td><code>ModuleNotFoundError: No module named 'fusion_engine_client'</code></td><td>py37 env not activated. Run <code>conda activate py37</code> and <code>source ~/env/bin/activate</code></td></tr>
      <tr><td><code>mamba: command not found</code> after reboot</td><td>Conda init not added to .bashrc. Run <code>conda init bash &amp;&amp; source ~/.bashrc</code></td></tr>
      <tr><td><code>config_tool.py</code> says device busy</td><td>Another process holds the serial port open</td><td>Close all other terminals that may be using the GPS port; reboot if needed</td></tr>
      <tr><td>Miniforge installer fails with wrong architecture</td><td>32-bit Pi OS vs 64-bit installer URL</td><td>Check <code>uname -m</code>; download matching installer from Miniforge releases page</td></tr>
    </tbody>
  </table></div>

  <h3>WiFi &amp; RTK Accuracy</h3>
  <div class="tw"><table>
    <thead><tr><th>Symptom</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>GPS accuracy degrades from cm to meters mid-run</td><td>WiFi extender lost connection to campus network â€” reposition antenna to face EBU2, check ALLWEI battery charge</td></tr>
      <tr><td>RTK connection drops repeatedly</td><td>Campus firewall blocking Polaris port â€” try connecting from a mobile hotspot to isolate the issue</td></tr>
      <tr><td>GPS jumps several meters suddenly</td><td>Multipath reflection from nearby building â€” move the car away from walls and run in the open Warren Mall area</td></tr>
    </tbody>
  </table></div>

  <div class="divider"></div>
  <p style="text-align:center; font-size:13px;">UCSD Jacobs School of Engineering â€” ECE/MAE 148 Intro to Autonomous Vehicles</p>
</section>

</div><!-- /content -->
</div><!-- /main -->
</main><!-- /layout -->

<button id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">â†‘</button>

<script>
// â”€â”€ COPY BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doCopy(btn) {
  const pre = btn.closest('.cb').querySelector('pre');
  const text = pre.innerText;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'COPIED âœ“';
    btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    btn.textContent = 'COPIED âœ“'; btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  });
}

// â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const btt = document.getElementById('btt');
window.addEventListener('scroll', () => {
  btt.classList.toggle('show', window.scrollY > 500);
});

// â”€â”€ READ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const progressFill = document.getElementById('read-progress-fill');
const npFill = document.getElementById('np-fill');
const npPct = document.getElementById('np-pct');
window.addEventListener('scroll', () => {
  const docH = document.documentElement.scrollHeight - window.innerHeight;
  const pct = Math.min(100, Math.round((window.scrollY / docH) * 100));
  progressFill.style.width = pct + '%';
  npFill.style.width = pct + '%';
  npPct.textContent = pct + '%';
});

// â”€â”€ ACTIVE NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const anchors = document.querySelectorAll('.section-anchor[id]');
const navLinks = document.querySelectorAll('.nav-link');
const io = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      navLinks.forEach(l => l.classList.remove('active'));
      const a = document.querySelector(`.nav-link[href="#${e.target.id}"]`);
      if (a) a.classList.add('active');
    }
  });
}, { rootMargin: '-60px 0px -80% 0px' });
anchors.forEach(a => io.observe(a));

// â”€â”€ NAV SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterNav(q) {
  const term = q.toLowerCase();
  document.querySelectorAll('.nav-link').forEach(l => {
    l.style.display = l.textContent.toLowerCase().includes(term) ? '' : 'none';
  });
  document.querySelectorAll('.nav-group-label').forEach(g => {
    let next = g.nextElementSibling;
    let hasVisible = false;
    while (next && !next.classList.contains('nav-group-label')) {
      if (next.style.display !== 'none') hasVisible = true;
      next = next.nextElementSibling;
    }
    g.style.display = hasVisible ? '' : 'none';
  });
}

// â”€â”€ MOBILE MENU CLOSE ON LINK CLICK â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.nav-link').forEach(l => {
  l.addEventListener('click', () => {
    document.getElementById('sidebar').classList.remove('open');
  });
});
</script>
</body>
</html>
