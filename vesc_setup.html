<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ECE/MAE 148 ‚Äî UCSD VESC Setup & Motor Calibration Guide</title>
<meta name="description" content="Complete VESC setup, firmware update, FOC motor detection, hall sensor calibration and servo steering guide for the UCSD Robocar used in ECE/MAE 148.">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --ucsd-navy:    #002E6D;
  --ucsd-blue:    #00629B;
  --ucsd-gold:    #C69214;
  --ucsd-gold-lt: #E8B931;
  --bg:           #09111E;
  --bg2:          #0D1A2D;
  --surface:      #111F35;
  --surface2:     #162643;
  --surface3:     #1C2F50;
  --border:       #1E3355;
  --border-lt:    #2A4670;
  --text:         #DCE8F5;
  --text-muted:   #7A9EC4;
  --text-dim:     #4D6E96;
  --accent:       #00A8E8;
  --accent-glow:  rgba(0,168,232,0.15);
  --gold-glow:    rgba(198,146,20,0.18);
  --green:        #00C896;
  --yellow:       #F0B429;
  --red:          #F04E37;
  --purple:       #9B7FE8;
  --code-bg:      #060E1A;
  --code-border:  #1A2E4A;
  --sidebar-w:    290px;
  --topbar-h:     60px;
  --r:            6px;
  --font-body:    'Sora', sans-serif;
  --font-mono:    'IBM Plex Mono', monospace;
  --ease:         cubic-bezier(0.4,0,0.2,1);
}

*,*::before,*::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 15px; scroll-behavior: smooth; scroll-padding-top: calc(var(--topbar-h) + 20px); }
body { font-family: var(--font-body); background: var(--bg); color: var(--text); line-height: 1.7; min-height: 100vh; overflow-x: hidden; }

body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    linear-gradient(rgba(0,98,155,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,98,155,0.04) 1px, transparent 1px);
  background-size: 40px 40px;
}

.topbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 200;
  height: var(--topbar-h);
  background: rgba(9,17,30,0.95);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(16px);
  display: flex; align-items: center;
  padding: 0 0 0 var(--sidebar-w);
}
.topbar-inner { display: flex; align-items: center; gap: 16px; padding: 0 32px; width: 100%; }
.topbar-brand { display: flex; align-items: center; gap: 12px; text-decoration: none; flex-shrink: 0; }
.topbar-emblem {
  width: 36px; height: 36px; background: var(--ucsd-navy);
  border: 2px solid var(--ucsd-gold); border-radius: 8px;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.topbar-emblem svg { width: 20px; height: 20px; }
.topbar-name { font-size: 15px; font-weight: 700; color: var(--text); letter-spacing: -0.3px; }
.topbar-course { font-size: 11px; color: var(--text-muted); font-family: var(--font-mono); }
.topbar-divider { width: 1px; height: 28px; background: var(--border); flex-shrink: 0; }
.topbar-breadcrumb { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }
.topbar-spacer { flex: 1; }

.page-switcher {
  display: flex; align-items: center; gap: 2px;
  background: var(--surface); border: 1px solid var(--border-lt);
  border-radius: 20px; padding: 3px; flex-shrink: 0;
}
.ps-link {
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  padding: 4px 14px; border-radius: 16px; letter-spacing: 0.4px;
  text-decoration: none; color: var(--text-muted);
  transition: all 0.15s var(--ease);
}
.ps-link:hover { color: var(--text); background: rgba(255,255,255,0.06); }
.ps-link.active { background: var(--ucsd-gold); color: var(--bg); }
@media (max-width: 768px) { .page-switcher { display: none; } }
#menu-toggle {
  display: none; background: none; border: 1px solid var(--border);
  color: var(--text-muted); padding: 6px 10px; border-radius: var(--r);
  cursor: pointer; font-size: 16px; flex-shrink: 0;
}

.sidebar {
  position: fixed; top: 0; left: 0; bottom: 0; z-index: 150;
  width: var(--sidebar-w); background: var(--bg2);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column; overflow: hidden;
}
.sidebar-header {
  padding: 16px 20px; border-bottom: 1px solid var(--border);
  background: var(--ucsd-navy); flex-shrink: 0;
}
.sidebar-logo-row { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
.sidebar-logo {
  width: 32px; height: 32px; border-radius: 6px;
  background: rgba(198,146,20,0.2); border: 1.5px solid var(--ucsd-gold);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono); font-size: 12px; font-weight: 600; color: var(--ucsd-gold);
}
.sidebar-title { font-size: 13px; font-weight: 700; color: #fff; }
.sidebar-sub { font-size: 10px; color: rgba(255,255,255,0.5); font-family: var(--font-mono); margin-top: 2px; }
.sidebar-search { margin: 12px 16px; position: relative; flex-shrink: 0; }
.sidebar-search input {
  width: 100%; padding: 8px 12px 8px 32px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--r); color: var(--text); font-family: var(--font-body);
  font-size: 12px; outline: none;
}
.sidebar-search input::placeholder { color: var(--text-dim); }
.sidebar-search input:focus { border-color: var(--border-lt); }
.sidebar-search-icon {
  position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
  color: var(--text-dim); font-size: 13px; pointer-events: none;
}
.nav-scroll { overflow-y: auto; flex: 1; padding-bottom: 40px; }
.nav-scroll::-webkit-scrollbar { width: 3px; }
.nav-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
.nav-group-label {
  font-family: var(--font-mono); font-size: 9px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1.8px;
  color: var(--text-dim); padding: 16px 20px 6px;
  display: flex; align-items: center; gap: 8px;
}
.nav-group-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.nav-link {
  display: flex; align-items: center; gap: 10px;
  padding: 7px 20px; text-decoration: none; color: var(--text-muted); font-size: 12.5px;
  border-left: 2px solid transparent; transition: all 0.15s var(--ease);
}
.nav-link .nl-num {
  font-family: var(--font-mono); font-size: 9px; color: var(--text-dim);
  background: var(--surface); border: 1px solid var(--border);
  padding: 1px 5px; border-radius: 3px; flex-shrink: 0;
}
.nav-link:hover { color: var(--text); background: rgba(255,255,255,0.03); border-left-color: var(--border-lt); }
.nav-link.active { color: var(--ucsd-gold-lt); border-left-color: var(--ucsd-gold); background: var(--gold-glow); }
.nav-link.active .nl-num { background: rgba(198,146,20,0.2); border-color: rgba(198,146,20,0.3); color: var(--ucsd-gold); }
.nav-progress { padding: 12px 20px; border-top: 1px solid var(--border); flex-shrink: 0; }
.np-label { font-family: var(--font-mono); font-size: 10px; color: var(--text-dim); margin-bottom: 6px; display: flex; justify-content: space-between; }
.np-bar { height: 3px; background: var(--border); border-radius: 3px; overflow: hidden; }
.np-fill { height: 100%; background: linear-gradient(90deg, var(--ucsd-gold), var(--ucsd-gold-lt)); border-radius: 3px; width: 0%; transition: width 0.4s var(--ease); }

.layout { display: flex; padding-top: var(--topbar-h); min-height: 100vh; }
.main { margin-left: var(--sidebar-w); flex: 1; min-width: 0; position: relative; z-index: 1; }

.hero {
  background:
    radial-gradient(ellipse 80% 100% at 100% 50%, rgba(0,98,155,0.25), transparent),
    radial-gradient(ellipse 50% 80% at 0% 0%, rgba(198,146,20,0.08), transparent),
    linear-gradient(180deg, var(--bg2) 0%, var(--bg) 100%);
  border-bottom: 1px solid var(--border);
  padding: 72px 80px 60px; position: relative; overflow: hidden;
}
.hero::before {
  content: ''; position: absolute; top: -40px; right: -40px;
  width: 400px; height: 400px; border-radius: 50%;
  background: radial-gradient(circle, rgba(0,168,232,0.07), transparent 70%);
  pointer-events: none;
}
.hero-eyebrow {
  display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px;
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); letter-spacing: 1px;
  background: var(--gold-glow); border: 1px solid rgba(198,146,20,0.3);
  padding: 5px 14px; border-radius: 20px;
}
.hero-eyebrow-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ucsd-gold); }
.hero h1 { font-size: clamp(32px, 4.5vw, 56px); font-weight: 800; line-height: 1.08; letter-spacing: -1.5px; margin-bottom: 20px; color: var(--text); }
.hero h1 span { color: var(--ucsd-gold); }
.hero-desc { font-size: 16px; color: var(--text-muted); max-width: 640px; line-height: 1.65; margin-bottom: 36px; }
.hero-chips { display: flex; flex-wrap: wrap; gap: 10px; }
.hero-chip {
  display: inline-flex; align-items: center; gap: 7px;
  background: var(--surface); border: 1px solid var(--border-lt);
  color: var(--text-muted); font-size: 12px; font-family: var(--font-mono);
  padding: 6px 14px; border-radius: 20px;
}
.hero-chip-icon { font-size: 14px; }

.content { padding: 0 80px 80px; }

.section { padding-top: 64px; }
.section-anchor {
  display: block;
  visibility: hidden;
  height: 0;
  margin-top: calc(-1 * (var(--topbar-h) + 24px));
  padding-top: calc(var(--topbar-h) + 24px);
}
.sec-header {
  display: flex; align-items: flex-start; gap: 20px;
  margin-bottom: 28px; padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}
.sec-num {
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); background: var(--gold-glow);
  border: 1px solid rgba(198,146,20,0.3);
  padding: 4px 12px; border-radius: 20px; flex-shrink: 0; margin-top: 4px;
}
.sec-title-block { flex: 1; }
.sec-title-block h2 { font-size: 24px; font-weight: 700; color: var(--text); letter-spacing: -0.5px; line-height: 1.2; }
.sec-title-block .sec-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
.sec-badges { display: flex; gap: 6px; margin-left: auto; flex-shrink: 0; align-items: center; }

h3 { font-size: 15px; font-weight: 600; color: var(--accent); margin: 28px 0 10px; letter-spacing: -0.2px; }
h4 { font-size: 13px; font-weight: 600; color: var(--text-muted); margin: 18px 0 8px; text-transform: uppercase; letter-spacing: 0.5px; }
p { color: var(--text-muted); margin-bottom: 14px; font-size: 14px; line-height: 1.75; }
p strong { color: var(--text); font-weight: 600; }
p code, li code {
  font-family: var(--font-mono); font-size: 12px;
  background: rgba(0,168,232,0.1); color: var(--accent);
  padding: 1px 5px; border-radius: 3px;
}

.badge { font-family: var(--font-mono); font-size: 9px; font-weight: 700; padding: 3px 9px; border-radius: 3px; letter-spacing: 0.8px; text-transform: uppercase; }
.badge-new    { background: rgba(155,127,232,0.2); color: var(--purple); border: 1px solid rgba(155,127,232,0.3); }
.badge-fix    { background: rgba(0,200,150,0.15); color: var(--green); border: 1px solid rgba(0,200,150,0.3); }
.badge-warn   { background: rgba(240,78,55,0.15); color: var(--red); border: 1px solid rgba(240,78,55,0.3); }
.badge-critical { background: rgba(240,78,55,0.2); color: #ff7b6e; border: 1px solid rgba(240,78,55,0.4); }

.callout { display: flex; gap: 14px; padding: 16px 18px; border-radius: var(--r); margin: 16px 0; border: 1px solid; font-size: 13.5px; }
.callout-icon { font-size: 16px; flex-shrink: 0; line-height: 1.4; }
.callout-body { flex: 1; min-width: 0; }
.callout-title { font-size: 11px; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; margin-bottom: 5px; }
.callout-text { color: var(--text-muted); line-height: 1.65; }
.callout-text code { font-family: var(--font-mono); font-size: 11.5px; background: rgba(255,255,255,0.07); color: var(--text); padding: 1px 5px; border-radius: 3px; }
.callout.info  { background: rgba(0,168,232,0.07); border-color: rgba(0,168,232,0.25); }
.callout.info  .callout-title { color: var(--accent); }
.callout.warn  { background: rgba(240,180,41,0.07); border-color: rgba(240,180,41,0.28); }
.callout.warn  .callout-title { color: var(--yellow); }
.callout.tip   { background: rgba(0,200,150,0.07); border-color: rgba(0,200,150,0.25); }
.callout.tip   .callout-title { color: var(--green); }
.callout.error { background: rgba(240,78,55,0.07); border-color: rgba(240,78,55,0.28); }
.callout.error .callout-title { color: var(--red); }
.callout.new   { background: rgba(155,127,232,0.07); border-color: rgba(155,127,232,0.28); }
.callout.new   .callout-title { color: var(--purple); }

.cb { background: var(--code-bg); border: 1px solid var(--code-border); border-radius: var(--r); margin: 12px 0; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
.cb-header { display: flex; align-items: center; justify-content: space-between; padding: 9px 14px; background: var(--surface); border-bottom: 1px solid var(--code-border); }
.cb-label { font-family: var(--font-mono); font-size: 10.5px; color: var(--text-dim); display: flex; align-items: center; gap: 8px; }
.cb-label::before { content: ''; display: inline-block; width: 7px; height: 7px; border-radius: 50%; background: var(--ucsd-gold); opacity: 0.7; }
.copy-btn { font-family: var(--font-mono); font-size: 9.5px; font-weight: 600; background: var(--surface2); border: 1px solid var(--border-lt); color: var(--text-dim); padding: 4px 12px; border-radius: 4px; cursor: pointer; transition: all 0.15s var(--ease); letter-spacing: 0.5px; }
.copy-btn:hover { background: var(--border); color: var(--text); }
.copy-btn.ok { color: var(--green); border-color: rgba(0,200,150,0.4); }
pre { padding: 18px 20px; overflow-x: auto; font-family: var(--font-mono); font-size: 12.5px; line-height: 1.7; tab-size: 2; color: #C9D8EC; }
pre::-webkit-scrollbar { height: 3px; }
pre::-webkit-scrollbar-thumb { background: var(--border); }
.k  { color: #6BBFFF; }
.s  { color: #A8D8B9; }
.c  { color: #4D6E96; font-style: italic; }
.f  { color: #BFA0F4; }
.v  { color: #F0B429; }
.ok { color: #00C896; }
.er { color: #F04E37; }

.steps { display: flex; flex-direction: column; gap: 14px; margin: 16px 0; }
.step { display: flex; gap: 18px; padding: 20px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); transition: border-color 0.15s var(--ease); }
.step:hover { border-color: var(--border-lt); }
.step-num { width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0; background: var(--gold-glow); border: 1.5px solid rgba(198,146,20,0.45); color: var(--ucsd-gold); font-family: var(--font-mono); font-size: 11px; font-weight: 700; display: flex; align-items: center; justify-content: center; }
.step-body { flex: 1; min-width: 0; }
.step-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.step-desc { font-size: 13px; color: var(--text-muted); line-height: 1.65; margin-bottom: 8px; }
.step-desc:last-child { margin-bottom: 0; }

.tw { overflow-x: auto; margin: 14px 0; border-radius: var(--r); border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead tr { background: var(--surface2); }
th { text-align: left; padding: 11px 16px; font-family: var(--font-mono); font-size: 10px; font-weight: 600; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; border-bottom: 1px solid var(--border); }
td { padding: 11px 16px; border-bottom: 1px solid var(--border); color: var(--text-muted); vertical-align: top; font-size: 13px; line-height: 1.6; }
td code { font-family: var(--font-mono); font-size: 11.5px; color: var(--accent); background: rgba(0,168,232,0.08); padding: 1px 6px; border-radius: 3px; }
td strong { color: var(--text); }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: rgba(255,255,255,0.015); }

/* ‚îÄ‚îÄ FIGURE / SCREENSHOT STYLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
figure { margin: 20px 0; border-radius: var(--r); overflow: hidden; border: 1px solid var(--border); background: var(--surface); box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
.fig-wrap { background: var(--surface2); display: flex; align-items: center; justify-content: center; padding: 16px; min-height: 100px; }
.fig-wrap img { max-width: 100%; height: auto; display: block; border-radius: 4px; }
figcaption { padding: 10px 16px; font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); border-top: 1px solid var(--border); display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.fig-label { color: var(--ucsd-gold); font-weight: 600; }
.fig-key { margin-left: auto; background: var(--surface2); border: 1px solid var(--border); padding: 2px 8px; border-radius: 3px; font-size: 10px; color: var(--text-dim); white-space: nowrap; }

/* Placeholder box shown when image src is not yet set */
.img-ph {
  width: 100%; min-height: 130px;
  background: var(--surface3);
  border: 2px dashed var(--border-lt);
  border-radius: 4px;
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 8px; padding: 24px 16px;
  color: var(--text-dim);
  font-family: var(--font-mono); font-size: 11px;
  text-align: center;
}
.img-ph.visible { display: flex; }
.img-ph-icon { font-size: 28px; opacity: 0.5; }
.img-ph-label { color: var(--ucsd-gold); font-weight: 600; font-size: 10px; letter-spacing: 0.8px; text-transform: uppercase; }
.img-ph-desc { color: var(--text-dim); font-size: 10px; line-height: 1.5; max-width: 400px; }

/* Screenshot groups (side by side small screenshots) */
.fig-row { display: flex; gap: 12px; margin: 20px 0; flex-wrap: wrap; }
.fig-row figure { flex: 1; min-width: 200px; margin: 0; }

.divider { height: 1px; background: var(--border); margin: 48px 0; }

#btt { position: fixed; bottom: 28px; right: 28px; z-index: 190; width: 42px; height: 42px; border-radius: 50%; background: var(--surface2); border: 1px solid var(--border-lt); color: var(--text-muted); font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; transition: all 0.2s var(--ease); pointer-events: none; box-shadow: 0 4px 16px rgba(0,0,0,0.4); }
#btt.show { opacity: 1; pointer-events: auto; }
#btt:hover { background: var(--ucsd-gold); color: var(--bg); border-color: var(--ucsd-gold); transform: translateY(-2px); }

#read-progress { position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 2px; z-index: 300; background: transparent; }
#read-progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--ucsd-navy), var(--ucsd-gold)); transition: width 0.1s linear; }

@media (max-width: 1024px) { .hero { padding: 48px 40px 40px; } .content { padding: 0 40px 60px; } }
@media (max-width: 768px) {
  #menu-toggle { display: flex; }
  .sidebar { transform: translateX(-100%); transition: transform 0.25s var(--ease); top: var(--topbar-h); }
  .sidebar.open { transform: translateX(0); }
  .topbar { padding-left: 0; }
  .main { margin-left: 0; }
  .hero { padding: 32px 20px 28px; }
  .content { padding: 0 20px 48px; }
  #read-progress { left: 0; }
  .fig-row { flex-direction: column; }
}
</style>
</head>
<body>

<div id="read-progress"><div id="read-progress-fill"></div></div>

<header class="topbar">
  <div class="topbar-inner">
    <a href="#hero" class="topbar-brand">
      <div class="topbar-emblem">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="5" stroke="#C69214" stroke-width="2"/>
          <path d="M12 3v3M12 18v3M3 12h3M18 12h3" stroke="#C69214" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="12" r="2" fill="#C69214"/>
        </svg>
      </div>
      <div>
        <div class="topbar-name">UCSD Robocar</div>
        <div class="topbar-course">ECE / MAE 148</div>
      </div>
    </a>
    <div class="topbar-divider"></div>
    <span class="topbar-breadcrumb">VESC Setup & Motor Calibration</span>
    <div class="topbar-spacer"></div>
    <div class="page-switcher">
      <a href="./index.html" class="ps-link">ROS Setup</a>
      <a href="./vesc_setup.html" class="ps-link active">VESC Setup</a>
      <a href="./gps_laps.html" class="ps-link">GPS Laps</a>
      <a href="./donkeycar.html" class="ps-link">DonkeyCar</a>
      <a href="./rpi_setup.html" class="ps-link">RPI Setup</a>
    </div>
    <button id="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">&#9776;</button>
  </div>
</header>

<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo-row">
      <div class="sidebar-logo">V6</div>
      <div>
        <div class="sidebar-title">VESC Docs</div>
        <div class="sidebar-sub">ECE/MAE 148 ¬∑ UCSD</div>
      </div>
    </div>
  </div>

  <div class="sidebar-search">
    <span class="sidebar-search-icon">‚åï</span>
    <input type="text" placeholder="Search sections‚Ä¶" id="nav-search" oninput="filterNav(this.value)">
  </div>

  <div class="nav-scroll" id="nav-scroll">
    <div class="nav-group-label">Prerequisites</div>
    <a class="nav-link" href="#s1"><span class="nl-num">01</span>Overview & Safety</a>
    <a class="nav-link" href="#s2"><span class="nl-num">02</span>Required Hardware</a>
    <a class="nav-link" href="#s3"><span class="nl-num">03</span>Install VESC Tool</a>

    <div class="nav-group-label">Firmware</div>
    <a class="nav-link" href="#s4"><span class="nl-num">04</span>Connect VESC</a>
    <a class="nav-link" href="#s5"><span class="nl-num">05</span>Firmware (VESC 6.x)</a>
    <a class="nav-link" href="#s6"><span class="nl-num">06</span>Firmware (VESC 4.x Legacy)</a>

    <div class="nav-group-label">Motor Detection</div>
    <a class="nav-link" href="#s7"><span class="nl-num">07</span>Cable Connections</a>
    <a class="nav-link" href="#s8"><span class="nl-num">08</span>FOC Wizard Setup</a>
    <a class="nav-link" href="#s9"><span class="nl-num">09</span>Battery Config</a>
    <a class="nav-link" href="#s10"><span class="nl-num">10</span>Motor Parameters</a>
    <a class="nav-link" href="#s11"><span class="nl-num">11</span>Run Detection & Direction</a>

    <div class="nav-group-label">Calibration</div>
    <a class="nav-link" href="#s12"><span class="nl-num">12</span>Hall Sensor Detection</a>
    <a class="nav-link" href="#s13"><span class="nl-num">13</span>Enable Servo Steering</a>
    <a class="nav-link" href="#s14"><span class="nl-num">14</span>Troubleshooting</a>
  </div>

  <div class="nav-progress">
    <div class="np-label"><span>Reading Progress</span><span id="np-pct">0%</span></div>
    <div class="np-bar"><div class="np-fill" id="np-fill"></div></div>
  </div>
</nav>

<main class="layout">
<div class="main">

<div class="hero" id="hero">
  <div class="hero-eyebrow"><div class="hero-eyebrow-dot"></div>UCSD Jacobs School of Engineering</div>
  <h1>VESC Setup &<br><span>Motor Calibration</span></h1>
  <p class="hero-desc">Complete reference for ECE/MAE 148 ‚Äî covering VESC Tool installation, firmware updates for VESC 6.x and 4.x hardware, FOC motor detection, hall sensor calibration, battery configuration, and servo steering setup for autonomous RC cars.</p>
  <div class="hero-chips">
    <div class="hero-chip"><span class="hero-chip-icon">‚ö°</span>VESC 6.x / EDU</div>
    <div class="hero-chip"><span class="hero-chip-icon">üîß</span>VESC Tool</div>
    <div class="hero-chip"><span class="hero-chip-icon">üöó</span>BLDC Motor</div>
    <div class="hero-chip"><span class="hero-chip-icon">üîã</span>LiPO Battery</div>
  </div>
</div>

<div class="content">

<!-- ¬ß1 ‚Äî Overview & Safety -->
<div class="section-anchor" id="s1"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">01</span>
    <div class="sec-title-block">
      <h2>Overview & Safety</h2>
      <div class="sec-subtitle">Read this before touching any hardware</div>
    </div>
    <div class="sec-badges"><span class="badge badge-critical">CRITICAL</span></div>
  </div>

  <p>The VESC (Vedder Electronic Speed Controller) is the motor driver used in all ECE/MAE 148 robots. It controls the BLDC (Brushless DC) drive motor and the servo motor used for steering. Before beginning setup, you must understand the hardware variants and safety requirements ‚Äî choosing the wrong firmware version can permanently damage your VESC.</p>

  <div class="callout error">
    <div class="callout-icon">üõë</div>
    <div class="callout-body">
      <div class="callout-title">STAND REQUIREMENT ‚Äî WHEELS MUST BE CLEAR</div>
      <div class="callout-text">Place the robot on the class-provided stand before connecting anything. The drive wheels <strong>will spin during motor detection</strong> ‚Äî they must be completely clear of any surfaces, cables, your laptop, and your hands. This is not optional. Failure to use the stand can result in injury or damaged hardware. This warning appears multiple times in this guide intentionally.</div>
    </div>
  </div>

  <div class="callout warn">
    <div class="callout-icon">‚ö†</div>
    <div class="callout-body">
      <div class="callout-title">DO NOT Disconnect During Firmware Update</div>
      <div class="callout-text">Never remove power or the USB cable from the VESC while firmware is uploading. Doing so will almost certainly brick the VESC, requiring a programmer to recover it. Wait for the "Upload done" confirmation before touching any cables.</div>
    </div>
  </div>

  <h3>VESC Hardware Versions in This Class</h3>
  <div class="tw"><table>
    <thead><tr><th>Hardware</th><th>Identifier in VESC Tool</th><th>Firmware Track</th><th>Notes</th></tr></thead>
    <tbody>
      <tr><td><strong>VESC 6 EDU</strong></td><td><code>Hw: EDU</code></td><td>v6.00 (VESC_default.bin)</td><td>Primary class hardware as of Fall 2022</td></tr>
      <tr><td><strong>Original VESC 6.x</strong></td><td><code>Hw: 60</code></td><td>v6.00 (VESC_default.bin)</td><td>Can upgrade to latest firmware</td></tr>
      <tr><td><strong>FLIPSKY FSESC 6.6</strong></td><td><code>Hw: 60</code> or similar</td><td>v6.00</td><td>VESC 6.x compatible, follow VESC 6 instructions</td></tr>
      <tr><td><strong>FLIPSKY FSESC 6.7</strong></td><td><code>Hw: 60</code> or similar</td><td>v6.00</td><td>VESC 6.x compatible, follow VESC 6 instructions</td></tr>
      <tr><td><strong>VESC 4.12 / FLIPSKY Mini FSESC4.2</strong></td><td><code>Hw: 412</code></td><td>v4.2 (VESC_servoout.bin)</td><td>Legacy. Use VESC Tool v2.03 only. Do NOT upgrade firmware.</td></tr>
    </tbody>
  </table></div>

  <div class="callout info">
    <div class="callout-icon">‚Ñπ</div>
    <div class="callout-body">
      <div class="callout-title">Which Hardware Do You Have?</div>
      <div class="callout-text">Look at the physical board label, or connect with VESC Tool and read the hardware version shown in the bottom status bar and the Firmware section. If you see <code>Hw: EDU</code> or <code>Hw: 60</code>, follow the VESC 6.x instructions (Sections 4‚Äì5). If you see <code>Hw: 412</code>, follow the legacy VESC 4.x instructions (Section 6).</div>
    </div>
  </div>
</section>

<!-- ¬ß2 ‚Äî Required Hardware -->
<div class="section-anchor" id="s2"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">02</span>
    <div class="sec-title-block">
      <h2>Required Hardware</h2>
      <div class="sec-subtitle">Everything you need before starting</div>
    </div>
  </div>

  <p>Gather all hardware listed below before starting. Using the wrong battery or cable during firmware update will damage the VESC.</p>

  <div class="tw"><table>
    <thead><tr><th>Item</th><th>Specification</th><th>Why It's Needed</th></tr></thead>
    <tbody>
      <tr><td><strong>RC Car Battery (LiPO/LiIon)</strong></td><td>3S or 4S depending on your robot ‚Äî ECE/MAE 148 uses 3S (3-cell, 3Ah) by default</td><td>The VESC must be powered by the same battery you plan to use in operation. Using a different power source produces incorrect motor calibration values.</td></tr>
      <tr><td><strong>LiPO Battery Alarm</strong></td><td>Matches your battery cell count</td><td>Protects the battery from over-discharge during the motor detection spin cycle, which can run for several seconds.</td></tr>
      <tr><td><strong>Micro-USB Cable (long)</strong></td><td>At least 1 m recommended</td><td>Connects VESC to your host PC. Must be long enough that the PC stays away from the spinning wheels. Ask a TA if you need a longer cable.</td></tr>
      <tr><td><strong>Host PC</strong></td><td>Windows / macOS / Linux with USB port</td><td>Runs VESC Tool for firmware update and configuration. Not the Raspberry Pi ‚Äî use your laptop.</td></tr>
      <tr><td><strong>Class-provided robot stand</strong></td><td>Lifts all four wheels off the ground</td><td>Wheels spin freely during motor detection. The stand prevents the robot from driving off the table.</td></tr>
      <tr><td><strong>BLDC drive motor</strong></td><td>Sensored (hall sensor connector)</td><td>The class uses sensored BLDC motors for precise low-speed control.</td></tr>
      <tr><td><strong>Steering servo motor</strong></td><td>Standard RC servo (PWM)</td><td>Controlled via VESC's PWM servo output.</td></tr>
    </tbody>
  </table></div>
</section>

<!-- ¬ß3 ‚Äî Install VESC Tool -->
<div class="section-anchor" id="s3"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">03</span>
    <div class="sec-title-block">
      <h2>Install VESC Tool</h2>
      <div class="sec-subtitle">Use the class-provided version to ensure identical firmware across all robots</div>
    </div>
  </div>

  <p>The entire class uses the same version of VESC Tool to keep firmware versions consistent between robots. Using a different version may produce incompatible firmware builds.</p>

  <div class="callout warn">
    <div class="callout-icon">‚ö†</div>
    <div class="callout-body">
      <div class="callout-title">Use the Class-Provided VESC Tool</div>
      <div class="callout-text">When VESC Tool opens, it may prompt you to download a newer version. <strong>Dismiss this warning and do not upgrade</strong> unless you are using the class-provided version. The instructor provides a specific version that matches the firmware used on all class robots.</div>
    </div>
  </div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Download the Class-Provided VESC Tool</div>
        <div class="step-desc">Get the VESC Tool version specified by your instructor from the <strong>class Google Drive folder</strong> linked below. This folder contains the exact version used in class for both VESC 6.x and VESC 4.x hardware. You can also download manually using the direct link.</div>

        <div class="callout tip">
          <div class="callout-icon">üì•</div>
          <div class="callout-body">
            <div class="callout-title">Class VESC Tool ‚Äî Google Drive Download</div>
            <div class="callout-text">
              Download the class-provided VESC Tool from the shared Google Drive folder:<br><br>
              <a href="https://drive.google.com/drive/folders/1m_gqcIWwaCzV3y3raU1FFiEpCyf3rYPi?usp=sharing"
                 target="_blank" rel="noopener"
                 style="display:inline-flex;align-items:center;gap:8px;background:rgba(198,146,20,0.15);border:1px solid rgba(198,146,20,0.4);color:var(--ucsd-gold-lt);font-family:var(--font-mono);font-size:12px;font-weight:600;padding:8px 16px;border-radius:6px;text-decoration:none;letter-spacing:0.3px;transition:all 0.15s;">
                üîó &nbsp;Open VESC Tool Class Drive Folder
              </a>
            </div>
          </div>
        </div>

        <div class="cb"><div class="cb-header"><span class="cb-label">VESC Tool ‚Äî Direct Drive Link (copy &amp; paste)</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>https://drive.google.com/drive/folders/1m_gqcIWwaCzV3y3raU1FFiEpCyf3rYPi?usp=sharing
<span class="c"># Download the binary for your OS from this shared folder</span></pre></div>
        <div class="cb"><div class="cb-header"><span class="cb-label">VESC 4.x legacy ‚Äî pre-built VESC Tool v2.03 (fallback)</span></div><pre>https://github.com/rpasichnyk/vesc_tool/releases/tag/v2.03
<span class="c"># Download the binary for your OS from this release page</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Install and Launch VESC Tool</div>
        <div class="step-desc">On Windows, run the installer. On macOS, drag to Applications. On Linux, extract and run the AppImage. Launch the tool and dismiss any "newer version available" prompts.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig01_version_popup.png" alt="VESC Tool new version available popup">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig01_version_popup.png</div>
              <div class="img-ph-desc">PDF Page 1 ‚Äî VESC Tool popup: "A new version of VESC Tool is available. Go to http://vesc-project.com/ to download it and get all the latest features." with OK button.</div>
            </div>
          </div>
          <figcaption>
            <span class="fig-label">Fig 01</span>
            VESC Tool version warning ‚Äî click OK to dismiss, do NOT follow the upgrade link
            <span class="fig-key">PDF p.1</span>
          </figcaption>
        </figure>

        <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Dismiss Version Warnings</div><div class="callout-text">If you see a popup saying "A new version of VESC Tool is available", click OK to dismiss it. Do NOT click the link to download a new version unless instructed by the TA.</div></div></div>
      </div>
    </div>
  </div>
</section>

<!-- ¬ß4 ‚Äî Connect VESC -->
<div class="section-anchor" id="s4"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">04</span>
    <div class="sec-title-block">
      <h2>Connect the VESC to Your Host PC</h2>
      <div class="sec-subtitle">Power and USB setup before opening VESC Tool</div>
    </div>
  </div>

  <div class="callout error">
    <div class="callout-icon">üõë</div>
    <div class="callout-body">
      <div class="callout-title">Robot Must Be on the Stand</div>
      <div class="callout-text">Place the robot on the class-provided stand. All wheels must be completely clear to spin freely. Keep your laptop and hands away from the wheel path.</div>
    </div>
  </div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Disconnect the VESC from the Raspberry Pi</div>
        <div class="step-desc">If the VESC is currently plugged into the SBC (Single Board Computer / Raspberry Pi), unplug the USB cable from the SBC. For this procedure, the VESC must connect directly to your host (laptop) PC.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Connect the LiPO Battery Alarm</div>
        <div class="step-desc">Plug the LiPO battery alarm (balance plug connector) into the battery before connecting the battery to the VESC. This protects the battery from being over-discharged during the motor detection cycle.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Connect the Battery to the VESC</div>
        <div class="step-desc">Plug the RC car battery into the VESC's power input. Use the same battery you plan to use during robot operation ‚Äî the motor calibration values depend on supply voltage.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Connect VESC to Host PC via Micro-USB</div>
        <div class="step-desc">Plug the micro-USB cable into the VESC and the other end into your laptop. Use a cable long enough that your laptop is kept well clear of the wheels.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-body">
        <div class="step-title">Open VESC Tool and Connect</div>
        <div class="step-desc">Launch VESC Tool on your laptop. Click the connect icon (plug symbol) in the top-left toolbar, or go to the Connection panel, click SCAN, then click CONNECT on the detected device.</div>

        <div class="fig-row">
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig02a_connect_icon.png" alt="VESC Tool connect icon in toolbar">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig02a_connect_icon.png</div>
                <div class="img-ph-desc">PDF Page 2 ‚Äî VESC Tool connect icon (white plug icon in top-left toolbar)</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 02a</span> Connect icon in toolbar <span class="fig-key">PDF p.2</span></figcaption>
          </figure>
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig02b_connection_panel.png" alt="VESC Tool Connection panel with SCAN and CONNECT buttons">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig02b_connection_panel.png</div>
                <div class="img-ph-desc">PDF Page 2 ‚Äî Connection panel: HIDE / Devices Found / SCAN buttons, detected device "Serial STM32 /dev/tty.usbmodem3141" with CONNECT button</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 02b</span> Connection panel ‚Äî SCAN then CONNECT <span class="fig-key">PDF p.2</span></figcaption>
          </figure>
        </div>

        <div class="cb"><div class="cb-header"><span class="cb-label">VESC Tool connection flow</span></div><pre><span class="c">1. Click the plug/connect icon  OR</span>
<span class="c">2. Connection panel ‚Üí SCAN ‚Üí select your device ‚Üí CONNECT</span>

<span class="c"># Expected output in status bar:</span>
<span class="ok">Connected to VESC</span>   Fw: v6.00, Hw: EDU   <span class="c"># (example)</span></pre></div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig03_test_fw_warning.png" alt="VESC test firmware warning dialog">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig03_test_fw_warning.png</div>
              <div class="img-ph-desc">PDF Page 2 ‚Äî Warning dialog: "The connected VESC has test firmware, and this is not a test build of VESC Tool. You should update the firmware urgently, as this is not a safe situation." with OK button.</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 03</span> Test firmware warning ‚Äî dismiss with OK; VESC 6.x users proceed to update, VESC 4.x users do NOT update <span class="fig-key">PDF p.2</span></figcaption>
        </figure>

        <div class="callout info"><div class="callout-icon">‚Ñπ</div><div class="callout-body"><div class="callout-title">Firmware Version Warning at Connection</div><div class="callout-text">VESC Tool may display "The connected VESC has test firmware and this is not a test build of VESC Tool." This is expected for VESC 4.x devices. For VESC 6.x: dismiss and proceed to update. For VESC 4.x: dismiss and do NOT update.</div></div></div>
      </div>
    </div>
  </div>
</section>

<!-- ¬ß5 ‚Äî Firmware VESC 6.x -->
<div class="section-anchor" id="s5"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">05</span>
    <div class="sec-title-block">
      <h2>Firmware Update ‚Äî VESC 6.x</h2>
      <div class="sec-subtitle">Update to firmware v6.00 for all VESC 6.x hardware (EDU, original 6.x, FLIPSKY 6.6/6.7)</div>
    </div>
    <div class="sec-badges"><span class="badge badge-warn">VESC 6.x ONLY</span></div>
  </div>

  <p>After connecting, identify your hardware version in the Firmware panel. VESC 6.x devices (including VESC EDU) should be updated to firmware v6.00 using <code>VESC_default.bin</code>. The target firmware version as of 30 Dec 2022 is <strong>6.00</strong>.</p>

  <h3>How to Identify Your Hardware Version</h3>
  <p>When connected in VESC Tool, look at the bottom-left status area and the Firmware panel. You should see one of the following hardware identifiers:</p>
  <div class="tw"><table>
    <thead><tr><th>Hardware Shows</th><th>Firmware File</th><th>Action</th></tr></thead>
    <tbody>
      <tr><td><code>Hw: EDU</code></td><td>VESC_default.bin (EDU row)</td><td>Update to v6.00</td></tr>
      <tr><td><code>Hw: 60</code></td><td>VESC_default.bin (60 row)</td><td>Update to v6.00</td></tr>
      <tr><td><code>Hw: 412</code></td><td>VESC_servoout.bin (v4.2)</td><td>Skip to Section 6 ‚Äî do NOT update here</td></tr>
    </tbody>
  </table></div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Open the Firmware Panel</div>
        <div class="step-desc">In the VESC Tool left navigation, click <strong>Firmware</strong>. You will see a list of hardware versions and their associated firmware files. Find your hardware version in the list (EDU or 60).</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig04_sidebar_firmware.png" alt="VESC Tool sidebar showing Firmware menu item highlighted">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig04_sidebar_firmware.png</div>
              <div class="img-ph-desc">PDF Page 2 ‚Äî VESC Tool left sidebar: Connection, Firmware (highlighted in blue), VESC Packages</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 04</span> VESC Tool sidebar ‚Äî click Firmware to open the firmware panel <span class="fig-key">PDF p.2</span></figcaption>
        </figure>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Select Your Hardware Row and Click Update</div>
        <div class="step-desc">Select the row matching your hardware (e.g., EDU ‚Üí VESC_default.bin). Click the download arrow button labeled "Update firmware on the connected VESC". Do not click "‚Üì All" unless instructed.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig05_fw_hw60_row.png" alt="Firmware panel showing hardware version 60 row selected with VESC_default.bin">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig05_fw_hw60_row.png</div>
              <div class="img-ph-desc">PDF Page 2 ‚Äî Firmware list: Hardware Version column showing "60" highlighted in blue; Firmware column showing "VESC_default.bin"</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 05</span> Hardware version "60" row selected ‚Äî VESC_default.bin will be flashed (VESC EDU shows "EDU" row instead) <span class="fig-key">PDF p.2</span></figcaption>
        </figure>

        <div class="fig-row">
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig06_fw_toolbar_buttons.png" alt="VESC Tool firmware update toolbar buttons with Update firmware tooltip">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig06_fw_toolbar_buttons.png</div>
                <div class="img-ph-desc">PDF Page 3 ‚Äî Toolbar showing download arrow (‚Üì), "‚Üì All" button, CAN button; tooltip reads "Update firmware on the connected VESC"</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 06</span> Firmware update buttons ‚Äî click the single ‚Üì arrow (not ‚Üì All) <span class="fig-key">PDF p.3</span></figcaption>
          </figure>
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig07_download_button.png" alt="Large download arrow button in VESC Tool">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig07_download_button.png</div>
                <div class="img-ph-desc">PDF Page 3 ‚Äî Large download arrow button (dark square with white downward arrow icon)</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 07</span> The download/flash button ‚Äî click to begin firmware upload <span class="fig-key">PDF p.3</span></figcaption>
          </figure>
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Confirm the Firmware Overwrite Warning</div>
        <div class="step-desc">A dialog appears: "Uploading new firmware will clear all settings in the VESC firmware and you have to do the configuration again. Do you want to continue?" Click <strong>YES</strong>. All settings are cleared ‚Äî this is expected and you will reconfigure them in the motor detection steps.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig08_overwrite_dialog.png" alt="Firmware overwrite confirmation dialog with No and Yes buttons">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig08_overwrite_dialog.png</div>
              <div class="img-ph-desc">PDF Page 3 ‚Äî Dialog: "Uploading new firmware will clear all settings in the VESC firmware and you have to do the configuration again. Do you want to continue?" with No / Yes buttons</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 08</span> Firmware overwrite confirmation ‚Äî click YES <span class="fig-key">PDF p.3</span></figcaption>
        </figure>

        <div class="callout error"><div class="callout-icon">üõë</div><div class="callout-body"><div class="callout-title">DO NOT Disconnect During Upload</div><div class="callout-text">After clicking YES, do not disconnect power or the USB cable until you see "Upload done" in the status bar. The VESC will automatically reboot within 10 seconds after the upload. Do not touch anything until the reboot completes.</div></div></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Verify Successful Upload</div>
        <div class="step-desc">After the VESC reboots, reconnect in VESC Tool. The status bar should show the new firmware version. For VESC EDU, you will see <code>Fw: v6.00, Hw: EDU</code>.</div>

        <div class="fig-row">
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig09a_upload_done_dialog.png" alt="Firmware upload done dialog box">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig09a_upload_done_dialog.png</div>
                <div class="img-ph-desc">PDF Page 4 ‚Äî Dialog: "The firmware upload is done. The device should reboot automatically within 10 seconds. Do NOT remove power before the reboot is done as that can brick the CPU and requires a programmer to fix." with OK button</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 09a</span> Upload done dialog ‚Äî do not remove power <span class="fig-key">PDF p.4</span></figcaption>
          </figure>
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig09b_upload_done_statusbar.png" alt="VESC Tool status bar showing Upload done">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig09b_upload_done_statusbar.png</div>
                <div class="img-ph-desc">PDF Page 4 ‚Äî VESC Tool bottom status bar showing "Upload done" text in the FW Upload Status area</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 09b</span> "Upload done" in status bar ‚Äî wait for auto-reboot <span class="fig-key">PDF p.4</span></figcaption>
          </figure>
        </div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig10_fw_update_success.png" alt="VESC Tool showing successful firmware update with Fw v6.00 Hw EDU status">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig10_fw_update_success.png</div>
              <div class="img-ph-desc">PDF Page 4 ‚Äî VESC Tool firmware panel after successful update: EDU row selected, VESC_default.bin; status shows "Fw: v6.00, Hw: EDU / Paired: false, Status: STABLE / HW Type: VESC, Phase Filters: Yes / NRF Name: No, Pin: No" with "6.00" badge; also shows "Hw: 60" hardware version badge.</div>
            </div>
          </div>
          <figcaption>
            <span class="fig-label">Fig 10</span>
            Successful VESC 6.x firmware update ‚Äî status shows Fw: v6.00, Hw: EDU; VESC 6.x (non-EDU) shows Hw: 60
            <span class="fig-key">PDF p.4</span>
          </figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">Expected status after successful VESC 6.x firmware update</span></div><pre>Fw: v6.00, Hw: EDU
Paired: false, Status: STABLE
HW Type: VESC, Phase Filters: Yes
NRF Name: No, Pin: No

<span class="c"># Status bar shows: "Upload done" then VESC reboots automatically</span></pre></div>
      </div>
    </div>
  </div>

  <div class="callout tip">
    <div class="callout-icon">‚úì</div>
    <div class="callout-body">
      <div class="callout-title">Firmware Upload Done ‚Äî Now Disconnect Power Safely</div>
      <div class="callout-text">Once you see "Upload done" and the VESC has rebooted (about 10 seconds), it is safe to proceed. The next section covers connecting the motor and servo cables before running motor detection.</div>
    </div>
  </div>
</section>

<!-- ¬ß6 ‚Äî Firmware VESC 4.x Legacy -->
<div class="section-anchor" id="s6"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">06</span>
    <div class="sec-title-block">
      <h2>Firmware Update ‚Äî VESC 4.x Legacy</h2>
      <div class="sec-subtitle">Special servo-out firmware for VESC 4.12 / FLIPSKY Mini FSESC4.2</div>
    </div>
    <div class="sec-badges"><span class="badge badge-new">LEGACY ONLY</span></div>
  </div>

  <div class="callout info">
    <div class="callout-icon">‚Ñπ</div>
    <div class="callout-body">
      <div class="callout-title">VESC 6.x Users ‚Äî Skip This Section</div>
      <div class="callout-text">If you completed Section 5 (VESC 6.x firmware update), skip directly to Section 7 (Cable Connections). This section is only for robots still using VESC 4.x hardware.</div>
    </div>
  </div>

  <p>VESC 4.x hardware requires a special firmware called <code>VESC_servoout.bin</code> that repurposes the VESC's PWM input pin as a PWM output to drive the steering servo motor. The latest VESC Tool versions do not include this firmware ‚Äî you must use VESC Tool v2.03 which ships with firmware v4.2 containing <code>VESC_servoout.bin</code>.</p>

  <div class="callout warn">
    <div class="callout-icon">‚ö†</div>
    <div class="callout-body">
      <div class="callout-title">DO NOT Upgrade VESC 4.x Firmware</div>
      <div class="callout-text">For VESC V4.x (e.g., V4.2, Hw: 412), do NOT upgrade to the latest firmware. Later firmware versions for 4.x hardware do not include <code>vesc_servoout.bin</code>, which is required for servo steering. Use VESC Tool v2.03 and stay on firmware v4.2.</div>
    </div>
  </div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Download VESC Tool v2.03 (Required for 4.x)</div>
        <div class="step-desc">Use the pre-built release from the repository below. Do not use any other version ‚Äî only v2.03 includes the servoout firmware for 4.x hardware.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">VESC Tool v2.03 download</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>https://github.com/rpasichnyk/vesc_tool/releases/tag/v2.03</pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Flash VESC_servoout.bin Firmware</div>
        <div class="step-desc">In VESC Tool v2.03, go to Firmware. Find hardware version 4.12 and select <code>VESC_servoout.bin</code> (NOT the default <code>VESC_default.bin</code>). Click Update. The servoout firmware enables the PWM output needed for steering.</div>
        <div class="callout error"><div class="callout-icon">üõë</div><div class="callout-body"><div class="callout-title">DO NOT Disconnect During Upload</div><div class="callout-text">Same rules apply as VESC 6.x: never disconnect power or USB during firmware upload. Wait for "Upload done" and automatic reboot before proceeding.</div></div></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Alternative Firmware Source (if needed)</div>
        <div class="step-desc">If VESC Tool v2.03 does not include servoout firmware for your specific 4.x hardware, the following repository contains archived v4.2 firmware files:</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Backup firmware repository for VESC 4.x</span></div><pre>https://github.com/RacecarJ/vesc-firmware
https://github.com/RacecarJ/vesc-firmware/tree/master/firm
<span class="c"># Look for: VESC_servoout.bin targeting HW 4.12</span></pre></div>
      </div>
    </div>
  </div>

  <p>After flashing <code>VESC_servoout.bin</code> on VESC 4.x, continue with Section 7 (Cable Connections) and follow the same motor detection steps as VESC 6.x ‚Äî the wizard procedure is identical.</p>
</section>

<!-- ¬ß7 ‚Äî Cable Connections -->
<div class="section-anchor" id="s7"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">07</span>
    <div class="sec-title-block">
      <h2>Cable Connections</h2>
      <div class="sec-subtitle">Connect motor, sensors, and servo before running motor detection</div>
    </div>
  </div>

  <div class="callout error">
    <div class="callout-icon">üõë</div>
    <div class="callout-body">
      <div class="callout-title">Disconnect Power Before Connecting Cables</div>
      <div class="callout-text">Remove the battery from the VESC before connecting or disconnecting any motor or servo cables. Never connect or disconnect motor phase wires while the VESC is powered ‚Äî this can cause large voltage spikes and destroy the FETs.</div>
    </div>
  </div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Disconnect Battery from VESC</div>
        <div class="step-desc">Before connecting any motor cables, remove the battery connector from the VESC. Also unplug the USB cable from the host PC.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Connect the BLDC Drive Motor</div>
        <div class="step-desc">Connect the three motor phase wires (usually labeled A, B, C or bullet connectors) from the BLDC motor to the three motor output terminals on the VESC. The order can be changed later in software if the motor spins the wrong direction.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Connect the Motor Sensor Cable (Hall Sensors)</div>
        <div class="step-desc">Connect the motor's hall sensor connector (usually a 6-pin JST connector) to the VESC's sensor port. This cable carries the three hall sensor signals, 5V power, and ground ‚Äî it enables the VESC to know rotor position for low-speed sensored FOC control.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Connect the Steering Servo Motor</div>
        <div class="step-desc">Connect the servo motor's 3-pin connector (signal/power/ground) to the VESC's PWM servo output port. The signal (white/yellow) wire should be at the correct pin ‚Äî consult your VESC variant's pinout if unsure.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-body">
        <div class="step-title">Reconnect the LiPO Battery Alarm and Battery</div>
        <div class="step-desc">Plug the LiPO alarm balance connector back in, then reconnect the main battery to the VESC.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">6</div>
      <div class="step-body">
        <div class="step-title">Reconnect USB to Host PC and Open VESC Tool</div>
        <div class="step-desc">Plug the USB cable back into the host PC. Launch VESC Tool and connect to the VESC using the connect button or the Connection panel.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig11_reconnect_icon.png" alt="VESC Tool connect icon after cable connections">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig11_reconnect_icon.png</div>
              <div class="img-ph-desc">PDF Page 5 ‚Äî VESC Tool connect icon (plug icon, same as Fig 02a) ‚Äî reconnect after cabling is complete</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 11</span> Reconnect VESC Tool after completing all cable connections <span class="fig-key">PDF p.5</span></figcaption>
        </figure>
      </div>
    </div>
  </div>

  <div class="tw"><table>
    <thead><tr><th>Cable</th><th>From</th><th>To (VESC Port)</th><th>Purpose</th></tr></thead>
    <tbody>
      <tr><td>3x Motor Phase Wires</td><td>BLDC Motor (A, B, C)</td><td>Motor output terminals</td><td>Power delivery to motor coils</td></tr>
      <tr><td>6-pin Hall Sensor JST</td><td>Motor sensor port</td><td>VESC sensor input</td><td>Rotor position sensing for FOC</td></tr>
      <tr><td>3-pin PWM Servo</td><td>Steering servo</td><td>VESC servo/PWM output</td><td>Steering control via PWM signal</td></tr>
      <tr><td>Battery Main Connector</td><td>LiPO/LiIon Battery</td><td>VESC power input</td><td>Main power supply</td></tr>
      <tr><td>Balance Plug</td><td>LiPO Battery</td><td>LiPO alarm monitor</td><td>Cell voltage monitoring / over-discharge protection</td></tr>
    </tbody>
  </table></div>
</section>

<!-- ¬ß8 ‚Äî FOC Wizard Setup -->
<div class="section-anchor" id="s8"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">08</span>
    <div class="sec-title-block">
      <h2>FOC Motor Detection Wizard</h2>
      <div class="sec-subtitle">Use the Setup Motors FOC wizard to automatically detect motor parameters</div>
    </div>
  </div>

  <div class="callout error">
    <div class="callout-icon">üõë</div>
    <div class="callout-body">
      <div class="callout-title">Last Chance ‚Äî Is the Robot on the Stand?</div>
      <div class="callout-text">The motor detection process will spin the wheels. Confirm the robot is elevated on the class stand and all four wheels are clear of any contact before proceeding.</div>
    </div>
  </div>

  <p>The FOC (Field-Oriented Control) wizard automatically measures your motor's resistance, inductance, and flux linkage, then configures the VESC optimally. This replaces manual parameter entry and produces more accurate calibration than guessing values.</p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Navigate to Welcome & Wizards ‚Üí Setup Motors FOC</div>
        <div class="step-desc">In the VESC Tool left sidebar, click <strong>Welcome &amp; Wizards</strong>. Then click the <strong>Setup Motors FOC</strong> button. A dialog will appear asking about loading default parameters.</div>

        <div class="fig-row">
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig12a_wizards_menu.png" alt="VESC Tool Welcome and Wizards menu item highlighted">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig12a_wizards_menu.png</div>
                <div class="img-ph-desc">PDF Page 6 ‚Äî VESC Tool sidebar: "Welcome & Wizards" highlighted in blue, "Connection" below it</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 12a</span> Welcome & Wizards in sidebar <span class="fig-key">PDF p.6</span></figcaption>
          </figure>
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig12b_setup_motors_foc.png" alt="Setup Motors FOC button in VESC Tool wizard panel">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig12b_setup_motors_foc.png</div>
                <div class="img-ph-desc">PDF Page 6 ‚Äî Large button labeled "Setup Motors FOC" with star/asterisk icon on the left</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 12b</span> Setup Motors FOC button <span class="fig-key">PDF p.6</span></figcaption>
          </figure>
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Load Default Parameters ‚Äî Click YES</div>
        <div class="step-desc">The dialog "Would you like to restore this VESC, and all VESCs on the CAN-bus (if any), to their default settings before proceeding?" ‚Äî click <strong>YES</strong>. This ensures a clean starting state and prevents old misconfigured settings from interfering.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig13_load_defaults_dialog.png" alt="Load Default Parameters dialog with NO and YES buttons">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig13_load_defaults_dialog.png</div>
              <div class="img-ph-desc">PDF Page 6 ‚Äî Dialog: "Load Default Parameters ‚Äî Would you like to restore this VESC, and all VESCs on the CAN-bus (if any), to their default settings before proceeding?" with NO / YES buttons</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 13</span> Load Default Parameters ‚Äî click YES <span class="fig-key">PDF p.6</span></figcaption>
        </figure>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Select Motor Usage: Generic</div>
        <div class="step-desc">On the Usage tab, select <strong>Generic</strong>. Do not select a specific motor profile ‚Äî Generic applies the appropriate FOC parameters for a wide range of BLDC motors.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig14_foc_usage_tab.png" alt="FOC wizard USAGE tab with Generic motor type selected">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig14_foc_usage_tab.png</div>
              <div class="img-ph-desc">PDF Page 7 ‚Äî FOC wizard USAGE tab: "Generic" option highlighted in blue with a circular radial motor icon</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 14</span> Select "Generic" on the USAGE tab <span class="fig-key">PDF p.7</span></figcaption>
        </figure>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Select Motor Type: Medium Inrunner (~750g)</div>
        <div class="step-desc">On the Motor tab, select <strong>Medium Inrunner (~750 g)</strong>. This motor size category has been validated to work correctly for the class RC car motors (e.g., XeRun 3660 G2 and similar sensored inrunner motors).</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig15_foc_motor_tab.png" alt="FOC wizard Motor tab with Medium Inrunner 750g selected">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig15_foc_motor_tab.png</div>
              <div class="img-ph-desc">PDF Page 7 ‚Äî FOC wizard Motor tab: "Medium Inrunner (~750 g)" card highlighted in blue, with an image of an inrunner motor on the left side</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 15</span> Select "Medium Inrunner (~750 g)" on the Motor tab <span class="fig-key">PDF p.7</span></figcaption>
        </figure>

        <div class="callout info"><div class="callout-icon">‚Ñπ</div><div class="callout-body"><div class="callout-title">Why Medium Inrunner?</div><div class="callout-text">The class uses sensored inrunner BLDC motors in the 700‚Äì800g range. The Medium Inrunner preset sets appropriate current limits and FOC tuning parameters for this motor class. Using the wrong preset can cause jerky performance or trigger over-current protection.</div></div></div>
      </div>
    </div>
  </div>
</section>

<!-- ¬ß9 ‚Äî Battery Config -->
<div class="section-anchor" id="s9"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">09</span>
    <div class="sec-title-block">
      <h2>Battery Configuration</h2>
      <div class="sec-subtitle">Set the correct battery type, cell count, and capacity</div>
    </div>
  </div>

  <p>Correct battery configuration is critical for safety. The VESC uses the battery settings to calculate low-voltage cutoff thresholds. Using the wrong cell count can result in either premature shutdowns or, more dangerously, over-discharging the LiPO/LiIon battery which causes permanent damage and fire risk.</p>

  <div class="callout warn">
    <div class="callout-icon">‚ö†</div>
    <div class="callout-body">
      <div class="callout-title">Check Your Physical Battery</div>
      <div class="callout-text">Look at the label on your battery before entering values. The cell count (S) and capacity (Ah) are printed on the battery itself. Do not assume ‚Äî getting this wrong can damage the battery. ECE/MAE 148 generally uses 3S 3Ah batteries. DSC 178 and racing robots use 4S 4Ah.</div>
    </div>
  </div>

  <div class="tw"><table>
    <thead><tr><th>Course / Robot</th><th>Battery Cells Series</th><th>Battery Capacity</th><th>Battery Type</th></tr></thead>
    <tbody>
      <tr><td><strong>ECE/MAE 148</strong></td><td>3 (3S)</td><td>3.000 Ah</td><td>BATTERY_TYPE_LIION_3_0__4_2</td></tr>
      <tr><td><strong>DSC 178 / Racing</strong></td><td>4 (4S)</td><td>4.000 Ah</td><td>BATTERY_TYPE_LIION_3_0__4_2</td></tr>
    </tbody>
  </table></div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Set Battery Type, Cells, and Capacity</div>
        <div class="step-desc">In the Battery tab of the FOC wizard, set Battery Type to <code>BATTERY_TYPE_LIION_3_0__4_2</code>. Set Battery Cells Series and Battery Capacity to match your physical battery (see table above).</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig16_foc_battery_tab.png" alt="FOC wizard Battery tab showing BATTERY_TYPE_LIION_3_0_4_2 with 3 cells and 3.000 Ah">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig16_foc_battery_tab.png</div>
              <div class="img-ph-desc">PDF Page 7 ‚Äî FOC wizard Battery tab: Battery Type = BATTERY_TYPE_LIION_3_0__4_2; Battery Cells Series = 3 (with +/- buttons and CURRENT/DEFAULT/HELP); Battery Capacity shown; also shown on PDF p.9 with 4 cells / 4.000 Ah for DSC 178.</div>
            </div>
          </div>
          <figcaption>
            <span class="fig-label">Fig 16</span>
            Battery tab ‚Äî ECE/MAE 148 uses 3 cells / 3.000 Ah; DSC 178 / racing robots use 4 cells / 4.000 Ah
            <span class="fig-key">PDF p.7‚Äì9</span>
          </figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">Battery settings in FOC wizard</span></div><pre>Battery Type:         BATTERY_TYPE_LIION_3_0__4_2

<span class="c"># ECE/MAE 148:</span>
Battery Cells Series: <span class="v">3</span>        <span class="c"># 3-cell LiIon/LiPO battery</span>
Battery Capacity:     <span class="v">3.000 Ah</span>  <span class="c"># Printed on battery label</span>

<span class="c"># DSC 178 / Racing robots:</span>
Battery Cells Series: <span class="v">4</span>        <span class="c"># 4-cell LiIon/LiPO battery</span>
Battery Capacity:     <span class="v">4.000 Ah</span>  <span class="c"># Printed on battery label</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Click Next to Continue</div>
        <div class="step-desc">After setting the battery parameters, click <strong>Next</strong> to advance to the motor parameter configuration page.</div>
      </div>
    </div>
  </div>
</section>

<!-- ¬ß10 ‚Äî Motor Parameters -->
<div class="section-anchor" id="s10"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">10</span>
    <div class="sec-title-block">
      <h2>Motor Parameters</h2>
      <div class="sec-subtitle">Set pole count, gear ratio, and wheel diameter</div>
    </div>
  </div>

  <p>The VESC needs accurate motor parameters to calculate correct RPM readings and speed control. The most important value is the number of magnetic poles on your motor ‚Äî this directly affects all speed calculations.</p>

  <h3>Finding Your Motor's Pole Count</h3>
  <p>You must look up the pole count for your specific motor model. The pole count is NOT the same as the number of stator slots ‚Äî it refers to the number of magnetic poles on the rotor. For the class example motor:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Example: XeRun 3660 G2 Sensored Motor</span></div><pre><span class="c"># Motor part number: XeRun 3660 G2</span>
<span class="c"># Manufacturer link:</span>
https://www.hobbywingdirect.com/products/xerun-3660-g2-sensored-motor

<span class="c"># Spec quote: "innovative 4-pole-8-magnet staggered pole rotor"</span>
<span class="c"># Pole count for VESC wizard = 4</span>
<span class="c"># (Always look up YOUR specific motor ‚Äî do not guess)</span></pre></div>

  <div class="callout info">
    <div class="callout-icon">‚Ñπ</div>
    <div class="callout-body">
      <div class="callout-title">How to Find Pole Count</div>
      <div class="callout-text">Search the motor part number on the manufacturer's website or datasheet. Look for phrases like "X-pole rotor" or "X magnet". The number you enter in VESC Tool is the pole count (not the slot count). Most small RC inrunner motors are 4-pole. If you cannot find the spec, ask a TA.</div>
    </div>
  </div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Set Gear Ratio: Direct Drive</div>
        <div class="step-desc">In the wizard, select <strong>Direct Drive</strong> for gear ratio. The class RC cars use a direct-drive setup between the motor and wheels with no gear reduction factor beyond what the physical gearbox handles internally.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig17_foc_gear_ratio.png" alt="FOC wizard Gear Ratio section with Direct Drive checkbox selected">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig17_foc_gear_ratio.png</div>
              <div class="img-ph-desc">PDF Page 8 ‚Äî FOC wizard: "Gear Ratio" section showing "Direct Drive" option with a blue checkmark selected</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 17</span> Select "Direct Drive" for the gear ratio setting <span class="fig-key">PDF p.8</span></figcaption>
        </figure>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Set Number of Motor Poles</div>
        <div class="step-desc">Enter the pole count for your motor. For the XeRun 3660 G2 and most class motors, this is <strong>4</strong>. Look up your motor's datasheet to confirm.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Motor pole count entry</span></div><pre>Motor Poles: <span class="v">4</span>   <span class="c"># Verify against YOUR motor's datasheet</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Set Wheel Diameter: 100.00 mm</div>
        <div class="step-desc">Set the wheel diameter to <strong>100.00 mm</strong>. This is the standard wheel size used on the class RC car platform. Accurate wheel diameter ensures speed readings in m/s are correct when using the Robocar framework later.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Wheel diameter setting</span></div><pre>Wheel Diameter: <span class="v">100.00 mm</span>   <span class="c"># Standard class RC car wheel</span></pre></div>
      </div>
    </div>
  </div>
</section>

<!-- ¬ß11 ‚Äî Run Detection & Direction -->
<div class="section-anchor" id="s11"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">11</span>
    <div class="sec-title-block">
      <h2>Run Detection & Motor Direction</h2>
      <div class="sec-subtitle">Execute the FOC detection spin cycle and set correct forward direction</div>
    </div>
  </div>

  <div class="callout error">
    <div class="callout-icon">üõë</div>
    <div class="callout-body">
      <div class="callout-title">Final Safety Check ‚Äî Wheels Must Be Completely Clear</div>
      <div class="callout-text">This step will physically spin the wheels. This is your last chance to verify the robot is elevated on the stand with all wheels free of any contact. Keep hands, cables, and your laptop away from the wheel path.</div>
    </div>
  </div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Click "Run Detection"</div>
        <div class="step-desc">In the wizard, click <strong>Run Detection</strong>. The VESC will automatically measure resistance (RL measurement), inductance, and flux linkage (Œª). The wheels will spin forward briefly then backward. This process takes approximately 10‚Äì30 seconds.</div>
        <div class="callout info"><div class="callout-icon">‚Ñπ</div><div class="callout-body"><div class="callout-title">What Happens During Detection</div><div class="callout-text">The VESC runs controlled current pulses through the motor to measure its electrical parameters (R, L, Œª). These values are unique to your specific motor. The auto-detected values will be different from the example screenshots ‚Äî that is normal and correct.</div></div></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Set Motor Direction (FWD or REV)</div>
        <div class="step-desc">After detection, the wizard shows a Direction screen with <strong>FWD</strong> and <strong>REV</strong> buttons. Press FWD ‚Äî if the wheels spin forward (away from the front of the car), you're done. If the wheels spin backward when pressing FWD, press <strong>REV</strong> to invert the direction. Confirm that FWD produces forward wheel rotation before continuing.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig18_foc_direction_tab.png" alt="FOC wizard DIRECTION tab with FWD and REV buttons and Inverted toggle">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig18_foc_direction_tab.png</div>
              <div class="img-ph-desc">PDF Page 9 ‚Äî FOC wizard DIRECTION tab: three tabs (BATTERY | SETUP | DIRECTION active); "This VESC ID: 69" icon with Inverted toggle and FWD/REV buttons</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 18</span> Direction tab ‚Äî press FWD and verify wheels spin forward; toggle Inverted or press REV if backwards <span class="fig-key">PDF p.9</span></figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">Direction determination logic</span></div><pre><span class="c"># After clicking Run Detection:</span>
<span class="c"># Press FWD button in wizard</span>

<span class="c"># If wheels spin in FORWARD direction:</span>
<span class="ok"># ‚Üí Leave as FWD, continue to next step</span>

<span class="c"># If wheels spin in REVERSE direction:</span>
<span class="er"># ‚Üí Enable the "Inverted" toggle / click REV</span>
<span class="c"># ‚Üí This is controlled by toggling the Inverted switch next to This VESC</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Write Motor Configuration</div>
        <div class="step-desc">Click the <strong>Write Motor Configuration</strong> button (‚ÜìM icon in the toolbar). This saves all detected motor parameters to the VESC's non-volatile memory. Without this step, the settings are lost on power cycle.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig19_write_motor_config.png" alt="Write Motor Configuration button showing the down-arrow M icon">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig19_write_motor_config.png</div>
              <div class="img-ph-desc">PDF Pages 9 & 12 ‚Äî Write Motor Configuration button: dark square toolbar button showing "‚ÜìM" (downward arrow with M) icon</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 19</span> Write Motor Configuration (‚ÜìM) ‚Äî always click this after detection or changing motor settings <span class="fig-key">PDF p.9</span></figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">Write motor config ‚Äî do this immediately after detection</span></div><pre><span class="c"># Click the ‚ÜìM button in the VESC Tool toolbar</span>
<span class="c"># OR: Motor Settings ‚Üí Write Motor Configuration</span>
<span class="ok"># Confirmation: "Motor configuration written"</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Write App Configuration</div>
        <div class="step-desc">Click the <strong>Write App Configuration</strong> button (‚ÜìA icon). This saves the application-layer settings (UART, servo output, etc.) to the VESC. Always write both motor and app config after making changes.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig20_write_app_config.png" alt="Write App Configuration button showing the down-arrow A icon">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig20_write_app_config.png</div>
              <div class="img-ph-desc">PDF Pages 10 & 12 ‚Äî Write App Configuration button: dark square toolbar button with "‚ÜìA" (downward arrow with A) icon, tooltip reads "Write app configuration"</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 20</span> Write App Configuration (‚ÜìA) ‚Äî save app-layer settings to NVRAM <span class="fig-key">PDF p.10</span></figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">Write app config</span></div><pre><span class="c"># Click the ‚ÜìA button in the VESC Tool toolbar</span>
<span class="c"># OR: App Settings ‚Üí Write App Configuration</span>
<span class="ok"># Confirmation: "App configuration written"</span></pre></div>
      </div>
    </div>
  </div>

  <div class="callout tip">
    <div class="callout-icon">‚úì</div>
    <div class="callout-body">
      <div class="callout-title">Tires Not Moving / Steering?</div>
      <div class="callout-text">If the front tires do not move or steer at this stage, that is completely normal and expected. Nothing is broken. The servo output needs to be enabled separately ‚Äî this is covered in Section 13. Continue to Section 12 (Hall Sensor Detection) now.</div>
    </div>
  </div>
</section>

<!-- ¬ß12 ‚Äî Hall Sensor Detection -->
<div class="section-anchor" id="s12"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">12</span>
    <div class="sec-title-block">
      <h2>Hall Sensor Detection</h2>
      <div class="sec-subtitle">Detect and map the hall sensor table for sensored FOC operation</div>
    </div>
  </div>

  <p>The motor detection wizard sets motor parameters (R, L, Œª) but the hall sensor mapping is a separate step. Hall sensors tell the VESC exactly where the motor rotor is at low speeds, enabling smooth startup and precise low-speed control ‚Äî critical for autonomous vehicle operation at low throttle values.</p>

  <h3>Why Hall Sensor Detection Matters</h3>
  <p>Without correct hall sensor calibration, the motor operates in sensorless mode below the <code>Sensorless ERPM</code> threshold. This produces stuttering and jerky starts. With hall sensors properly mapped, the VESC transitions smoothly from sensored to sensorless operation as speed increases.</p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Navigate to Motor Settings ‚Üí FOC ‚Üí Hall Sensors Tab</div>
        <div class="step-desc">In the VESC Tool left sidebar, click <strong>Motor Settings ‚Üí FOC</strong>. In the tabs at the top of the FOC panel, click the <strong>Hall Sensors</strong> tab. You will see the Sensor Mode dropdown and the Hall Table entries.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig21_foc_motor_settings.png" alt="VESC Tool Motor Settings FOC panel showing RL measurement, flux linkage, and Apply button">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig21_foc_motor_settings.png</div>
              <div class="img-ph-desc">PDF Page 10 ‚Äî VESC Tool: sidebar showing General/FOC/PID Controllers (FOC highlighted); RL measurement panel with "Measure resistance and inductance" tooltip; Œª (Measure flux linkage) panel; Apply button</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 21</span> Motor Settings ‚Üí FOC panel showing the RL measurement, flux linkage (Œª), and Apply controls <span class="fig-key">PDF p.10</span></figcaption>
        </figure>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Verify Sensor Mode is Set to "Hall Sensors"</div>
        <div class="step-desc">The Sensor Mode dropdown should show <strong>Hall Sensors</strong>. If it shows Sensorless or Encoder, change it to Hall Sensors. This tells the VESC to use the connected hall sensor cable for rotor position feedback.</div>

        <div class="fig-row">
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig22a_sensor_mode_hall.png" alt="Sensor Mode display showing Hall Sensors">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig22a_sensor_mode_hall.png</div>
                <div class="img-ph-desc">PDF Page 11 ‚Äî Large display: "Sensor Mode" label on left, "Hall Sensors" value on right (both in large white text on dark background)</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 22a</span> Sensor Mode set to Hall Sensors <span class="fig-key">PDF p.11</span></figcaption>
          </figure>
          <figure>
            <div class="fig-wrap">
              <img src="images/vesc_fig22b_hall_sensors_button.png" alt="Hall Sensors button in VESC Tool">
              <div class="img-ph">
                <div class="img-ph-icon">üñº</div>
                <div class="img-ph-label">üìÅ vesc_fig22b_hall_sensors_button.png</div>
                <div class="img-ph-desc">PDF Page 11 ‚Äî Standalone "Hall Sensors" button/badge (dark button with Hall Sensors label)</div>
              </div>
            </div>
            <figcaption><span class="fig-label">Fig 22b</span> Hall Sensors selection button <span class="fig-key">PDF p.11</span></figcaption>
          </figure>
        </div>

        <div class="cb"><div class="cb-header"><span class="cb-label">Sensor Mode setting</span></div><pre>Sensor Mode: <span class="v">Hall Sensors</span>   <span class="c"># Must be set to this value</span>
<span class="c"># NOT: Sensorless</span>
<span class="c"># NOT: Encoder</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Run Hall Sensor Detection</div>
        <div class="step-desc">At the bottom of the Hall Sensors tab, find the <strong>Detect Hall Sensors</strong> section. Set the detection current (default 10.00 A is appropriate for class motors). Click <strong>Start Detection</strong>. The motor will spin briefly while the hall sensor pattern is mapped.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig23_hall_table_255.png" alt="Full VESC Tool screenshot showing Hall Sensors tab with all 255 values before detection">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig23_hall_table_255.png</div>
              <div class="img-ph-desc">PDF Page 11 ‚Äî Full VESC Tool screenshot: Hall Sensors tab active; Hall Table [0]‚Äì[7] all showing 255 (before detection); Detect Hall Sensors section with I: 10.00 A, Apply button, Start detection button visible at bottom</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 23</span> Hall Sensors tab before detection ‚Äî all values show 255; click Start Detection to populate the table <span class="fig-key">PDF p.11</span></figcaption>
        </figure>

        <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">Wheels Will Spin During Detection</div><div class="callout-text">The motor rotates during hall sensor detection. Robot must be on the stand with wheels clear.</div></div></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Verify Hall Table Values and Click Apply</div>
        <div class="step-desc">After detection, the Hall Table entries (Hall Table [0] through [7]) will be populated with values. These values are unique to your motor and wiring ‚Äî they will differ from the example below. Click <strong>Apply</strong> to accept the detected values.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig24_hall_table_detected.png" alt="Hall sensor table values after detection showing example values">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig24_hall_table_detected.png</div>
              <div class="img-ph-desc">PDF Page 11 ‚Äî Hall sensor values table after detection: Sensorless ERPM: 4000.00, Hall Interpolation ERPM: 500.00, Hall Table [0]: 255, [1]: 115, [2]: 49, [3]: 82, [4]: 182, [5]: 149, [6]: 15, [7]: 255, Hall Sensor Extra Samples: 1</div>
            </div>
          </div>
          <figcaption>
            <span class="fig-label">Fig 24</span>
            Example hall table values after detection ‚Äî your values will differ; this is normal and expected
            <span class="fig-key">PDF p.11</span>
          </figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">Example hall sensor detection output (your values will differ)</span></div><pre><span class="c"># This is an EXAMPLE ‚Äî do not manually enter these values</span>
<span class="c"># Your detected values will be different and that is correct</span>

Sensorless ERPM:          4000.00
Hall Interpolation ERPM:  500.00
Hall Table [0]:           255
Hall Table [1]:           115     <span class="c"># ‚Üê unique to your motor/wiring</span>
Hall Table [2]:           49
Hall Table [3]:           82
Hall Table [4]:           182
Hall Table [5]:           149
Hall Table [6]:           15
Hall Table [7]:           255
Hall Sensor Extra Samples: 1</pre></div>
        <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">What Do These Values Mean?</div><div class="callout-text">The Hall Table maps the 6 commutation states of the BLDC motor to the 3 hall sensor signals. The values 0‚Äì5 represent valid states, 255 means unused. The detection routine rotates the motor and records the hall signal pattern for each rotor position. If you get all 255s after detection, the hall sensor cable is not connected correctly.</div></div></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-body">
        <div class="step-title">Write Motor Configuration</div>
        <div class="step-desc">After clicking Apply, write the motor configuration to save the hall table to NVRAM. Click the <strong>‚ÜìM (Write Motor Configuration)</strong> button.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Save hall sensor configuration</span></div><pre><span class="c"># Motor Settings ‚Üí FOC ‚Üí Hall Sensors ‚Üí Apply (after detection)</span>
<span class="c"># Then click ‚ÜìM button in toolbar</span>
<span class="ok"># "Motor configuration written" ‚Äî hall table saved</span></pre></div>
      </div>
    </div>
  </div>

  <h3>Troubleshooting Hall Sensor Detection</h3>
  <div class="tw"><table>
    <thead><tr><th>Symptom</th><th>Likely Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>All Hall Table values = 255 after detection</td><td>Hall sensor cable not connected or loose</td><td>Re-seat the 6-pin JST hall sensor connector on both motor and VESC ends. Try detection again.</td></tr>
      <tr><td>Detection fails / motor stutters badly</td><td>Detection current too low, or motor phase wires wrong order</td><td>Try increasing detection current to 15A. If still failing, swap any two of the three motor phase wire connections.</td></tr>
      <tr><td>Some table values are 255, some are numbers</td><td>Intermittent hall sensor connection</td><td>Check for damaged wires in the hall sensor cable. Reconnect firmly and repeat detection.</td></tr>
      <tr><td>Motor runs fine fast but stutters at low speed</td><td>Hall sensors not being used (sensorless mode)</td><td>Verify Sensor Mode is "Hall Sensors" (not Sensorless) and that the Hall Table was properly written.</td></tr>
    </tbody>
  </table></div>
</section>

<!-- ¬ß13 ‚Äî Enable Servo Steering -->
<div class="section-anchor" id="s13"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">13</span>
    <div class="sec-title-block">
      <h2>Enable Servo Steering Output</h2>
      <div class="sec-subtitle">Configure the VESC PWM output to control the steering servo motor</div>
    </div>
  </div>

  <p>By default, the VESC's PWM/servo pin is configured as an input. For the class robot, we need it as an output to generate the PWM signal that drives the steering servo motor. This requires enabling "Servo Output" in the App Settings and writing the configuration.</p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Navigate to App Settings ‚Üí General</div>
        <div class="step-desc">In the VESC Tool left sidebar, click <strong>App Settings ‚Üí General</strong>. This is the APP section (not the MOTOR section) of the settings panel.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig25_app_settings_sidebar.png" alt="VESC Tool sidebar App Settings General selected with APP badge">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig25_app_settings_sidebar.png</div>
              <div class="img-ph-desc">PDF Pages 5 & 12 ‚Äî VESC Tool sidebar: "App Settings" header with arrow; "General" highlighted in blue with "APP" badge; "UART" below it with "APP" badge</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 25</span> Navigate to App Settings ‚Üí General (APP section) <span class="fig-key">PDF p.5 & p.12</span></figcaption>
        </figure>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Enable Servo Output</div>
        <div class="step-desc">Find the <strong>Enable Servo Output</strong> setting and change it from <code>False</code> to <code>True</code>. This repurposes the PWM servo pin as an output, allowing the VESC to drive a standard RC servo motor.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig26_servo_output_true.png" alt="App Settings General showing Enable Servo Output set to True">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig26_servo_output_true.png</div>
              <div class="img-ph-desc">PDF Page 12 ‚Äî App Settings General panel: "UAVCAN Raw RPM Max" row (50000); "Enable Servo Output" row with value "True" shown in large text</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 26</span> Enable Servo Output ‚Üí set to True <span class="fig-key">PDF p.12</span></figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">App Settings ‚Üí General ‚Äî enable servo output</span></div><pre>UAVCAN Raw RPM Max:   50000
Enable Servo Output:  <span class="v">True</span>    <span class="c"># ‚Üê Change this from False to True</span>
Kill Switch Mode:     Disabled</pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Write App Configuration</div>
        <div class="step-desc">Click the <strong>‚ÜìA (Write App Configuration)</strong> button to save this change to NVRAM. Without writing, the servo output enable reverts to False on the next power cycle.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig27_write_app_config_servo.png" alt="Write App Configuration button to save servo output enable">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig27_write_app_config_servo.png</div>
              <div class="img-ph-desc">PDF Page 12 ‚Äî Write App Configuration (‚ÜìA) button with "Write app configuration" tooltip ‚Äî click after enabling servo output</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 27</span> Write App Configuration (‚ÜìA) ‚Äî save the Enable Servo Output change <span class="fig-key">PDF p.12</span></figcaption>
        </figure>

        <div class="cb"><div class="cb-header"><span class="cb-label">Save servo output enable setting</span></div><pre><span class="c"># Click ‚ÜìA button in toolbar after enabling servo output</span>
<span class="ok"># "App configuration written"</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Test the Steering Servo</div>
        <div class="step-desc">Navigate to <strong>App Settings ‚Üí General ‚Üí Controls tab</strong>. You will see a <strong>Servo Output</strong> slider. Drag the slider left and right ‚Äî the front wheels should turn left and right accordingly. There is also a <strong>Center</strong> button to return to neutral.</div>

        <figure>
          <div class="fig-wrap">
            <img src="images/vesc_fig28_servo_slider_test.png" alt="App Settings General Controls tab showing Servo Output slider and Center button">
            <div class="img-ph">
              <div class="img-ph-icon">üñº</div>
              <div class="img-ph-label">üìÅ vesc_fig28_servo_slider_test.png</div>
              <div class="img-ph-desc">PDF Page 5 ‚Äî App Settings General, Controls tab: "Servo Output" label with a horizontal slider (centered at midpoint); "Center" button below the slider</div>
            </div>
          </div>
          <figcaption><span class="fig-label">Fig 28</span> Controls tab ‚Äî Servo Output slider; drag left/right to steer; wheels should follow <span class="fig-key">PDF p.5</span></figcaption>
        </figure>

        <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">Wheels Not Moving?</div><div class="callout-text">If the front wheels do not respond to the servo slider: verify the servo cable is connected to the VESC PWM port; confirm Enable Servo Output is True and the app config was written; and check that the servo motor is powered (it draws 5V from the VESC's BEC output ‚Äî confirm your VESC has this output).</div></div></div>
        <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Success State</div><div class="callout-text">Moving the servo output slider produces left/right front wheel steering. The VESC setup is complete. You can now connect the VESC USB cable to the Raspberry Pi (SBC) instead of the host PC and proceed with the Robocar software setup.</div></div></div>
      </div>
    </div>
  </div>
</section>

<!-- ¬ß14 ‚Äî Troubleshooting -->
<div class="section-anchor" id="s14"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">14</span>
    <div class="sec-title-block">
      <h2>Troubleshooting & Known Issues</h2>
      <div class="sec-subtitle">Quick reference for common VESC setup failure modes</div>
    </div>
  </div>

  <h3>Firmware & Connection</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Likely Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>VESC not detected by VESC Tool</td><td>USB cable not carrying data (charge-only cable), or wrong COM port</td><td>Try a different micro-USB cable that is confirmed for data transfer. On Windows, check Device Manager for the COM port. On Linux, check <code>dmesg | grep usb</code>.</td></tr>
      <tr><td>VESC Tool shows no device after SCAN</td><td>VESC not powered, or USB driver not installed</td><td>Confirm battery is connected to VESC and VESC LEDs are on. On Windows, install the VESC USB driver (STM32 Virtual COM Port driver).</td></tr>
      <tr><td>Firmware update fails / hangs</td><td>USB cable issue or low battery</td><td>Use a shorter, higher-quality USB cable. Ensure battery is charged. If VESC becomes unresponsive, it may need a hardware programmer to recover.</td></tr>
      <tr><td>VESC bricked after firmware update</td><td>Power or USB disconnected mid-upload</td><td>This requires a ST-Link or similar SWD programmer to reflash. See the TA immediately.</td></tr>
    </tbody>
  </table></div>

  <h3>Motor Detection</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Likely Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>Motor does not spin during FOC detection</td><td>Motor phase cables not connected, or motor not getting current</td><td>Check all three motor phase wire connections. Confirm battery voltage is adequate (VESC needs at least 2S). Check Current setting in detection ‚Äî default 10A should be sufficient.</td></tr>
      <tr><td>Motor stutters badly / detection fails</td><td>Wrong motor type selected, or phase wires in wrong order</td><td>Re-run detection with Medium Inrunner selected. If still failing, swap any two of the three motor phase wires and re-detect.</td></tr>
      <tr><td>Motor spins backward during FWD test</td><td>Phase wire polarity or hall sensor wiring</td><td>Toggle the Inverted switch in the Direction step of the wizard. If direction is still wrong after writing config, swap any two motor phase wires.</td></tr>
      <tr><td>Detection values look unreasonable (R = 0 or very high)</td><td>Motor phase wire not making contact</td><td>Check bullet connector crimps. Clean connectors with electrical contact cleaner. Ensure wires are not broken internally.</td></tr>
    </tbody>
  </table></div>

  <h3>Hall Sensors</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Likely Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>Hall Table all 255 after detection</td><td>Hall sensor cable not connected</td><td>Re-seat the 6-pin JST hall sensor connector. Verify pin 1 orientation matches the VESC pinout diagram.</td></tr>
      <tr><td>Motor works fast but stutters at low RPM</td><td>Hall sensors disabled or table incorrect</td><td>Verify Sensor Mode = Hall Sensors. Re-run hall sensor detection. Write motor config after.</td></tr>
      <tr><td>Hall detection succeeds but some values still 255</td><td>Damaged hall sensor wire</td><td>Inspect the hall sensor cable for pinched or broken wires. Replace cable if damaged.</td></tr>
    </tbody>
  </table></div>

  <h3>Servo Steering</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Likely Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>Servo slider in VESC Tool does nothing</td><td>Enable Servo Output = False, or app config not written</td><td>Go to App Settings ‚Üí General, set Enable Servo Output to True, click ‚ÜìA to write app config, then test again.</td></tr>
      <tr><td>Servo moves in VESC Tool but not from ROS2</td><td>VESC USB not connected to Raspberry Pi</td><td>After VESC setup on host PC, move the USB cable from laptop to Raspberry Pi USB port. The Pi runs the actuator ROS2 node.</td></tr>
      <tr><td>Servo only moves one direction</td><td>PWM signal range not calibrated for this servo</td><td>The servo PWM center, min, and max values may need adjustment. These are in App Settings ‚Üí General ‚Äî consult the TA for your specific servo specs.</td></tr>
      <tr><td>Steering direction inverted in autonomous mode</td><td>Steering polarity setting in Robocar YAML</td><td>Set <code>steering_polarity: -1</code> in <code>car_config.yaml</code> and run <code>build_ros2</code>. This is a ROS2-level fix, not a VESC setting.</td></tr>
    </tbody>
  </table></div>

  <h3>Battery & Power</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Likely Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>VESC immediately shuts down under load</td><td>Low-voltage cutoff triggered ‚Äî battery too low, or wrong cell count configured</td><td>Charge the battery. Verify Battery Cells Series matches your actual battery (3S or 4S). Write motor config after any change.</td></tr>
      <tr><td>LiPO alarm beeping constantly</td><td>Battery discharged below 3.0V/cell</td><td>Stop all tests immediately. Charge the battery. Do not discharge a LiPO below 3.0V per cell ‚Äî permanent damage occurs.</td></tr>
      <tr><td>VESC runs for a few seconds then cuts out</td><td>Motor current limit too high, or thermal protection</td><td>Let VESC cool for 5 minutes. If persistent, reduce Motor Current Max in FOC settings. Default detection values should be safe for class motors.</td></tr>
    </tbody>
  </table></div>

  <div class="divider"></div>
  <p style="text-align:center; font-size:13px;">UCSD Jacobs School of Engineering ‚Äî ECE/MAE 148 Intro to Autonomous Vehicles</p>
</section>

</div><!-- /content -->
</div><!-- /main -->
</main>

<button id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">‚Üë</button>

<script>
// ‚îÄ‚îÄ COPY BUTTON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function doCopy(btn) {
  const pre = btn.closest('.cb').querySelector('pre');
  const text = pre.innerText;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'COPIED ‚úì';
    btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    btn.textContent = 'COPIED ‚úì'; btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  });
}

// ‚îÄ‚îÄ BACK TO TOP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const btt = document.getElementById('btt');
window.addEventListener('scroll', () => {
  btt.classList.toggle('show', window.scrollY > 500);
});

// ‚îÄ‚îÄ READ PROGRESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const progressFill = document.getElementById('read-progress-fill');
const npFill = document.getElementById('np-fill');
const npPct = document.getElementById('np-pct');
window.addEventListener('scroll', () => {
  const docH = document.documentElement.scrollHeight - window.innerHeight;
  const pct = docH > 0 ? Math.min(100, Math.round((window.scrollY / docH) * 100)) : 0;
  progressFill.style.width = pct + '%';
  npFill.style.width = pct + '%';
  npPct.textContent = pct + '%';
});

// ‚îÄ‚îÄ ACTIVE NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const anchors = document.querySelectorAll('.section-anchor[id]');
const navLinks = document.querySelectorAll('.nav-link');
const io = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      navLinks.forEach(l => l.classList.remove('active'));
      const a = document.querySelector(`.nav-link[href="#${e.target.id}"]`);
      if (a) { a.classList.add('active'); }
    }
  });
}, { rootMargin: '-60px 0px -80% 0px' });
anchors.forEach(a => io.observe(a));

// ‚îÄ‚îÄ NAV SEARCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterNav(q) {
  const term = q.toLowerCase();
  document.querySelectorAll('.nav-link').forEach(l => {
    l.style.display = l.textContent.toLowerCase().includes(term) ? '' : 'none';
  });
  document.querySelectorAll('.nav-group-label').forEach(g => {
    let next = g.nextElementSibling;
    let hasVisible = false;
    while (next && !next.classList.contains('nav-group-label')) {
      if (next.style.display !== 'none') hasVisible = true;
      next = next.nextElementSibling;
    }
    g.style.display = hasVisible ? '' : 'none';
  });
}

// ‚îÄ‚îÄ MOBILE SIDEBAR CLOSE ON LINK CLICK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.nav-link').forEach(l => {
  l.addEventListener('click', () => {
    document.querySelector('.sidebar').classList.remove('open');
  });
});

// ‚îÄ‚îÄ IMAGE PLACEHOLDER LOGIC (RACE-CONDITION FIX) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// The script runs after the DOM is fully parsed, but images start loading
// as soon as the browser encounters their <src> attributes. By the time
// this script runs, some images may already be complete (loaded or failed).
// The original code only attached addEventListener('error'/'load') and never
// checked img.complete, so 404'd images that finished before the listener
// was attached would show broken img icons instead of the styled placeholder.
// Fix: after attaching listeners, check img.complete and handle synchronously.
document.querySelectorAll('figure img').forEach(img => {
  const showPlaceholder = () => {
    img.style.display = 'none';
    const ph = img.nextElementSibling;
    if (ph && ph.classList.contains('img-ph')) ph.style.display = 'flex';
  };
  const showImage = () => {
    img.style.display = 'block';
    const ph = img.nextElementSibling;
    if (ph && ph.classList.contains('img-ph')) ph.style.display = 'none';
  };

  // If src is blank or not set, show placeholder immediately and stop
  if (!img.getAttribute('src') || img.getAttribute('src') === '' ||
      img.src === window.location.href || img.src.endsWith('#')) {
    showPlaceholder();
    return;
  }

  // Attach future-event listeners (fires if image completes AFTER this script)
  img.addEventListener('error', showPlaceholder);
  img.addEventListener('load', showImage);

  // ‚îÄ‚îÄ RACE-CONDITION GUARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // If the image already finished loading (or failed) before this listener
  // was attached, the events won't fire again. Check img.complete explicitly.
  if (img.complete) {
    // naturalWidth === 0 means the image failed (404 or broken src)
    if (img.naturalWidth > 0) {
      showImage();      // Image loaded successfully ‚Äî ensure it is visible
    } else {
      showPlaceholder(); // Image failed ‚Äî show the styled placeholder
    }
  }
});
</script>
</body>
</html>
