<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UCSD Robocar â€” ECE/MAE 148 Setup Guide</title>

<!-- ================================================================
  IMAGE REPLACEMENT GUIDE
  ================================================================
  All images live in the ./images/ folder.
  To replace any figure, simply drop a new file with the SAME name
  into ./images/ and commit to GitHub.

  Current image files:
    images/fig_xeyes.jpg          â†’ Section 3: X11 forwarding test
    images/fig_hsv_chart.jpg      â†’ Section 10: HSV color wheel diagram
    images/fig_mask_default.jpg   â†’ Section 10: Default mask sliders
    images/fig_mask_yellow.jpg    â†’ Section 10: Yellow-tuned mask
    images/fig_bw_calibration.jpg â†’ Section 10: B&W noise reduction
    images/fig_line_calibration.jpg â†’ Section 11: Line detection view
    images/fig_error_threshold.jpg  â†’ Section 11: Error threshold view
    images/fig_camera_align.jpg   â†’ Section 11: Camera alignment view
    images/fig_throttle_steering.jpg â†’ Section 12: Throttle/steering GUI
    images/fig_system_response.jpg   â†’ Section 12: System response plot

  To add a new image anywhere:
    1. Drop the .jpg/.png into ./images/
    2. Add <figure> block in the HTML where you want it
  ================================================================ -->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">

<style>
/* â”€â”€ CSS VARIABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --ucsd-navy:    #003262;
  --ucsd-gold:    #C69214;
  --ucsd-light:   #E8EDF2;
  --bg:           #0D1117;
  --surface:      #161B22;
  --surface2:     #1E2530;
  --border:       #2D3748;
  --text:         #E6EDF3;
  --text-muted:   #8B949E;
  --text-dim:     #6E7681;
  --code-bg:      #0D1117;
  --blue:         #58A6FF;
  --green:        #3FB950;
  --yellow:       #F0B429;
  --red:          #F85149;
  --purple:       #BC8CFF;
  --teal:         #39D353;
  --sidebar-w:    280px;
  --radius:       8px;
  --font-mono:    'JetBrains Mono', monospace;
  --font-body:    'Outfit', sans-serif;
  --transition:   0.18s ease;
}

/* â”€â”€ RESET & BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; scroll-padding-top: 80px; }
body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  line-height: 1.7;
  font-size: 15px;
}

/* â”€â”€ TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  height: 56px;
  background: rgba(13,17,23,0.92);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 24px;
  gap: 16px;
}
.topbar-brand {
  display: flex; align-items: center; gap: 12px;
  text-decoration: none;
}
.topbar-logo {
  width: 32px; height: 32px; border-radius: 6px;
  background: var(--ucsd-navy);
  border: 2px solid var(--ucsd-gold);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); letter-spacing: -0.5px;
}
.topbar-title { font-size: 14px; font-weight: 600; color: var(--text); }
.topbar-sub { font-size: 12px; color: var(--text-muted); }
.topbar-spacer { flex: 1; }
.topbar-tag {
  font-family: var(--font-mono); font-size: 11px;
  background: var(--surface2); border: 1px solid var(--border);
  color: var(--text-muted); padding: 3px 10px; border-radius: 20px;
}
#menu-toggle {
  display: none; background: none; border: 1px solid var(--border);
  color: var(--text); padding: 6px 10px; border-radius: 6px; cursor: pointer;
  font-size: 16px;
}

/* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.layout {
  display: flex; padding-top: 56px;
  min-height: 100vh;
}

/* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  position: fixed; top: 56px; left: 0; bottom: 0;
  width: var(--sidebar-w);
  background: var(--surface);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  padding: 24px 0 40px;
  transition: transform var(--transition);
}
.sidebar::-webkit-scrollbar { width: 4px; }
.sidebar::-webkit-scrollbar-track { background: transparent; }
.sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

.nav-section-label {
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  color: var(--text-dim); letter-spacing: 1.5px; text-transform: uppercase;
  padding: 16px 20px 6px;
}
.nav-item {
  display: block; padding: 6px 20px;
  text-decoration: none; color: var(--text-muted); font-size: 13px;
  border-left: 2px solid transparent;
  transition: all var(--transition);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.nav-item:hover { color: var(--text); background: var(--surface2); border-left-color: var(--border); }
.nav-item.active { color: var(--ucsd-gold); border-left-color: var(--ucsd-gold); background: rgba(198,146,20,0.08); }
.nav-item.sub { padding-left: 34px; font-size: 12px; }
.nav-divider { height: 1px; background: var(--border); margin: 8px 16px; }

/* â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  margin-left: var(--sidebar-w);
  flex: 1; padding: 48px 60px 80px;
  max-width: calc(var(--sidebar-w) + 860px);
}

/* â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero {
  background: linear-gradient(135deg, #0a1628 0%, #0d1f3c 50%, #0a1628 100%);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 48px;
  margin-bottom: 48px;
  position: relative; overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute; inset: 0;
  background: radial-gradient(ellipse 60% 60% at 80% 50%, rgba(198,146,20,0.12), transparent);
  pointer-events: none;
}
.hero-badge {
  display: inline-flex; align-items: center; gap: 6px;
  background: rgba(198,146,20,0.15); border: 1px solid rgba(198,146,20,0.4);
  color: var(--ucsd-gold); font-family: var(--font-mono); font-size: 11px;
  padding: 4px 12px; border-radius: 20px; margin-bottom: 20px;
}
.hero h1 {
  font-size: clamp(28px, 4vw, 42px); font-weight: 900; line-height: 1.1;
  background: linear-gradient(135deg, #ffffff 0%, var(--ucsd-gold) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; margin-bottom: 12px;
}
.hero p {
  color: var(--text-muted); font-size: 15px; max-width: 540px; line-height: 1.6;
}
.hero-meta {
  display: flex; gap: 24px; margin-top: 24px; flex-wrap: wrap;
}
.hero-meta-item {
  display: flex; align-items: center; gap: 8px;
  font-size: 12px; color: var(--text-muted); font-family: var(--font-mono);
}
.hero-meta-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ucsd-gold); }

/* â”€â”€ SECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section { margin-bottom: 64px; scroll-margin-top: 72px; }
.section-header {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 24px; padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}
.section-num {
  font-family: var(--font-mono); font-size: 12px; font-weight: 600;
  background: rgba(198,146,20,0.15); border: 1px solid rgba(198,146,20,0.35);
  color: var(--ucsd-gold); padding: 3px 10px; border-radius: 20px;
  white-space: nowrap;
}
.section-header h2 {
  font-size: 22px; font-weight: 700; color: var(--text);
}
h3 {
  font-size: 15px; font-weight: 600; color: var(--blue);
  margin: 24px 0 10px;
}
p { color: var(--text-muted); margin-bottom: 12px; }
p strong { color: var(--text); font-weight: 600; }

/* â”€â”€ CALLOUT BOXES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.callout {
  display: flex; gap: 12px;
  padding: 14px 16px; border-radius: var(--radius);
  margin: 16px 0; border: 1px solid;
}
.callout-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
.callout-body { flex: 1; }
.callout-title { font-size: 12px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; margin-bottom: 4px; }
.callout-text { font-size: 13px; color: var(--text-muted); line-height: 1.6; }
.callout-text code { font-family: var(--font-mono); font-size: 12px; background: rgba(255,255,255,0.08); padding: 1px 5px; border-radius: 3px; }

.callout.info { background: rgba(88,166,255,0.08); border-color: rgba(88,166,255,0.3); }
.callout.info .callout-title { color: var(--blue); }
.callout.warn { background: rgba(240,180,41,0.08); border-color: rgba(240,180,41,0.3); }
.callout.warn .callout-title { color: var(--yellow); }
.callout.tip  { background: rgba(63,185,80,0.08); border-color: rgba(63,185,80,0.3); }
.callout.tip .callout-title  { color: var(--green); }
.callout.error { background: rgba(248,81,73,0.08); border-color: rgba(248,81,73,0.3); }
.callout.error .callout-title { color: var(--red); }
.callout.new { background: rgba(188,140,255,0.08); border-color: rgba(188,140,255,0.35); }
.callout.new .callout-title { color: var(--purple); }

/* â”€â”€ CODE BLOCKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.code-block {
  background: var(--code-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin: 12px 0;
  overflow: hidden;
}
.code-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 14px;
  background: var(--surface2); border-bottom: 1px solid var(--border);
}
.code-label { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }
.copy-btn {
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  background: var(--surface); border: 1px solid var(--border);
  color: var(--text-muted); padding: 3px 10px; border-radius: 4px;
  cursor: pointer; transition: all var(--transition); letter-spacing: 0.3px;
}
.copy-btn:hover { background: var(--border); color: var(--text); }
.copy-btn.copied { color: var(--green); border-color: rgba(63,185,80,0.4); }
pre {
  padding: 16px; overflow-x: auto; font-family: var(--font-mono);
  font-size: 13px; line-height: 1.65; tab-size: 2;
}
pre::-webkit-scrollbar { height: 4px; }
pre::-webkit-scrollbar-track { background: transparent; }
pre::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
.hl-comment { color: #6E7681; }
.hl-cmd     { color: #79C0FF; }
.hl-str     { color: #A5D6FF; }
.hl-key     { color: #FF7B72; }
.hl-val     { color: #FFA657; }
.hl-flag    { color: #D2A8FF; }
.hl-ok      { color: var(--green); }
.hl-warn    { color: var(--yellow); }

/* â”€â”€ STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.steps { margin: 16px 0; }
.step {
  display: flex; gap: 16px; margin-bottom: 20px;
  padding: 16px; background: var(--surface);
  border: 1px solid var(--border); border-radius: var(--radius);
}
.step-num {
  width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0;
  background: rgba(198,146,20,0.15); border: 1.5px solid rgba(198,146,20,0.5);
  color: var(--ucsd-gold); font-family: var(--font-mono); font-size: 12px;
  font-weight: 700; display: flex; align-items: center; justify-content: center;
}
.step-body { flex: 1; }
.step-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 6px; }
.step-desc { font-size: 13px; color: var(--text-muted); margin-bottom: 8px; }

/* â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.table-wrap { overflow-x: auto; margin: 16px 0; border-radius: var(--radius); border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead tr { background: var(--surface2); }
th {
  text-align: left; padding: 10px 14px;
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--text-dim); letter-spacing: 0.8px; text-transform: uppercase;
  border-bottom: 1px solid var(--border);
}
td {
  padding: 10px 14px; border-bottom: 1px solid var(--border);
  color: var(--text-muted); vertical-align: top;
}
td code { font-family: var(--font-mono); font-size: 12px; color: var(--blue); background: rgba(88,166,255,0.1); padding: 1px 5px; border-radius: 3px; }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: rgba(255,255,255,0.02); }

/* â”€â”€ FIGURES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
figure {
  margin: 20px 0; border-radius: var(--radius); overflow: hidden;
  border: 1px solid var(--border); background: var(--surface);
}
/* -------------------------------------------------------
   IMAGE REPLACEMENT HINT
   Each figure has a data-img-key attribute matching the
   filename in ./images/. To replace, drop a new file with
   the same name into ./images/ and push to GitHub.
------------------------------------------------------- */
.fig-img-wrap {
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  min-height: 120px; padding: 12px;
}
.fig-img-wrap img {
  max-width: 100%; height: auto; border-radius: 4px;
  display: block;
}
figcaption {
  padding: 10px 16px;
  font-family: var(--font-mono); font-size: 11px;
  color: var(--text-dim); border-top: 1px solid var(--border);
  display: flex; align-items: center; gap: 8px;
}
figcaption .fig-key {
  margin-left: auto; background: var(--surface2); border: 1px solid var(--border);
  padding: 2px 8px; border-radius: 3px; color: var(--text-dim); font-size: 10px;
  white-space: nowrap;
}

/* â”€â”€ BADGES & PILLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge {
  display: inline-block; font-family: var(--font-mono); font-size: 10px; font-weight: 700;
  padding: 2px 8px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.5px;
}
.badge-new    { background: rgba(188,140,255,0.2); color: var(--purple); border: 1px solid rgba(188,140,255,0.3); }
.badge-fix    { background: rgba(63,185,80,0.15); color: var(--green); border: 1px solid rgba(63,185,80,0.3); }
.badge-warn   { background: rgba(248,81,73,0.15); color: var(--red); border: 1px solid rgba(248,81,73,0.3); }

/* â”€â”€ TEAM ID WIDGET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.team-widget {
  background: linear-gradient(135deg, rgba(0,50,98,0.5), rgba(13,17,23,0.9));
  border: 1px solid rgba(198,146,20,0.4); border-radius: 10px;
  padding: 24px; margin: 24px 0;
}
.team-widget h4 {
  font-size: 14px; font-weight: 700; color: var(--ucsd-gold); margin-bottom: 16px;
  display: flex; align-items: center; gap: 8px;
}
.team-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(56px, 1fr)); gap: 8px;
}
.team-id-cell {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 6px; padding: 6px;
  text-align: center; font-family: var(--font-mono); font-size: 11px; color: var(--text-muted);
}
.team-id-cell .id-num { font-size: 16px; font-weight: 700; color: var(--text); }
.team-id-cell.my-team { background: rgba(198,146,20,0.15); border-color: rgba(198,146,20,0.5); }
.team-id-cell.my-team .id-num { color: var(--ucsd-gold); }

/* â”€â”€ HORIZONTAL RULE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-rule {
  height: 1px; background: var(--border); margin: 40px 0;
}

/* â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#back-top {
  position: fixed; bottom: 28px; right: 28px; z-index: 90;
  width: 40px; height: 40px; border-radius: 50%;
  background: var(--surface2); border: 1px solid var(--border);
  color: var(--text-muted); font-size: 18px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: all var(--transition); pointer-events: none;
}
#back-top.visible { opacity: 1; pointer-events: auto; }
#back-top:hover { background: var(--ucsd-gold); color: var(--bg); border-color: var(--ucsd-gold); }

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 900px) {
  #menu-toggle { display: block; }
  .sidebar { transform: translateX(-100%); z-index: 90; }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; padding: 24px 20px 60px; }
  .hero { padding: 28px 24px; }
}
</style>
</head>
<body>

<!-- â”€â”€ TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="topbar">
  <a href="#top" class="topbar-brand">
    <div class="topbar-logo">RC</div>
    <div>
      <div class="topbar-title">UCSD Robocar</div>
      <div class="topbar-sub">ECE / MAE 148</div>
    </div>
  </a>
  <div class="topbar-spacer"></div>
  <span class="topbar-tag">v2025 â€” TA Edition</span>
  <button id="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">â˜°</button>
</header>

<!-- â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav class="sidebar" id="sidebar">
  <span class="nav-section-label">Getting Started</span>
  <a class="nav-item" href="#s1">1 Â· Docker Setup</a>
  <a class="nav-item" href="#s2">2 Â· Pull Robocar Image</a>
  <a class="nav-item" href="#s3">3 Â· X11 Forwarding</a>
  <a class="nav-item" href="#s4">4 Â· Run Container</a>
  <a class="nav-item" href="#s5">5 Â· Python Error Fix</a>
  <a class="nav-item" href="#s6">6 Â· Build Workspace</a>
  <a class="nav-item" href="#s7">7 Â· Aliases</a>

  <div class="nav-divider"></div>
  <span class="nav-section-label">Hardware</span>
  <a class="nav-item" href="#s8">8 Â· Camera Power Fix</a>
  <a class="nav-item" href="#s9-domain">9 Â· Camera Isolation âœ¦</a>

  <div class="nav-divider"></div>
  <span class="nav-section-label">Calibration</span>
  <a class="nav-item" href="#s10">10 Â· Config Overview</a>
  <a class="nav-item" href="#s11">11 Â· Color (HSV)</a>
  <a class="nav-item" href="#s12">12 Â· Line / Lane</a>
  <a class="nav-item" href="#s13">13 Â· Actuator & PID</a>
  <a class="nav-item" href="#s14">14 Â· Camera Nav</a>

  <div class="nav-divider"></div>
  <span class="nav-section-label">Development</span>
  <a class="nav-item" href="#s15">15 Â· ROS2 Node Dev</a>
  <a class="nav-item" href="#s16">16 Â· Troubleshooting</a>
</nav>

<!-- â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main class="main" id="top">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-badge">ğŸ¤– ECE / MAE 148 â€” Autonomous Vehicles</div>
    <h1>UCSD Robocar Framework<br>Complete Setup & Calibration Guide</h1>
    <p>Full documentation for Docker setup, X11 forwarding, camera calibration, PID tuning, ROS2 node development, and multi-team camera isolation.</p>
    <div class="hero-meta">
      <div class="hero-meta-item"><div class="hero-meta-dot"></div> Raspberry Pi 4</div>
      <div class="hero-meta-item"><div class="hero-meta-dot"></div> ROS2 Foxy/Humble</div>
      <div class="hero-meta-item"><div class="hero-meta-dot"></div> OAK-D Camera</div>
      <div class="hero-meta-item"><div class="hero-meta-dot"></div> VESC 6 ESC</div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 1 â€” Docker Setup
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s1">
    <div class="section-header">
      <span class="section-num">01</span>
      <h2>Initial Setup & Docker Installation</h2>
    </div>

    <p><strong>Goal:</strong> Install Docker on the Raspberry Pi so the Robocar software runs in a clean, self-contained environment that does not affect the host OS.</p>

    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-body">
          <div class="step-title">SSH into your Pi</div>
          <div class="step-desc">Replace the hostname with your robot's assigned name.</div>
          <div class="code-block">
            <div class="code-header"><span class="code-label">Terminal â€” your laptop</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
            <pre><span class="hl-cmd">ssh</span> pi@ucsdrobocar-148-TA.local</pre>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-num">2</div>
        <div class="step-body">
          <div class="step-title">Remove Old Docker Versions</div>
          <div class="step-desc">Clears conflicting legacy packages. "Package not found" errors are fine â€” it just means it was never installed.</div>
          <div class="code-block">
            <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
            <pre><span class="hl-cmd">sudo apt remove</span> docker docker-engine docker.io containerd runc</pre>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-num">3</div>
        <div class="step-body">
          <div class="step-title">Install Prerequisites</div>
          <div class="step-desc"><strong>ca-certificates</strong> trusts HTTPS. <strong>curl</strong> downloads files. <strong>gnupg</strong> verifies Docker's cryptographic signature. The keyrings directory stores the trusted key.</div>
          <div class="code-block">
            <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
            <pre><span class="hl-cmd">sudo apt update</span>
<span class="hl-cmd">sudo apt install</span> ca-certificates curl gnupg <span class="hl-flag">-y</span>
<span class="hl-cmd">sudo install</span> <span class="hl-flag">-m 0755 -d</span> /etc/apt/keyrings</pre>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-num">4</div>
        <div class="step-body">
          <div class="step-title">Add Docker's Official Repository</div>
          <div class="step-desc">Fetches Docker's GPG key and registers the official repo, ensuring packages are authentic and up to date.</div>
          <div class="code-block">
            <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
            <pre><span class="hl-cmd">curl</span> <span class="hl-flag">-fsSL</span> https://download.docker.com/linux/debian/gpg | \
  <span class="hl-cmd">sudo gpg</span> <span class="hl-flag">--dearmor -o</span> /etc/apt/keyrings/docker.gpg
<span class="hl-cmd">sudo chmod</span> a+r /etc/apt/keyrings/docker.gpg
<span class="hl-cmd">echo</span> <span class="hl-str">"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable"</span> \
  | <span class="hl-cmd">sudo tee</span> /etc/apt/sources.list.d/docker.list > /dev/null</pre>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-num">5</div>
        <div class="step-body">
          <div class="step-title">Install Docker Engine</div>
          <div class="code-block">
            <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
            <pre><span class="hl-cmd">sudo apt update</span>
<span class="hl-cmd">sudo apt install</span> docker-ce docker-ce-cli containerd.io \
  docker-buildx-plugin docker-compose-plugin <span class="hl-flag">-y</span></pre>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-num">6</div>
        <div class="step-body">
          <div class="step-title">Grant Docker Permissions & Reboot</div>
          <div class="step-desc">Adds your user to the <code>docker</code> group so you never need <code>sudo docker</code>. Reboot is mandatory.</div>
          <div class="code-block">
            <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
            <pre><span class="hl-cmd">sudo usermod</span> <span class="hl-flag">-aG</span> docker $USER
<span class="hl-cmd">sudo reboot</span></pre>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-num">7</div>
        <div class="step-body">
          <div class="step-title">Verify Installation</div>
          <div class="code-block">
            <div class="code-header"><span class="code-label">Pi terminal (after reboot)</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
            <pre><span class="hl-cmd">docker --version</span>
<span class="hl-cmd">docker run</span> hello-world</pre>
          </div>
          <div class="callout tip">
            <div class="callout-icon">âœ“</div>
            <div class="callout-body"><div class="callout-title">Success</div><div class="callout-text">You should see "Hello from Docker!" in the output. If you get <em>permission denied</em>, log out and back in â€” the group change hasn't taken effect yet.</div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 2 â€” Pull Image
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s2">
    <div class="section-header">
      <span class="section-num">02</span>
      <h2>Pulling the Robocar Image</h2>
    </div>

    <div class="callout warn">
      <div class="callout-icon">âš </div>
      <div class="callout-body"><div class="callout-title">Network Warning</div><div class="callout-text">This image is ~14.7 GB. Avoid campus WiFi â€” it drops mid-download. Use a home network or wired Ethernet. The pull can be safely restarted if interrupted.</div></div>
    </div>

    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi terminal â€” expect 20â€“40 min</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">docker pull</span> djnighti/ucsd_robocar:devel</pre>
    </div>

    <h3>Verify Download</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">docker images</span> | grep ucsd_robocar
<span class="hl-comment"># Expected: djnighti/ucsd_robocar   devel   ...   ~14.7GB</span></pre>
    </div>

    <h3>Troubleshooting</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
      <tbody>
        <tr><td>Download freezes</td><td>Re-run <code>docker pull</code> â€” resumes from last layer</td></tr>
        <tr><td>No space left</td><td><code>docker system prune -f</code></td></tr>
        <tr><td>Image shows 0B</td><td>Silent failure â€” re-run pull command</td></tr>
      </tbody>
    </table></div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 3 â€” X11 Forwarding (ENHANCED)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s3">
    <div class="section-header">
      <span class="section-num">03</span>
      <h2>Graphical Interface Setup (X11 Forwarding)</h2>
      <span class="badge badge-fix">Enhanced</span>
    </div>

    <p><strong>Goal:</strong> Forward GUI windows from the Pi (camera feeds, calibration sliders) to your laptop screen over SSH. Without this, calibration tools will not display.</p>

    <h3>Step 1 â€” Install X11 on the Pi</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">sudo apt update</span>
<span class="hl-cmd">sudo apt install</span> <span class="hl-flag">-y</span> x11-apps</pre>
    </div>

    <h3>Step 2 â€” Install an X Server on Your Laptop</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>OS</th><th>Software</th><th>Extra Setup</th></tr></thead>
      <tbody>
        <tr><td><strong>macOS</strong></td><td>XQuartz â€” xquartz.org</td><td>After install: Preferences â†’ Security â†’ âœ“ "Allow connections from network clients". Then restart your Mac.</td></tr>
        <tr><td><strong>Windows</strong></td><td>MobaXterm (handles X11 automatically)</td><td>None required.</td></tr>
        <tr><td><strong>Linux</strong></td><td>Built-in X11</td><td>None required.</td></tr>
      </tbody>
    </table></div>

    <h3>Step 3 â€” SSH with X11 Forwarding</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Your laptop terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Recommended: trusted forwarding (required if -X causes display errors)</span>
<span class="hl-cmd">ssh</span> <span class="hl-flag">-Y</span> pi@ucsdrobocar-148-TA.local

<span class="hl-comment"># Alternative: untrusted forwarding (stricter security)</span>
<span class="hl-cmd">ssh</span> <span class="hl-flag">-X</span> pi@ucsdrobocar-148-TA.local</pre>
    </div>
    <div class="callout info">
      <div class="callout-icon">â„¹</div>
      <div class="callout-body"><div class="callout-title">-Y vs -X</div><div class="callout-text">Use <code>-Y</code> (trusted) when <code>-X</code> gives "cannot open display" inside Docker. The container runs as <code>root</code>, which requires trusted forwarding to render windows on your laptop's X server.</div></div>
    </div>

    <h3>Step 4 â€” Test X11 (on Pi host, before Docker)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi terminal (NOT inside Docker)</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">xeyes</span>
<span class="hl-comment"># A pair of eyes should appear on your LAPTOP screen</span></pre>
    </div>

    <!-- FIGURE: xeyes -->
    <!-- IMAGE REPLACE: swap images/fig_xeyes.jpg with a new screenshot to update this figure -->
    <figure data-img-key="fig_xeyes.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_xeyes.jpg" alt="xeyes window forwarded via X11 to laptop screen" loading="lazy">
      </div>
      <figcaption>Figure 3.1 â€” Successful xeyes window forwarded through SSH X11 to laptop<span class="fig-key">images/fig_xeyes.jpg</span></figcaption>
    </figure>

    <h3>Step 5 â€” Why Each Docker Flag is Needed for X11</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Docker Flag</th><th>Why It's Required</th></tr></thead>
      <tbody>
        <tr><td><code>-e DISPLAY=$DISPLAY</code></td><td>Passes the Pi's X11 display address (e.g., <code>:10</code>) into the container so GUI apps know where to send windows.</td></tr>
        <tr><td><code>--volume="$HOME/.Xauthority:/root/.Xauthority:rw"</code></td><td>Shares the authentication cookie. Without this, the X server rejects connections with "Authorization required".</td></tr>
        <tr><td><code>--net=host</code></td><td>Container shares the Pi's network and Unix socket, required for X11 traffic to flow.</td></tr>
      </tbody>
    </table></div>

    <h3>Verify X11 Inside the Container</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker container</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">echo</span> $DISPLAY          <span class="hl-comment"># Must NOT be empty â€” should show :10 or similar</span>
<span class="hl-cmd">xeyes</span>                  <span class="hl-comment"># Eyes must appear on your laptop screen</span></pre>
    </div>

    <h3>Common X11 Errors & Fixes</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Error</th><th>Fix</th></tr></thead>
      <tbody>
        <tr><td>"cannot open display"</td><td>Re-SSH with <code>-Y</code> flag</td></tr>
        <tr><td>"No protocol specified"</td><td>On Pi host: <code>xhost +local:</code></td></tr>
        <tr><td>"Authorization required"</td><td>Ensure <code>.Xauthority</code> is volume-mounted in Docker run</td></tr>
        <tr><td>Breaks after reboot</td><td>Run: <code>xauth generate $DISPLAY . trusted</code> then re-SSH</td></tr>
        <tr><td>macOS: nothing appears</td><td>Enable "Allow connections from network clients" in XQuartz Preferences â†’ Security</td></tr>
      </tbody>
    </table></div>

    <h3>Xauth Reset Script (when X11 breaks after reboot)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi host terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">xauth generate</span> $DISPLAY . trusted
<span class="hl-cmd">xauth list</span>
<span class="hl-cmd">exit</span>                   <span class="hl-comment"># then re-SSH:</span>
<span class="hl-cmd">ssh</span> <span class="hl-flag">-Y</span> pi@ucsdrobocar-148-TA.local</pre>
    </div>
    <div class="callout warn">
      <div class="callout-icon">âš </div>
      <div class="callout-body"><div class="callout-title">Xauthority lock error</div><div class="callout-text">If you see "timeout in locking authority file", delete it and retry:<br><code>rm ~/.Xauthority && ssh -Y pi@ucsdrobocar-148-TA.local</code></div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 4 â€” Run Container
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s4">
    <div class="section-header">
      <span class="section-num">04</span>
      <h2>Running the Docker Container</h2>
    </div>

    <p>Add a shell function to <code>~/.bashrc</code> on the Pi so you don't have to type the full <code>docker run</code> command every time.</p>

    <h3>Step 1 â€” Add the Function to .bashrc</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi terminal â€” open .bashrc</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">nano</span> ~/.bashrc</pre>
    </div>
    <p>Paste this at the bottom. Replace <code>MY_CONTAINER_NAME</code> with your team's container name (e.g., <code>team04_car</code>):</p>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Paste into ~/.bashrc</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre>robocar_docker() {
  <span class="hl-cmd">docker run</span> \
    <span class="hl-flag">--name</span> MY_CONTAINER_NAME \
    <span class="hl-flag">-it</span> \
    <span class="hl-flag">--privileged</span> \
    <span class="hl-flag">--net=host</span> \
    <span class="hl-flag">-e</span> DISPLAY=$DISPLAY \
    <span class="hl-flag">-e</span> ROS_DOMAIN_ID=<span class="hl-val">YOUR_TEAM_ID</span> \   <span class="hl-comment"># â† See Section 9</span>
    <span class="hl-flag">--volume</span> /dev/bus/usb:/dev/bus/usb \
    <span class="hl-flag">--device-cgroup-rule=</span><span class="hl-str">'c 189:* rmw'</span> \
    <span class="hl-flag">--device</span> /dev/video0 \
    <span class="hl-flag">--volume=</span><span class="hl-str">"$HOME/.Xauthority:/root/.Xauthority:rw"</span> \
    <span class="hl-flag">--volume</span> /etc/passwd:/etc/passwd:ro \
    <span class="hl-flag">--volume</span> /etc/group:/etc/group:ro \
    djnighti/ucsd_robocar:${2:-devel}
}</pre>
    </div>
    <div class="callout info">
      <div class="callout-icon">â„¹</div>
      <div class="callout-body"><div class="callout-title">ROS_DOMAIN_ID</div><div class="callout-text">The <code>-e ROS_DOMAIN_ID=YOUR_TEAM_ID</code> line is critical for multi-team labs. See <strong>Section 9</strong> for your assigned team ID and why this prevents camera cross-talk.</div></div>
    </div>

    <h3>Step 2 â€” Reload and Launch</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">source</span> ~/.bashrc
<span class="hl-cmd">robocar_docker</span> MY_CONTAINER_NAME</pre>
    </div>

    <h3>Step 3 â€” Manage the Container After First Launch</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi terminal â€” after exit or reboot</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Start existing container</span>
<span class="hl-cmd">docker start</span> MY_CONTAINER_NAME

<span class="hl-comment"># Enter it (first terminal)</span>
<span class="hl-cmd">docker exec -it</span> MY_CONTAINER_NAME bash

<span class="hl-comment"># Open a second terminal into the same container</span>
<span class="hl-cmd">docker exec -it</span> MY_CONTAINER_NAME bash</pre>
    </div>
    <div class="callout tip">
      <div class="callout-icon">âœ“</div>
      <div class="callout-body"><div class="callout-title">Multiple Terminals</div><div class="callout-text">You will regularly need 3â€“4 concurrent windows: one for <code>ros2 launch</code>, one for config editing, one for topic monitoring, one for debugging.</div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 5 â€” Python Fix
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s5">
    <div class="section-header">
      <span class="section-num">05</span>
      <h2>Fixing Python Errors (If Needed)</h2>
    </div>
    <p>Some containers throw an <code>AttributeError: module 'apport_python_hook' has no attribute 'install'</code> when running ROS2 commands. This fix creates a safe <code>sitecustomize.py</code> that catches and ignores the error.</p>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker container</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">cat</span> > /usr/lib/python3.8/sitecustomize.py &lt;&lt;<span class="hl-str">'EOF'</span>
<span class="hl-comment"># Safe sitecustomize for containers</span>
try:
    import apport_python_hook
    if hasattr(apport_python_hook, <span class="hl-str">'install'</span>):
        apport_python_hook.install()
except Exception:
    pass
<span class="hl-str">EOF</span>

<span class="hl-comment"># Remove cached bytecode</span>
<span class="hl-cmd">rm -f</span> /usr/lib/python3.8/__pycache__/sitecustomize.cpython-38.pyc 2>/dev/null || true

<span class="hl-comment"># Verify</span>
<span class="hl-cmd">python3</span> -c <span class="hl-str">"print('python clean')"</span>
<span class="hl-cmd">ros2 --help</span> | head -3</pre>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 6 â€” Build Workspace
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s6">
    <div class="section-header">
      <span class="section-num">06</span>
      <h2>Package Installation & Build</h2>
    </div>

    <h3>Step 1 â€” Update setup.py</h3>
    <p>This version uses <code>os.walk</code> to recursively include all launch files, YAML configs, and RVIZ setups â€” fixing the common "launch file not found" error.</p>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker â€” navigate first</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">cd</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg</pre>
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker â€” write setup.py</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">cat</span> > setup.py &lt;&lt;<span class="hl-str">'EOF'</span>
from setuptools import setup
import os

package_name = <span class="hl-str">'ucsd_robocar_nav2_pkg'</span>

def package_files(directory):
    paths = []
    for (path, _, filenames) in os.walk(directory):
        for f in filenames:
            paths.append(os.path.join(path, f))
    return paths

data_files = [
    (<span class="hl-str">'share/ament_index/resource_index/packages'</span>, [<span class="hl-str">'resource/'</span> + package_name]),
    (<span class="hl-str">'share/'</span> + package_name, [<span class="hl-str">'package.xml'</span>]),
]

for d in [<span class="hl-str">'launch'</span>, <span class="hl-str">'config'</span>, <span class="hl-str">'rviz'</span>, <span class="hl-str">'urdf'</span>, <span class="hl-str">'ros_data'</span>]:
    if os.path.isdir(d):
        data_files.append((os.path.join(<span class="hl-str">'share'</span>, package_name, d), package_files(d)))

setup(
    name=package_name, version=<span class="hl-str">'0.0.0'</span>,
    packages=[package_name], data_files=data_files,
    install_requires=[<span class="hl-str">'setuptools'</span>], zip_safe=True,
    maintainer=<span class="hl-str">'root'</span>, maintainer_email=<span class="hl-str">'root@todo.todo'</span>,
    description=<span class="hl-str">'Nav2 launch/config package for UCSD RoboCar'</span>,
    license=<span class="hl-str">'TODO'</span>, tests_require=[<span class="hl-str">'pytest'</span>],
    entry_points={<span class="hl-str">'console_scripts'</span>: []},
)
<span class="hl-str">EOF</span></pre>
    </div>

    <h3>Step 2 â€” Build the Workspace</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">cd</span> /home/projects/ros2_ws
<span class="hl-cmd">rm -rf</span> build install log
<span class="hl-cmd">colcon build</span> <span class="hl-flag">--symlink-install</span>
<span class="hl-cmd">source</span> install/setup.bash
<span class="hl-cmd">ros2 pkg list</span> | grep ucsd_robocar_nav2_pkg</pre>
    </div>
    <div class="callout warn">
      <div class="callout-icon">âš </div>
      <div class="callout-body"><div class="callout-title">Always source after build</div><div class="callout-text">Run <code>source install/setup.bash</code> after every build. Without it, <code>ros2</code> will not find newly built packages. Section 7 creates an alias that handles this automatically.</div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 7 â€” Aliases
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s7">
    <div class="section-header">
      <span class="section-num">07</span>
      <h2>Shell Aliases: source_ros2 &amp; build_ros2</h2>
    </div>

    <p>Add these aliases to the container's <code>~/.bashrc</code> so you never have to type long colcon commands again. All steps in this guide use these aliases.</p>

    <div class="callout info">
      <div class="callout-icon">â„¹</div>
      <div class="callout-body"><div class="callout-title">Inside the container</div><div class="callout-text">These aliases go in <code>/root/.bashrc</code> INSIDE Docker, not the Pi host's .bashrc.</div></div>
    </div>

    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker â€” add to ~/.bashrc</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Source workspace only (fast â€” no recompile)</span>
alias source_ros2=<span class="hl-str">'source /home/projects/ros2_ws/install/setup.bash && echo "[ROS2] Sourced"'</span>

<span class="hl-comment"># Build then source (use after ANY file change)</span>
alias build_ros2=<span class="hl-str">'cd /home/projects/ros2_ws && colcon build --symlink-install && source install/setup.bash && echo "[ROS2] Build complete"'</span>

<span class="hl-comment"># Source global ROS2 install</span>
source /opt/ros/foxy/setup.bash 2>/dev/null || source /opt/ros/humble/setup.bash 2>/dev/null</pre>
    </div>

    <div class="code-block">
      <div class="code-header"><span class="code-label">Activate and test</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">source</span> ~/.bashrc
<span class="hl-cmd">source_ros2</span>
<span class="hl-cmd">build_ros2</span></pre>
    </div>

    <div class="table-wrap"><table>
      <thead><tr><th>Command</th><th>When to Use</th></tr></thead>
      <tbody>
        <tr><td><code>source_ros2</code></td><td>Opening a new terminal. Fast, no recompile.</td></tr>
        <tr><td><code>build_ros2</code></td><td>After ANY change to code, YAML, launch files, or setup.py.</td></tr>
      </tbody>
    </table></div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 8 â€” Camera Power
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s8">
    <div class="section-header">
      <span class="section-num">08</span>
      <h2>Camera Power Fix â€” USB Current &amp; Powered Hub</h2>
    </div>

    <div class="callout error">
      <div class="callout-icon">âœ—</div>
      <div class="callout-body"><div class="callout-title">Common Failure</div><div class="callout-text">The OAK-D camera draws up to 900mA peak. The Pi's USB ports supply ~600mA total by default, causing the camera to disconnect randomly, produce black frames, or fail to enumerate.</div></div>
    </div>

    <h3>Diagnose the Problem</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi host terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Look for "over-current" or "device not accepting address"</span>
<span class="hl-cmd">dmesg</span> | grep -i <span class="hl-str">'usb\|over-current\|power'</span> | tail -20

<span class="hl-comment"># Camera should appear here â€” Luxonis / Intel Movidius</span>
<span class="hl-cmd">lsusb</span> | grep -i <span class="hl-str">'movidius\|luxonis\|intel'</span></pre>
    </div>

    <h3>Solution 1 â€” Software Fix (config.txt)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi host terminal</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">sudo nano</span> /boot/config.txt
<span class="hl-comment"># Add this line at the END of the file:</span>
<span class="hl-key">max_usb_current</span>=<span class="hl-val">1</span>
<span class="hl-comment"># Save: Ctrl+O â†’ Enter â†’ Ctrl+X</span>
<span class="hl-cmd">sudo reboot</span></pre>
    </div>
    <div class="callout warn">
      <div class="callout-icon">âš </div>
      <div class="callout-body"><div class="callout-title">Requires a quality power supply</div><div class="callout-text">This only works with a 5V/3A+ USB-C supply. Cheap supplies will still fail. Check <code>dmesg | grep -i voltage</code> for undervoltage warnings after reboot.</div></div>
    </div>

    <h3>Solution 2 â€” Powered USB Hub (Recommended)</h3>
    <p>A powered hub gives the camera its own 5V/2A supply, completely bypassing the Pi's USB regulator.</p>
    <div class="table-wrap"><table>
      <thead><tr><th>Item</th><th>Spec</th></tr></thead>
      <tbody>
        <tr><td>Hub type</td><td>USB 3.0 with external power adapter (NOT bus-powered)</td></tr>
        <tr><td>Hub adapter</td><td>5V / 2A minimum (dedicated supply)</td></tr>
        <tr><td>Connection chain</td><td>Pi USB-A â†’ Hub â†’ OAK-D + VESC + other USB devices</td></tr>
      </tbody>
    </table></div>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Verify after connecting hub</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">lsusb</span> | grep -i luxonis       <span class="hl-comment"># Camera must appear</span>
<span class="hl-cmd">ls</span> /dev/video*               <span class="hl-comment"># Device node must exist</span></pre>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 9 â€” CAMERA ISOLATION (NEW)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s9-domain">
    <div class="section-header">
      <span class="section-num">09</span>
      <h2>Camera Isolation â€” Prevent Cross-Team Interference</h2>
      <span class="badge badge-new">New</span>
    </div>

    <div class="callout error">
      <div class="callout-icon">âœ—</div>
      <div class="callout-body">
        <div class="callout-title">Critical Lab Issue â€” Read Before Calibrating</div>
        <div class="callout-text">All robots running ROS2 on the same WiFi network can see each other's topics by default. This means during lab sessions Team 1's calibration sliders could be controlling Team 3's camera, or your robot's <code>/cmd_vel</code> could receive steering commands from another team's lane detection node. This causes extremely confusing behavior during calibration.</div>
      </div>
    </div>

    <h3>Root Cause â€” ROS2 DDS Discovery</h3>
    <p>ROS2 uses DDS (Data Distribution Service) for communication. By default, every ROS2 node on the same local network segment joins <strong>Domain ID 0</strong> and can discover all other nodes in that domain. With 10+ teams in the lab, all running identical node names and topic names, nodes connect to whichever publisher they find first â€” often the wrong team's robot.</p>

    <h3>The Fix â€” ROS_DOMAIN_ID</h3>
    <p>Each team is assigned a unique <strong>Domain ID</strong>. Nodes in different domain IDs cannot see each other at all â€” they are completely isolated at the network layer. This requires zero code changes; it's purely an environment variable.</p>

    <div class="team-widget">
      <h4>ğŸ· Team Domain ID Assignments</h4>
      <p style="font-size:12px; color:var(--text-muted); margin-bottom:14px;">Each team uses their team number as their Domain ID. IDs are valid from 0â€“232.</p>
      <div class="team-grid" id="team-grid">
        <!-- Generated by JS below -->
      </div>
    </div>

    <h3>Step 1 â€” Set ROS_DOMAIN_ID in the Docker Run Command</h3>
    <p>In your <code>robocar_docker</code> function in <code>~/.bashrc</code> on the Pi, replace <code>YOUR_TEAM_ID</code> with your team number:</p>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Pi ~/.bashrc â€” inside robocar_docker function</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Add this line to the docker run command (replace 4 with YOUR team number)</span>
<span class="hl-flag">-e</span> ROS_DOMAIN_ID=<span class="hl-val">4</span> \</pre>
    </div>

    <h3>Step 2 â€” Set ROS_DOMAIN_ID Inside the Container</h3>
    <p>Add to the container's <code>~/.bashrc</code> so every new terminal automatically uses your domain:</p>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker â€” add to ~/.bashrc</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Add this line â€” replace 4 with YOUR team number</span>
<span class="hl-key">export</span> ROS_DOMAIN_ID=<span class="hl-val">4</span>

<span class="hl-comment"># Reload</span>
<span class="hl-cmd">source</span> ~/.bashrc</pre>
    </div>

    <h3>Step 3 â€” Verify Isolation</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Confirm your domain ID</span>
<span class="hl-cmd">echo</span> $ROS_DOMAIN_ID           <span class="hl-ok"># Must print YOUR team number, not empty</span>

<span class="hl-comment"># Launch your nodes, then check topic list</span>
<span class="hl-comment"># You should ONLY see your own robot's topics</span>
<span class="hl-cmd">ros2 topic list</span>

<span class="hl-comment"># If you see topics you didn't launch â€” wrong domain ID</span></pre>
    </div>

    <h3>Step 4 â€” Additional Camera Topic Namespacing (Optional, Recommended)</h3>
    <p>For extra isolation, namespace your camera topics with your team name. This prevents topic name collisions even if two teams accidentally use the same Domain ID.</p>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker â€” add to ~/.bashrc</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment"># Namespace all your ROS2 nodes under your team name</span>
<span class="hl-comment"># Replace "team04" with your team identifier</span>
<span class="hl-key">export</span> ROS_NAMESPACE=<span class="hl-val">team04</span>

<span class="hl-comment"># Your topics will now appear as /team04/camera/color/image_raw</span>
<span class="hl-comment"># instead of /camera/color/image_raw</span></pre>
    </div>
    <div class="callout warn">
      <div class="callout-icon">âš </div>
      <div class="callout-body"><div class="callout-title">Namespacing changes topic paths</div><div class="callout-text">If you use <code>ROS_NAMESPACE</code>, update any topic subscriptions in your custom nodes to use the namespaced path (e.g., <code>/team04/error</code> instead of <code>/error</code>). The built-in robocar packages handle namespacing automatically.</div></div>
    </div>

    <h3>Summary: Multi-Team Checklist</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Where</th><th>What to Set</th><th>Value</th></tr></thead>
      <tbody>
        <tr><td>Pi <code>~/.bashrc</code> (docker run)</td><td><code>-e ROS_DOMAIN_ID=N</code></td><td>Your team number</td></tr>
        <tr><td>Container <code>~/.bashrc</code></td><td><code>export ROS_DOMAIN_ID=N</code></td><td>Your team number</td></tr>
        <tr><td>Container <code>~/.bashrc</code> (optional)</td><td><code>export ROS_NAMESPACE=teamNN</code></td><td>Your team identifier</td></tr>
        <tr><td>Verify</td><td><code>echo $ROS_DOMAIN_ID</code></td><td>Must match your team number</td></tr>
      </tbody>
    </table></div>

    <div class="callout tip">
      <div class="callout-icon">âœ“</div>
      <div class="callout-body"><div class="callout-title">Quick sanity check during lab</div><div class="callout-text">Before every calibration session, run <code>echo $ROS_DOMAIN_ID</code> in your container. If it's empty or shows <code>0</code>, your isolation is not active and you risk controlling another team's robot.</div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 10 â€” Config Overview
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s10">
    <div class="section-header">
      <span class="section-num">10</span>
      <h2>Calibration Overview &amp; Config Files</h2>
    </div>
    <div class="table-wrap"><table>
      <thead><tr><th>File</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td><code>node_config.yaml</code></td><td>Controls which nodes/components launch at startup</td></tr>
        <tr><td><code>car_config.yaml</code></td><td>Selects active hardware (camera type, motor controller)</td></tr>
        <tr><td><code>ros_racer_calibration.yaml</code></td><td>PID gains, throttle limits, steering limits</td></tr>
      </tbody>
    </table></div>

    <h3>Calibration Mode Config</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">node_config.yaml â€” calibration mode</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-key">all_components</span>:          <span class="hl-val">1</span>
<span class="hl-key">camera_nav_calibration</span>:  <span class="hl-val">1</span>   <span class="hl-comment"># ENABLE calibration GUI</span>
<span class="hl-key">sensor_visualization</span>:    <span class="hl-val">1</span>   <span class="hl-comment"># Enable for LiDAR testing</span>
<span class="hl-key">camera_nav</span>:              <span class="hl-val">0</span>   <span class="hl-comment"># DISABLE autonomous nav</span></pre>
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-label">car_config.yaml â€” both modes</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-key">oakd</span>:              <span class="hl-val">1</span>
<span class="hl-key">vesc_without_odom</span>: <span class="hl-val">1</span></pre>
    </div>

    <h3>Navigation Mode Config (After Calibration)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">node_config.yaml â€” navigation mode</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-key">all_components</span>:          <span class="hl-val">1</span>
<span class="hl-key">camera_nav_calibration</span>:  <span class="hl-val">0</span>   <span class="hl-comment"># Disable GUI</span>
<span class="hl-key">sensor_visualization</span>:    <span class="hl-val">0</span>
<span class="hl-key">camera_nav</span>:              <span class="hl-val">1</span>   <span class="hl-comment"># ENABLE autonomous driving</span></pre>
    </div>
    <div class="callout warn">
      <div class="callout-icon">âš </div>
      <div class="callout-body"><div class="callout-title">Always build_ros2 after YAML edits</div><div class="callout-text">Running <code>source_ros2</code> alone is NOT enough after changing YAML files. You must run <code>build_ros2</code> for config changes to take effect.</div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 11 â€” Color Calibration
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s11">
    <div class="section-header">
      <span class="section-num">11</span>
      <h2>Color Calibration (HSV Tuning)</h2>
    </div>

    <p>The lane detection pipeline uses HSV color filtering to isolate road markers. Pixels inside the HSV range become white (detected); everything else becomes black (ignored).</p>

    <!-- FIGURE: HSV chart -->
    <!-- IMAGE REPLACE: swap images/fig_hsv_chart.jpg with updated HSV diagram -->
    <figure data-img-key="fig_hsv_chart.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_hsv_chart.jpg" alt="HSV color wheel showing Hue 0-180" loading="lazy">
      </div>
      <figcaption>Figure 11.1 â€” HSV Hue spectrum (0â€“180 in OpenCV). Yellow = Hâ‰ˆ30. <span class="fig-key">images/fig_hsv_chart.jpg</span></figcaption>
    </figure>

    <div class="table-wrap"><table>
      <thead><tr><th>Channel</th><th>Range</th><th>Low Value Effect</th><th>High Value Effect</th></tr></thead>
      <tbody>
        <tr><td><strong>Hue (H)</strong></td><td>0â€“180</td><td>Red tones</td><td>Cycles back to red via purple</td></tr>
        <tr><td><strong>Saturation (S)</strong></td><td>0â€“255</td><td>White / gray</td><td>Pure vivid color</td></tr>
        <tr><td><strong>Value (V)</strong></td><td>0â€“255</td><td>Black / dark</td><td>Bright color</td></tr>
      </tbody>
    </table></div>

    <div class="callout info">
      <div class="callout-icon">â„¹</div>
      <div class="callout-body"><div class="callout-title">OpenCV Hue is 0â€“180, not 0â€“360</div><div class="callout-text">When looking up reference Hue values from a color picker, divide by 2. Standard yellow = 60Â° â†’ OpenCV H = 30.</div></div>
    </div>

    <!-- FIGURE: default sliders -->
    <!-- IMAGE REPLACE: swap images/fig_mask_default.jpg -->
    <figure data-img-key="fig_mask_default.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_mask_default.jpg" alt="Default HSV mask sliders â€” all pass" loading="lazy">
      </div>
      <figcaption>Figure 11.2 â€” Default sliders: entire image passes as white (everything detected). <span class="fig-key">images/fig_mask_default.jpg</span></figcaption>
    </figure>

    <!-- FIGURE: yellow-tuned mask -->
    <!-- IMAGE REPLACE: swap images/fig_mask_yellow.jpg -->
    <figure data-img-key="fig_mask_yellow.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_mask_yellow.jpg" alt="HSV tuned for yellow road dots" loading="lazy">
      </div>
      <figcaption>Figure 11.3 â€” Tuned for yellow (lowH=25, highH=35, lowSâ‰ˆ56, lowVâ‰ˆ112). Only yellow road dots appear white. <span class="fig-key">images/fig_mask_yellow.jpg</span></figcaption>
    </figure>

    <h3>Calibration Procedure</h3>
    <div class="steps">
      <div class="step"><div class="step-num">1</div><div class="step-body"><div class="step-title">Launch calibration GUI</div><div class="step-desc"><code>build_ros2</code> then <code>ros2 launch ucsd_robocar_nav2_pkg all_nodes.launch.py</code></div></div></div>
      <div class="step"><div class="step-num">2</div><div class="step-body"><div class="step-title">Set Hue Range for Yellow</div><div class="step-desc">Set <code>lowH=25</code>, <code>highH=35</code>. This isolates yellow hues.</div></div></div>
      <div class="step"><div class="step-num">3</div><div class="step-body"><div class="step-title">Tune Saturation</div><div class="step-desc">Raise <code>lowS</code> to ~50â€“80 to eliminate gray background. If yellow spots disappear, lower it.</div></div></div>
      <div class="step"><div class="step-num">4</div><div class="step-body"><div class="step-title">Tune Value</div><div class="step-desc">Raise <code>lowV</code> to ~80â€“120 to eliminate dark noise. If shadows on yellow marks disappear, lower it.</div></div></div>
      <div class="step"><div class="step-num">5</div><div class="step-body"><div class="step-title">Remove Background Noise</div><div class="step-desc">Adjust <code>erosion_iterations</code> to shrink speckles. Adjust <code>dilation_iterations</code> to restore valid markers.</div></div></div>
    </div>

    <!-- FIGURE: BW calibration -->
    <!-- IMAGE REPLACE: swap images/fig_bw_calibration.jpg -->
    <figure data-img-key="fig_bw_calibration.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_bw_calibration.jpg" alt="Noise reduction calibration sliders" loading="lazy">
      </div>
      <figcaption>Figure 11.4 â€” Noise reduction sliders (gray_thresh, erosion, dilation). <span class="fig-key">images/fig_bw_calibration.jpg</span></figcaption>
    </figure>

    <h3>Color Reference Table</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Color</th><th>lowH</th><th>highH</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Yellow (center dots)</td><td>25</td><td>35</td><td>Primary track target</td></tr>
        <tr><td>White (lane lines)</td><td>0</td><td>180 + invert=1</td><td>Use inverted filter</td></tr>
        <tr><td>Orange cones</td><td>10</td><td>20</td><td>Varies by lighting</td></tr>
        <tr><td>Red stop line</td><td>0â€“10</td><td>or 165â€“179</td><td>Red wraps around H=0; may need two ranges</td></tr>
      </tbody>
    </table></div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 12 â€” Line / Lane Calibration
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s12">
    <div class="section-header">
      <span class="section-num">12</span>
      <h2>Line / Lane Calibration</h2>
    </div>

    <!-- FIGURE: line calibration -->
    <!-- IMAGE REPLACE: swap images/fig_line_calibration.jpg -->
    <figure data-img-key="fig_line_calibration.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_line_calibration.jpg" alt="Line detection calibration window" loading="lazy">
      </div>
      <figcaption>Figure 12.1 â€” Line calibration view: green segments = detected lines, blue dot = centroid. <span class="fig-key">images/fig_line_calibration.jpg</span></figcaption>
    </figure>

    <div class="table-wrap"><table>
      <thead><tr><th>Parameter</th><th>Effect</th><th>Tip</th></tr></thead>
      <tbody>
        <tr><td><code>min_width</code></td><td>Min pixel width of a valid contour</td><td>Set ~15 to ignore thin distant lines</td></tr>
        <tr><td><code>max_width</code></td><td>Max pixel width; filters large blobs</td><td>Set ~200; reduce if full-road blobs detected</td></tr>
        <tr><td><code>number_of_lines</code></td><td>How many line segments used for centroid</td><td>Start at 3â€“4</td></tr>
      </tbody>
    </table></div>

    <h3>Error Threshold</h3>

    <!-- FIGURE: error threshold -->
    <!-- IMAGE REPLACE: swap images/fig_error_threshold.jpg -->
    <figure data-img-key="fig_error_threshold.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_error_threshold.jpg" alt="Error threshold red bars in calibration view" loading="lazy">
      </div>
      <figcaption>Figure 12.2 â€” Red bars = error threshold zone. Lines inside this zone are ignored (treated as zero error). <span class="fig-key">images/fig_error_threshold.jpg</span></figcaption>
    </figure>

    <div class="table-wrap"><table>
      <thead><tr><th>Scenario</th><th>Effect</th></tr></thead>
      <tbody>
        <tr><td>Threshold too wide (straight road)</td><td>Robot ignores drift â†’ progressive steering off-center</td></tr>
        <tr><td>Threshold too narrow (straight road)</td><td>Constant overcorrection â†’ oscillation</td></tr>
        <tr><td>Small threshold (curves)</td><td>Reacts to nearby lines â†’ tight, responsive turns</td></tr>
        <tr><td>Large threshold (curves)</td><td>Reacts to distant lines â†’ smooth predictive cornering</td></tr>
      </tbody>
    </table></div>

    <h3>Camera Alignment &amp; Cropping</h3>

    <!-- FIGURE: camera alignment -->
    <!-- IMAGE REPLACE: swap images/fig_camera_align.jpg -->
    <figure data-img-key="fig_camera_align.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_camera_align.jpg" alt="Camera alignment with green centerline bar" loading="lazy">
      </div>
      <figcaption>Figure 12.3 â€” Camera alignment: green bar = centerline, red bars = error threshold. <span class="fig-key">images/fig_camera_align.jpg</span></figcaption>
    </figure>

    <div class="table-wrap"><table>
      <thead><tr><th>Parameter</th><th>Effect</th></tr></thead>
      <tbody>
        <tr><td><code>camera_centerline</code></td><td>Position of the green zero-error reference bar. Align to physical car center using a ruler.</td></tr>
        <tr><td><code>frame_width</code></td><td>Crops image horizontally. Use to ignore sidewalls.</td></tr>
        <tr><td><code>rows_to_watch</code></td><td>Crops image vertically. Smaller = only immediate road ahead.</td></tr>
        <tr><td><code>rows_offset</code></td><td>Vertical pan. Higher = looks further down the road.</td></tr>
      </tbody>
    </table></div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 13 â€” Actuator Calibration
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s13">
    <div class="section-header">
      <span class="section-num">13</span>
      <h2>Actuator Calibration (PID &amp; Throttle)</h2>
    </div>

    <!-- FIGURE: throttle/steering GUI -->
    <!-- IMAGE REPLACE: swap images/fig_throttle_steering.jpg -->
    <figure data-img-key="fig_throttle_steering.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_throttle_steering.jpg" alt="Throttle and steering calibration GUI" loading="lazy">
      </div>
      <figcaption>Figure 13.1 â€” Throttle and steering calibration GUI with PID sliders and mode selector. <span class="fig-key">images/fig_throttle_steering.jpg</span></figcaption>
    </figure>

    <h3>Steering Physical Limits</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Mode</th><th>Sets</th><th>Procedure</th></tr></thead>
      <tbody>
        <tr><td>Steering_mode = 0</td><td>Max LEFT limit</td><td>Adjust until full left turn. Switch to Mode 1 to save.</td></tr>
        <tr><td>Steering_mode = 1</td><td>STRAIGHT value</td><td>Adjust until car drives perfectly straight.</td></tr>
        <tr><td>Steering_mode = 2</td><td>Max RIGHT limit</td><td>Adjust until full right turn.</td></tr>
      </tbody>
    </table></div>

    <h3>Throttle Limits</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Mode</th><th>Sets</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Throttle_mode = 0</td><td>zero_throttle (neutral)</td><td>Car stationary, VESC silent</td></tr>
        <tr><td>Throttle_mode = 1</td><td>max_throttle</td><td>Increase in small increments â€” prop stand required</td></tr>
        <tr><td>Throttle_mode = 2</td><td>min_throttle</td><td>Minimum value that actually moves the car</td></tr>
      </tbody>
    </table></div>

    <!-- FIGURE: system response -->
    <!-- IMAGE REPLACE: swap images/fig_system_response.jpg -->
    <figure data-img-key="fig_system_response.jpg">
      <div class="fig-img-wrap">
        <img src="images/fig_system_response.jpg" alt="System response throttle scheduling plot" loading="lazy">
      </div>
      <figcaption>Figure 13.2 â€” System response: max throttle when error is low; throttle decreases linearly to min when error is high. <span class="fig-key">images/fig_system_response.jpg</span></figcaption>
    </figure>

    <h3>PID Gains</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Gain</th><th>Effect</th><th>Starting Value</th></tr></thead>
      <tbody>
        <tr><td>Kp_steering</td><td>Proportional: direct response to current error. Too high = oscillation.</td><td>0.3 â€“ 0.5</td></tr>
        <tr><td>Ki_steering</td><td>Integral: corrects steady-state bias. Too high = windup.</td><td>0.0 â€“ 0.05</td></tr>
        <tr><td>Kd_steering</td><td>Derivative: dampens oscillation. Too high = jerky.</td><td>0.05 â€“ 0.2</td></tr>
      </tbody>
    </table></div>

    <h3>Manual YAML Edit (Recommended)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">nano</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_lane_detection2_pkg/config/ros_racer_calibration.yaml</pre>
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-label">ros_racer_calibration.yaml</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre>lane_guidance_node:
  ros__parameters:
    <span class="hl-key">Kp_steering</span>:      <span class="hl-val">0.4</span>
    <span class="hl-key">Ki_steering</span>:      <span class="hl-val">0.01</span>
    <span class="hl-key">Kd_steering</span>:      <span class="hl-val">0.1</span>
    <span class="hl-key">zero_throttle</span>:    <span class="hl-val">0</span>
    <span class="hl-key">max_throttle</span>:     <span class="hl-val">0.382</span>
    <span class="hl-key">min_throttle</span>:     <span class="hl-val">0.363</span>
    <span class="hl-key">error_threshold</span>:  <span class="hl-val">0.15</span>
    <span class="hl-key">max_right_steering</span>: <span class="hl-val">1</span>
    <span class="hl-key">max_left_steering</span>:  <span class="hl-val">-1</span>

vesc_twist_node:
  ros__parameters:
    <span class="hl-key">steering_polarity</span>:  <span class="hl-val">1</span>   <span class="hl-comment"># flip to -1 if reversed</span>
    <span class="hl-key">throttle_polarity</span>:  <span class="hl-val">1</span>   <span class="hl-comment"># flip to -1 if car goes backward</span>
    <span class="hl-key">max_potential_rpm</span>:  <span class="hl-val">20000</span>
    <span class="hl-key">zero_throttle</span>:      <span class="hl-val">0</span>
    <span class="hl-key">max_throttle</span>:       <span class="hl-val">0.382</span>
    <span class="hl-key">min_throttle</span>:       <span class="hl-val">0.363</span>
    <span class="hl-key">straight_steering</span>:  <span class="hl-val">0</span>
    <span class="hl-key">max_right_steering</span>: <span class="hl-val">1</span>
    <span class="hl-key">max_left_steering</span>:  <span class="hl-val">-1</span></pre>
    </div>
    <div class="callout warn">
      <div class="callout-icon">âš </div>
      <div class="callout-body"><div class="callout-title">Critical: build after every YAML change</div><div class="callout-text">The GUI also overwrites this file when closed. Edit manually OR use the GUI â€” not both. Always run <code>build_ros2</code> after any edit.</div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 14 â€” Camera Navigation
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s14">
    <div class="section-header">
      <span class="section-num">14</span>
      <h2>Camera Navigation &amp; Final Launch</h2>
    </div>
    <div class="callout error">
      <div class="callout-icon">âœ—</div>
      <div class="callout-body"><div class="callout-title">Safety First</div><div class="callout-text">Never launch on the track without someone ready to intercept the car. Always have Ctrl+C ready in the launch terminal.</div></div>
    </div>

    <div class="code-block">
      <div class="code-header"><span class="code-label">Inside Docker â€” launch autonomous nav</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">source_ros2</span>
<span class="hl-cmd">build_ros2</span>
<span class="hl-cmd">ros2 launch</span> ucsd_robocar_nav2_pkg all_nodes.launch.py</pre>
    </div>

    <h3>Live Debug View</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Second terminal â€” toggle debug overlay</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">ros2 param set</span> /lane_detection_node debug_cv <span class="hl-val">1</span>   <span class="hl-comment"># ON</span>
<span class="hl-cmd">ros2 param set</span> /lane_detection_node debug_cv <span class="hl-val">0</span>   <span class="hl-comment"># OFF</span></pre>
    </div>

    <h3>Debugging Lane Following</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Symptom</th><th>Cause</th><th>Fix</th></tr></thead>
      <tbody>
        <tr><td>Hard steer immediately</td><td>Centerline not calibrated / polarity flipped</td><td>Recalibrate centerline; check <code>steering_polarity</code></td></tr>
        <tr><td>Slow drift</td><td>Threshold too wide or Ki needed</td><td>Narrow threshold; add small Ki</td></tr>
        <tr><td>Rapid oscillation</td><td>Kp too high / Kd too low</td><td>Reduce Kp; increase Kd</td></tr>
        <tr><td>No movement</td><td>zero_throttle wrong or VESC disconnected</td><td>Check <code>/cmd_vel</code> topic; check USB</td></tr>
        <tr><td>Black camera feed</td><td>Insufficient USB power</td><td>See Section 8 â€” powered hub</td></tr>
      </tbody>
    </table></div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 15 â€” ROS2 Dev Guide
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s15">
    <div class="section-header">
      <span class="section-num">15</span>
      <h2>ROS2 Nodes, Topics &amp; Subscribers â€” Dev Guide</h2>
    </div>

    <h3>Key Nodes & Their Topics</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Node</th><th>Publishes</th><th>Subscribes To</th></tr></thead>
      <tbody>
        <tr><td><code>/camera_node</code></td><td><code>/camera/color/image_raw</code></td><td>â€”</td></tr>
        <tr><td><code>/lane_detection_node</code></td><td><code>/error</code> (Float32)</td><td><code>/camera/color/image_raw</code></td></tr>
        <tr><td><code>/lane_guidance_node</code></td><td><code>/cmd_vel</code> (Twist)</td><td><code>/error</code></td></tr>
        <tr><td><code>/vesc_twist_node</code></td><td>Hardware PWM</td><td><code>/cmd_vel</code></td></tr>
        <tr><td><code>/lidar_node</code></td><td><code>/scan</code> (LaserScan)</td><td>â€”</td></tr>
      </tbody>
    </table></div>

    <h3>Custom Subscriber Node (Full Working Example)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">my_custom_node.py</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment">#!/usr/bin/env python3</span>
import rclpy
from rclpy.node import Node
from std_msgs.msg import Float32
from geometry_msgs.msg import Twist

class LaneErrorMonitor(Node):
    def __init__(self):
        super().__init__(<span class="hl-str">'lane_error_monitor'</span>)

        <span class="hl-comment"># Subscribe to lane tracking error (-1.0 to 1.0)</span>
        self.error_sub = self.create_subscription(
            Float32, <span class="hl-str">'/error'</span>, self.error_callback, <span class="hl-val">10</span>)

        <span class="hl-comment"># Publisher to override cmd_vel if needed</span>
        self.pub = self.create_publisher(Twist, <span class="hl-str">'/cmd_vel'</span>, <span class="hl-val">10</span>)
        self.get_logger().info(<span class="hl-str">'LaneErrorMonitor started!'</span>)

    def error_callback(self, msg: Float32):
        self.get_logger().info(f<span class="hl-str">'Lane error: {msg.data:.4f}'</span>)

        <span class="hl-comment"># Emergency stop if error exceeds 80% off-center</span>
        if abs(msg.data) > <span class="hl-val">0.8</span>:
            self.get_logger().warn(<span class="hl-str">'ERROR TOO HIGH â€” stopping!'</span>)
            self.pub.publish(Twist())   <span class="hl-comment"># all-zeros = stop</span>

def main(args=None):
    rclpy.init(args=args)
    node = LaneErrorMonitor()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()

if __name__ == <span class="hl-str">'__main__'</span>:
    main()</pre>
    </div>

    <h3>Custom Publisher Node (Timed Commands)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">test_drive_node.py</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-comment">#!/usr/bin/env python3</span>
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import Twist

class TestDriveNode(Node):
    def __init__(self):
        super().__init__(<span class="hl-str">'test_drive_node'</span>)
        self.pub = self.create_publisher(Twist, <span class="hl-str">'/cmd_vel'</span>, <span class="hl-val">10</span>)
        <span class="hl-comment"># Publish at 10 Hz</span>
        self.timer = self.create_timer(<span class="hl-val">0.1</span>, self.send_command)

    def send_command(self):
        msg = Twist()
        msg.linear.x = <span class="hl-val">0.37</span>   <span class="hl-comment"># forward speed</span>
        msg.angular.z = <span class="hl-val">0.0</span>   <span class="hl-comment"># straight</span>
        self.pub.publish(msg)

def main(args=None):
    rclpy.init(args=args)
    node = TestDriveNode()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()

if __name__ == <span class="hl-str">'__main__'</span>:
    main()</pre>
    </div>

    <h3>Register Your Node in setup.py</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">setup.py â€” entry_points</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre>entry_points={
    <span class="hl-str">'console_scripts'</span>: [
        <span class="hl-str">'lane_error_monitor = ucsd_robocar_nav2_pkg.my_custom_node:main'</span>,
        <span class="hl-str">'test_drive = ucsd_robocar_nav2_pkg.test_drive_node:main'</span>,
    ],
},</pre>
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-label">Build and run</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre><span class="hl-cmd">build_ros2</span>
<span class="hl-cmd">ros2 run</span> ucsd_robocar_nav2_pkg lane_error_monitor</pre>
    </div>

    <h3>Camera Feed Subscription (with OpenCV)</h3>
    <div class="code-block">
      <div class="code-header"><span class="code-label">camera_subscriber snippet</span><button class="copy-btn" onclick="copyCode(this)">COPY</button></div>
      <pre>from sensor_msgs.msg import Image
from cv_bridge import CvBridge
import cv2

class CameraNode(Node):
    def __init__(self):
        super().__init__(<span class="hl-str">'camera_sub'</span>)
        self.bridge = CvBridge()
        self.sub = self.create_subscription(
            Image, <span class="hl-str">'/camera/color/image_raw'</span>,
            self.image_callback, <span class="hl-val">10</span>)

    def image_callback(self, msg):
        cv_img = self.bridge.imgmsg_to_cv2(msg, <span class="hl-str">'bgr8'</span>)
        <span class="hl-comment"># cv_img is a numpy array â€” use OpenCV normally</span>
        gray = cv2.cvtColor(cv_img, cv2.COLOR_BGR2GRAY)
        cv2.imshow(<span class="hl-str">'Camera'</span>, cv_img)
        cv2.waitKey(<span class="hl-val">1</span>)</pre>
    </div>

    <h3>Reuse Existing Packages</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Package</th><th>What to Reuse</th></tr></thead>
      <tbody>
        <tr><td><code>ucsd_robocar_sensor2_pkg</code></td><td>Camera + LiDAR publishers. Enable in <code>car_config.yaml</code>.</td></tr>
        <tr><td><code>ucsd_robocar_lane_detection2_pkg</code></td><td>Full lane pipeline. Extend by subscribing to <code>/error</code>.</td></tr>
        <tr><td><code>ucsd_robocar_actuator2_pkg</code></td><td>VESC driver. Publish to <code>/cmd_vel</code>.</td></tr>
        <tr><td><code>ucsd_robocar_nav2_pkg</code></td><td>Launch files. Copy and modify for custom setups.</td></tr>
      </tbody>
    </table></div>
    <div class="callout tip">
      <div class="callout-icon">âœ“</div>
      <div class="callout-body"><div class="callout-title">Efficiency Rule</div><div class="callout-text">Before writing any new node, run <code>ros2 topic list</code> and <code>ros2 node list</code>. The data you need is almost certainly already published â€” just subscribe to it.</div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION 16 â€” Troubleshooting
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="section" id="s16">
    <div class="section-header">
      <span class="section-num">16</span>
      <h2>Troubleshooting &amp; Known Bugs</h2>
    </div>

    <h3>Docker & System</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
      <tbody>
        <tr><td>docker: permission denied</td><td><code>sudo usermod -aG docker $USER</code> then fully log out</td></tr>
        <tr><td>Container not found after reboot</td><td><code>docker start MY_CONTAINER_NAME</code></td></tr>
        <tr><td>No space left on device</td><td><code>docker system prune -f</code></td></tr>
      </tbody>
    </table></div>

    <h3>Camera & Hardware</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
      <tbody>
        <tr><td>OAK-D disconnects randomly</td><td>Powered USB hub (Section 8)</td></tr>
        <tr><td>Black camera feed</td><td>USB power insufficient; use powered hub</td></tr>
        <tr><td>VESC not responding</td><td>Check USB cable; <code>dmesg | grep usb</code></td></tr>
        <tr><td>Wheels spin backwards</td><td>Set <code>throttle_polarity: -1</code> in YAML</td></tr>
        <tr><td>Steering reversed</td><td>Set <code>steering_polarity: -1</code> in YAML</td></tr>
        <tr><td>Controlling another team's camera</td><td><strong>Set ROS_DOMAIN_ID</strong> â€” see Section 9</td></tr>
      </tbody>
    </table></div>

    <h3>Build & ROS2</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
      <tbody>
        <tr><td>Package not found after build</td><td>Did you run <code>source_ros2</code>? Run <code>build_ros2</code> again.</td></tr>
        <tr><td>YAML changes have no effect</td><td>Must run <code>build_ros2</code> â€” not just source_ros2</td></tr>
        <tr><td>Launch file not found</td><td>Verify <code>setup.py</code> includes <code>launch/</code> dir; re-run <code>build_ros2</code></td></tr>
        <tr><td>GUI closes immediately</td><td>X11 not working inside Docker â€” see Section 3</td></tr>
      </tbody>
    </table></div>

    <h3>PID & Lane Following</h3>
    <div class="table-wrap"><table>
      <thead><tr><th>Symptom</th><th>Fix</th></tr></thead>
      <tbody>
        <tr><td>Rapid oscillation</td><td>Reduce Kp; increase Kd</td></tr>
        <tr><td>Consistent left/right drift</td><td>Add small Ki; recalibrate centerline</td></tr>
        <tr><td>Goes too fast on curves</td><td>Reduce max_throttle; increase error_threshold</td></tr>
        <tr><td>No response to curves</td><td>Decrease error_threshold; increase Kp</td></tr>
        <tr><td>No lines detected</td><td>Recalibrate HSV for current lighting; toggle debug_cv</td></tr>
      </tbody>
    </table></div>
  </section>

</main><!-- /main -->

<button id="back-top" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">â†‘</button>

<script>
// â”€â”€ COPY BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function copyCode(btn) {
  const pre = btn.closest('.code-block').querySelector('pre');
  const text = pre.innerText;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'COPIED';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('copied'); }, 1800);
  });
}

// â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const backTop = document.getElementById('back-top');
window.addEventListener('scroll', () => {
  backTop.classList.toggle('visible', window.scrollY > 400);
});

// â”€â”€ ACTIVE NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const sections = document.querySelectorAll('.section[id]');
const navLinks = document.querySelectorAll('.nav-item');
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      navLinks.forEach(l => l.classList.remove('active'));
      const link = document.querySelector(`.nav-item[href="#${e.target.id}"]`);
      if (link) link.classList.add('active');
    }
  });
}, { rootMargin: '-30% 0px -60% 0px' });
sections.forEach(s => observer.observe(s));

// â”€â”€ CLOSE SIDEBAR ON MOBILE NAV CLICK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
navLinks.forEach(l => l.addEventListener('click', () => {
  document.querySelector('.sidebar').classList.remove('open');
}));

// â”€â”€ GENERATE TEAM GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const grid = document.getElementById('team-grid');
for (let i = 1; i <= 30; i++) {
  const cell = document.createElement('div');
  cell.className = 'team-id-cell';
  cell.innerHTML = `<div class="id-num">${i}</div><div>Team ${i}</div>`;
  grid.appendChild(cell);
}
// Highlight one cell for demonstration â€” TA can hardcode per team
// cell.classList.add('my-team'); // students add this for their own team
</script>

</body>
</html>
