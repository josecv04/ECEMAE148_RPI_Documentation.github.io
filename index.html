<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ECE/MAE 148 ‚Äî UCSD Robocar Setup & Calibration Guide</title>
<meta name="description" content="Complete setup, calibration and development guide for the UCSD Robocar Framework used in ECE/MAE 148 Intro to Autonomous Vehicles.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --ucsd-navy:    #002E6D;
  --ucsd-blue:    #00629B;
  --ucsd-gold:    #C69214;
  --ucsd-gold-lt: #E8B931;
  --bg:           #09111E;
  --bg2:          #0D1A2D;
  --surface:      #111F35;
  --surface2:     #162643;
  --surface3:     #1C2F50;
  --border:       #1E3355;
  --border-lt:    #2A4670;
  --text:         #DCE8F5;
  --text-muted:   #7A9EC4;
  --text-dim:     #4D6E96;
  --accent:       #00A8E8;
  --accent-glow:  rgba(0,168,232,0.15);
  --gold-glow:    rgba(198,146,20,0.18);
  --green:        #00C896;
  --yellow:       #F0B429;
  --red:          #F04E37;
  --purple:       #9B7FE8;
  --code-bg:      #060E1A;
  --code-border:  #1A2E4A;
  --sidebar-w:    290px;
  --topbar-h:     60px;
  --r:            6px;
  --font-body:    'Sora', sans-serif;
  --font-mono:    'IBM Plex Mono', monospace;
  --ease:         cubic-bezier(0.4,0,0.2,1);
}
*,*::before,*::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 15px; scroll-behavior: smooth; scroll-padding-top: calc(var(--topbar-h) + 20px); }
body { font-family: var(--font-body); background: var(--bg); color: var(--text); line-height: 1.7; min-height: 100vh; overflow-x: hidden; }
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image: linear-gradient(rgba(0,98,155,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(0,98,155,0.04) 1px, transparent 1px);
  background-size: 40px 40px;
}
.topbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 200;
  height: var(--topbar-h); background: rgba(9,17,30,0.95); border-bottom: 1px solid var(--border);
  backdrop-filter: blur(16px); display: flex; align-items: center; padding: 0 0 0 var(--sidebar-w);
}
.topbar-inner { display: flex; align-items: center; gap: 16px; padding: 0 32px; width: 100%; }
.topbar-brand { display: flex; align-items: center; gap: 12px; text-decoration: none; flex-shrink: 0; }
.topbar-emblem {
  width: 36px; height: 36px; background: var(--ucsd-navy); border: 2px solid var(--ucsd-gold);
  border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.topbar-emblem svg { width: 20px; height: 20px; }
.topbar-name { font-size: 15px; font-weight: 700; color: var(--text); letter-spacing: -0.3px; }
.topbar-course { font-size: 11px; color: var(--text-muted); font-family: var(--font-mono); }
.topbar-divider { width: 1px; height: 28px; background: var(--border); flex-shrink: 0; }
.topbar-breadcrumb { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }
.topbar-spacer { flex: 1; }
.page-switcher {
  display: flex; align-items: center; gap: 2px;
  background: var(--surface); border: 1px solid var(--border-lt); border-radius: 20px; padding: 3px; flex-shrink: 0;
}
.ps-link {
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  padding: 4px 14px; border-radius: 16px; letter-spacing: 0.4px;
  text-decoration: none; color: var(--text-muted); transition: all 0.15s var(--ease);
}
.ps-link:hover { color: var(--text); background: rgba(255,255,255,0.06); }
.ps-link.active { background: var(--ucsd-gold); color: var(--bg); }
@media (max-width: 768px) { .page-switcher { display: none; } }
#menu-toggle {
  display: none; background: none; border: 1px solid var(--border);
  color: var(--text-muted); padding: 6px 10px; border-radius: var(--r);
  cursor: pointer; font-size: 16px; flex-shrink: 0;
}
.sidebar {
  position: fixed; top: 0; left: 0; bottom: 0; z-index: 150;
  width: var(--sidebar-w); background: var(--bg2); border-right: 1px solid var(--border);
  display: flex; flex-direction: column; overflow: hidden;
}
.sidebar-header {
  padding: 16px 20px; border-bottom: 1px solid var(--border);
  background: var(--ucsd-navy); flex-shrink: 0;
}
.sidebar-logo-row { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
.sidebar-logo {
  width: 32px; height: 32px; border-radius: 6px;
  background: rgba(198,146,20,0.2); border: 1.5px solid var(--ucsd-gold);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono); font-size: 12px; font-weight: 600; color: var(--ucsd-gold);
}
.sidebar-title { font-size: 13px; font-weight: 700; color: #fff; }
.sidebar-sub { font-size: 10px; color: rgba(255,255,255,0.5); font-family: var(--font-mono); margin-top: 2px; }
.sidebar-search { margin: 12px 16px; position: relative; flex-shrink: 0; }
.sidebar-search input {
  width: 100%; padding: 8px 12px 8px 32px; background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--r); color: var(--text); font-family: var(--font-body); font-size: 12px; outline: none;
}
.sidebar-search input::placeholder { color: var(--text-dim); }
.sidebar-search input:focus { border-color: var(--border-lt); }
.sidebar-search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-dim); font-size: 13px; pointer-events: none; }
.nav-scroll { overflow-y: auto; flex: 1; padding-bottom: 40px; }
.nav-scroll::-webkit-scrollbar { width: 3px; }
.nav-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
.nav-group-label {
  font-family: var(--font-mono); font-size: 9px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1.8px; color: var(--text-dim); padding: 16px 20px 6px;
  display: flex; align-items: center; gap: 8px;
}
.nav-group-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.nav-link {
  display: flex; align-items: center; gap: 10px; padding: 7px 20px;
  text-decoration: none; color: var(--text-muted); font-size: 12.5px;
  border-left: 2px solid transparent; transition: all 0.15s var(--ease);
}
.nav-link .nl-num {
  font-family: var(--font-mono); font-size: 9px; color: var(--text-dim);
  background: var(--surface); border: 1px solid var(--border); padding: 1px 5px; border-radius: 3px; flex-shrink: 0;
}
.nav-link:hover { color: var(--text); background: rgba(255,255,255,0.03); border-left-color: var(--border-lt); }
.nav-link.active { color: var(--ucsd-gold-lt); border-left-color: var(--ucsd-gold); background: var(--gold-glow); }
.nav-link.active .nl-num { background: rgba(198,146,20,0.2); border-color: rgba(198,146,20,0.3); color: var(--ucsd-gold); }
.nav-progress { padding: 12px 20px; border-top: 1px solid var(--border); flex-shrink: 0; }
.np-label { font-family: var(--font-mono); font-size: 10px; color: var(--text-dim); margin-bottom: 6px; display: flex; justify-content: space-between; }
.np-bar { height: 3px; background: var(--border); border-radius: 3px; overflow: hidden; }
.np-fill { height: 100%; background: linear-gradient(90deg, var(--ucsd-gold), var(--ucsd-gold-lt)); border-radius: 3px; width: 0%; transition: width 0.4s var(--ease); }
.layout { display: flex; padding-top: var(--topbar-h); min-height: 100vh; }
.main { margin-left: var(--sidebar-w); flex: 1; min-width: 0; position: relative; z-index: 1; }
.hero {
  background: radial-gradient(ellipse 80% 100% at 100% 50%, rgba(0,98,155,0.25), transparent),
    radial-gradient(ellipse 50% 80% at 0% 0%, rgba(198,146,20,0.08), transparent),
    linear-gradient(180deg, var(--bg2) 0%, var(--bg) 100%);
  border-bottom: 1px solid var(--border); padding: 72px 80px 60px; position: relative; overflow: hidden;
}
.hero::before {
  content: ''; position: absolute; top: -40px; right: -40px; width: 400px; height: 400px; border-radius: 50%;
  background: radial-gradient(circle, rgba(0,168,232,0.07), transparent 70%); pointer-events: none;
}
.hero-eyebrow {
  display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px;
  font-family: var(--font-mono); font-size: 11px; font-weight: 600; color: var(--ucsd-gold); letter-spacing: 1px;
  background: var(--gold-glow); border: 1px solid rgba(198,146,20,0.3); padding: 5px 14px; border-radius: 20px;
}
.hero-eyebrow-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ucsd-gold); }
.hero h1 { font-size: clamp(32px, 4.5vw, 56px); font-weight: 800; line-height: 1.08; letter-spacing: -1.5px; margin-bottom: 20px; color: var(--text); }
.hero h1 span { color: var(--ucsd-gold); }
.hero-desc { font-size: 16px; color: var(--text-muted); max-width: 640px; line-height: 1.65; margin-bottom: 36px; }
.hero-chips { display: flex; flex-wrap: wrap; gap: 10px; }
.hero-chip {
  display: inline-flex; align-items: center; gap: 7px; background: var(--surface); border: 1px solid var(--border-lt);
  color: var(--text-muted); font-size: 12px; font-family: var(--font-mono); padding: 6px 14px; border-radius: 20px;
}
.hero-chip-icon { font-size: 14px; }
.content { padding: 0 80px 80px; }
.section { padding-top: 64px; }
.section-anchor {
  display: block; visibility: hidden; height: 0;
  margin-top: calc(-1 * (var(--topbar-h) + 24px)); padding-top: calc(var(--topbar-h) + 24px);
}
.sec-header {
  display: flex; align-items: flex-start; gap: 20px; margin-bottom: 28px; padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}
.sec-num {
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); background: var(--gold-glow); border: 1px solid rgba(198,146,20,0.3);
  padding: 4px 12px; border-radius: 20px; flex-shrink: 0; margin-top: 4px;
}
.sec-title-block { flex: 1; }
.sec-title-block h2 { font-size: 24px; font-weight: 700; color: var(--text); letter-spacing: -0.5px; line-height: 1.2; }
.sec-title-block .sec-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
.sec-badges { display: flex; gap: 6px; margin-left: auto; flex-shrink: 0; align-items: center; }
h3 { font-size: 15px; font-weight: 600; color: var(--accent); margin: 28px 0 10px; letter-spacing: -0.2px; }
h4 { font-size: 13px; font-weight: 600; color: var(--text-muted); margin: 18px 0 8px; text-transform: uppercase; letter-spacing: 0.5px; }
p { color: var(--text-muted); margin-bottom: 14px; font-size: 14px; line-height: 1.75; }
p strong { color: var(--text); font-weight: 600; }
p code, li code {
  font-family: var(--font-mono); font-size: 12px;
  background: rgba(0,168,232,0.1); color: var(--accent); padding: 1px 5px; border-radius: 3px;
}
.badge { font-family: var(--font-mono); font-size: 9px; font-weight: 700; padding: 3px 9px; border-radius: 3px; letter-spacing: 0.8px; text-transform: uppercase; }
.badge-new    { background: rgba(155,127,232,0.2); color: var(--purple); border: 1px solid rgba(155,127,232,0.3); }
.badge-fix    { background: rgba(0,200,150,0.15); color: var(--green); border: 1px solid rgba(0,200,150,0.3); }
.badge-warn   { background: rgba(240,78,55,0.15); color: var(--red); border: 1px solid rgba(240,78,55,0.3); }
.badge-critical { background: rgba(240,78,55,0.2); color: #ff7b6e; border: 1px solid rgba(240,78,55,0.4); }
.callout { display: flex; gap: 14px; padding: 16px 18px; border-radius: var(--r); margin: 16px 0; border: 1px solid; font-size: 13.5px; }
.callout-icon { font-size: 16px; flex-shrink: 0; line-height: 1.4; }
.callout-body { flex: 1; min-width: 0; }
.callout-title { font-size: 11px; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; margin-bottom: 5px; }
.callout-text { color: var(--text-muted); line-height: 1.65; }
.callout-text code { font-family: var(--font-mono); font-size: 11.5px; background: rgba(255,255,255,0.07); color: var(--text); padding: 1px 5px; border-radius: 3px; }
.callout.info  { background: rgba(0,168,232,0.07); border-color: rgba(0,168,232,0.25); }
.callout.info  .callout-title { color: var(--accent); }
.callout.warn  { background: rgba(240,180,41,0.07); border-color: rgba(240,180,41,0.28); }
.callout.warn  .callout-title { color: var(--yellow); }
.callout.tip   { background: rgba(0,200,150,0.07); border-color: rgba(0,200,150,0.25); }
.callout.tip   .callout-title { color: var(--green); }
.callout.error { background: rgba(240,78,55,0.07); border-color: rgba(240,78,55,0.28); }
.callout.error .callout-title { color: var(--red); }
.callout.new   { background: rgba(155,127,232,0.07); border-color: rgba(155,127,232,0.28); }
.callout.new   .callout-title { color: var(--purple); }
.cb { background: var(--code-bg); border: 1px solid var(--code-border); border-radius: var(--r); margin: 12px 0; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
.cb-header { display: flex; align-items: center; justify-content: space-between; padding: 9px 14px; background: var(--surface); border-bottom: 1px solid var(--code-border); }
.cb-label { font-family: var(--font-mono); font-size: 10.5px; color: var(--text-dim); display: flex; align-items: center; gap: 8px; }
.cb-label::before { content: ''; display: inline-block; width: 7px; height: 7px; border-radius: 50%; background: var(--ucsd-gold); opacity: 0.7; }
.copy-btn { font-family: var(--font-mono); font-size: 9.5px; font-weight: 600; background: var(--surface2); border: 1px solid var(--border-lt); color: var(--text-dim); padding: 4px 12px; border-radius: 4px; cursor: pointer; transition: all 0.15s var(--ease); letter-spacing: 0.5px; }
.copy-btn:hover { background: var(--border); color: var(--text); }
.copy-btn.ok { color: var(--green); border-color: rgba(0,200,150,0.4); }
pre { padding: 18px 20px; overflow-x: auto; font-family: var(--font-mono); font-size: 12.5px; line-height: 1.7; tab-size: 2; color: #C9D8EC; }
pre::-webkit-scrollbar { height: 3px; }
pre::-webkit-scrollbar-thumb { background: var(--border); }
.k  { color: #6BBFFF; }
.s  { color: #A8D8B9; }
.c  { color: #4D6E96; font-style: italic; }
.f  { color: #BFA0F4; }
.v  { color: #F0B429; }
.ok { color: #00C896; }
.er { color: #F04E37; }
.steps { display: flex; flex-direction: column; gap: 14px; margin: 16px 0; }
.step { display: flex; gap: 18px; padding: 20px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); transition: border-color 0.15s var(--ease); }
.step:hover { border-color: var(--border-lt); }
.step-num { width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0; background: var(--gold-glow); border: 1.5px solid rgba(198,146,20,0.45); color: var(--ucsd-gold); font-family: var(--font-mono); font-size: 11px; font-weight: 700; display: flex; align-items: center; justify-content: center; }
.step-body { flex: 1; min-width: 0; }
.step-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.step-desc { font-size: 13px; color: var(--text-muted); line-height: 1.65; margin-bottom: 8px; }
.step-desc:last-child { margin-bottom: 0; }
.tw { overflow-x: auto; margin: 14px 0; border-radius: var(--r); border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead tr { background: var(--surface2); }
th { text-align: left; padding: 11px 16px; font-family: var(--font-mono); font-size: 10px; font-weight: 600; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; border-bottom: 1px solid var(--border); }
td { padding: 11px 16px; border-bottom: 1px solid var(--border); color: var(--text-muted); vertical-align: top; font-size: 13px; line-height: 1.6; }
td code { font-family: var(--font-mono); font-size: 11.5px; color: var(--accent); background: rgba(0,168,232,0.08); padding: 1px 6px; border-radius: 3px; }
td strong { color: var(--text); }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: rgba(255,255,255,0.015); }
figure { margin: 20px 0; border-radius: var(--r); overflow: hidden; border: 1px solid var(--border); background: var(--surface); box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
.fig-wrap { background: var(--surface2); display: flex; align-items: center; justify-content: center; padding: 16px; min-height: 100px; }
.fig-wrap img { max-width: 100%; height: auto; display: block; border-radius: 4px; }
figcaption { padding: 10px 16px; font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); border-top: 1px solid var(--border); display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.fig-label { color: var(--ucsd-gold); font-weight: 600; }
.team-widget { background: linear-gradient(135deg, rgba(0,46,109,0.5), rgba(13,26,45,0.8)); border: 1px solid rgba(198,146,20,0.3); border-radius: var(--r); padding: 24px; margin: 20px 0; }
.team-widget-title { font-size: 13px; font-weight: 700; color: var(--ucsd-gold); display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.team-widget-sub { font-size: 12px; color: var(--text-dim); font-family: var(--font-mono); margin-bottom: 16px; }
.team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(68px, 1fr)); gap: 8px; }
.tc { background: var(--surface); border: 1px solid var(--border); border-radius: 5px; padding: 8px 4px; text-align: center; font-family: var(--font-mono); cursor: default; }
.tc-num { font-size: 18px; font-weight: 700; color: var(--text); }
.tc-label { font-size: 9px; color: var(--text-dim); }
.divider { height: 1px; background: var(--border); margin: 48px 0; }
/* Track workflow banner */
.track-banner {
  display: flex; align-items: center; gap: 16px; padding: 18px 22px;
  background: linear-gradient(135deg, rgba(198,146,20,0.12), rgba(198,146,20,0.04));
  border: 1.5px solid rgba(198,146,20,0.45); border-radius: var(--r); margin: 20px 0;
}
.track-banner-icon { font-size: 28px; flex-shrink: 0; }
.track-banner-body h4 { font-size: 13px; font-weight: 700; color: var(--ucsd-gold); margin: 0 0 4px; text-transform: uppercase; letter-spacing: 0.6px; }
.track-banner-body p { font-size: 13px; color: var(--text-muted); margin: 0; line-height: 1.55; }
/* Workflow progress indicator */
.workflow-bar {
  display: flex; align-items: center; gap: 0; margin: 24px 0; overflow-x: auto; padding-bottom: 4px;
}
.workflow-step {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  padding: 12px 16px; background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--r); min-width: 120px; flex-shrink: 0; position: relative;
}
.workflow-step.active { border-color: var(--ucsd-gold); background: var(--gold-glow); }
.workflow-step.done { border-color: rgba(0,200,150,0.4); background: rgba(0,200,150,0.06); }
.workflow-arrow { font-size: 18px; color: var(--text-dim); flex-shrink: 0; padding: 0 4px; }
.ws-num { font-family: var(--font-mono); font-size: 9px; font-weight: 700; color: var(--text-dim); }
.workflow-step.active .ws-num { color: var(--ucsd-gold); }
.workflow-step.done .ws-num { color: var(--green); }
.ws-label { font-size: 11px; font-weight: 600; color: var(--text); text-align: center; }
/* Source/build reminder badge */
.sb-reminder {
  display: flex; align-items: center; gap: 12px; padding: 12px 16px;
  background: rgba(0,168,232,0.08); border: 1px solid rgba(0,168,232,0.3); border-radius: var(--r); margin: 14px 0;
}
.sb-reminder-icon { font-size: 16px; flex-shrink: 0; }
.sb-reminder-text { font-family: var(--font-mono); font-size: 12px; color: var(--accent); }
.sb-reminder-text strong { color: var(--text); }
#btt { position: fixed; bottom: 28px; right: 28px; z-index: 190; width: 42px; height: 42px; border-radius: 50%; background: var(--surface2); border: 1px solid var(--border-lt); color: var(--text-muted); font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; transition: all 0.2s var(--ease); pointer-events: none; box-shadow: 0 4px 16px rgba(0,0,0,0.4); }
#btt.show { opacity: 1; pointer-events: auto; }
#btt:hover { background: var(--ucsd-gold); color: var(--bg); border-color: var(--ucsd-gold); transform: translateY(-2px); }
#read-progress { position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 2px; z-index: 300; background: transparent; }
#read-progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--ucsd-navy), var(--ucsd-gold)); transition: width 0.1s linear; }
@media (max-width: 1024px) { .hero { padding: 48px 40px 40px; } .content { padding: 0 40px 60px; } }
@media (max-width: 768px) {
  #menu-toggle { display: flex; }
  .sidebar { transform: translateX(-100%); transition: transform 0.25s var(--ease); top: var(--topbar-h); }
  .sidebar.open { transform: translateX(0); }
  .topbar { padding-left: 0; }
  .main { margin-left: 0; }
  .hero { padding: 32px 20px 28px; }
  .content { padding: 0 20px 48px; }
  #read-progress { left: 0; }
  .workflow-bar { flex-wrap: wrap; }
}
</style>
</head>
<body>

<div id="read-progress"><div id="read-progress-fill"></div></div>

<header class="topbar">
  <div class="topbar-inner">
    <a href="#hero" class="topbar-brand">
      <div class="topbar-emblem">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="5" stroke="#C69214" stroke-width="2"/>
          <path d="M12 3v3M12 18v3M3 12h3M18 12h3" stroke="#C69214" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="12" r="2" fill="#C69214"/>
        </svg>
      </div>
      <div>
        <div class="topbar-name">UCSD Robocar</div>
        <div class="topbar-course">ECE / MAE 148</div>
      </div>
    </a>
    <div class="topbar-divider"></div>
    <span class="topbar-breadcrumb">Setup & Calibration Guide</span>
    <div class="topbar-spacer"></div>
    <div class="page-switcher">
      <a href="./rpi_setup.html" class="ps-link">RPI Setup</a>
      <a href="./vesc_setup.html" class="ps-link">VESC Setup</a>
      <a href="./donkeycar.html" class="ps-link">DonkeyCar</a>
      <a href="./gps_laps.html" class="ps-link">GPS Laps</a>
      <a href="./index.html" class="ps-link active">ROS Setup</a>
    </div>
    <button id="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">&#9776;</button>
  </div>
</header>

<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo-row">
      <div class="sidebar-logo">RC</div>
      <div>
        <div class="sidebar-title">Robocar Docs</div>
        <div class="sidebar-sub">ECE/MAE 148 ¬∑ UCSD</div>
      </div>
    </div>
  </div>
  <div class="sidebar-search">
    <span class="sidebar-search-icon">‚åï</span>
    <input type="text" placeholder="Search sections‚Ä¶" id="nav-search" oninput="filterNav(this.value)">
  </div>
  <div class="nav-scroll" id="nav-scroll">
    <div class="nav-group-label">Getting Started</div>
    <a class="nav-link" href="#s1"><span class="nl-num">01</span>Docker Setup</a>
    <a class="nav-link" href="#s2"><span class="nl-num">02</span>Pull Robocar Image</a>
    <a class="nav-link" href="#s3"><span class="nl-num">03</span>X11 Forwarding</a>
    <a class="nav-link" href="#s4"><span class="nl-num">04</span>Run Container</a>
    <a class="nav-link" href="#s5"><span class="nl-num">05</span>Python Error Fix</a>
    <a class="nav-link" href="#s6"><span class="nl-num">06</span>Build Workspace</a>
    <a class="nav-link" href="#s7"><span class="nl-num">07</span>Shell Aliases</a>
    <div class="nav-group-label">Hardware</div>
    <a class="nav-link" href="#s8"><span class="nl-num">08</span>Camera Power Fix</a>
    <a class="nav-link" href="#s9"><span class="nl-num">09</span>Camera Isolation</a>
    <div class="nav-group-label">Calibration</div>
    <a class="nav-link" href="#s10"><span class="nl-num">10</span>Config Overview</a>
    <a class="nav-link" href="#s11"><span class="nl-num">11</span>Step 1 ¬∑ Calibration Mode</a>
    <a class="nav-link" href="#s12"><span class="nl-num">12</span>Step 2 ¬∑ HSV Tuning (Track)</a>
    <a class="nav-link" href="#s13"><span class="nl-num">13</span>Step 3 ¬∑ Lane Calibration</a>
    <a class="nav-link" href="#s14"><span class="nl-num">14</span>Step 4 ¬∑ Navigation & PID</a>
    <div class="nav-group-label">Development</div>
    <a class="nav-link" href="#s15"><span class="nl-num">15</span>ROS2 Node Dev</a>
    <a class="nav-link" href="#s16"><span class="nl-num">16</span>Troubleshooting</a>
  </div>
  <div class="nav-progress">
    <div class="np-label"><span>Reading Progress</span><span id="np-pct">0%</span></div>
    <div class="np-bar"><div class="np-fill" id="np-fill"></div></div>
  </div>
</nav>

<main class="layout">
<div class="main">

<div class="hero" id="hero">
  <div class="hero-eyebrow"><div class="hero-eyebrow-dot"></div>UCSD Jacobs School of Engineering</div>
  <h1>Robocar Framework<br><span>Setup & Calibration</span></h1>
  <p class="hero-desc">Complete reference for ECE/MAE 148 ‚Äî covering Docker environment setup, X11 display forwarding, OAK-D camera calibration, VESC motor tuning, PID controller configuration, and custom ROS2 node development.</p>
  <div class="hero-chips">
    <div class="hero-chip"><span class="hero-chip-icon">üçì</span>Raspberry Pi 5</div>
    <div class="hero-chip"><span class="hero-chip-icon">üê≥</span>Docker</div>
    <div class="hero-chip"><span class="hero-chip-icon">ü§ñ</span>ROS2 Foxy</div>
  </div>
</div>

<div class="content">

<!-- ¬ß1 ‚Äî Docker Setup -->
<div class="section-anchor" id="s1"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">01</span>
    <div class="sec-title-block">
      <h2>Initial Setup &amp; Docker Installation</h2>
      <div class="sec-subtitle">Prepare the Raspberry Pi with a clean, reproducible Docker environment</div>
    </div>
  </div>
  <p>Docker allows the entire Robocar software stack ‚Äî ROS2, camera drivers, motor controllers, and all Python dependencies ‚Äî to run inside a self-contained container. This means the host Raspberry Pi operating system stays clean, every student robot runs identical software, and a broken environment can always be restored by re-pulling the Docker image rather than reinstalling the entire OS.</p>
  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">SSH into Your Pi</div>
        <div class="step-desc">Replace <code>XX</code> with your robot's assigned number. The <code>.local</code> suffix uses mDNS (Bonjour/Avahi) to locate the Pi on your local network without needing to know its IP address.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Terminal ‚Äî your laptop</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">ssh</span> pi@ucsdrobocar-148-XX.local</pre></div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Remove Old Docker Versions</div>
        <div class="step-desc">Removes any conflicting legacy packages that could cause dependency conflicts during the official Docker installation. "Package not found" messages are completely normal ‚Äî they simply mean these packages were never installed.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt remove</span> docker docker-engine docker.io containerd runc</pre></div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Install Prerequisites</div>
        <div class="step-desc"><strong>ca-certificates</strong> enables verification of HTTPS connections. <strong>curl</strong> downloads files from the web. <strong>gnupg</strong> verifies Docker's cryptographic signature to confirm that the packages you install are authentic and unmodified.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt update</span>
<span class="k">sudo apt install</span> ca-certificates curl gnupg <span class="f">-y</span>
<span class="k">sudo install</span> <span class="f">-m 0755 -d</span> /etc/apt/keyrings</pre></div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Add Docker's Official Repository</div>
        <div class="step-desc">Downloads Docker's GPG signing key, converts it to the binary format that <code>apt</code> expects, then registers Docker's official package repository.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">curl</span> <span class="f">-fsSL</span> https://download.docker.com/linux/debian/gpg | \
  <span class="k">sudo gpg</span> <span class="f">--dearmor -o</span> /etc/apt/keyrings/docker.gpg
<span class="k">sudo chmod</span> a+r /etc/apt/keyrings/docker.gpg
<span class="k">echo</span> <span class="s">"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/debian \
  $(. /etc/os-release &amp;&amp; echo "$VERSION_CODENAME") stable"</span> \
  | <span class="k">sudo tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</pre></div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">5</div>
      <div class="step-body">
        <div class="step-title">Install Docker Engine</div>
        <div class="step-desc"><strong>docker-ce</strong> is the core container engine. <strong>docker-ce-cli</strong> provides the <code>docker</code> command. <strong>containerd.io</strong> manages the low-level container lifecycle. <strong>docker-buildx-plugin</strong> enables multi-platform image builds. <strong>docker-compose-plugin</strong> enables multi-container orchestration.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt update</span>
<span class="k">sudo apt install</span> docker-ce docker-ce-cli containerd.io \
  docker-buildx-plugin docker-compose-plugin <span class="f">-y</span></pre></div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">6</div>
      <div class="step-body">
        <div class="step-title">Grant Permissions &amp; Reboot</div>
        <div class="step-desc">Adding your user to the <code>docker</code> group lets you run <code>docker</code> without typing <code>sudo</code> every time. A full reboot is required ‚Äî the group membership change only takes effect after starting a new login session.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo usermod</span> <span class="f">-aG</span> docker $USER
<span class="k">sudo reboot</span></pre></div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">7</div>
      <div class="step-body">
        <div class="step-title">Verify Installation</div>
        <div class="step-desc">SSH back in after the reboot and confirm Docker is working correctly.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal (after reboot)</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">docker --version</span>          <span class="c"># Should print a version number</span>
<span class="k">docker run</span> hello-world     <span class="c"># Should print "Hello from Docker!"</span>
<span class="k">groups</span> $USER | grep docker <span class="c"># Should show "docker" in the list</span></pre></div>
        <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Success</div><div class="callout-text">You should see "Hello from Docker!" in the output. If you see <em>permission denied</em>, fully log out of your SSH session and reconnect ‚Äî the group change requires a fresh login.</div></div></div>
      </div>
    </div>
  </div>
</section>

<!-- ¬ß2 ‚Äî Pull Image -->
<div class="section-anchor" id="s2"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">02</span>
    <div class="sec-title-block">
      <h2>Pulling the Robocar Image</h2>
      <div class="sec-subtitle">Download the pre-built UCSD Robocar software environment (~14.7 GB)</div>
    </div>
  </div>
  <p>The Robocar Docker image contains a fully configured environment including ROS2, OAK-D depth camera drivers (DepthAI), VESC motor controller drivers, all lane detection packages, and every required Python dependency. You pull it once and it persists on the Pi's storage.</p>
  <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">Network Warning ‚Äî Use Home Wi-Fi or Wired Ethernet</div><div class="callout-text">This image is approximately 14.7 GB. The campus Wi-Fi network frequently drops connections mid-download, corrupting the image and forcing a full re-pull. Use a home network or a wired Ethernet connection. If the download is interrupted, simply re-run the pull command ‚Äî Docker automatically resumes from the last successfully downloaded layer.</div></div></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal ‚Äî expect 20‚Äì40 minutes on a fast connection</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">docker pull</span> djnighti/ucsd_robocar:devel</pre></div>
  <h3>Verify the Download Succeeded</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">docker images</span> | grep ucsd_robocar
<span class="c"># Expected output:</span>
<span class="ok"># djnighti/ucsd_robocar   devel   &lt;id&gt;   &lt;date&gt;   14.7GB</span></pre></div>
  <h3>Troubleshooting</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Solution</th></tr></thead>
    <tbody>
      <tr><td>Download hangs or freezes</td><td>Re-run <code>docker pull</code> ‚Äî it resumes automatically from the last completed layer</td></tr>
      <tr><td>"No space left on device"</td><td>Run <code>docker system prune -f</code> to remove old images and stopped containers</td></tr>
      <tr><td>Image shows a size of 0B</td><td>The pull failed silently. Delete with <code>docker rmi djnighti/ucsd_robocar:devel</code> and re-pull</td></tr>
      <tr><td>Authentication error</td><td>The image is public. Verify your internet connection: <code>ping 8.8.8.8</code></td></tr>
    </tbody>
  </table></div>
</section>

<!-- ¬ß3 ‚Äî X11 Forwarding -->
<div class="section-anchor" id="s3"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">03</span>
    <div class="sec-title-block">
      <h2>Graphical Interface Setup (X11 Forwarding)</h2>
      <div class="sec-subtitle">Stream GUI windows from the Pi to your laptop screen over SSH</div>
    </div>
    <div class="sec-badges"><span class="badge badge-fix">Enhanced</span></div>
  </div>
  <p>X11 forwarding lets programs running on the Pi render graphical windows (calibration sliders, live camera feeds, debug overlays) and stream those windows over your SSH connection to your laptop's screen. Without X11 forwarding, none of the visual calibration tools will work.</p>
  <div class="callout info"><div class="callout-icon">‚Ñπ</div><div class="callout-body"><div class="callout-title">Complete This Section Before Creating the Docker Container</div><div class="callout-text">Set up X11 forwarding on both your laptop (Steps 2‚Äì3) and the Pi host (Steps 1 and 4) now. You will verify that it works <em>inside the Docker container</em> in Section 4, after the container is created.</div></div></div>
  <h3>Step 1 ‚Äî Install X11 Apps on the Pi</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt update</span>
<span class="k">sudo apt install</span> <span class="f">-y</span> x11-apps</pre></div>
  <h3>Step 2 ‚Äî Install an X Server on Your Laptop</h3>
  <div class="tw"><table>
    <thead><tr><th>Your OS</th><th>Software to Install</th><th>Required Extra Step</th></tr></thead>
    <tbody>
      <tr><td><strong>macOS</strong></td><td>XQuartz ‚Äî download from xquartz.org</td><td>After installing, open XQuartz ‚Üí Preferences ‚Üí Security tab ‚Üí check <strong>"Allow connections from network clients"</strong>. Then fully restart your Mac.</td></tr>
      <tr><td><strong>Windows</strong></td><td>MobaXterm ‚Äî download from mobaxterm.mobatek.net</td><td>No extra steps needed. MobaXterm includes a built-in X server and handles X11 forwarding automatically.</td></tr>
      <tr><td><strong>Linux</strong></td><td>X11 is built into all major distributions</td><td>No extra steps needed.</td></tr>
    </tbody>
  </table></div>
  <h3>Step 3 ‚Äî Connect via SSH with Forwarding Enabled</h3>
  <p>The <code>-Y</code> flag enables "trusted" X11 forwarding, which is required when the Docker container runs as <code>root</code>. The stricter <code>-X</code> flag blocks cross-user connections and will prevent calibration windows from opening inside Docker.</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Your laptop terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Use -Y (trusted forwarding) ‚Äî required for the Docker container</span>
<span class="k">ssh</span> <span class="f">-Y</span> pi@ucsdrobocar-148-XX.local

<span class="c"># Alternatively, -X (untrusted forwarding) ‚Äî use only if -Y is unavailable</span>
<span class="k">ssh</span> <span class="f">-X</span> pi@ucsdrobocar-148-XX.local</pre></div>
  <h3>Step 4 ‚Äî Test X11 on the Pi Host (Before Docker)</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal ‚Äî NOT inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">xeyes</span>
<span class="c"># A pair of animated eyes should appear on YOUR LAPTOP SCREEN</span>
<span class="c"># The eyes follow your mouse cursor. Press Ctrl+C to close.</span></pre></div>
  <figure>
    <div class="fig-wrap"><img src="images/fig_xeyes.png" alt="xeyes GUI window forwarded via X11 to laptop screen" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 3.1</span> Successful X11 host test ‚Äî the xeyes window appears on your laptop, forwarded from the Pi over SSH.</figcaption>
  </figure>
  <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">xeyes Opens? You're Ready for Section 4</div><div class="callout-text">If xeyes appeared on your laptop screen, X11 forwarding is working correctly on the Pi host. Proceed to Section 4 to create your Docker container.</div></div></div>
  <h3>How the Docker Flags Enable X11 (Reference)</h3>
  <div class="tw"><table>
    <thead><tr><th>Docker Flag</th><th>What It Does</th><th>Without It</th></tr></thead>
    <tbody>
      <tr><td><code>-e DISPLAY=$DISPLAY</code></td><td>Passes the Pi's X11 display socket address into the container so GUI applications know where to connect.</td><td>GUI applications crash immediately with "cannot open display".</td></tr>
      <tr><td><code>--volume="$HOME/.Xauthority:/root/.Xauthority:rw"</code></td><td>Mounts the Xauthority cookie file that proves the container is permitted to use the X server.</td><td>"Authorization required, rejecting connection" ‚Äî all GUI calls fail.</td></tr>
      <tr><td><code>--net=host</code></td><td>The container shares the Pi's full network stack, including the X11 IPC socket.</td><td>The X11 socket is unreachable from inside the container.</td></tr>
    </tbody>
  </table></div>
  <h3>Common X11 Errors &amp; Fixes</h3>
  <div class="tw"><table>
    <thead><tr><th>Error Message</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>"cannot open display"</td><td>SSH was not started with the <code>-Y</code> flag. Exit and reconnect: <code>ssh -Y pi@ucsdrobocar-148-XX.local</code></td></tr>
      <tr><td>"No protocol specified"</td><td>Run on the Pi host: <code>xhost +local:</code> then retry inside Docker</td></tr>
      <tr><td>"Authorization required"</td><td>The <code>.Xauthority</code> file is not mounted. Check the <code>--volume</code> flag in your docker run command.</td></tr>
      <tr><td>xeyes opens on Pi host but not inside Docker</td><td>Switch from <code>ssh -X</code> to <code>ssh -Y</code> and restart the container.</td></tr>
      <tr><td>macOS: nothing appears at all</td><td>Enable "Allow connections from network clients" in XQuartz Preferences ‚Üí Security. Restart your Mac after changing this setting.</td></tr>
      <tr><td>Works, then breaks after a Pi reboot</td><td>Run the Xauth reset script below.</td></tr>
    </tbody>
  </table></div>
  <h3>Xauth Reset Script (If X11 Breaks After a Reboot)</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi host terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">xauth generate</span> $DISPLAY . trusted
<span class="k">xauth list</span>      <span class="c"># Confirm credentials were written</span>
<span class="k">exit</span>
<span class="k">ssh</span> <span class="f">-Y</span> pi@ucsdrobocar-148-XX.local</pre></div>
  <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">Xauthority Lock Error</div><div class="callout-text">If you see "timeout in locking authority file", the <code>.Xauthority</code> file is corrupt. Delete it and start fresh: <code>rm ~/.Xauthority &amp;&amp; ssh -Y pi@ucsdrobocar-148-XX.local</code></div></div></div>
</section>

<!-- ¬ß4 ‚Äî Run Container -->
<div class="section-anchor" id="s4"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">04</span>
    <div class="sec-title-block">
      <h2>Running the Docker Container</h2>
      <div class="sec-subtitle">Start the Robocar environment using a reusable shell function</div>
    </div>
  </div>
  <p>The full <code>docker run</code> command is long and prone to typos. We store it as a shell function in <code>~/.bashrc</code> on the Pi so it becomes a simple one-word command.</p>
  <h3>Step 1 ‚Äî Add the Shell Function to the Pi's .bashrc</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> ~/.bashrc  <span class="c"># Scroll to the bottom and paste the function below</span></pre></div>
  <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">Replace the Placeholder Values Before Saving</div><div class="callout-text">Replace <code>MY_CONTAINER_NAME</code> with a name of your choosing (e.g., <code>robocar_team4</code>). Replace <code>YOUR_TEAM_ID</code> with your team number (e.g., <code>4</code>).</div></div></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Paste into Pi ~/.bashrc ‚Äî edit MY_CONTAINER_NAME and YOUR_TEAM_ID</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>robocar_docker() {
  docker run \
    --name MY_CONTAINER_NAME \
    -it \
    --privileged \
    --net=host \
    -e DISPLAY=$DISPLAY \
    -e ROS_DOMAIN_ID=YOUR_TEAM_ID \
    --volume /dev/bus/usb:/dev/bus/usb \
    --device-cgroup-rule='c 189:* rmw' \
    --device /dev/video0 \
    --volume="$HOME/.Xauthority:/root/.Xauthority:rw" \
    --volume /etc/passwd:/etc/passwd:ro \
    --volume /etc/group:/etc/group:ro \
    djnighti/ucsd_robocar:${2:-devel}
}</pre></div>
  <h3>Step 2 ‚Äî Reload and Launch the Container</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">source</span> ~/.bashrc
<span class="k">robocar_docker</span> MY_CONTAINER_NAME</pre></div>
  <div class="callout info"><div class="callout-icon">‚Ñπ</div><div class="callout-body"><div class="callout-title">First Run vs. All Future Sessions</div><div class="callout-text">The <code>docker run</code> command (via <code>robocar_docker</code>) only works the <strong>first time</strong> ‚Äî it creates a brand-new container. Once you exit, the container still exists on disk but is stopped. For every future session, use <code>docker start</code> + <code>docker exec</code> as shown in Step 3.</div></div></div>
  <h3>Step 3 ‚Äî Manage the Container in All Future Sessions</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal ‚Äî all future sessions after the first</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Start the stopped container (run this after a reboot or after exiting)</span>
<span class="k">docker start</span> MY_CONTAINER_NAME

<span class="c"># Open an interactive terminal inside the running container</span>
<span class="k">docker exec -it</span> MY_CONTAINER_NAME bash

<span class="c"># Open ADDITIONAL terminal tabs into the SAME running container</span>
<span class="k">docker exec -it</span> MY_CONTAINER_NAME bash</pre></div>
  <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Multi-Terminal Workflow</div><div class="callout-text">You will regularly need 3‚Äì4 concurrent terminals: one for <code>ros2 launch</code>, one for editing YAML config files, one for <code>ros2 topic echo</code> to monitor live data, and one for debugging. Open each by running <code>docker exec -it MY_CONTAINER_NAME bash</code> in separate SSH windows.</div></div></div>
  <h3>Step 4 ‚Äî Verify X11 Works Inside the Container</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker container</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># DISPLAY must not be empty ‚Äî it should show a value like :10 or :11</span>
<span class="k">echo</span> $DISPLAY

<span class="c"># xeyes must appear on YOUR LAPTOP SCREEN</span>
<span class="k">xeyes</span></pre></div>
</section>

<!-- ¬ß5 ‚Äî Python Error Fix -->
<div class="section-anchor" id="s5"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">05</span>
    <div class="sec-title-block">
      <h2>Fixing Python Errors (If Needed)</h2>
      <div class="sec-subtitle">Resolve the apport_python_hook AttributeError inside the container</div>
    </div>
  </div>
  <p>On some Pi setups, the Docker container throws the following error when running ROS2 commands:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Error message to watch for</span></div><pre><span class="er">AttributeError: module 'apport_python_hook' has no attribute 'install'</span></pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker container</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cat</span> &gt; /usr/lib/python3.8/sitecustomize.py &lt;&lt;<span class="s">'EOF'</span>
try:
    import apport_python_hook
    if hasattr(apport_python_hook, <span class="s">'install'</span>):
        apport_python_hook.install()
except Exception:
    pass
<span class="s">EOF</span>

<span class="k">rm -f</span> /usr/lib/python3.8/__pycache__/sitecustomize.cpython-38.pyc 2&gt;/dev/null || true
<span class="k">python3</span> -c <span class="s">"print('Python OK')"</span>
<span class="k">ros2 --help</span> | head -3</pre></div>
  <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">Check Your Python Version First</div><div class="callout-text">The path <code>/usr/lib/python3.8/</code> must match the Python version inside your container. Check it with <code>python3 --version</code>. If it shows Python 3.10, use <code>/usr/lib/python3.10/sitecustomize.py</code>.</div></div></div>
</section>

<!-- ¬ß6 ‚Äî Build Workspace -->
<div class="section-anchor" id="s6"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">06</span>
    <div class="sec-title-block">
      <h2>Package Installation &amp; Build</h2>
      <div class="sec-subtitle">Configure setup.py and compile the ROS2 workspace with colcon</div>
    </div>
  </div>
  <p>ROS2 uses <code>colcon</code> as its build system. Before building, we update <code>setup.py</code> to ensure all launch files, YAML configs, and RVIZ files are correctly installed.</p>
  <h3>Step 1 ‚Äî Navigate to the Package Directory</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cd</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg</pre></div>
  <h3>Step 2 ‚Äî Write the Improved setup.py</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî write improved setup.py</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cat</span> &gt; setup.py &lt;&lt;<span class="s">'EOF'</span>
from setuptools import setup
import os

package_name = <span class="s">'ucsd_robocar_nav2_pkg'</span>

def package_files(directory):
    paths = []
    for (path, _, filenames) in os.walk(directory):
        for f in filenames:
            paths.append(os.path.join(path, f))
    return paths

data_files = [
    (<span class="s">'share/ament_index/resource_index/packages'</span>, [<span class="s">'resource/'</span> + package_name]),
    (<span class="s">'share/'</span> + package_name, [<span class="s">'package.xml'</span>]),
]

for d in [<span class="s">'launch'</span>, <span class="s">'config'</span>, <span class="s">'rviz'</span>, <span class="s">'urdf'</span>, <span class="s">'ros_data'</span>]:
    if os.path.isdir(d):
        data_files.append((os.path.join(<span class="s">'share'</span>, package_name, d), package_files(d)))

setup(
    name=package_name, version=<span class="s">'0.0.0'</span>,
    packages=[package_name], data_files=data_files,
    install_requires=[<span class="s">'setuptools'</span>], zip_safe=True,
    maintainer=<span class="s">'root'</span>, maintainer_email=<span class="s">'root@todo.todo'</span>,
    description=<span class="s">'Nav2 launch/config package for UCSD RoboCar'</span>,
    license=<span class="s">'TODO'</span>, tests_require=[<span class="s">'pytest'</span>],
    entry_points={<span class="s">'console_scripts'</span>: []},
)
<span class="s">EOF</span></pre></div>
  <h3>Step 3 ‚Äî Build the Workspace</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cd</span> /home/projects/ros2_ws
<span class="k">rm -rf</span> build install log
<span class="k">colcon build</span> <span class="f">--symlink-install</span>
<span class="k">source</span> install/setup.bash
<span class="k">ros2 pkg list</span> | grep ucsd_robocar</pre></div>
  <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">Always Source After Every Build</div><div class="callout-text">Running <code>colcon build</code> compiles the code but does <strong>not</strong> make it available to ROS2. You must run <code>source install/setup.bash</code> every time after building. Section 7 creates aliases that handle this automatically.</div></div></div>
</section>

<!-- ¬ß7 ‚Äî Shell Aliases -->
<div class="section-anchor" id="s7"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">07</span>
    <div class="sec-title-block">
      <h2>Shell Aliases: source_ros2 &amp; build_ros2</h2>
      <div class="sec-subtitle">One-command shortcuts for every build and source operation</div>
    </div>
  </div>
  <p>These two aliases eliminate the most common source of student mistakes: forgetting to rebuild or re-source after changing a file.</p>
  <div class="callout info"><div class="callout-icon">‚Ñπ</div><div class="callout-body"><div class="callout-title">These Aliases Go Inside the Container</div><div class="callout-text">Add these to <code>/root/.bashrc</code> <strong>inside Docker</strong>, not the Pi host's <code>~/.bashrc</code>. If your ROS2 distribution is not Foxy, update the last line accordingly (e.g., replace <code>foxy</code> with <code>humble</code>).</div></div></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî paste into ~/.bashrc</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># ‚îÄ‚îÄ Source workspace only (fast ‚Äî no recompilation) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
alias source_ros2=<span class="s">'source /home/projects/ros2_ws/install/setup.bash &amp;&amp; echo "[ROS2] Workspace sourced ‚úì"'</span>

<span class="c"># ‚îÄ‚îÄ Full build then source (use after ANY file change) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
alias build_ros2=<span class="s">'cd /home/projects/ros2_ws &amp;&amp; colcon build --symlink-install &amp;&amp; source install/setup.bash &amp;&amp; echo "[ROS2] Build complete ‚úì"'</span>

<span class="c"># ‚îÄ‚îÄ Source the global ROS2 base installation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
source /opt/ros/foxy/setup.bash 2&gt;/dev/null</pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Activate and test</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">source</span> ~/.bashrc
<span class="k">source_ros2</span>    <span class="c"># Should print: [ROS2] Workspace sourced ‚úì</span>
<span class="k">build_ros2</span>     <span class="c"># Should print: [ROS2] Build complete ‚úì</span></pre></div>
  <div class="tw"><table>
    <thead><tr><th>Alias</th><th>When to Use</th><th>Speed</th></tr></thead>
    <tbody>
      <tr><td><code>source_ros2</code></td><td>Opening a new terminal into an already-built container ‚Äî no recompilation, only registers packages.</td><td>~1 second</td></tr>
      <tr><td><code>build_ros2</code></td><td>After <strong>any</strong> change to Python code, YAML configs, launch files, or setup.py. Always use this after edits.</td><td>30‚Äì120 seconds</td></tr>
    </tbody>
  </table></div>
</section>

<!-- ¬ß8 ‚Äî Camera Power Fix -->
<div class="section-anchor" id="s8"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">08</span>
    <div class="sec-title-block">
      <h2>Camera Power Fix ‚Äî USB Current &amp; Powered Hub</h2>
      <div class="sec-subtitle">Fix random camera disconnects caused by insufficient USB power</div>
    </div>
  </div>
  <div class="callout error"><div class="callout-icon">‚úó</div><div class="callout-body"><div class="callout-title">Very Common Lab Issue</div><div class="callout-text">The OAK-D camera draws up to 900 mA at peak. The Raspberry Pi's USB ports are limited to approximately 600 mA total by firmware default. This causes the camera to disconnect randomly, produce an all-black feed, or fail to appear as a USB device entirely.</div></div></div>
  <h3>Diagnose the Problem First</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi host terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">dmesg</span> | grep -i <span class="s">'usb\|over-current\|power'</span> | tail -20
<span class="k">lsusb</span> | grep -i <span class="s">'movidius\|luxonis\|intel'</span></pre></div>
  <h3>Solution 1 ‚Äî Software Fix via config.txt</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi host terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo nano</span> /boot/config.txt
<span class="c"># Add this exact line at the END of the file:</span>
<span class="v">max_usb_current=1</span>
<span class="k">sudo reboot</span></pre></div>
  <h3>Solution 2 ‚Äî Powered USB Hub (Most Reliable)</h3>
  <div class="tw"><table>
    <thead><tr><th>Component</th><th>Requirement</th></tr></thead>
    <tbody>
      <tr><td>USB Hub</td><td>USB 3.0 hub with an external power adapter ‚Äî must <strong>not</strong> be bus-powered</td></tr>
      <tr><td>Hub Power Adapter</td><td>5V / 2A minimum, dedicated supply</td></tr>
      <tr><td>Connection</td><td>Pi USB-A port ‚Üí Powered Hub ‚Üí OAK-D + VESC + other USB devices</td></tr>
    </tbody>
  </table></div>
</section>

<!-- ¬ß9 ‚Äî Camera Isolation -->
<div class="section-anchor" id="s9"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">09</span>
    <div class="sec-title-block">
      <h2>Camera Isolation ‚Äî Prevent Cross-Team Interference</h2>
      <div class="sec-subtitle">Ensure your robot only communicates with your own team's nodes</div>
    </div>
  </div>
  <div class="callout error"><div class="callout-icon">‚úó</div><div class="callout-body"><div class="callout-title">Critical Lab Issue ‚Äî Read Before Starting Any Calibration</div><div class="callout-text">All robots running ROS2 on the same Wi-Fi network are visible to each other by default. During a lab session with 10+ teams, your calibration GUI may be receiving another team's camera feed, or your steering commands could be controlling a different robot.</div></div></div>
  <h3>The Fix ‚Äî Assign Each Team a Unique ROS_DOMAIN_ID</h3>
  <p>Nodes on different Domain IDs are completely invisible to each other at the DDS network layer. Setting a unique Domain ID requires zero code changes ‚Äî it is purely an environment variable. Domain ID 0 is the system default and is <strong>not safe</strong> to use in a multi-team environment.</p>
  <div class="team-widget">
    <div class="team-widget-title">üè∑ Team Domain ID Assignments</div>
    <div class="team-widget-sub">Your team number = your Domain ID. Valid range: 1‚Äì232 (avoid 0 ‚Äî it is the shared default).</div>
    <div class="team-grid" id="team-grid"></div>
  </div>
  <h3>Step 1 ‚Äî Set ROS_DOMAIN_ID in the Docker Run Command</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> ~/.bashrc
<span class="c"># Find the line that reads: -e ROS_DOMAIN_ID=YOUR_TEAM_ID</span>
<span class="c"># Change it to your team number, for example Team 4:</span>
<span class="f">-e</span> ROS_DOMAIN_ID=<span class="v">4</span> \</pre></div>
  <h3>Step 2 ‚Äî Set ROS_DOMAIN_ID Persistently Inside the Container</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî add to ~/.bashrc</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> ~/.bashrc
<span class="c"># Add this line (replacing 4 with your actual team number):</span>
<span class="k">export</span> ROS_DOMAIN_ID=<span class="v">4</span>
<span class="k">source</span> ~/.bashrc</pre></div>
  <h3>Step 3 ‚Äî Verify Isolation Is Active</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Must print your team number ‚Äî if empty, isolation is NOT active</span>
<span class="k">echo</span> $ROS_DOMAIN_ID
<span class="k">ros2 topic list</span>   <span class="c"># Verify you only see your own topics</span>
<span class="k">ros2 node list</span>    <span class="c"># Verify you only see your own nodes</span></pre></div>
  <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Quick Lab Sanity Check</div><div class="callout-text">Before every calibration session, run <code>echo $ROS_DOMAIN_ID</code> inside Docker. If it prints empty or <code>0</code>, isolation is not active and your calibration may be interfering with other teams.</div></div></div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CALIBRATION SECTIONS ‚Äî RESTRUCTURED
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- ¬ß10 ‚Äî Config Overview -->
<div class="section-anchor" id="s10"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">10</span>
    <div class="sec-title-block">
      <h2>Calibration Overview &amp; Config Files</h2>
      <div class="sec-subtitle">Understand the full calibration flow before you touch a single slider</div>
    </div>
    <div class="sec-badges"><span class="badge badge-critical">Read First</span></div>
  </div>

  <div class="track-banner">
    <div class="track-banner-icon">üèÅ</div>
    <div class="track-banner-body">
      <h4>All calibration is done on the track</h4>
      <p>Every slider adjustment in Sections 11‚Äì13 must be performed with the car <strong>physically placed on the track</strong>, camera pointed at the actual <strong>yellow lane markers</strong> your car will follow. Desktop or carpet calibration will not transfer to the track.</p>
    </div>
  </div>

  <h3>The Two-Phase Calibration Workflow</h3>
  <div class="workflow-bar">
    <div class="workflow-step done">
      <div class="ws-num">PHASE 1</div>
      <div class="ws-label">Change Nodes<br>(Calibration Mode)</div>
    </div>
    <div class="workflow-arrow">‚Üí</div>
    <div class="workflow-step done">
      <div class="ws-num">PHASE 1</div>
      <div class="ws-label">Launch GUI<br>on Track</div>
    </div>
    <div class="workflow-arrow">‚Üí</div>
    <div class="workflow-step done">
      <div class="ws-num">PHASE 1</div>
      <div class="ws-label">Tune HSV &amp;<br>Lane Sliders</div>
    </div>
    <div class="workflow-arrow">‚Üí</div>
    <div class="workflow-step active">
      <div class="ws-num">PHASE 2</div>
      <div class="ws-label">Change Nodes<br>(Nav Mode)</div>
    </div>
    <div class="workflow-arrow">‚Üí</div>
    <div class="workflow-step active">
      <div class="ws-num">PHASE 2</div>
      <div class="ws-label">Launch Car<br>&amp; Tune PID</div>
    </div>
  </div>

  <h3>Config Files Reference</h3>
  <div class="tw"><table>
    <thead><tr><th>File</th><th>Controls</th><th>Full Path Inside Docker</th></tr></thead>
    <tbody>
      <tr><td><code>node_config.yaml</code></td><td>Which ROS2 nodes are launched ‚Äî calibration GUI on/off, autonomous navigation on/off. <strong>This is the first file you edit.</strong></td><td><code>/home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg/config/node_config.yaml</code></td></tr>
      <tr><td><code>car_config.yaml</code></td><td>Which hardware is active ‚Äî camera model, motor controller type</td><td><code>/home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg/config/car_config.yaml</code></td></tr>
      <tr><td><code>ros_racer_calibration.yaml</code></td><td>PID gains, throttle limits, steering limits, error threshold. <strong>Edited during Phase 2 on the track.</strong></td><td><code>/home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_lane_detection2_pkg/config/ros_racer_calibration.yaml</code></td></tr>
    </tbody>
  </table></div>

  <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">The Golden Rule ‚Äî Every Change Needs build_ros2</div><div class="callout-text">Every time you edit <strong>any</strong> YAML file, Python file, or launch file, you must run <code>build_ros2</code> for the change to take effect. Running <code>source_ros2</code> alone is <strong>not enough</strong> for YAML changes. This is the single most common student mistake.</div></div></div>

  <div class="sb-reminder">
    <div class="sb-reminder-icon">üîÅ</div>
    <div class="sb-reminder-text"><strong>The Workflow You Will Repeat Constantly:</strong> Edit file ‚Üí <code>build_ros2</code> ‚Üí test ‚Üí repeat</div>
  </div>
</section>

<!-- ¬ß11 ‚Äî Step 1: Enable Calibration Mode (Change the Nodes) -->
<div class="section-anchor" id="s11"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">11</span>
    <div class="sec-title-block">
      <h2>Step 1 ‚Äî Switch to Calibration Mode</h2>
      <div class="sec-subtitle">Edit node_config.yaml to enable the GUI, then build and launch on the track</div>
    </div>
    <div class="sec-badges"><span class="badge badge-new">Phase 1 ¬∑ Start Here</span></div>
  </div>

  <p>Before adjusting any sliders, you must tell ROS2 <em>which nodes to run</em> by editing <code>node_config.yaml</code>. In calibration mode, the system launches the GUI sliders and camera feed but <strong>disables autonomous driving</strong> ‚Äî so the car stays still while you tune. Do not skip this step or the car may drive away during calibration.</p>

  <h3>Edit node_config.yaml ‚Äî Calibration Mode Values</h3>
  <div class="sb-reminder">
    <div class="sb-reminder-icon">üîÅ</div>
    <div class="sb-reminder-text">Workflow: <strong>Edit file</strong> ‚Üí <code>build_ros2</code> ‚Üí launch ‚Üí tune sliders</div>
  </div>

  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî open node_config.yaml</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg/config/node_config.yaml</pre></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">node_config.yaml ‚Äî set these exact values for CALIBRATION MODE</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="v">all_components</span>:          1
<span class="v">camera_nav_calibration</span>:  1   <span class="c"># ‚úÖ ENABLE ‚Äî opens the calibration slider GUI</span>
<span class="v">sensor_visualization</span>:    1   <span class="c"># Enable for LiDAR visualization (set 0 if not using LiDAR)</span>
<span class="v">camera_nav</span>:              0   <span class="c"># ‚ùå DISABLE ‚Äî autonomous driving must be OFF during calibration</span></pre></div>

  <h3>Edit car_config.yaml ‚Äî Hardware Selection</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî open car_config.yaml</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg/config/car_config.yaml</pre></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">car_config.yaml ‚Äî same values for both calibration and navigation</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="v">oakd</span>:              1   <span class="c"># Enable the OAK-D camera</span>
<span class="v">vesc_without_odom</span>: 1   <span class="c"># Enable VESC motor controller (no odometry feedback needed)</span></pre></div>

  <h3>Build the Workspace</h3>
  <p>After saving both config files, you <strong>must</strong> rebuild before the changes take effect:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">build_ros2</span>
<span class="c"># Wait for "Build complete ‚úì" ‚Äî this takes 30‚Äì120 seconds</span></pre></div>

  <h3>Place the Car on the Track and Launch</h3>
  <div class="track-banner">
    <div class="track-banner-icon">üöó</div>
    <div class="track-banner-body">
      <h4>Go to the track now</h4>
      <p>Place your car on the track with the camera pointed at the <strong>yellow lane markers</strong>. The car will not move during calibration mode, but make sure it is positioned as it would be during a real run ‚Äî this ensures what you see in the GUI reflects real track conditions.</p>
    </div>
  </div>

  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî launch all calibration nodes</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">source_ros2</span>
<span class="k">ros2 launch</span> ucsd_robocar_nav2_pkg all_nodes.launch.py</pre></div>

  <div class="callout info"><div class="callout-icon">‚Ñπ</div><div class="callout-body"><div class="callout-title">Multiple GUI Windows Will Open on Your Laptop</div><div class="callout-text">Via X11 forwarding, several windows will appear on your laptop screen simultaneously: the <strong>live camera feed</strong>, the <strong>HSV color mask preview</strong>, the <strong>lane detection overlay</strong>, and the <strong>slider control panel</strong>. This command <em>blocks</em> the terminal while running ‚Äî open a second terminal with <code>docker exec -it MY_CONTAINER_NAME bash</code> if you need to run other commands.</div></div></div>

  <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Calibration Launched Successfully?</div><div class="callout-text">You should see GUI windows on your laptop and a live camera feed showing the track. Proceed to Section 12 to tune the HSV color filter, followed by Section 13 for lane parameters. Both are done with the car on the track and the GUI running.</div></div></div>
</section>

<!-- ¬ß12 ‚Äî Step 2: HSV Tuning on Track -->
<div class="section-anchor" id="s12"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">12</span>
    <div class="sec-title-block">
      <h2>Step 2 ‚Äî Color Calibration (HSV Tuning) on the Track</h2>
      <div class="sec-subtitle">Isolate the yellow lane markers from the camera feed using HSV color filtering</div>
    </div>
    <div class="sec-badges"><span class="badge badge-new">Phase 1 ¬∑ With GUI Running</span></div>
  </div>

  <div class="track-banner">
    <div class="track-banner-icon">üü°</div>
    <div class="track-banner-body">
      <h4>You are calibrating for the yellow lane markers</h4>
      <p>The car follows the <strong>yellow center dots/lines</strong> on the track. Your goal is to make exactly those yellow markers appear <strong>white</strong> in the mask preview while everything else appears <strong>black</strong>. The GUI must be running (from Section 11) and the car must be on the track for this step.</p>
    </div>
  </div>

  <p>The lane detection pipeline converts each camera frame to HSV (Hue, Saturation, Value) color space and applies a threshold. Pixels whose HSV values fall within your specified range appear white (detected road markers); everything else appears black (background). Lighting conditions change throughout the day ‚Äî re-tune if you notice inconsistent detection.</p>

  <figure>
    <div class="fig-wrap"><img src="images/fig_hsv_chart.png" alt="HSV color spectrum showing Hue 0-180 in OpenCV" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 12.1</span> HSV Hue spectrum (0‚Äì180 in OpenCV). Yellow ‚âà Hue 25‚Äì35. Note: OpenCV uses 0‚Äì180 for Hue instead of the standard 0‚Äì360 ‚Äî divide any standard hue value by 2.</figcaption>
  </figure>

  <div class="tw"><table>
    <thead><tr><th>Channel</th><th>Range</th><th>Low Extreme</th><th>High Extreme</th></tr></thead>
    <tbody>
      <tr><td><strong>Hue (H)</strong></td><td>0‚Äì180 (OpenCV)</td><td>Red tones (0)</td><td>Violet back to red (180)</td></tr>
      <tr><td><strong>Saturation (S)</strong></td><td>0‚Äì255</td><td>White / desaturated gray (no color)</td><td>Pure vivid saturated color</td></tr>
      <tr><td><strong>Value (V)</strong></td><td>0‚Äì255</td><td>Black / very dark (0)</td><td>Bright, fully lit (255)</td></tr>
    </tbody>
  </table></div>

  <h3>What You Should See in the GUI</h3>

  <figure>
    <div class="fig-wrap"><img src="images/fig_mask_default.png" alt="Default HSV mask ‚Äî full white image" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 12.2</span> Default slider values ‚Äî the entire image passes through the filter and appears white. No useful detection is possible. This is your starting point before tuning.</figcaption>
  </figure>

  <figure>
    <div class="fig-wrap"><img src="images/fig_mask_yellow.png" alt="HSV mask tuned to isolate yellow road dots" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 12.3</span> Target result: tuned for yellow road dots (lowH=25, highH=35, lowS‚âà56, lowV‚âà112). Only the yellow lane markers appear white; the rest is black. This is what you are working toward.</figcaption>
  </figure>

  <h3>Step-by-Step Tuning Procedure</h3>
  <p>With the calibration launch running and the car on the track, adjust the sliders in the GUI in this order:</p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">Set the Hue Range for Yellow</div>
        <div class="step-desc">For the yellow lane markers used on the ECE/MAE 148 track, start with <code>lowH = 25</code> and <code>highH = 35</code>. These values isolate the yellow-green to yellow-orange range. The mask preview should now show only roughly yellow regions as white.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-body">
        <div class="step-title">Raise lowS to Filter Out Gray Road Surface</div>
        <div class="step-desc">Increase <code>lowS</code> to approximately 50‚Äì80. This removes desaturated gray patches (the road itself) that might bleed into the yellow hue range under certain lighting. If the actual yellow dots start disappearing, lower <code>lowS</code> until they reappear.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Raise lowV to Eliminate Shadow Noise</div>
        <div class="step-desc">Increase <code>lowV</code> to approximately 80‚Äì120. This removes dark shadow regions that might have a yellow hue component. Track shadows are a major source of false detections. Lower the value if shadowed portions of the actual yellow markers start disappearing.</div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Remove Remaining Speckle Noise</div>
        <div class="step-desc">Use <strong>erosion_iterations</strong> to shrink all pixel blobs (removes small noise dots), then use <strong>dilation_iterations</strong> to expand the remaining valid blobs back (restores the real markers). Use <strong>gray_thresh</strong> to additionally eliminate near-gray pixels.</div>
      </div>
    </div>
  </div>

  <figure>
    <div class="fig-wrap"><img src="images/fig_bw_calibration.png" alt="Noise reduction calibration sliders" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 12.4</span> Noise reduction sliders. After tuning, the mask preview should show clean white rectangles (the yellow lane markers) against a solid black background with no stray speckles.</figcaption>
  </figure>

  <h3>Color Quick Reference</h3>
  <div class="tw"><table>
    <thead><tr><th>Target Color</th><th>lowH</th><th>highH</th><th>Strategy</th></tr></thead>
    <tbody>
      <tr><td><strong>Yellow center dots</strong> ‚Üê primary target</td><td>25</td><td>35</td><td>Direct Hue filtering. This is what the car follows on the ECE/MAE 148 track.</td></tr>
      <tr><td>White lane lines</td><td>0</td><td>180</td><td>Set <code>inverted_filter=1</code>, then tune S and V to exclude the gray road surface.</td></tr>
      <tr><td>Orange cones</td><td>10</td><td>20</td><td>May vary with your specific cones and lighting.</td></tr>
      <tr><td>Red stop line</td><td>0‚Äì10 or 165‚Äì179</td><td>Wrap-around</td><td>Red wraps at H=0/180 in OpenCV. May need two separate filter passes.</td></tr>
    </tbody>
  </table></div>

  <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Good HSV Calibration Result</div><div class="callout-text">The mask preview shows solid white blocks where the yellow markers are, clean black everywhere else, and no stray speckles on the road surface. When you move the car slightly, the white blocks shift position in the mask. Proceed to Section 13 to configure lane detection parameters ‚Äî do not stop the launch.</div></div></div>
</section>

<!-- ¬ß13 ‚Äî Step 3: Lane Calibration -->
<div class="section-anchor" id="s13"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">13</span>
    <div class="sec-title-block">
      <h2>Step 3 ‚Äî Lane &amp; Line Calibration on the Track</h2>
      <div class="sec-subtitle">Configure contour filtering, error threshold, and camera alignment</div>
    </div>
    <div class="sec-badges"><span class="badge badge-new">Phase 1 ¬∑ With GUI Running</span></div>
  </div>

  <div class="track-banner">
    <div class="track-banner-icon">üéØ</div>
    <div class="track-banner-body">
      <h4>Still on the track with the GUI running</h4>
      <p>Continue from Section 12 ‚Äî do not stop the launch. These sliders configure how the filtered mask is converted into a steering error signal. The goal is a stable blue centroid dot that follows the yellow lane center as the car moves.</p>
    </div>
  </div>

  <p>After the HSV filter produces a binary black-and-white image, the lane detection algorithm finds contours (connected white pixel groups), measures their widths, and computes a centroid. This centroid position is translated into a steering error signal for the PID controller.</p>

  <figure>
    <div class="fig-wrap"><img src="images/fig_line_calibration.png" alt="Line calibration view with detected markers" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 13.1</span> Lane calibration view: green segments are valid detected markers, the <strong>blue dot</strong> is the computed centroid, and the green vertical bar is the camera centerline reference. Your goal is a stable, steady blue dot centered on the lane.</figcaption>
  </figure>

  <h3>Contour Size Filtering</h3>
  <div class="tw"><table>
    <thead><tr><th>Parameter</th><th>Effect</th><th>Starting Value</th></tr></thead>
    <tbody>
      <tr><td><code>min_width</code></td><td>Minimum pixel width for a contour to be accepted as a valid road marker. Eliminates thin, distant, or noisy detections.</td><td>15</td></tr>
      <tr><td><code>max_width</code></td><td>Maximum pixel width. Filters out very wide blobs such as road surface color or shadows.</td><td>200</td></tr>
      <tr><td><code>number_of_lines</code></td><td>How many valid line segments to include in the centroid calculation. More lines = more stable on straights, harder to tune on tight curves.</td><td>3‚Äì4</td></tr>
    </tbody>
  </table></div>

  <h3>Error Threshold ‚Äî The Dead Band</h3>
  <figure>
    <div class="fig-wrap"><img src="images/fig_error_threshold.png" alt="Error threshold dead band shown as red vertical bars" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 13.2</span> The two red vertical bars define the error threshold dead band. When the lane centroid falls between these bars, the error is treated as zero and no steering correction is applied.</figcaption>
  </figure>

  <p>The error threshold defines a "dead band" around the camera centerline. If the computed lane centroid falls within this zone, the robot treats the error as zero and makes no steering correction. This prevents constant micro-corrections on straight sections.</p>

  <div class="tw"><table>
    <thead><tr><th>Scenario</th><th>Threshold Too Wide</th><th>Threshold Too Narrow</th></tr></thead>
    <tbody>
      <tr><td><strong>Straight sections</strong></td><td>Small drifts uncorrected ‚Üí car gradually wanders off center</td><td>Constant micro-corrections ‚Üí jittery, oscillating steering</td></tr>
      <tr><td><strong>Curved sections</strong></td><td>Anticipates turns earlier ‚Üí smoother cornering</td><td>Reacts to nearest markers ‚Üí tighter, more aggressive turns</td></tr>
    </tbody>
  </table></div>

  <h3>Camera Alignment &amp; Cropping</h3>
  <figure>
    <div class="fig-wrap"><img src="images/fig_camera_align.png" alt="Camera centerline alignment view" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 13.3</span> Camera alignment view: the green bar marks the zero-error centerline reference (align this to the car's physical center), and the red bars show the error threshold bounds.</figcaption>
  </figure>

  <div class="tw"><table>
    <thead><tr><th>Parameter</th><th>Effect</th></tr></thead>
    <tbody>
      <tr><td><code>camera_centerline</code></td><td>Sets the position of the green zero-error reference bar. Place a ruler along the car's physical centerline and adjust this slider until the green bar aligns with it.</td></tr>
      <tr><td><code>frame_width</code></td><td>Crops the image horizontally. Reduces analysis columns to ignore walls and off-track objects at frame edges.</td></tr>
      <tr><td><code>rows_to_watch</code></td><td>Crops the image vertically ‚Äî controls how many rows from the bottom are analyzed. Smaller = focuses on road immediately ahead; larger = looks further ahead.</td></tr>
      <tr><td><code>rows_offset</code></td><td>Shifts the vertical crop window up/down. Higher offset makes the car "look" further down the road, useful for anticipating curves at higher speeds.</td></tr>
    </tbody>
  </table></div>

  <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Lane Calibration Complete ‚Äî Ready for Phase 2</div><div class="callout-text">When the blue centroid dot tracks the yellow lane markers steadily and the error threshold bars are positioned appropriately, you are done with Phase 1 calibration. Press <strong>Ctrl+C</strong> to stop the launch and proceed to Section 14 to switch to navigation mode and tune PID on the track.</div></div></div>
</section>

<!-- ¬ß14 ‚Äî Step 4: Navigation Mode + PID Tuning -->
<div class="section-anchor" id="s14"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">14</span>
    <div class="sec-title-block">
      <h2>Step 4 ‚Äî Switch to Navigation Mode &amp; Tune PID</h2>
      <div class="sec-subtitle">Change the nodes, launch the car autonomously, and dial in PID gains on the track</div>
    </div>
    <div class="sec-badges"><span class="badge badge-warn">Phase 2 ¬∑ Car Moves</span></div>
  </div>

  <div class="callout error"><div class="callout-icon">‚úó</div><div class="callout-body"><div class="callout-title">Safety ‚Äî Read Before the Car Moves</div><div class="callout-text">Never launch navigation mode with the robot on the track without at least one person positioned to physically stop it. Always have Ctrl+C ready in the launch terminal. Start at minimum throttle and verify behavior before increasing speed.</div></div></div>

  <h3>Phase 2, Part A ‚Äî Edit node_config.yaml to Navigation Mode</h3>
  <p>Stop the calibration launch (Ctrl+C if it is still running), then change <code>node_config.yaml</code> to switch from calibration to autonomous driving:</p>

  <div class="sb-reminder">
    <div class="sb-reminder-icon">üîÅ</div>
    <div class="sb-reminder-text">Workflow: <strong>Edit node_config.yaml</strong> ‚Üí <code>build_ros2</code> ‚Üí test ‚Üí repeat</div>
  </div>

  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî open node_config.yaml</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg/config/node_config.yaml</pre></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">node_config.yaml ‚Äî set these exact values for NAVIGATION MODE</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="v">all_components</span>:          1
<span class="v">camera_nav_calibration</span>:  0   <span class="c"># ‚ùå DISABLE ‚Äî calibration GUI not needed during racing</span>
<span class="v">sensor_visualization</span>:    0   <span class="c"># ‚ùå DISABLE ‚Äî saves CPU cycles for the control loop</span>
<span class="v">camera_nav</span>:              1   <span class="c"># ‚úÖ ENABLE ‚Äî activates autonomous lane following</span></pre></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî build after changing node_config.yaml</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">build_ros2</span>
<span class="c"># Wait for "Build complete ‚úì"</span></pre></div>

  <h3>Phase 2, Part B ‚Äî Actuator Calibration (Steering & Throttle Limits)</h3>
  <p>Before tuning PID, set physical limits for your steering servo and throttle. These are saved in <code>ros_racer_calibration.yaml</code> and are set using the actuator GUI sliders during a short calibration launch.</p>

  <figure>
    <div class="fig-wrap"><img src="images/fig_throttle_steering.png" alt="Throttle and steering calibration GUI sliders" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 14.1</span> Actuator calibration GUI. Set steering physical limits first (modes 0, 1, 2 in order), then throttle limits.</figcaption>
  </figure>

  <div class="tw"><table>
    <thead><tr><th>Mode</th><th>Sets</th><th>Procedure</th></tr></thead>
    <tbody>
      <tr><td><strong>Steering_mode = 0</strong></td><td>Maximum LEFT steering limit</td><td>Adjust <code>Steering_value</code> until wheels reach mechanical full-left stop. Switch to Mode 1 ‚Äî value saves automatically when you switch.</td></tr>
      <tr><td><strong>Steering_mode = 1</strong></td><td>STRAIGHT (zero error) value</td><td>Drive on flat surface. Adjust until car tracks perfectly straight with no steering input.</td></tr>
      <tr><td><strong>Steering_mode = 2</strong></td><td>Maximum RIGHT steering limit</td><td>Adjust until wheels reach mechanical full-right stop. Switch back to Mode 0 to save.</td></tr>
    </tbody>
  </table></div>

  <div class="tw"><table>
    <thead><tr><th>Mode</th><th>Sets</th><th>Procedure</th></tr></thead>
    <tbody>
      <tr><td><strong>Throttle_mode = 0</strong></td><td>zero_throttle (neutral / stopped)</td><td>Find the value at which the VESC makes no sound and the car does not move.</td></tr>
      <tr><td><strong>Throttle_mode = 1</strong></td><td>max_throttle (full speed)</td><td>Increase in small increments only. Use a prop stand with wheels off the ground first. Typical values: 0.38‚Äì0.42.</td></tr>
      <tr><td><strong>Throttle_mode = 2</strong></td><td>min_throttle (minimum moving speed)</td><td>Find the minimum value that actually moves the car forward on the track surface.</td></tr>
    </tbody>
  </table></div>

  <figure>
    <div class="fig-wrap"><img src="images/fig_system_response.png" alt="Throttle scheduling diagram" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 14.2</span> Throttle scheduling: the car runs at max_throttle when lane tracking error is low (straights) and decreases linearly to min_throttle as error increases (sharp curves).</figcaption>
  </figure>

  <h3>Phase 2, Part C ‚Äî PID Steering Gains (Tuned While Driving)</h3>
  <p>PID tuning is an iterative process done <strong>on the track with the car driving</strong>. Start with conservative values below, launch the car, observe the behavior, then edit the YAML and rebuild. Repeat until the car follows the lane smoothly.</p>

  <div class="sb-reminder">
    <div class="sb-reminder-icon">üîÅ</div>
    <div class="sb-reminder-text">PID workflow: <strong>Edit ros_racer_calibration.yaml</strong> ‚Üí <code>build_ros2</code> ‚Üí launch car ‚Üí observe ‚Üí repeat</div>
  </div>

  <div class="tw"><table>
    <thead><tr><th>Gain</th><th>Tuning Effect</th><th>Starting Value</th></tr></thead>
    <tbody>
      <tr><td><strong>Kp_steering</strong> (Proportional)</td><td>Direct response to current error magnitude. Too low = sluggish, slow to correct. Too high = rapid left-right oscillation.</td><td>0.3 ‚Äì 0.5</td></tr>
      <tr><td><strong>Ki_steering</strong> (Integral)</td><td>Corrects accumulated steady-state drift (e.g., car consistently drifts one direction on straights). Too high = integrator windup and instability.</td><td>0.0 ‚Äì 0.05</td></tr>
      <tr><td><strong>Kd_steering</strong> (Derivative)</td><td>Dampens oscillation by reacting to how quickly the error is changing. Too high = jerky, oversensitive steering.</td><td>0.05 ‚Äì 0.2</td></tr>
    </tbody>
  </table></div>

  <h3>Edit ros_racer_calibration.yaml</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî open calibration YAML</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_lane_detection2_pkg/config/ros_racer_calibration.yaml</pre></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">ros_racer_calibration.yaml ‚Äî reference starting values</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>lane_guidance_node:
  ros__parameters:
    <span class="v">Kp_steering</span>:        <span class="v">0.4</span>    <span class="c"># Start here ‚Äî increase if sluggish, decrease if oscillating</span>
    <span class="v">Ki_steering</span>:        <span class="v">0.01</span>   <span class="c"># Keep near zero unless car has a persistent one-sided drift</span>
    <span class="v">Kd_steering</span>:        <span class="v">0.1</span>    <span class="c"># Increase to dampen oscillation</span>
    <span class="v">zero_throttle</span>:      <span class="v">0</span>
    <span class="v">max_throttle</span>:       <span class="v">0.382</span>  <span class="c"># Moderate speed ‚Äî increase carefully after verifying straight tracking</span>
    <span class="v">min_throttle</span>:       <span class="v">0.363</span>  <span class="c"># Minimum to overcome static friction on your track surface</span>
    <span class="v">error_threshold</span>:    <span class="v">0.15</span>   <span class="c"># Dead band (0‚Äì1 normalized error scale)</span>
    <span class="v">max_right_steering</span>: <span class="v">1</span>
    <span class="v">max_left_steering</span>:  <span class="v">-1</span>

vesc_twist_node:
  ros__parameters:
    <span class="v">steering_polarity</span>:  <span class="v">1</span>       <span class="c"># Change to -1 if steering direction is reversed</span>
    <span class="v">throttle_polarity</span>:  <span class="v">1</span>       <span class="c"># Change to -1 if the car drives backward instead of forward</span>
    <span class="v">max_potential_rpm</span>:  <span class="v">20000</span>
    <span class="v">zero_throttle</span>:      <span class="v">0</span>
    <span class="v">max_throttle</span>:       <span class="v">0.382</span>
    <span class="v">min_throttle</span>:       <span class="v">0.363</span>
    <span class="v">straight_steering</span>:  <span class="v">0</span>
    <span class="v">max_right_steering</span>: <span class="v">1</span>
    <span class="v">max_left_steering</span>:  <span class="v">-1</span></pre></div>

  <div class="callout warn"><div class="callout-icon">‚ö†</div><div class="callout-body"><div class="callout-title">build_ros2 After Every YAML Edit ‚Äî No Exceptions</div><div class="callout-text">After saving any change to <code>ros_racer_calibration.yaml</code>, you must run <code>build_ros2</code>. Simply saving the file is not enough ‚Äî ROS2 won't see the new values until after a rebuild and re-launch.</div></div></div>

  <h3>Launch the Car Autonomously</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ‚Äî launch autonomous lane following</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">source_ros2</span>
<span class="k">build_ros2</span>          <span class="c"># Always build before launching to catch any unsaved YAML changes</span>
<span class="k">ros2 launch</span> ucsd_robocar_nav2_pkg all_nodes.launch.py</pre></div>

  <h3>PID Symptom-Fix Table ‚Äî On-Track Reference</h3>
  <div class="tw"><table>
    <thead><tr><th>What You See on Track</th><th>Most Likely Cause</th><th>Fix (edit YAML ‚Üí build_ros2 ‚Üí relaunch)</th></tr></thead>
    <tbody>
      <tr><td>Rapid left-right oscillation on straights</td><td><code>Kp_steering</code> too high or <code>Kd_steering</code> too low</td><td>Reduce <code>Kp_steering</code> by 0.05‚Äì0.1. Increase <code>Kd_steering</code> by 0.05.</td></tr>
      <tr><td>Consistent drift to one side on straights</td><td><code>camera_centerline</code> miscalibrated or <code>Ki_steering</code> too low</td><td>Recalibrate centerline (Section 13). Add small <code>Ki_steering</code> (e.g., 0.01).</td></tr>
      <tr><td>Slow/sluggish correction in curves</td><td><code>Kp_steering</code> too low or <code>error_threshold</code> too wide</td><td>Increase <code>Kp_steering</code>. Narrow <code>error_threshold</code>.</td></tr>
      <tr><td>Flies off the track on tight curves</td><td><code>max_throttle</code> too high, <code>error_threshold</code> too wide</td><td>Reduce <code>max_throttle</code>. Widen <code>error_threshold</code> so throttle scheduling slows car earlier.</td></tr>
      <tr><td>Car steers in the wrong direction</td><td><code>steering_polarity</code> is wrong</td><td>Set <code>steering_polarity: -1</code>, then <code>build_ros2</code>.</td></tr>
      <tr><td>Car drives backward</td><td><code>throttle_polarity</code> is wrong</td><td>Set <code>throttle_polarity: -1</code>, then <code>build_ros2</code>.</td></tr>
      <tr><td>Car does not move at all</td><td><code>zero_throttle</code> miscalibrated or VESC not connected</td><td>Echo <code>/cmd_vel</code> to confirm commands publishing. Check USB: <code>dmesg | grep usb</code>.</td></tr>
      <tr><td>No lane detected / black camera feed</td><td>Insufficient USB power to OAK-D or HSV not calibrated</td><td>Use powered USB hub (Section 8). Re-run HSV calibration (Section 12).</td></tr>
    </tbody>
  </table></div>

  <h3>Live Debug Overlay</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Second terminal (while car is running)</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">ros2 param set</span> /lane_detection_node debug_cv <span class="v">1</span>   <span class="c"># Turn ON visual overlay window</span>
<span class="k">ros2 param set</span> /lane_detection_node debug_cv <span class="v">0</span>   <span class="c"># Turn OFF (reduces CPU during racing)</span></pre></div>
</section>

<!-- ¬ß15 ‚Äî ROS2 Node Dev -->
<div class="section-anchor" id="s15"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">15</span>
    <div class="sec-title-block">
      <h2>ROS2 Nodes, Topics &amp; Subscribers ‚Äî Dev Guide</h2>
      <div class="sec-subtitle">Write custom nodes, integrate sensors, and reuse existing packages</div>
    </div>
  </div>
  <p>This section gives you the foundation to extend the Robocar framework for your team's custom project. Understanding the existing node graph lets you intercept live data, add new behaviors, and reuse pre-built functionality without rewriting code that already exists.</p>
  <h3>Node Architecture ‚Äî Data Flow</h3>
  <div class="tw"><table>
    <thead><tr><th>Node</th><th>Publishes</th><th>Subscribes To</th><th>Hardware</th></tr></thead>
    <tbody>
      <tr><td><code>/camera_node</code></td><td><code>/camera/color/image_raw</code></td><td>‚Äî</td><td>OAK-D Camera</td></tr>
      <tr><td><code>/lane_detection_node</code></td><td><code>/error</code> (Float32, ‚Äì1 to 1)</td><td><code>/camera/color/image_raw</code></td><td>‚Äî</td></tr>
      <tr><td><code>/lane_guidance_node</code></td><td><code>/cmd_vel</code> (Twist)</td><td><code>/error</code></td><td>‚Äî</td></tr>
      <tr><td><code>/vesc_twist_node</code></td><td>Hardware PWM signals</td><td><code>/cmd_vel</code></td><td>VESC ESC ‚Üí Motor + Servo</td></tr>
      <tr><td><code>/lidar_node</code></td><td><code>/scan</code> (LaserScan)</td><td>‚Äî</td><td>RPLiDAR (if installed)</td></tr>
    </tbody>
  </table></div>
  <h3>Custom Subscriber Node ‚Äî Full Working Example</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">my_custom_node.py ‚Äî place in your package directory</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c">#!/usr/bin/env python3</span>
import rclpy
from rclpy.node import Node
from std_msgs.msg import Float32
from geometry_msgs.msg import Twist

class LaneErrorMonitor(Node):
    def __init__(self):
        super().__init__(<span class="s">'lane_error_monitor'</span>)
        self.sub = self.create_subscription(Float32, <span class="s">'/error'</span>, self.error_callback, 10)
        self.pub = self.create_publisher(Twist, <span class="s">'/cmd_vel'</span>, 10)
        self.get_logger().info(<span class="s">'LaneErrorMonitor started!'</span>)

    def error_callback(self, msg: Float32):
        self.get_logger().info(f<span class="s">'Error: {msg.data:.4f}'</span>)
        if abs(msg.data) &gt; 0.8:
            self.get_logger().warn(<span class="s">'CRITICAL ERROR ‚Äî sending stop command!'</span>)
            self.pub.publish(Twist())  <span class="c"># Zero velocity to stop the car</span>

def main(args=None):
    rclpy.init(args=args)
    node = LaneErrorMonitor()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()

if __name__ == <span class="s">'__main__'</span>:
    main()</pre></div>
  <h3>Register Your Node in setup.py</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">setup.py ‚Äî entry_points section</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>entry_points={
    <span class="s">'console_scripts'</span>: [
        <span class="s">'lane_monitor = ucsd_robocar_nav2_pkg.my_custom_node:main'</span>,
        <span class="s">'test_drive   = ucsd_robocar_nav2_pkg.test_drive_node:main'</span>,
    ],
},</pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Build and run your node</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">build_ros2</span>
<span class="k">ros2 run</span> ucsd_robocar_nav2_pkg lane_monitor</pre></div>
  <div class="callout tip"><div class="callout-icon">‚úì</div><div class="callout-body"><div class="callout-title">Check What Already Exists First</div><div class="callout-text">Before writing any new code, run <code>ros2 topic list</code> and <code>ros2 node list</code>. The sensor data you need is almost certainly already being published. Subscribing to an existing topic takes about 10 lines of code. Writing a new hardware driver from scratch takes hundreds.</div></div></div>
  <div class="tw"><table>
    <thead><tr><th>Package</th><th>What It Provides</th><th>How to Use It</th></tr></thead>
    <tbody>
      <tr><td><code>ucsd_robocar_sensor2_pkg</code></td><td>Camera publisher, LiDAR publisher, IMU data</td><td>Enable in <code>car_config.yaml</code>. Subscribe to the published topics.</td></tr>
      <tr><td><code>ucsd_robocar_lane_detection2_pkg</code></td><td>Full HSV pipeline ‚Üí publishes to <code>/error</code></td><td>Subscribe to <code>/error</code> (Float32, ‚Äì1 to 1) to build your own controller.</td></tr>
      <tr><td><code>ucsd_robocar_actuator2_pkg</code></td><td>VESC hardware driver ‚Äî accepts <code>/cmd_vel</code></td><td>Publish Twist messages to <code>/cmd_vel</code>. That is all that is required.</td></tr>
      <tr><td><code>ucsd_robocar_nav2_pkg</code></td><td>Launch files and the YAML config system</td><td>Copy existing launch files as starting templates for custom node graphs.</td></tr>
    </tbody>
  </table></div>
</section>

<!-- ¬ß16 ‚Äî Troubleshooting -->
<div class="section-anchor" id="s16"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">16</span>
    <div class="sec-title-block">
      <h2>Troubleshooting &amp; Known Issues</h2>
      <div class="sec-subtitle">Quick reference for the most common failure modes</div>
    </div>
  </div>
  <h3>Docker &amp; System</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td><code>docker: permission denied</code></td><td>Run <code>sudo usermod -aG docker $USER</code> then fully log out and back in</td></tr>
      <tr><td>"Container name already in use"</td><td>Use <code>docker start MY_CONTAINER_NAME</code> then <code>docker exec -it MY_CONTAINER_NAME bash</code></td></tr>
      <tr><td>Container not found after Pi reboot</td><td>Run <code>docker start MY_CONTAINER_NAME</code> ‚Äî container exists on disk, just stopped</td></tr>
      <tr><td>"No space left on device"</td><td>Run <code>docker system prune -f</code> to remove dangling images and stopped containers</td></tr>
    </tbody>
  </table></div>
  <h3>X11 &amp; Display</h3>
  <div class="tw"><table>
    <thead><tr><th>Error</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>"cannot open display"</td><td>Reconnect with the <code>-Y</code> flag: <code>ssh -Y pi@ucsdrobocar-148-XX.local</code></td></tr>
      <tr><td>"No protocol specified"</td><td>Run on the Pi host (not inside Docker): <code>xhost +local:</code></td></tr>
      <tr><td>"Authorization required" inside Docker</td><td>Ensure <code>--volume $HOME/.Xauthority:/root/.Xauthority:rw</code> is in your docker run command</td></tr>
      <tr><td>GUI works on Pi host but not inside container</td><td>Switch from <code>ssh -X</code> to <code>ssh -Y</code> and recreate or restart the container</td></tr>
    </tbody>
  </table></div>
  <h3>Camera &amp; Hardware</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>OAK-D disconnects randomly</td><td>Use a powered USB hub ‚Äî see Section 8</td></tr>
      <tr><td>All-black camera feed</td><td>Insufficient USB power ‚Äî a powered USB hub is required</td></tr>
      <tr><td>VESC not responding</td><td>Check the USB cable. Run <code>dmesg | grep usb</code> and look for enumeration errors</td></tr>
      <tr><td>Wheels spin backward</td><td>Set <code>throttle_polarity: -1</code> in <code>ros_racer_calibration.yaml</code>, then <code>build_ros2</code></td></tr>
      <tr><td>Steering direction inverted</td><td>Set <code>steering_polarity: -1</code> in <code>ros_racer_calibration.yaml</code>, then <code>build_ros2</code></td></tr>
      <tr><td>Receiving another team's robot data</td><td><strong>Set ROS_DOMAIN_ID ‚Äî see Section 9. Always the cause of this problem.</strong></td></tr>
    </tbody>
  </table></div>
  <h3>Build &amp; ROS2</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>"Package not found" after a successful build</td><td>Run <code>source_ros2</code>. The build succeeded, but ROS2 has not been told about the new packages yet.</td></tr>
      <tr><td>YAML changes have no effect</td><td>You must run <code>build_ros2</code> ‚Äî <code>source_ros2</code> alone is not enough. Most common student mistake.</td></tr>
      <tr><td>"Launch file not found"</td><td>Verify <code>setup.py</code> includes the <code>launch/</code> directory, then re-run <code>build_ros2</code>.</td></tr>
      <tr><td>Calibration GUI closes immediately</td><td>X11 is not working inside Docker. Verify: <code>echo $DISPLAY</code> inside container ‚Äî must not be empty.</td></tr>
    </tbody>
  </table></div>
  <h3>PID &amp; Lane Following</h3>
  <div class="tw"><table>
    <thead><tr><th>Symptom</th><th>Fix (always followed by build_ros2 + relaunch)</th></tr></thead>
    <tbody>
      <tr><td>Rapid left-right oscillation</td><td>Reduce <code>Kp_steering</code>. Increase <code>Kd_steering</code>.</td></tr>
      <tr><td>Consistent drift in one direction</td><td>Recalibrate <code>camera_centerline</code>. Add small <code>Ki_steering</code> (e.g., 0.01).</td></tr>
      <tr><td>Too fast on curves, flies off track</td><td>Reduce <code>max_throttle</code>. Widen <code>error_threshold</code>.</td></tr>
      <tr><td>No response to curves, goes straight</td><td>Narrow <code>error_threshold</code>. Increase <code>Kp_steering</code>.</td></tr>
      <tr><td>No lines detected in debug view</td><td>Recalibrate HSV on the track ‚Äî lighting changes throughout the day.</td></tr>
    </tbody>
  </table></div>

  <div class="divider"></div>
  <p style="text-align:center; font-size:13px; color: var(--text-dim);">UCSD Jacobs School of Engineering ‚Äî ECE/MAE 148 Intro to Autonomous Vehicles</p>
</section>

</div><!-- /content -->
</div><!-- /main -->
</main>

<button id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">‚Üë</button>

<script>
function doCopy(btn) {
  const pre = btn.closest('.cb').querySelector('pre');
  const text = pre.innerText;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'COPIED ‚úì'; btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    btn.textContent = 'COPIED ‚úì'; btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  });
}
const btt = document.getElementById('btt');
window.addEventListener('scroll', () => { btt.classList.toggle('show', window.scrollY > 500); });
const progressFill = document.getElementById('read-progress-fill');
const npFill = document.getElementById('np-fill');
const npPct = document.getElementById('np-pct');
window.addEventListener('scroll', () => {
  const docH = document.documentElement.scrollHeight - window.innerHeight;
  const pct = docH > 0 ? Math.min(100, Math.round((window.scrollY / docH) * 100)) : 0;
  progressFill.style.width = pct + '%';
  npFill.style.width = pct + '%';
  npPct.textContent = pct + '%';
});
const anchors = document.querySelectorAll('.section-anchor[id]');
const navLinks = document.querySelectorAll('.nav-link');
const io = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      navLinks.forEach(l => l.classList.remove('active'));
      const a = document.querySelector(`.nav-link[href="#${e.target.id}"]`);
      if (a) a.classList.add('active');
    }
  });
}, { rootMargin: '-60px 0px -80% 0px' });
anchors.forEach(a => io.observe(a));
function filterNav(q) {
  const term = q.toLowerCase();
  document.querySelectorAll('.nav-link').forEach(l => {
    l.style.display = l.textContent.toLowerCase().includes(term) ? '' : 'none';
  });
  document.querySelectorAll('.nav-group-label').forEach(g => {
    let next = g.nextElementSibling; let hasVisible = false;
    while (next && !next.classList.contains('nav-group-label')) {
      if (next.style.display !== 'none') hasVisible = true;
      next = next.nextElementSibling;
    }
    g.style.display = hasVisible ? '' : 'none';
  });
}
document.querySelectorAll('.nav-link').forEach(l => {
  l.addEventListener('click', () => { document.getElementById('sidebar').classList.remove('open'); });
});
(function() {
  const grid = document.getElementById('team-grid');
  if (!grid) return;
  for (let i = 1; i <= 15; i++) {
    const tc = document.createElement('div');
    tc.className = 'tc';
    tc.innerHTML = '<div class="tc-num">' + i + '</div><div class="tc-label">Team ' + i + '</div>';
    grid.appendChild(tc);
  }
})();
</script>
</body>
</html>
