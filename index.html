<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ECE/MAE 148 â€” UCSD Robocar Setup & Calibration Guide</title>
<meta name="description" content="Complete setup, calibration and development guide for the UCSD Robocar Framework used in ECE/MAE 148 Intro to Autonomous Vehicles.">

<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  IMAGE REPLACEMENT GUIDE                                     â•‘
  â•‘  All images live in ./images/ as .png files.                 â•‘
  â•‘  To update a figure, drop a new .png with the SAME name      â•‘
  â•‘  into ./images/ and push to GitHub. Site rebuilds in <2 min. â•‘
  â•‘                                                              â•‘
  â•‘  FILE â†’ SECTION â†’ DESCRIPTION                                â•‘
  â•‘  fig_xeyes.png          â†’ Â§3  X11 test screenshot            â•‘
  â•‘  fig_hsv_chart.png      â†’ Â§11 HSV color spectrum             â•‘
  â•‘  fig_mask_default.png   â†’ Â§11 Default mask sliders           â•‘
  â•‘  fig_mask_yellow.png    â†’ Â§11 Yellow-tuned mask              â•‘
  â•‘  fig_bw_calibration.png â†’ Â§11 Noise reduction sliders        â•‘
  â•‘  fig_line_calibration.png â†’ Â§12 Line detection view          â•‘
  â•‘  fig_error_threshold.png  â†’ Â§12 Error threshold bars         â•‘
  â•‘  fig_camera_align.png   â†’ Â§12 Camera alignment               â•‘
  â•‘  fig_throttle_steering.png â†’ Â§13 Throttle/steering GUI       â•‘
  â•‘  fig_system_response.png   â†’ Â§13 System response plot        â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN: Industrial Technical â€” UCSD Blue/Gold
   Full viewport width, two-column fixed layout
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* Brand */
  --ucsd-navy:    #002E6D;
  --ucsd-blue:    #00629B;
  --ucsd-gold:    #C69214;
  --ucsd-gold-lt: #E8B931;
  /* Surfaces */
  --bg:           #09111E;
  --bg2:          #0D1A2D;
  --surface:      #111F35;
  --surface2:     #162643;
  --surface3:     #1C2F50;
  --border:       #1E3355;
  --border-lt:    #2A4670;
  /* Text */
  --text:         #DCE8F5;
  --text-muted:   #7A9EC4;
  --text-dim:     #4D6E96;
  /* Accents */
  --accent:       #00A8E8;
  --accent-glow:  rgba(0,168,232,0.15);
  --gold-glow:    rgba(198,146,20,0.18);
  --green:        #00C896;
  --yellow:       #F0B429;
  --red:          #F04E37;
  --purple:       #9B7FE8;
  /* Code */
  --code-bg:      #060E1A;
  --code-border:  #1A2E4A;
  /* Layout */
  --sidebar-w:    290px;
  --topbar-h:     60px;
  --r:            6px;
  --font-body:    'Sora', sans-serif;
  --font-mono:    'IBM Plex Mono', monospace;
  --ease:         cubic-bezier(0.4,0,0.2,1);
}

/* â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 15px; scroll-behavior: smooth; scroll-padding-top: calc(var(--topbar-h) + 20px); }
body { font-family: var(--font-body); background: var(--bg); color: var(--text); line-height: 1.7; min-height: 100vh; overflow-x: hidden; }

/* â”€â”€â”€ GRID BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    linear-gradient(rgba(0,98,155,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,98,155,0.04) 1px, transparent 1px);
  background-size: 40px 40px;
}

/* â”€â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 200;
  height: var(--topbar-h);
  background: rgba(9,17,30,0.95);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(16px);
  display: flex; align-items: center;
  padding: 0 0 0 var(--sidebar-w);
  gap: 0;
}
.topbar-inner {
  display: flex; align-items: center; gap: 16px;
  padding: 0 32px; width: 100%;
}
.topbar-brand {
  display: flex; align-items: center; gap: 12px; text-decoration: none;
  flex-shrink: 0;
}
.topbar-emblem {
  width: 36px; height: 36px;
  background: var(--ucsd-navy);
  border: 2px solid var(--ucsd-gold);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.topbar-emblem svg { width: 20px; height: 20px; }
.topbar-name { font-size: 15px; font-weight: 700; color: var(--text); letter-spacing: -0.3px; }
.topbar-course { font-size: 11px; color: var(--text-muted); font-family: var(--font-mono); }
.topbar-divider { width: 1px; height: 28px; background: var(--border); flex-shrink: 0; }
.topbar-breadcrumb { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }
.topbar-spacer { flex: 1; }
.topbar-status {
  display: flex; align-items: center; gap: 6px;
  font-family: var(--font-mono); font-size: 11px; color: var(--text-muted);
}
.status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse-dot 2s ease-in-out infinite; }
@keyframes pulse-dot { 0%,100%{ opacity:1; } 50%{ opacity:0.4; } }
.topbar-pill {
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  padding: 4px 12px; border-radius: 20px; letter-spacing: 0.5px;
  background: var(--surface2); border: 1px solid var(--border-lt); color: var(--text-muted);
}

/* â”€â”€â”€ PAGE SWITCHER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-switcher {
  display: flex; align-items: center; gap: 2px;
  background: var(--surface); border: 1px solid var(--border-lt);
  border-radius: 20px; padding: 3px; flex-shrink: 0;
}
.ps-link {
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  padding: 4px 14px; border-radius: 16px; letter-spacing: 0.4px;
  text-decoration: none; color: var(--text-muted);
  transition: all 0.15s var(--ease);
}
.ps-link:hover { color: var(--text); background: rgba(255,255,255,0.06); }
.ps-link.active { background: var(--ucsd-gold); color: var(--bg); }
@media (max-width: 768px) { .page-switcher { display: none; } }
#menu-toggle {
  display: none; background: none; border: 1px solid var(--border);
  color: var(--text-muted); padding: 6px 10px; border-radius: var(--r);
  cursor: pointer; font-size: 16px; flex-shrink: 0;
}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  position: fixed; top: 0; left: 0; bottom: 0; z-index: 150;
  width: var(--sidebar-w);
  background: var(--bg2);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  overflow: hidden;
}
.sidebar-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  background: var(--ucsd-navy);
  flex-shrink: 0;
}
.sidebar-logo-row { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
.sidebar-logo {
  width: 32px; height: 32px; border-radius: 6px;
  background: rgba(198,146,20,0.2); border: 1.5px solid var(--ucsd-gold);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono); font-size: 12px; font-weight: 600; color: var(--ucsd-gold);
}
.sidebar-title { font-size: 13px; font-weight: 700; color: #fff; }
.sidebar-sub { font-size: 10px; color: rgba(255,255,255,0.5); font-family: var(--font-mono); margin-top: 2px; }
.sidebar-search {
  margin: 12px 16px;
  position: relative; flex-shrink: 0;
}
.sidebar-search input {
  width: 100%; padding: 8px 12px 8px 32px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--r); color: var(--text); font-family: var(--font-body);
  font-size: 12px; outline: none;
}
.sidebar-search input::placeholder { color: var(--text-dim); }
.sidebar-search input:focus { border-color: var(--border-lt); }
.sidebar-search-icon {
  position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
  color: var(--text-dim); font-size: 13px; pointer-events: none;
}
.nav-scroll { overflow-y: auto; flex: 1; padding-bottom: 40px; }
.nav-scroll::-webkit-scrollbar { width: 3px; }
.nav-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

.nav-group-label {
  font-family: var(--font-mono); font-size: 9px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1.8px;
  color: var(--text-dim); padding: 16px 20px 6px;
  display: flex; align-items: center; gap: 8px;
}
.nav-group-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.nav-link {
  display: flex; align-items: center; gap: 10px;
  padding: 7px 20px;
  text-decoration: none; color: var(--text-muted); font-size: 12.5px;
  border-left: 2px solid transparent;
  transition: all 0.15s var(--ease);
  position: relative;
}
.nav-link .nl-num {
  font-family: var(--font-mono); font-size: 9px; color: var(--text-dim);
  background: var(--surface); border: 1px solid var(--border);
  padding: 1px 5px; border-radius: 3px; flex-shrink: 0;
}
.nav-link .nl-badge {
  margin-left: auto; font-family: var(--font-mono); font-size: 9px;
  background: rgba(198,146,20,0.2); color: var(--ucsd-gold);
  padding: 1px 5px; border-radius: 3px;
}
.nav-link:hover { color: var(--text); background: rgba(255,255,255,0.03); border-left-color: var(--border-lt); }
.nav-link.active { color: var(--ucsd-gold-lt); border-left-color: var(--ucsd-gold); background: var(--gold-glow); }
.nav-link.active .nl-num { background: rgba(198,146,20,0.2); border-color: rgba(198,146,20,0.3); color: var(--ucsd-gold); }
.nav-progress {
  padding: 12px 20px;
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}
.np-label { font-family: var(--font-mono); font-size: 10px; color: var(--text-dim); margin-bottom: 6px; display: flex; justify-content: space-between; }
.np-bar { height: 3px; background: var(--border); border-radius: 3px; overflow: hidden; }
.np-fill { height: 100%; background: linear-gradient(90deg, var(--ucsd-gold), var(--ucsd-gold-lt)); border-radius: 3px; width: 0%; transition: width 0.4s var(--ease); }

/* â”€â”€â”€ MAIN LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.layout { display: flex; padding-top: var(--topbar-h); min-height: 100vh; }
.main {
  margin-left: var(--sidebar-w);
  flex: 1;
  min-width: 0;
  position: relative; z-index: 1;
}

/* â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero {
  background:
    radial-gradient(ellipse 80% 100% at 100% 50%, rgba(0,98,155,0.25), transparent),
    radial-gradient(ellipse 50% 80% at 0% 0%, rgba(198,146,20,0.08), transparent),
    linear-gradient(180deg, var(--bg2) 0%, var(--bg) 100%);
  border-bottom: 1px solid var(--border);
  padding: 72px 80px 60px;
  position: relative; overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute; top: -40px; right: -40px;
  width: 400px; height: 400px; border-radius: 50%;
  background: radial-gradient(circle, rgba(0,168,232,0.07), transparent 70%);
  pointer-events: none;
}
.hero-eyebrow {
  display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px;
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); letter-spacing: 1px;
  background: var(--gold-glow); border: 1px solid rgba(198,146,20,0.3);
  padding: 5px 14px; border-radius: 20px;
}
.hero-eyebrow-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ucsd-gold); }
.hero h1 {
  font-size: clamp(32px, 4.5vw, 56px); font-weight: 800; line-height: 1.08;
  letter-spacing: -1.5px; margin-bottom: 20px;
  color: var(--text);
}
.hero h1 span { color: var(--ucsd-gold); }
.hero-desc {
  font-size: 16px; color: var(--text-muted); max-width: 640px;
  line-height: 1.65; margin-bottom: 36px;
}
.hero-chips { display: flex; flex-wrap: wrap; gap: 10px; }
.hero-chip {
  display: inline-flex; align-items: center; gap: 7px;
  background: var(--surface); border: 1px solid var(--border-lt);
  color: var(--text-muted); font-size: 12px; font-family: var(--font-mono);
  padding: 6px 14px; border-radius: 20px;
}
.hero-chip-icon { font-size: 14px; }

/* â”€â”€â”€ CONTENT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.content { padding: 0 80px 80px; }

/* â”€â”€â”€ SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section { padding-top: 64px; }
.section-anchor { display: block; margin-top: -80px; padding-top: 80px; }
.sec-header {
  display: flex; align-items: flex-start; gap: 20px;
  margin-bottom: 28px; padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}
.sec-num {
  font-family: var(--font-mono); font-size: 11px; font-weight: 600;
  color: var(--ucsd-gold); background: var(--gold-glow);
  border: 1px solid rgba(198,146,20,0.3);
  padding: 4px 12px; border-radius: 20px; flex-shrink: 0; margin-top: 4px;
}
.sec-title-block { flex: 1; }
.sec-title-block h2 { font-size: 24px; font-weight: 700; color: var(--text); letter-spacing: -0.5px; line-height: 1.2; }
.sec-title-block .sec-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
.sec-badges { display: flex; gap: 6px; margin-left: auto; flex-shrink: 0; align-items: center; }

h3 { font-size: 15px; font-weight: 600; color: var(--accent); margin: 28px 0 10px; letter-spacing: -0.2px; }
h4 { font-size: 13px; font-weight: 600; color: var(--text-muted); margin: 18px 0 8px; text-transform: uppercase; letter-spacing: 0.5px; }
p { color: var(--text-muted); margin-bottom: 14px; font-size: 14px; line-height: 1.75; }
p strong { color: var(--text); font-weight: 600; }
p code, li code {
  font-family: var(--font-mono); font-size: 12px;
  background: rgba(0,168,232,0.1); color: var(--accent);
  padding: 1px 5px; border-radius: 3px;
}

/* â”€â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge {
  font-family: var(--font-mono); font-size: 9px; font-weight: 700;
  padding: 3px 9px; border-radius: 3px; letter-spacing: 0.8px; text-transform: uppercase;
}
.badge-new    { background: rgba(155,127,232,0.2); color: var(--purple); border: 1px solid rgba(155,127,232,0.3); }
.badge-fix    { background: rgba(0,200,150,0.15); color: var(--green); border: 1px solid rgba(0,200,150,0.3); }
.badge-warn   { background: rgba(240,78,55,0.15); color: var(--red); border: 1px solid rgba(240,78,55,0.3); }
.badge-critical { background: rgba(240,78,55,0.2); color: #ff7b6e; border: 1px solid rgba(240,78,55,0.4); }

/* â”€â”€â”€ CALLOUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.callout {
  display: flex; gap: 14px; padding: 16px 18px;
  border-radius: var(--r); margin: 16px 0; border: 1px solid;
  font-size: 13.5px;
}
.callout-icon { font-size: 16px; flex-shrink: 0; line-height: 1.4; }
.callout-body { flex: 1; min-width: 0; }
.callout-title { font-size: 11px; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; margin-bottom: 5px; }
.callout-text { color: var(--text-muted); line-height: 1.65; }
.callout-text code { font-family: var(--font-mono); font-size: 11.5px; background: rgba(255,255,255,0.07); color: var(--text); padding: 1px 5px; border-radius: 3px; }

.callout.info   { background: rgba(0,168,232,0.07); border-color: rgba(0,168,232,0.25); }
.callout.info   .callout-title { color: var(--accent); }
.callout.warn   { background: rgba(240,180,41,0.07); border-color: rgba(240,180,41,0.28); }
.callout.warn   .callout-title { color: var(--yellow); }
.callout.tip    { background: rgba(0,200,150,0.07); border-color: rgba(0,200,150,0.25); }
.callout.tip    .callout-title { color: var(--green); }
.callout.error  { background: rgba(240,78,55,0.07); border-color: rgba(240,78,55,0.28); }
.callout.error  .callout-title { color: var(--red); }
.callout.new    { background: rgba(155,127,232,0.07); border-color: rgba(155,127,232,0.28); }
.callout.new    .callout-title { color: var(--purple); }

/* â”€â”€â”€ CODE BLOCKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cb {
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  border-radius: var(--r); margin: 12px 0; overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}
.cb-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 9px 14px;
  background: var(--surface); border-bottom: 1px solid var(--code-border);
}
.cb-label {
  font-family: var(--font-mono); font-size: 10.5px; color: var(--text-dim);
  display: flex; align-items: center; gap: 8px;
}
.cb-label::before {
  content: '';
  display: inline-block; width: 7px; height: 7px; border-radius: 50%;
  background: var(--ucsd-gold); opacity: 0.7;
}
.copy-btn {
  font-family: var(--font-mono); font-size: 9.5px; font-weight: 600;
  background: var(--surface2); border: 1px solid var(--border-lt);
  color: var(--text-dim); padding: 4px 12px; border-radius: 4px;
  cursor: pointer; transition: all 0.15s var(--ease); letter-spacing: 0.5px;
}
.copy-btn:hover { background: var(--border); color: var(--text); }
.copy-btn.ok { color: var(--green); border-color: rgba(0,200,150,0.4); }
pre {
  padding: 18px 20px; overflow-x: auto;
  font-family: var(--font-mono); font-size: 12.5px; line-height: 1.7; tab-size: 2;
  color: #C9D8EC;
}
pre::-webkit-scrollbar { height: 3px; }
pre::-webkit-scrollbar-thumb { background: var(--border); }
/* Syntax highlights */
.k  { color: #6BBFFF; } /* keywords/commands */
.s  { color: #A8D8B9; } /* strings */
.c  { color: #4D6E96; font-style: italic; } /* comments */
.f  { color: #BFA0F4; } /* flags */
.v  { color: #F0B429; } /* values */
.ok { color: #00C896; }
.er { color: #F04E37; }

/* â”€â”€â”€ STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.steps { display: flex; flex-direction: column; gap: 14px; margin: 16px 0; }
.step {
  display: flex; gap: 18px;
  padding: 20px; background: var(--surface);
  border: 1px solid var(--border); border-radius: var(--r);
  transition: border-color 0.15s var(--ease);
}
.step:hover { border-color: var(--border-lt); }
.step-num {
  width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0;
  background: var(--gold-glow); border: 1.5px solid rgba(198,146,20,0.45);
  color: var(--ucsd-gold); font-family: var(--font-mono);
  font-size: 11px; font-weight: 700;
  display: flex; align-items: center; justify-content: center;
}
.step-body { flex: 1; min-width: 0; }
.step-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.step-desc { font-size: 13px; color: var(--text-muted); line-height: 1.65; margin-bottom: 8px; }
.step-desc:last-child { margin-bottom: 0; }

/* â”€â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tw { overflow-x: auto; margin: 14px 0; border-radius: var(--r); border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead tr { background: var(--surface2); }
th {
  text-align: left; padding: 11px 16px;
  font-family: var(--font-mono); font-size: 10px; font-weight: 600;
  color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase;
  border-bottom: 1px solid var(--border);
}
td {
  padding: 11px 16px; border-bottom: 1px solid var(--border);
  color: var(--text-muted); vertical-align: top; font-size: 13px; line-height: 1.6;
}
td code { font-family: var(--font-mono); font-size: 11.5px; color: var(--accent); background: rgba(0,168,232,0.08); padding: 1px 6px; border-radius: 3px; }
td strong { color: var(--text); }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: rgba(255,255,255,0.015); }

/* â”€â”€â”€ FIGURES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* â”€â”€ REPLACE IMAGES: change filename in src= â”€â”€ */
figure {
  margin: 20px 0; border-radius: var(--r); overflow: hidden;
  border: 1px solid var(--border);
  background: var(--surface);
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}
.fig-wrap {
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  padding: 16px; min-height: 100px;
}
.fig-wrap img {
  max-width: 100%; height: auto; display: block; border-radius: 4px;
}
figcaption {
  padding: 10px 16px;
  font-family: var(--font-mono); font-size: 11px; color: var(--text-dim);
  border-top: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
}
.fig-label { color: var(--ucsd-gold); font-weight: 600; }
.fig-key {
  margin-left: auto; background: var(--surface2); border: 1px solid var(--border);
  padding: 2px 8px; border-radius: 3px; font-size: 10px; color: var(--text-dim);
  white-space: nowrap;
}

/* â”€â”€â”€ TEAM WIDGET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.team-widget {
  background: linear-gradient(135deg, rgba(0,46,109,0.5), rgba(13,26,45,0.8));
  border: 1px solid rgba(198,146,20,0.3); border-radius: var(--r);
  padding: 24px; margin: 20px 0;
}
.team-widget-title {
  font-size: 13px; font-weight: 700; color: var(--ucsd-gold);
  display: flex; align-items: center; gap: 8px; margin-bottom: 6px;
}
.team-widget-sub { font-size: 12px; color: var(--text-dim); font-family: var(--font-mono); margin-bottom: 16px; }
.team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(68px, 1fr)); gap: 8px; }
.tc {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 5px; padding: 8px 4px;
  text-align: center; font-family: var(--font-mono); cursor: default;
}
.tc-num { font-size: 18px; font-weight: 700; color: var(--text); }
.tc-label { font-size: 9px; color: var(--text-dim); }
.tc.mine { background: var(--gold-glow); border-color: rgba(198,146,20,0.5); }
.tc.mine .tc-num { color: var(--ucsd-gold-lt); }

/* â”€â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider { height: 1px; background: var(--border); margin: 48px 0; }

/* â”€â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#btt {
  position: fixed; bottom: 28px; right: 28px; z-index: 190;
  width: 42px; height: 42px; border-radius: 50%;
  background: var(--surface2); border: 1px solid var(--border-lt);
  color: var(--text-muted); font-size: 16px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: all 0.2s var(--ease); pointer-events: none;
  box-shadow: 0 4px 16px rgba(0,0,0,0.4);
}
#btt.show { opacity: 1; pointer-events: auto; }
#btt:hover { background: var(--ucsd-gold); color: var(--bg); border-color: var(--ucsd-gold); transform: translateY(-2px); }

/* â”€â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#read-progress {
  position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 2px; z-index: 300;
  background: transparent;
}
#read-progress-fill {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, var(--ucsd-navy), var(--ucsd-gold));
  transition: width 0.1s linear;
}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 1024px) {
  .hero { padding: 48px 40px 40px; }
  .content { padding: 0 40px 60px; }
}
@media (max-width: 768px) {
  #menu-toggle { display: flex; }
  .sidebar { transform: translateX(-100%); transition: transform 0.25s var(--ease); top: var(--topbar-h); }
  .sidebar.open { transform: translateX(0); }
  .topbar { padding-left: 0; }
  .main { margin-left: 0; }
  .hero { padding: 32px 20px 28px; }
  .content { padding: 0 20px 48px; }
  #read-progress { left: 0; }
}
</style>
</head>
<body>

<!-- READ PROGRESS -->
<div id="read-progress"><div id="read-progress-fill"></div></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOPBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="topbar">
  <div class="topbar-inner">
    <a href="#hero" class="topbar-brand">
      <div class="topbar-emblem">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="5" stroke="#C69214" stroke-width="2"/>
          <path d="M12 3v3M12 18v3M3 12h3M18 12h3" stroke="#C69214" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="12" r="2" fill="#C69214"/>
        </svg>
      </div>
      <div>
        <div class="topbar-name">UCSD Robocar</div>
        <div class="topbar-course">ECE / MAE 148</div>
      </div>
    </a>
    <div class="topbar-divider"></div>
    <span class="topbar-breadcrumb">Setup & Calibration Guide</span>
    <div class="topbar-spacer"></div>
    <div class="page-switcher">
      <a href="./index.html" class="ps-link active">ROS Setup</a>
      <a href="./gps_laps.html" class="ps-link">GPS Laps</a>
    </div>
    <button id="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">&#9776;</button>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo-row">
      <div class="sidebar-logo">RC</div>
      <div>
        <div class="sidebar-title">Robocar Docs</div>
        <div class="sidebar-sub">ECE/MAE 148 Â· UCSD</div>
      </div>
    </div>
  </div>

  <div class="sidebar-search">
    <span class="sidebar-search-icon">âŒ•</span>
    <input type="text" placeholder="Search sectionsâ€¦" id="nav-search" oninput="filterNav(this.value)">
  </div>

  <div class="nav-scroll" id="nav-scroll">
    <div class="nav-group-label">Getting Started</div>
    <a class="nav-link" href="#s1"><span class="nl-num">01</span>Docker Setup</a>
    <a class="nav-link" href="#s2"><span class="nl-num">02</span>Pull Robocar Image</a>
    <a class="nav-link" href="#s3"><span class="nl-num">03</span>X11 Forwarding</a>
    <a class="nav-link" href="#s4"><span class="nl-num">04</span>Run Container</a>
    <a class="nav-link" href="#s5"><span class="nl-num">05</span>Python Error Fix</a>
    <a class="nav-link" href="#s6"><span class="nl-num">06</span>Build Workspace</a>
    <a class="nav-link" href="#s7"><span class="nl-num">07</span>Shell Aliases</a>

    <div class="nav-group-label">Hardware</div>
    <a class="nav-link" href="#s8"><span class="nl-num">08</span>Camera Power Fix</a>
    <a class="nav-link" href="#s9"><span class="nl-num">09</span>Camera Isolation</a>

    <div class="nav-group-label">Calibration</div>
    <a class="nav-link" href="#s10"><span class="nl-num">10</span>Config Overview</a>
    <a class="nav-link" href="#s11"><span class="nl-num">11</span>Color Â· HSV Tuning</a>
    <a class="nav-link" href="#s12"><span class="nl-num">12</span>Line / Lane</a>
    <a class="nav-link" href="#s13"><span class="nl-num">13</span>Actuator & PID</a>
    <a class="nav-link" href="#s14"><span class="nl-num">14</span>Camera Navigation</a>

    <div class="nav-group-label">Development</div>
    <a class="nav-link" href="#s15"><span class="nl-num">15</span>ROS2 Node Dev</a>
    <a class="nav-link" href="#s16"><span class="nl-num">16</span>Troubleshooting</a>
  </div>

  <div class="nav-progress">
    <div class="np-label"><span>Reading Progress</span><span id="np-pct">0%</span></div>
    <div class="np-bar"><div class="np-fill" id="np-fill"></div></div>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="layout">
<div class="main">

<!-- â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="hero" id="hero">
  <div class="hero-eyebrow"><div class="hero-eyebrow-dot"></div>UCSD Jacobs School of Engineering</div>
  <h1>Robocar Framework<br><span>Setup & Calibration</span></h1>
  <p class="hero-desc">Complete reference for ECE/MAE 148 â€” covering Docker environment setup, X11 display forwarding, OAK-D camera calibration, VESC motor tuning, PID controller configuration, and custom node development.</p>
  <div class="hero-chips">
    <div class="hero-chip"><span class="hero-chip-icon">ğŸ“</span>Raspberry Pi 5</div>
    <div class="hero-chip"><span class="hero-chip-icon">ğŸ³</span>Docker</div>
    <div class="hero-chip"><span class="hero-chip-icon">ğŸ¤–</span>ROS2 Foxy</div>
  </div>
</div>

<div class="content">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§1 â€” Docker Setup
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s1"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">01</span>
    <div class="sec-title-block">
      <h2>Initial Setup & Docker Installation</h2>
      <div class="sec-subtitle">Prepare the Raspberry Pi with a clean, reproducible Docker environment</div>
    </div>
  </div>

  <p>Docker allows the entire Robocar software stack â€” ROS2, camera drivers, motor controllers, and all Python dependencies â€” to run in a self-contained container. This means the host Raspberry Pi OS stays clean, every student robot runs identical software, and you can always restore a broken environment by simply restarting the container.</p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-body">
        <div class="step-title">SSH into Your Pi</div>
        <div class="step-desc">Replace the hostname with your robot's assigned name. The <code>.local</code> suffix uses mDNS (Bonjour/Avahi) to find the Pi on the local network without needing an IP address.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Terminal â€” your laptop</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">ssh</span> pi@ucsdrobocar-148-XX.local</pre></div>
      <div class="step-body">
        <div class="step-title">Remove Old Docker Versions</div>
        <div class="step-desc">Removes conflicting legacy packages that could cause dependency conflicts. "Package not found" errors are completely normal â€” it just means they were never installed.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt remove</span> docker docker-engine docker.io containerd runc</pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-body">
        <div class="step-title">Install Prerequisites</div>
        <div class="step-desc"><strong>ca-certificates</strong> trusts HTTPS connections. <strong>curl</strong> downloads files from the web. <strong>gnupg</strong> verifies Docker's GPG signature to confirm the package is authentic. The keyrings directory stores the trusted signing key.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt update</span>
<span class="k">sudo apt install</span> ca-certificates curl gnupg <span class="f">-y</span>
<span class="k">sudo install</span> <span class="f">-m 0755 -d</span> /etc/apt/keyrings</pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-body">
        <div class="step-title">Add Docker's Official Repository</div>
        <div class="step-desc">Downloads Docker's GPG key, converts it to the binary format apt expects, then registers Docker's official package repository. This ensures you get official, up-to-date Docker packages rather than potentially outdated versions from Debian's default repos.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">curl</span> <span class="f">-fsSL</span> https://download.docker.com/linux/debian/gpg | \
  <span class="k">sudo gpg</span> <span class="f">--dearmor -o</span> /etc/apt/keyrings/docker.gpg
<span class="k">sudo chmod</span> a+r /etc/apt/keyrings/docker.gpg
<span class="k">echo</span> <span class="s">"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable"</span> \
  | <span class="k">sudo tee</span> /etc/apt/sources.list.d/docker.list > /dev/null</pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-body">
        <div class="step-title">Install Docker Engine</div>
        <div class="step-desc"><strong>docker-ce</strong> is the core container engine. <strong>docker-ce-cli</strong> provides the <code>docker</code> command. <strong>containerd.io</strong> manages container lifecycle. <strong>docker-buildx-plugin</strong> enables multi-platform builds. <strong>docker-compose-plugin</strong> enables multi-container orchestration.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt update</span>
<span class="k">sudo apt install</span> docker-ce docker-ce-cli containerd.io \
  docker-buildx-plugin docker-compose-plugin <span class="f">-y</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">6</div>
      <div class="step-body">
        <div class="step-title">Grant Permissions & Reboot</div>
        <div class="step-desc">By default, only <code>root</code> can run Docker commands. Adding your user to the <code>docker</code> group lets you run <code>docker</code> without typing <code>sudo</code> every time. The reboot is mandatory â€” the group change only takes effect after a full session restart.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo usermod</span> <span class="f">-aG</span> docker $USER
<span class="k">sudo reboot</span></pre></div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">7</div>
      <div class="step-body">
        <div class="step-title">Verify Installation</div>
        <div class="step-desc">SSH back in after the reboot and confirm Docker is working correctly.</div>
        <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal (after reboot)</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">docker --version</span>         <span class="c"># Should print version number</span>
<span class="k">docker run</span> hello-world    <span class="c"># Should print "Hello from Docker!"</span>
<span class="k">groups</span> $USER | grep docker <span class="c"># Should show docker in the list</span></pre></div>
        <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Success</div><div class="callout-text">You should see "Hello from Docker!" If you see <em>permission denied</em>, fully log out of your SSH session and back in â€” the group change requires a fresh login, not just a new terminal tab.</div></div></div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§2 â€” Pull Image
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s2"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">02</span>
    <div class="sec-title-block">
      <h2>Pulling the Robocar Image</h2>
      <div class="sec-subtitle">Download the pre-built UCSD Robocar software environment (~14.7 GB)</div>
    </div>
  </div>

  <p>The Robocar Docker image contains a fully configured environment including ROS2, OAK-D depth camera drivers (DepthAI), VESC motor controller drivers, all lane detection packages, and every Python dependency. You pull it once and it persists on the Pi's storage.</p>

  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Network Warning â€” Use Home WiFi</div><div class="callout-text">This image is approximately 14.7 GB. The campus WiFi network often drops mid-download, corrupting the image and forcing a full re-pull. Use a home network or a wired Ethernet connection. If the download is interrupted, simply re-run the pull command â€” Docker resumes from the last successfully downloaded layer.</div></div></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” expect 20â€“40 minutes</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">docker pull</span> djnighti/ucsd_robocar:devel</pre></div>

  <h3>Verify Download Succeeded</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">docker images</span> | grep ucsd_robocar
<span class="c"># Expected output:</span>
<span class="ok"># djnighti/ucsd_robocar   devel   &lt;id&gt;   &lt;date&gt;   14.7GB</span></pre></div>

  <h3>Troubleshooting</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Solution</th></tr></thead>
    <tbody>
      <tr><td>Download hangs or freezes</td><td>Re-run <code>docker pull</code> â€” it resumes automatically from the last layer</td></tr>
      <tr><td>"No space left on device"</td><td>Run <code>docker system prune -f</code> to clear old images and containers</td></tr>
      <tr><td>Image shows SIZE of 0B</td><td>The pull failed silently. Delete it with <code>docker rmi djnighti/ucsd_robocar:devel</code> and re-pull</td></tr>
      <tr><td>Authentication error</td><td>The image is public. Verify internet connectivity: <code>ping 8.8.8.8</code></td></tr>
    </tbody>
  </table></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§3 â€” X11 Forwarding
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s3"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">03</span>
    <div class="sec-title-block">
      <h2>Graphical Interface Setup (X11 Forwarding)</h2>
      <div class="sec-subtitle">Stream GUI windows from the Pi to your laptop screen over SSH</div>
    </div>
    <div class="sec-badges"><span class="badge badge-fix">Enhanced</span></div>
  </div>

  <p>X11 forwarding lets the Pi render GUI applications (calibration sliders, camera feeds, plots) and stream those windows over SSH to your laptop's screen. Without this, you cannot use any of the visual calibration tools â€” they will open on the Pi with no display to show on.</p>

  <h3>Step 1 â€” Install X11 Apps on the Pi</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo apt update</span>
<span class="k">sudo apt install</span> <span class="f">-y</span> x11-apps</pre></div>

  <h3>Step 2 â€” Install an X Server on Your Laptop</h3>
  <div class="tw"><table>
    <thead><tr><th>Your OS</th><th>Software to Install</th><th>Required Extra Step</th></tr></thead>
    <tbody>
      <tr><td><strong>macOS</strong></td><td>XQuartz â€” download from xquartz.org</td><td>After install: open XQuartz â†’ Preferences â†’ Security tab â†’ check <strong>"Allow connections from network clients"</strong>. Then fully restart your Mac (not just XQuartz).</td></tr>
      <tr><td><strong>Windows</strong></td><td>MobaXterm â€” handles X11 automatically in its built-in terminal</td><td>No extra steps needed. Use MobaXterm's SSH to connect.</td></tr>
      <tr><td><strong>Linux</strong></td><td>X11 is built in to all major distributions</td><td>No extra steps needed.</td></tr>
    </tbody>
  </table></div>

  <h3>Step 3 â€” Connect via SSH with Forwarding Enabled</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Your laptop terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Trusted forwarding â€” RECOMMENDED (use this if -X causes issues)</span>
<span class="k">ssh</span> <span class="f">-Y</span> pi@ucsdrobocar-148-XX.local

<span class="c"># Untrusted forwarding â€” stricter security</span>
<span class="k">ssh</span> <span class="f">-X</span> pi@ucsdrobocar-148-XX.local</pre></div>
  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">Why -Y instead of -X?</div><div class="callout-text">The Docker container runs as <code>root</code>, which is a different user than the <code>pi</code> user on the host. The <code>-X</code> flag (untrusted) blocks connections from different users for security reasons. The <code>-Y</code> flag (trusted) allows it. If calibration windows won't open inside Docker but xeyes works on the Pi host, switch to <code>-Y</code>.</div></div></div>

  <h3>Step 4 â€” Test X11 Before Entering Docker</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal (NOT inside Docker)</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">xeyes</span>
<span class="c"># A pair of animated eyes should appear on YOUR LAPTOP SCREEN</span>
<span class="c"># The eyes follow your mouse cursor</span></pre></div>

  <figure data-img-key="fig_xeyes.png">
    <div class="fig-wrap"><img src="images/fig_xeyes.png" alt="xeyes GUI window forwarded via X11 SSH to laptop screen" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 3.1</span> Successful X11 test â€” xeyes renders on your laptop screen, forwarded from the Pi over SSH <span class="fig-key">images/fig_xeyes.png</span></figcaption>
  </figure>

  <h3>Step 5 â€” Why These Docker Flags Are Required for X11</h3>
  <p>The <code>robocar_docker</code> function in Section 4 handles all of this automatically. Here's why each X11-related flag exists:</p>
  <div class="tw"><table>
    <thead><tr><th>Docker Flag</th><th>What It Does</th><th>Without It</th></tr></thead>
    <tbody>
      <tr><td><code>-e DISPLAY=$DISPLAY</code></td><td>Passes the Pi's X11 display socket address (e.g., <code>:10</code>) into the container so GUI apps know where to connect.</td><td>GUI apps start but have no display to connect to â€” they crash immediately.</td></tr>
      <tr><td><code>--volume="$HOME/.Xauthority:/root/.Xauthority:rw"</code></td><td>Mounts the Xauthority cookie file that proves the container is allowed to use the X server.</td><td>"Authorization required, rejecting connection" â€” all GUI calls fail.</td></tr>
      <tr><td><code>--net=host</code></td><td>Container shares the Pi's full network stack, including the <code>/tmp/.X11-unix/</code> socket used for X11 IPC.</td><td>The X11 socket is not reachable from inside the container.</td></tr>
    </tbody>
  </table></div>

  <h3>Step 6 â€” Verify X11 Inside the Docker Container</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker container</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">echo</span> $DISPLAY    <span class="c"># Must NOT be empty â€” should show :10 or :11</span>
<span class="k">xeyes</span>           <span class="c"># Eyes must appear on your laptop screen</span></pre></div>

  <h3>Common X11 Errors & Fixes</h3>
  <div class="tw"><table>
    <thead><tr><th>Error Message</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>"cannot open display"</td><td>SSH was not started with <code>-Y</code> flag. Exit and reconnect: <code>ssh -Y pi@hostname.local</code></td></tr>
      <tr><td>"No protocol specified"</td><td>Run on the Pi host: <code>xhost +local:</code> then retry inside Docker</td></tr>
      <tr><td>"Authorization required"</td><td>The <code>.Xauthority</code> file is not mounted in Docker. Check your <code>--volume</code> flag in the docker run command.</td></tr>
      <tr><td>xeyes opens on Pi host but not inside Docker</td><td>Switch from <code>ssh -X</code> to <code>ssh -Y</code> and restart the container.</td></tr>
      <tr><td>macOS: nothing appears at all</td><td>Enable "Allow connections from network clients" in XQuartz Preferences â†’ Security. Restart your Mac after.</td></tr>
      <tr><td>Works then breaks after Pi reboot</td><td>Run the xauth reset script below.</td></tr>
    </tbody>
  </table></div>

  <h3>Xauth Reset Script (After Reboot Breaks X11)</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi host terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Regenerate Xauthority credentials for your current display</span>
<span class="k">xauth generate</span> $DISPLAY . trusted
<span class="k">xauth list</span>      <span class="c"># Confirm credentials were written</span>

<span class="c"># Exit and re-SSH with trusted forwarding</span>
<span class="k">exit</span>
<span class="k">ssh</span> <span class="f">-Y</span> pi@ucsdrobocar-148-XX.local</pre></div>
  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Xauthority Lock Error</div><div class="callout-text">If you see "timeout in locking authority file", the file is corrupt. Delete it and start fresh:<br><code>rm ~/.Xauthority && ssh -Y pi@ucsdrobocar-148-XX.local</code></div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§4 â€” Run Container
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s4"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">04</span>
    <div class="sec-title-block">
      <h2>Running the Docker Container</h2>
      <div class="sec-subtitle">Start the Robocar environment using a reusable shell function</div>
    </div>
  </div>

  <p>The full <code>docker run</code> command is long and easy to mistype. We store it as a shell function in <code>~/.bashrc</code> so it becomes a simple one-word command. This function maps all hardware devices, sets up X11 forwarding, and configures your team's ROS2 domain in one step.</p>

  <h3>Step 1 â€” Add the Shell Function to Pi's .bashrc</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> ~/.bashrc  <span class="c"># Scroll to the bottom and paste the function below</span></pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Paste into Pi ~/.bashrc â€” replace MY_CONTAINER_NAME and YOUR_TEAM_ID</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>robocar_docker() {
  <span class="k">docker run</span> \
    <span class="f">--name</span> MY_CONTAINER_NAME \
    <span class="f">-it</span> \
    <span class="f">--privileged</span> \          <span class="c"># Full hardware access (cameras, serial, USB)</span>
    <span class="f">--net=host</span> \            <span class="c"># Share Pi's network stack (required for X11 + ROS2)</span>
    <span class="f">-e</span> DISPLAY=$DISPLAY \   <span class="c"># Forward X11 display address</span>
    <span class="f">-e</span> ROS_DOMAIN_ID=<span class="v">YOUR_TEAM_ID</span> \   <span class="c"># â† CRITICAL: See Section 9</span>
    <span class="f">--volume</span> /dev/bus/usb:/dev/bus/usb \
    <span class="f">--device-cgroup-rule=</span><span class="s">'c 189:* rmw'</span> \
    <span class="f">--device</span> /dev/video0 \
    <span class="f">--volume=</span><span class="s">"$HOME/.Xauthority:/root/.Xauthority:rw"</span> \
    <span class="f">--volume</span> /etc/passwd:/etc/passwd:ro \
    <span class="f">--volume</span> /etc/group:/etc/group:ro \
    djnighti/ucsd_robocar:${2:-devel}
}</pre></div>

  <h3>Step 2 â€” Reload and Launch</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">source</span> ~/.bashrc
<span class="k">robocar_docker</span> MY_CONTAINER_NAME</pre></div>
  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">First Run vs. Subsequent Runs</div><div class="callout-text">The <code>docker run</code> command only works the first time â€” it creates a new container. Once you exit, the container still exists but is stopped. For all future sessions, use <code>docker start</code> + <code>docker exec</code> (see below). Do NOT run <code>robocar_docker</code> again or you will get a "name already in use" error.</div></div></div>

  <h3>Step 3 â€” Manage the Container After First Launch</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi terminal â€” all future sessions</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Start the container (after it was stopped/Pi rebooted)</span>
<span class="k">docker start</span> MY_CONTAINER_NAME

<span class="c"># Open a terminal inside the running container</span>
<span class="k">docker exec -it</span> MY_CONTAINER_NAME bash

<span class="c"># Open ADDITIONAL terminals into the SAME running container</span>
<span class="c"># (run this in new SSH sessions or terminal tabs)</span>
<span class="k">docker exec -it</span> MY_CONTAINER_NAME bash</pre></div>
  <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Multi-Terminal Workflow</div><div class="callout-text">You will regularly need 3â€“4 concurrent terminals: one for <code>ros2 launch</code> (blocks), one for editing YAML config, one for <code>ros2 topic echo</code> monitoring, and one for debugging. All can be opened with <code>docker exec -it NAME bash</code> in separate SSH windows.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§5 â€” Python Fix
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s5"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">05</span>
    <div class="sec-title-block">
      <h2>Fixing Python Errors (If Needed)</h2>
      <div class="sec-subtitle">Resolve the apport_python_hook AttributeError in the container</div>
    </div>
  </div>

  <p>On some Pi setups the Docker container throws the following error when running ROS2 commands:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Error to watch for</span></div><pre><span class="er">AttributeError: module 'apport_python_hook' has no attribute 'install'</span></pre></div>
  <p>This happens because Ubuntu's crash reporter module (<code>apport</code>) is partially installed but incompatible with the container environment. The fix creates a safe <code>sitecustomize.py</code> file that catches and swallows the error before it can interrupt Python startup.</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker container</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cat</span> > /usr/lib/python3.8/sitecustomize.py &lt;&lt;<span class="s">'EOF'</span>
<span class="c"># Safe sitecustomize for containers</span>
<span class="c"># Only install apport hook if available and compatible</span>
try:
    import apport_python_hook
    if hasattr(apport_python_hook, <span class="s">'install'</span>):
        apport_python_hook.install()
except Exception:
    pass
<span class="s">EOF</span>

<span class="c"># Remove compiled bytecode so the fix takes effect immediately</span>
<span class="k">rm -f</span> /usr/lib/python3.8/__pycache__/sitecustomize.cpython-38.pyc 2>/dev/null || true

<span class="c"># Verify â€” both commands should work without errors</span>
<span class="k">python3</span> -c <span class="s">"print('Python OK')"</span>
<span class="k">ros2 --help</span> | head -3</pre></div>
  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Wrong Python Version?</div><div class="callout-text">The path <code>/usr/lib/python3.8/</code> must match your container's Python version. Check with <code>python3 --version</code>. If it shows Python 3.10, use <code>/usr/lib/python3.10/sitecustomize.py</code> instead.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§6 â€” Build Workspace
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s6"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">06</span>
    <div class="sec-title-block">
      <h2>Package Installation & Build</h2>
      <div class="sec-subtitle">Configure setup.py and compile the ROS2 workspace with colcon</div>
    </div>
  </div>

  <p>ROS2 uses <code>colcon</code> as its build system. Before building, we update <code>setup.py</code> to ensure all launch files, YAML configs, and RVIZ files are correctly installed. The default <code>setup.py</code> often misses subdirectories, causing "launch file not found" errors.</p>

  <h3>Step 1 â€” Update setup.py</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cd</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_nav2_pkg</pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker â€” write improved setup.py</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cat</span> > setup.py &lt;&lt;<span class="s">'EOF'</span>
from setuptools import setup
import os

package_name = <span class="s">'ucsd_robocar_nav2_pkg'</span>

def package_files(directory):
    <span class="c"># Recursively finds ALL files in the directory â€” fixes missing launch files</span>
    paths = []
    for (path, _, filenames) in os.walk(directory):
        for f in filenames:
            paths.append(os.path.join(path, f))
    return paths

data_files = [
    (<span class="s">'share/ament_index/resource_index/packages'</span>, [<span class="s">'resource/'</span> + package_name]),
    (<span class="s">'share/'</span> + package_name, [<span class="s">'package.xml'</span>]),
]

for d in [<span class="s">'launch'</span>, <span class="s">'config'</span>, <span class="s">'rviz'</span>, <span class="s">'urdf'</span>, <span class="s">'ros_data'</span>]:
    if os.path.isdir(d):
        data_files.append((os.path.join(<span class="s">'share'</span>, package_name, d), package_files(d)))

setup(
    name=package_name, version=<span class="s">'0.0.0'</span>,
    packages=[package_name], data_files=data_files,
    install_requires=[<span class="s">'setuptools'</span>], zip_safe=True,
    maintainer=<span class="s">'root'</span>, maintainer_email=<span class="s">'root@todo.todo'</span>,
    description=<span class="s">'Nav2 launch/config package for UCSD RoboCar'</span>,
    license=<span class="s">'TODO'</span>, tests_require=[<span class="s">'pytest'</span>],
    entry_points={<span class="s">'console_scripts'</span>: []},
)
<span class="s">EOF</span></pre></div>

  <h3>Step 2 â€” Build the Workspace</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">cd</span> /home/projects/ros2_ws
<span class="k">rm -rf</span> build install log            <span class="c"># Clean slate â€” avoids stale artifact issues</span>
<span class="k">colcon build</span> <span class="f">--symlink-install</span>      <span class="c"># Compile all packages</span>
<span class="k">source</span> install/setup.bash          <span class="c"># Register built packages with ROS2</span>
<span class="k">ros2 pkg list</span> | grep ucsd_robocar  <span class="c"># Verify packages are found</span></pre></div>
  <p><strong>--symlink-install</strong>: Instead of copying Python files, colcon creates symbolic links back to your source files. This means you can edit a <code>.py</code> script and re-run without rebuilding. However, YAML config files and launch files still require a rebuild when changed.</p>
  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Always Source After Build</div><div class="callout-text">Running <code>colcon build</code> compiles the code but does NOT make it available to ROS2 automatically. You must run <code>source install/setup.bash</code> afterward. If you skip this, <code>ros2</code> commands will report "package not found" even though the build succeeded. Section 7 creates aliases that handle this automatically.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§7 â€” Aliases
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s7"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">07</span>
    <div class="sec-title-block">
      <h2>Shell Aliases: source_ros2 & build_ros2</h2>
      <div class="sec-subtitle">One-command shortcuts for every build and source operation</div>
    </div>
  </div>

  <p>These two aliases eliminate the most common source of student errors: forgetting to rebuild or source after a file change. Once set up, every step in this guide becomes a single short command.</p>
  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">Inside the Container</div><div class="callout-text">These aliases go in <code>/root/.bashrc</code> INSIDE Docker, not the Pi host's <code>~/.bashrc</code>. You need to re-add them if you create a fresh container.</div></div></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker â€” open .bashrc</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> ~/.bashrc  <span class="c"># Scroll to bottom and paste below</span></pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Paste into container ~/.bashrc</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># â”€â”€ Source workspace only (fast â€” no recompile) â”€â”€</span>
alias source_ros2=<span class="s">'source /home/projects/ros2_ws/install/setup.bash && echo "[ROS2] Workspace sourced âœ“"'</span>

<span class="c"># â”€â”€ Build then source (use after ANY file change) â”€â”€</span>
alias build_ros2=<span class="s">'cd /home/projects/ros2_ws && colcon build --symlink-install && source install/setup.bash && echo "[ROS2] Build complete âœ“"'</span>

<span class="c"># â”€â”€ Source global ROS2 base install â”€â”€</span>
source /opt/ros/foxy/setup.bash 2>/dev/null</pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Activate and test</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">source</span> ~/.bashrc
<span class="k">source_ros2</span>    <span class="c"># Should print: [ROS2] Workspace sourced âœ“</span>
<span class="k">build_ros2</span>     <span class="c"># Should print: [ROS2] Build complete âœ“</span></pre></div>

  <div class="tw"><table>
    <thead><tr><th>Alias</th><th>When to Use</th><th>Speed</th></tr></thead>
    <tbody>
      <tr><td><code>source_ros2</code></td><td>Opening a new terminal tab into an existing container. Does NOT recompile anything.</td><td>~1 second</td></tr>
      <tr><td><code>build_ros2</code></td><td>After ANY change to Python code, YAML config, launch files, or setup.py. Always use this after edits.</td><td>30â€“120 seconds</td></tr>
    </tbody>
  </table></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§8 â€” Camera Power
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s8"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">08</span>
    <div class="sec-title-block">
      <h2>Camera Power Fix â€” USB Current & Powered Hub</h2>
      <div class="sec-subtitle">Fix random camera disconnects caused by insufficient USB power</div>
    </div>
  </div>

  <div class="callout error"><div class="callout-icon">âœ—</div><div class="callout-body"><div class="callout-title">Very Common Lab Issue</div><div class="callout-text">The OAK-D camera draws up to 900 mA at peak. The Raspberry Pi's USB ports are limited to ~600 mA total by firmware default. This causes the camera to disconnect randomly, produce an all-black feed, or fail to appear as a USB device at all. If your camera is misbehaving, power is almost certainly why.</div></div></div>

  <h3>Diagnose the Problem First</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi host terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Look for "over-current" or "device not accepting address" messages</span>
<span class="k">dmesg</span> | grep -i <span class="s">'usb\|over-current\|power'</span> | tail -20

<span class="c"># Camera should appear as Luxonis / Intel Movidius</span>
<span class="k">lsusb</span> | grep -i <span class="s">'movidius\|luxonis\|intel'</span></pre></div>

  <h3>Solution 1 â€” Software Fix via config.txt</h3>
  <p>This instructs the Pi firmware to draw more current through USB, raising the limit to approximately 1.2A total.</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi host terminal</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">sudo nano</span> /boot/config.txt
<span class="c"># Add this exact line at the END of the file:</span>
<span class="v">max_usb_current=1</span>
<span class="c"># Save: Ctrl+O â†’ Enter â†’ Ctrl+X, then reboot:</span>
<span class="k">sudo reboot</span></pre></div>
  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Requires a Quality 5V/3A+ Power Supply</div><div class="callout-text">This fix only works if the Pi itself is powered by a genuine 5V/3A USB-C supply. A cheap or underpowered supply will trigger undervoltage throttling even with this setting. Verify with: <code>dmesg | grep -i voltage</code> after reboot â€” you should see no warnings.</div></div></div>

  <h3>Solution 2 â€” Powered USB Hub (Most Reliable)</h3>
  <p>A powered USB hub provides the camera with a completely separate 5V power source, bypassing the Pi's USB regulator entirely. This is the recommended solution for lab and track use.</p>
  <div class="tw"><table>
    <thead><tr><th>Component</th><th>Requirement</th></tr></thead>
    <tbody>
      <tr><td>USB Hub</td><td>USB 3.0 hub with external power adapter â€” must NOT be bus-powered</td></tr>
      <tr><td>Hub Power Adapter</td><td>5V / 2A minimum dedicated supply (not shared with the Pi)</td></tr>
      <tr><td>Connection</td><td>Pi USB-A port â†’ Powered Hub â†’ OAK-D + VESC + other USB devices</td></tr>
    </tbody>
  </table></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Verify camera after connecting hub</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">lsusb</span> | grep -i luxonis    <span class="c"># Camera must appear here</span>
<span class="k">ls</span> /dev/video*             <span class="c"># /dev/video0 must exist</span>
<span class="k">dmesg</span> | grep -i 'usb' | tail -5  <span class="c"># Should show clean enumeration, no errors</span></pre></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§9 â€” Camera Isolation (NEW)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s9"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">09</span>
    <div class="sec-title-block">
      <h2>Camera Isolation â€” Prevent Cross-Team Interference</h2>
      <div class="sec-subtitle">Fix the multi-team problem where students connect to the wrong robot's camera</div>
    </div>
  </div>

  <div class="callout error"><div class="callout-icon">âœ—</div><div class="callout-body"><div class="callout-title">Critical Lab Issue â€” Read Before Starting Any Calibration</div><div class="callout-text">All robots running ROS2 on the same WiFi network are visible to each other by default. During a lab session with 10+ teams, Team 1's calibration GUI may be controlling Team 7's camera. Your <code>/cmd_vel</code> commands could be sending steering signals to a different team's VESC. Your lane detection node might be subscribing to a neighbor's camera feed. This causes completely baffling behavior that looks like a software bug but is actually a network isolation issue.</div></div></div>

  <h3>Why This Happens â€” ROS2 DDS Discovery</h3>
  <p>ROS2 uses DDS (Data Distribution Service) as its communication middleware. By default, every ROS2 node on the same local network automatically joins <strong>Domain ID 0</strong> and broadcasts its existence to all other nodes in that domain. Since every team runs nodes with the same names (<code>/lane_detection_node</code>, <code>/camera_node</code>, <code>/cmd_vel</code>), ROS2 connects to whichever publisher it discovers first â€” which may be a completely different team's robot sitting next to you.</p>

  <h3>The Fix â€” Assign Each Team a Unique ROS_DOMAIN_ID</h3>
  <p>Nodes on different Domain IDs are completely invisible to each other at the DDS network layer â€” they cannot publish to, subscribe to, or discover each other's topics at all. Setting a unique Domain ID requires zero code changes; it's purely an environment variable set before launching any ROS2 nodes.</p>

  <div class="team-widget">
    <div class="team-widget-title">ğŸ· Team Domain ID Assignments</div>
    <div class="team-widget-sub">Your team number = your Domain ID. Valid range: 0â€“232.</div>
    <div class="team-grid" id="team-grid"></div>
  </div>

  <h3>Step 1 â€” Set ROS_DOMAIN_ID in the Docker Run Command</h3>
  <p>In your <code>robocar_docker</code> function on the Pi's <code>~/.bashrc</code>, change <code>YOUR_TEAM_ID</code> to your actual team number. For example, Team 4:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Pi ~/.bashrc â€” inside robocar_docker function</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Replace 4 with YOUR team number</span>
<span class="f">-e</span> ROS_DOMAIN_ID=<span class="v">4</span> \</pre></div>

  <h3>Step 2 â€” Set ROS_DOMAIN_ID Inside the Container</h3>
  <p>Also add the export to the container's <code>~/.bashrc</code> so every new terminal window automatically uses your domain without needing the <code>-e</code> flag from docker exec:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker â€” add to ~/.bashrc</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Add to container ~/.bashrc â€” replace 4 with YOUR team number</span>
<span class="k">export</span> ROS_DOMAIN_ID=<span class="v">4</span>

<span class="c"># Reload</span>
<span class="k">source</span> ~/.bashrc</pre></div>

  <h3>Step 3 â€” Verify Isolation is Active</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Must print your team number â€” if empty, isolation is NOT active</span>
<span class="k">echo</span> $ROS_DOMAIN_ID

<span class="c"># Launch your nodes, then verify you only see YOUR topics</span>
<span class="k">ros2 topic list</span>

<span class="c"># Count the nodes â€” should only show your own</span>
<span class="k">ros2 node list</span></pre></div>

  <h3>Step 4 â€” Optional: Topic Namespacing for Extra Safety</h3>
  <p>If two teams accidentally use the same Domain ID (e.g., both set to 4), topic namespacing provides a second layer of isolation by prefixing all topics with your team identifier:</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker ~/.bashrc (optional)</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c"># Replace team04 with your team identifier</span>
<span class="k">export</span> ROS_NAMESPACE=<span class="v">team04</span>

<span class="c"># Effect: /camera/color/image_raw â†’ /team04/camera/color/image_raw</span>
<span class="c"># Effect: /cmd_vel â†’ /team04/cmd_vel</span></pre></div>
  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">Namespacing Changes All Topic Paths</div><div class="callout-text">If you enable <code>ROS_NAMESPACE</code>, every topic in your system gets the prefix. Any custom nodes you write that subscribe to <code>/error</code> must be updated to subscribe to <code>/team04/error</code> instead. The built-in Robocar packages handle namespacing automatically.</div></div></div>

  <h3>Multi-Team Checklist</h3>
  <div class="tw"><table>
    <thead><tr><th>Where</th><th>What to Set</th><th>Value</th></tr></thead>
    <tbody>
      <tr><td>Pi <code>~/.bashrc</code> (in robocar_docker)</td><td><code>-e ROS_DOMAIN_ID=N</code></td><td>Your team number</td></tr>
      <tr><td>Container <code>~/.bashrc</code></td><td><code>export ROS_DOMAIN_ID=N</code></td><td>Your team number</td></tr>
      <tr><td>Container <code>~/.bashrc</code> (optional)</td><td><code>export ROS_NAMESPACE=teamNN</code></td><td>Your team identifier string</td></tr>
      <tr><td>Verify (every lab session)</td><td><code>echo $ROS_DOMAIN_ID</code></td><td>Must match your team number, not empty or 0</td></tr>
    </tbody>
  </table></div>
  <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Quick Lab Sanity Check</div><div class="callout-text">Before every calibration session, open a terminal and run <code>echo $ROS_DOMAIN_ID</code>. If it shows empty or <code>0</code>, your isolation is not active. Any calibration you perform could be affecting a different team's robot.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§10 â€” Config Overview
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s10"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">10</span>
    <div class="sec-title-block">
      <h2>Calibration Overview & Config Files</h2>
      <div class="sec-subtitle">Understand the YAML configuration system before starting calibration</div>
    </div>
  </div>
  <p>All calibration parameters, hardware selections, and node activation flags live in YAML files that ROS2 reads at launch time. Understanding which file controls what prevents the most common calibration mistakes.</p>
  <div class="tw"><table>
    <thead><tr><th>File</th><th>Controls</th><th>Path</th></tr></thead>
    <tbody>
      <tr><td><code>node_config.yaml</code></td><td>Which ROS2 nodes are launched (calibration GUI on/off, autonomous nav on/off)</td><td><code>ucsd_robocar_nav2_pkg/config/</code></td></tr>
      <tr><td><code>car_config.yaml</code></td><td>Which hardware is active (camera model, motor controller type)</td><td><code>ucsd_robocar_nav2_pkg/config/</code></td></tr>
      <tr><td><code>ros_racer_calibration.yaml</code></td><td>PID gains, throttle limits, steering limits, error threshold</td><td><code>ucsd_robocar_lane_detection2_pkg/config/</code></td></tr>
    </tbody>
  </table></div>
  <h3>Calibration Mode â€” Enable GUI</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">node_config.yaml</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="v">all_components</span>:          1
<span class="v">camera_nav_calibration</span>:  1   <span class="c"># ENABLE calibration GUI sliders</span>
<span class="v">sensor_visualization</span>:    1   <span class="c"># Enable for LiDAR visualization</span>
<span class="v">camera_nav</span>:              0   <span class="c"># DISABLE autonomous nav during calibration</span></pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">car_config.yaml â€” same for both modes</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="v">oakd</span>:              1   <span class="c"># Enable OAK-D camera</span>
<span class="v">vesc_without_odom</span>: 1   <span class="c"># Enable VESC (no odometry feedback needed)</span></pre></div>
  <h3>Navigation Mode â€” After All Calibrations Complete</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">node_config.yaml</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="v">all_components</span>:          1
<span class="v">camera_nav_calibration</span>:  0   <span class="c"># DISABLE calibration GUI</span>
<span class="v">sensor_visualization</span>:    0   <span class="c"># Disable (saves CPU)</span>
<span class="v">camera_nav</span>:              1   <span class="c"># ENABLE autonomous driving</span></pre></div>
  <div class="callout warn"><div class="callout-icon">âš </div><div class="callout-body"><div class="callout-title">YAML Changes Require build_ros2</div><div class="callout-text">Running <code>source_ros2</code> alone does NOT apply YAML changes. You must run <code>build_ros2</code> after every YAML edit. This is the single most common mistake students make â€” they edit the config but wonder why nothing changed.</div></div></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§11 â€” Color Calibration
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s11"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">11</span>
    <div class="sec-title-block">
      <h2>Color Calibration (HSV Tuning)</h2>
      <div class="sec-subtitle">Isolate road markers from the camera feed using HSV color filtering</div>
    </div>
  </div>
  <p>The lane detection pipeline converts each camera frame to HSV (Hue, Saturation, Value) color space and applies a threshold. Pixels whose HSV values fall within your specified range become white (detected road markers); everything else becomes black (background). Tuning these ranges correctly for your specific track lighting is essential for reliable lane following.</p>

  <figure data-img-key="fig_hsv_chart.png">
    <div class="fig-wrap"><img src="images/fig_hsv_chart.png" alt="HSV color spectrum showing Hue 0-180 in OpenCV" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 11.1</span> HSV Hue spectrum (0â€“180 in OpenCV). Red=0, Yellowâ‰ˆ30, Greenâ‰ˆ60, Blueâ‰ˆ120. Divide standard 360Â° hue values by 2 for OpenCV. <span class="fig-key">images/fig_hsv_chart.png</span></figcaption>
  </figure>

  <div class="tw"><table>
    <thead><tr><th>Channel</th><th>Range</th><th>Low Extreme</th><th>High Extreme</th></tr></thead>
    <tbody>
      <tr><td><strong>Hue (H)</strong></td><td>0â€“180 (OpenCV)</td><td>Red tones (0)</td><td>Cycles back through violet to red (180)</td></tr>
      <tr><td><strong>Saturation (S)</strong></td><td>0â€“255</td><td>White / desaturated gray (0)</td><td>Pure, vivid, saturated color (255)</td></tr>
      <tr><td><strong>Value (V)</strong></td><td>0â€“255</td><td>Black / very dark (0)</td><td>Bright, fully lit color (255)</td></tr>
    </tbody>
  </table></div>

  <figure data-img-key="fig_mask_default.png">
    <div class="fig-wrap"><img src="images/fig_mask_default.png" alt="Default HSV mask sliders â€” entire image passes as white" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 11.2</span> Default slider values (lowH=0, highH=179, all S and V at extremes) â€” the entire image passes through as white. <span class="fig-key">images/fig_mask_default.png</span></figcaption>
  </figure>

  <figure data-img-key="fig_mask_yellow.png">
    <div class="fig-wrap"><img src="images/fig_mask_yellow.png" alt="HSV mask tuned for yellow road dots showing only yellow as white" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 11.3</span> Tuned for yellow road dots: lowH=25, highH=35, lowSâ‰ˆ56, lowVâ‰ˆ112. Only the yellow dashes appear white. <span class="fig-key">images/fig_mask_yellow.png</span></figcaption>
  </figure>

  <h3>Step-by-Step Tuning Procedure</h3>
  <div class="steps">
    <div class="step"><div class="step-num">1</div><div class="step-body"><div class="step-title">Launch calibration GUI</div><div class="step-desc">Run <code>build_ros2</code> then <code>ros2 launch ucsd_robocar_nav2_pkg all_nodes.launch.py</code>. The mask window will open on your laptop via X11.</div></div></div>
    <div class="step"><div class="step-num">2</div><div class="step-body"><div class="step-title">Set the Hue Range</div><div class="step-desc">For yellow road dots, set <code>lowH=25</code> and <code>highH=35</code>. For white lanes with inverted filter, keep wide Hue range and enable <code>inverted_filter=1</code>.</div></div></div>
    <div class="step"><div class="step-num">3</div><div class="step-body"><div class="step-title">Tune Saturation (lowS)</div><div class="step-desc">Raise <code>lowS</code> to ~50â€“80 to filter out desaturated grays and whites in the background. If the yellow road dots start disappearing, lower it until they reappear.</div></div></div>
    <div class="step"><div class="step-num">4</div><div class="step-body"><div class="step-title">Tune Value (lowV)</div><div class="step-desc">Raise <code>lowV</code> to ~80â€“120 to eliminate dark shadow noise. If shadowed portions of yellow markers disappear, lower it to include darker shades.</div></div></div>
    <div class="step"><div class="step-num">5</div><div class="step-body"><div class="step-title">Remove Remaining Speckle Noise</div><div class="step-desc">Use <strong>gray_thresh</strong> (eliminates near-gray pixels), <strong>erosion_iterations</strong> (shrinks pixel blobs â€” removes small noise), and <strong>dilation_iterations</strong> (expands blobs back â€” restores valid markers after erosion).</div></div></div>
  </div>

  <figure data-img-key="fig_bw_calibration.png">
    <div class="fig-wrap"><img src="images/fig_bw_calibration.png" alt="Noise reduction calibration sliders: gray_thresh, erosion, dilation" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 11.4</span> Noise reduction sliders. The preview shows a single clean white rectangle (road marker) against a black background after proper tuning. <span class="fig-key">images/fig_bw_calibration.png</span></figcaption>
  </figure>

  <h3>Color Quick Reference</h3>
  <div class="tw"><table>
    <thead><tr><th>Target Color</th><th>lowH</th><th>highH</th><th>Strategy</th></tr></thead>
    <tbody>
      <tr><td>Yellow center dots</td><td>25</td><td>35</td><td>Primary target. Direct filtering.</td></tr>
      <tr><td>White lane lines</td><td>0</td><td>180</td><td>Set <code>inverted_filter=1</code>, tune S and V to exclude road gray.</td></tr>
      <tr><td>Orange cones</td><td>10</td><td>20</td><td>May vary â€” adjust for your specific cone color under lab lighting.</td></tr>
      <tr><td>Red stop line</td><td>0â€“10 or 165â€“179</td><td>Wrap-around</td><td>Red wraps around H=0/180. May need two separate filter passes.</td></tr>
    </tbody>
  </table></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§12 â€” Line / Lane
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s12"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">12</span>
    <div class="sec-title-block">
      <h2>Line / Lane Calibration</h2>
      <div class="sec-subtitle">Configure contour filtering, error threshold, and camera alignment</div>
    </div>
  </div>
  <p>After the HSV filter produces a binary black-and-white image, the lane detection algorithm finds contours (groups of connected white pixels), measures their widths, and computes a centroid position. This section configures how those contours are selected and how the centroid translates into a steering error signal.</p>

  <figure data-img-key="fig_line_calibration.png">
    <div class="fig-wrap"><img src="images/fig_line_calibration.png" alt="Line calibration view showing green detected line segments and blue centroid dot" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 12.1</span> Line calibration view: green segments = valid detected lines, blue dot = computed centroid, green vertical bar = camera centerline reference. <span class="fig-key">images/fig_line_calibration.png</span></figcaption>
  </figure>

  <div class="tw"><table>
    <thead><tr><th>Parameter</th><th>Effect</th><th>Starting Value</th></tr></thead>
    <tbody>
      <tr><td><code>min_width</code></td><td>Minimum pixel width for a contour to be accepted as a valid road marker. Eliminates thin, distant lines.</td><td>15</td></tr>
      <tr><td><code>max_width</code></td><td>Maximum pixel width. Filters out very wide blobs (road surface, shadows, other large objects).</td><td>200</td></tr>
      <tr><td><code>number_of_lines</code></td><td>How many valid line segments to include in the centroid calculation. More lines = more stable on straights, harder to tune on curves.</td><td>3â€“4</td></tr>
    </tbody>
  </table></div>

  <h3>Error Threshold â€” The Dead Band</h3>
  <figure data-img-key="fig_error_threshold.png">
    <div class="fig-wrap"><img src="images/fig_error_threshold.png" alt="Error threshold red vertical bars in lane calibration view" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 12.2</span> The two red vertical bars define the error threshold dead band. Lines within this zone produce zero steering correction. Lines outside it trigger PID response. <span class="fig-key">images/fig_error_threshold.png</span></figcaption>
  </figure>
  <p>The error threshold defines a "dead band" around the camera centerline. If the computed lane centroid falls within this zone, the robot considers the error as zero and makes no steering correction. This prevents constant micro-corrections on straight roads.</p>
  <div class="tw"><table>
    <thead><tr><th>Scenario</th><th>Too Wide Threshold</th><th>Too Narrow Threshold</th></tr></thead>
    <tbody>
      <tr><td><strong>Straight Road</strong></td><td>Robot doesn't correct small drifts â†’ gradually wanders off-center</td><td>Constant micro-corrections â†’ jittery, oscillating steering</td></tr>
      <tr><td><strong>Curved Road</strong></td><td>Robot reacts to distant markers â†’ smoother, more predictive cornering</td><td>Robot reacts to nearby markers â†’ tighter, more aggressive turns</td></tr>
    </tbody>
  </table></div>

  <h3>Camera Alignment & Cropping</h3>
  <figure data-img-key="fig_camera_align.png">
    <div class="fig-wrap"><img src="images/fig_camera_align.png" alt="Camera centerline alignment with green bar and red error threshold bars" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 12.3</span> Camera alignment view: green bar = zero-error centerline reference (align to car physical center), red bars = error threshold bounds. <span class="fig-key">images/fig_camera_align.png</span></figcaption>
  </figure>
  <div class="tw"><table>
    <thead><tr><th>Parameter</th><th>Effect</th></tr></thead>
    <tbody>
      <tr><td><code>camera_centerline</code></td><td>Sets the position of the green zero-error reference bar. Place a ruler along the car's physical centerline and move this slider until the green bar aligns with the ruler.</td></tr>
      <tr><td><code>frame_width</code></td><td>Crops the image horizontally. Reduces the number of columns analyzed. Useful for ignoring room walls and off-track objects at the edges.</td></tr>
      <tr><td><code>rows_to_watch</code></td><td>Crops the image vertically. Controls how many rows (from the bottom up) the algorithm searches. Smaller = only immediate road ahead. Larger = looks further forward.</td></tr>
      <tr><td><code>rows_offset</code></td><td>Shifts the vertical crop window up or down. Higher offset = the car "looks" further ahead down the road, useful for anticipating curves earlier.</td></tr>
    </tbody>
  </table></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§13 â€” Actuator & PID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s13"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">13</span>
    <div class="sec-title-block">
      <h2>Actuator Calibration (PID & Throttle)</h2>
      <div class="sec-subtitle">Set servo limits, throttle schedule, and PID controller gains</div>
    </div>
  </div>

  <figure data-img-key="fig_throttle_steering.png">
    <div class="fig-wrap"><img src="images/fig_throttle_steering.png" alt="Throttle and steering calibration GUI with sliders" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 13.1</span> Actuator calibration GUI. Set steering physical limits first (modes 0/1/2), then throttle limits, then fine-tune PID gains. <span class="fig-key">images/fig_throttle_steering.png</span></figcaption>
  </figure>

  <h3>Steering Physical Limits (Set First)</h3>
  <div class="tw"><table>
    <thead><tr><th>Mode</th><th>Sets</th><th>Procedure</th></tr></thead>
    <tbody>
      <tr><td><strong>Steering_mode = 0</strong></td><td>Maximum LEFT steering limit</td><td>Adjust <code>Steering_value</code> until front wheels reach mechanical full-left stop. Switch to Mode 1 â€” this saves Mode 0's value.</td></tr>
      <tr><td><strong>Steering_mode = 1</strong></td><td>STRAIGHT (zero error) steering value</td><td>Drive car on flat surface. Adjust until it tracks perfectly straight. This is the PID setpoint at zero error.</td></tr>
      <tr><td><strong>Steering_mode = 2</strong></td><td>Maximum RIGHT steering limit</td><td>Adjust until front wheels reach mechanical full-right stop. Switch to Mode 0 to save Mode 2's value.</td></tr>
    </tbody>
  </table></div>
  <div class="callout info"><div class="callout-icon">â„¹</div><div class="callout-body"><div class="callout-title">Save-on-Switch Behavior</div><div class="callout-text">Values are saved to the YAML file at the moment you switch modes, not when you close the GUI. The value saved is whatever the slider shows when you switch. Example: set Mode_0 slider to 1250, switch to Mode_1 â†’ 1250 is saved for Mode_0.</div></div></div>

  <h3>Throttle Limits</h3>
  <div class="tw"><table>
    <thead><tr><th>Mode</th><th>Sets</th><th>Procedure</th></tr></thead>
    <tbody>
      <tr><td><strong>Throttle_mode = 0</strong></td><td>zero_throttle (neutral/stopped)</td><td>Find the value where the VESC makes no sound and the car doesn't move. This is your neutral PWM value.</td></tr>
      <tr><td><strong>Throttle_mode = 1</strong></td><td>max_throttle (full speed)</td><td>Increase in small increments only. Use a prop stand with wheels off the ground. Typical values: 0.38â€“0.42.</td></tr>
      <tr><td><strong>Throttle_mode = 2</strong></td><td>min_throttle (creep speed)</td><td>Find the minimum value that actually moves the car forward on your track surface. Just above stall.</td></tr>
    </tbody>
  </table></div>

  <figure data-img-key="fig_system_response.png">
    <div class="fig-wrap"><img src="images/fig_system_response.png" alt="System response plot showing throttle scheduling based on lane tracking error" loading="lazy"></div>
    <figcaption><span class="fig-label">Fig 13.2</span> Throttle scheduling: car runs at max_throttle when tracking error is low (straight), and decreases linearly to min_throttle when error is high (sharp curve). This prevents overrunning curves. <span class="fig-key">images/fig_system_response.png</span></figcaption>
  </figure>

  <h3>PID Steering Gains</h3>
  <div class="tw"><table>
    <thead><tr><th>Gain</th><th>Tuning Effect</th><th>Typical Start</th></tr></thead>
    <tbody>
      <tr><td><strong>Kp_steering</strong> (Proportional)</td><td>Direct response to current error magnitude. Too low = sluggish, slow to correct. Too high = oscillates left-right.</td><td>0.3 â€“ 0.5</td></tr>
      <tr><td><strong>Ki_steering</strong> (Integral)</td><td>Corrects accumulated steady-state error (car always drifts one direction). Too high = windup, instability.</td><td>0.0 â€“ 0.05</td></tr>
      <tr><td><strong>Kd_steering</strong> (Derivative)</td><td>Dampens oscillation by reacting to how fast error is changing. Too high = jerky, oversensitive steering.</td><td>0.05 â€“ 0.2</td></tr>
    </tbody>
  </table></div>

  <h3>Manual YAML Edit (More Precise than GUI)</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">nano</span> /home/projects/ros2_ws/src/ucsd_robocar_hub2/ucsd_robocar_lane_detection2_pkg/config/ros_racer_calibration.yaml</pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">ros_racer_calibration.yaml â€” reference values</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>lane_guidance_node:
  ros__parameters:
    <span class="v">Kp_steering</span>:        <span class="v">0.4</span>    <span class="c"># Start here â€” tune up if sluggish, down if oscillating</span>
    <span class="v">Ki_steering</span>:        <span class="v">0.01</span>   <span class="c"># Keep near zero unless persistent drift occurs</span>
    <span class="v">Kd_steering</span>:        <span class="v">0.1</span>    <span class="c"># Increase to dampen oscillation</span>
    <span class="v">zero_throttle</span>:      <span class="v">0</span>
    <span class="v">max_throttle</span>:       <span class="v">0.382</span>  <span class="c"># Moderate speed â€” increase carefully</span>
    <span class="v">min_throttle</span>:       <span class="v">0.363</span>  <span class="c"># Minimum to overcome static friction on track</span>
    <span class="v">error_threshold</span>:    <span class="v">0.15</span>   <span class="c"># Dead band (0â€“1 normalized error scale)</span>
    <span class="v">max_right_steering</span>: <span class="v">1</span>
    <span class="v">max_left_steering</span>:  <span class="v">-1</span>

vesc_twist_node:
  ros__parameters:
    <span class="v">steering_polarity</span>:  <span class="v">1</span>       <span class="c"># Flip to -1 if steering direction is reversed</span>
    <span class="v">throttle_polarity</span>:  <span class="v">1</span>       <span class="c"># Flip to -1 if car drives backward</span>
    <span class="v">max_potential_rpm</span>:  <span class="v">20000</span>
    <span class="v">zero_throttle</span>:      <span class="v">0</span>
    <span class="v">max_throttle</span>:       <span class="v">0.382</span>
    <span class="v">min_throttle</span>:       <span class="v">0.363</span>
    <span class="v">straight_steering</span>:  <span class="v">0</span>
    <span class="v">max_right_steering</span>: <span class="v">1</span>
    <span class="v">max_left_steering</span>:  <span class="v">-1</span></pre></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§14 â€” Camera Navigation
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s14"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">14</span>
    <div class="sec-title-block">
      <h2>Camera Navigation & Final Launch</h2>
      <div class="sec-subtitle">Deploy the robot on the track for autonomous lane following</div>
    </div>
  </div>
  <div class="callout error"><div class="callout-icon">âœ—</div><div class="callout-body"><div class="callout-title">Safety â€” Read Before Placing Robot on Track</div><div class="callout-text">Never launch the autonomous navigation stack on the track without at least one person positioned to physically stop the car if it veers off course. Always have Ctrl+C ready in the launch terminal. Start at minimum throttle and verify behavior before increasing speed.</div></div></div>

  <div class="cb"><div class="cb-header"><span class="cb-label">Inside Docker â€” launch autonomous lane following</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">source_ros2</span>
<span class="k">build_ros2</span>
<span class="k">ros2 launch</span> ucsd_robocar_nav2_pkg all_nodes.launch.py</pre></div>

  <h3>Live Debug Overlay</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Second terminal (while car is running)</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">ros2 param set</span> /lane_detection_node debug_cv <span class="v">1</span>   <span class="c"># Turn ON visual overlay</span>
<span class="k">ros2 param set</span> /lane_detection_node debug_cv <span class="v">0</span>   <span class="c"># Turn OFF (less CPU during racing)</span></pre></div>

  <h3>Debugging Lane Following on Track</h3>
  <div class="tw"><table>
    <thead><tr><th>Symptom</th><th>Most Likely Cause</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>Immediately steers hard to one side</td><td>camera_centerline wrong or steering_polarity flipped</td><td>Recalibrate centerline with ruler. If direction is inverted, set <code>steering_polarity: -1</code>.</td></tr>
      <tr><td>Gradually drifts off-center</td><td>error_threshold too wide or Ki too low</td><td>Narrow the error_threshold. Add a small Ki_steering value.</td></tr>
      <tr><td>Rapid left-right oscillation</td><td>Kp too high or Kd too low</td><td>Reduce Kp_steering. Increase Kd_steering to dampen.</td></tr>
      <tr><td>Car doesn't move at all</td><td>zero_throttle miscalibrated or VESC not connected</td><td>Echo <code>/cmd_vel</code> to confirm commands are publishing. Check USB with <code>dmesg | grep usb</code>.</td></tr>
      <tr><td>All-black camera feed</td><td>Insufficient USB power to OAK-D</td><td>Use powered USB hub â€” see Section 8.</td></tr>
      <tr><td>Seeing another team's robot data</td><td>ROS_DOMAIN_ID not set</td><td>See Section 9 â€” verify <code>echo $ROS_DOMAIN_ID</code>.</td></tr>
    </tbody>
  </table></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§15 â€” ROS2 Dev Guide
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s15"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">15</span>
    <div class="sec-title-block">
      <h2>ROS2 Nodes, Topics & Subscribers â€” Dev Guide</h2>
      <div class="sec-subtitle">Write custom nodes, integrate sensors, and reuse existing packages</div>
    </div>
  </div>
  <p>This section gives you the foundation to extend the Robocar framework for your team's custom project. Understanding the existing node graph lets you intercept data, add new behaviors, and reuse pre-built functionality without reinventing the wheel.</p>

  <h3>Node Architecture â€” Data Flow</h3>
  <div class="tw"><table>
    <thead><tr><th>Node</th><th>Publishes</th><th>Subscribes To</th><th>Hardware</th></tr></thead>
    <tbody>
      <tr><td><code>/camera_node</code></td><td><code>/camera/color/image_raw</code></td><td>â€”</td><td>OAK-D Camera</td></tr>
      <tr><td><code>/lane_detection_node</code></td><td><code>/error</code> (Float32, -1 to 1)</td><td><code>/camera/color/image_raw</code></td><td>â€”</td></tr>
      <tr><td><code>/lane_guidance_node</code></td><td><code>/cmd_vel</code> (Twist)</td><td><code>/error</code></td><td>â€”</td></tr>
      <tr><td><code>/vesc_twist_node</code></td><td>Hardware PWM signals</td><td><code>/cmd_vel</code></td><td>VESC ESC â†’ Motor + Servo</td></tr>
      <tr><td><code>/lidar_node</code></td><td><code>/scan</code> (LaserScan)</td><td>â€”</td><td>RPLiDAR (if installed)</td></tr>
    </tbody>
  </table></div>

  <h3>Custom Subscriber Node â€” Full Working Example</h3>
  <p>This node subscribes to the lane error topic and implements an emergency stop if the car goes too far off-track. Copy it into your package, register it in <code>setup.py</code>, and extend as needed.</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">my_custom_node.py â€” place in your package directory</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c">#!/usr/bin/env python3</span>
import rclpy
from rclpy.node import Node
from std_msgs.msg import Float32
from geometry_msgs.msg import Twist

class LaneErrorMonitor(Node):
    def __init__(self):
        super().__init__(<span class="s">'lane_error_monitor'</span>)

        <span class="c"># Subscribe to lane tracking error (-1.0 to 1.0 normalized)</span>
        self.sub = self.create_subscription(
            Float32, <span class="s">'/error'</span>, self.error_callback, 10)

        <span class="c"># Publisher to override cmd_vel in emergencies</span>
        self.pub = self.create_publisher(Twist, <span class="s">'/cmd_vel'</span>, 10)
        self.get_logger().info(<span class="s">'LaneErrorMonitor started!'</span>)

    def error_callback(self, msg: Float32):
        self.get_logger().info(f<span class="s">'Error: {msg.data:.4f}'</span>)

        <span class="c"># Emergency stop: error > 80% of maximum</span>
        if abs(msg.data) > 0.8:
            self.get_logger().warn(<span class="s">'CRITICAL ERROR â€” sending stop!'</span>)
            self.pub.publish(Twist())  <span class="c"># all-zero Twist = full stop</span>

def main(args=None):
    rclpy.init(args=args)
    node = LaneErrorMonitor()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()

if __name__ == <span class="s">'__main__'</span>:
    main()</pre></div>

  <h3>Custom Publisher Node â€” Timed Commands</h3>
  <p>Send periodic drive commands without running lane detection. Useful for testing the VESC or running a simple straight-line test.</p>
  <div class="cb"><div class="cb-header"><span class="cb-label">test_drive_node.py</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="c">#!/usr/bin/env python3</span>
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import Twist

class TestDriveNode(Node):
    def __init__(self):
        super().__init__(<span class="s">'test_drive_node'</span>)
        self.pub = self.create_publisher(Twist, <span class="s">'/cmd_vel'</span>, 10)
        self.timer = self.create_timer(0.1, self.send_command)  <span class="c"># 10 Hz</span>

    def send_command(self):
        msg = Twist()
        msg.linear.x = 0.37   <span class="c"># forward speed (maps to throttle)</span>
        msg.angular.z = 0.0   <span class="c"># steering (0.0 = straight)</span>
        self.pub.publish(msg)

def main(args=None):
    rclpy.init(args=args)
    node = TestDriveNode()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()

if __name__ == <span class="s">'__main__'</span>:
    main()</pre></div>

  <h3>Register Your Node in setup.py</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">setup.py â€” entry_points section</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>entry_points={
    <span class="s">'console_scripts'</span>: [
        <span class="s">'lane_monitor = ucsd_robocar_nav2_pkg.my_custom_node:main'</span>,
        <span class="s">'test_drive   = ucsd_robocar_nav2_pkg.test_drive_node:main'</span>,
    ],
},</pre></div>
  <div class="cb"><div class="cb-header"><span class="cb-label">Build and run</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre><span class="k">build_ros2</span>
<span class="k">ros2 run</span> ucsd_robocar_nav2_pkg lane_monitor</pre></div>

  <h3>Camera Feed Subscription (with OpenCV)</h3>
  <div class="cb"><div class="cb-header"><span class="cb-label">Camera subscriber snippet</span><button class="copy-btn" onclick="doCopy(this)">COPY</button></div><pre>from sensor_msgs.msg import Image
from cv_bridge import CvBridge
import cv2

class CameraSubscriberNode(Node):
    def __init__(self):
        super().__init__(<span class="s">'camera_sub'</span>)
        self.bridge = CvBridge()
        self.sub = self.create_subscription(
            Image, <span class="s">'/camera/color/image_raw'</span>,
            self.image_callback, 10)

    def image_callback(self, msg: Image):
        <span class="c"># Convert ROS Image â†’ OpenCV numpy array (BGR format)</span>
        cv_img = self.bridge.imgmsg_to_cv2(msg, <span class="s">'bgr8'</span>)

        <span class="c"># Now use it like a regular numpy array</span>
        gray = cv2.cvtColor(cv_img, cv2.COLOR_BGR2GRAY)

        <span class="c"># Display (requires X11 forwarding to be active)</span>
        cv2.imshow(<span class="s">'Camera'</span>, cv_img)
        cv2.waitKey(1)</pre></div>

  <h3>Reuse Existing Packages â€” Don't Reinvent</h3>
  <div class="callout tip"><div class="callout-icon">âœ“</div><div class="callout-body"><div class="callout-title">Efficiency Rule</div><div class="callout-text">Before writing any new code, run <code>ros2 topic list</code> and <code>ros2 node list</code>. The sensor data you need is almost certainly already being published as a topic. Subscribing to an existing topic takes 10 lines of code. Writing a new driver takes hundreds.</div></div></div>
  <div class="tw"><table>
    <thead><tr><th>Package</th><th>What It Provides</th><th>How to Use</th></tr></thead>
    <tbody>
      <tr><td><code>ucsd_robocar_sensor2_pkg</code></td><td>Camera publisher, LiDAR publisher, IMU</td><td>Enable in <code>car_config.yaml</code>. Subscribe to their topics.</td></tr>
      <tr><td><code>ucsd_robocar_lane_detection2_pkg</code></td><td>Full HSV pipeline â†’ <code>/error</code> topic</td><td>Subscribe to <code>/error</code> for your own PID or ML controller.</td></tr>
      <tr><td><code>ucsd_robocar_actuator2_pkg</code></td><td>VESC driver â€” accepts <code>/cmd_vel</code></td><td>Publish Twist messages to <code>/cmd_vel</code>. That's all.</td></tr>
      <tr><td><code>ucsd_robocar_nav2_pkg</code></td><td>Launch files, config system</td><td>Copy launch files as templates for custom node graphs.</td></tr>
    </tbody>
  </table></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Â§16 â€” Troubleshooting
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-anchor" id="s16"></div>
<section class="section">
  <div class="sec-header">
    <span class="sec-num">16</span>
    <div class="sec-title-block">
      <h2>Troubleshooting & Known Bugs</h2>
      <div class="sec-subtitle">Quick reference for the most common failure modes</div>
    </div>
  </div>

  <h3>Docker & System</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td><code>docker: permission denied</code></td><td><code>sudo usermod -aG docker $USER</code> then fully log out and back in</td></tr>
      <tr><td>Container name already in use</td><td>Container exists from a previous run. Use <code>docker start NAME</code> + <code>docker exec -it NAME bash</code></td></tr>
      <tr><td>Container not found after reboot</td><td><code>docker start MY_CONTAINER_NAME</code> â€” the container still exists, it's just stopped</td></tr>
      <tr><td>No space left on device</td><td><code>docker system prune -f</code> removes dangling images and stopped containers</td></tr>
    </tbody>
  </table></div>

  <h3>X11 & Display</h3>
  <div class="tw"><table>
    <thead><tr><th>Error</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>"cannot open display"</td><td>SSH with <code>-Y</code> flag: <code>ssh -Y pi@hostname.local</code></td></tr>
      <tr><td>"No protocol specified"</td><td>Run on Pi host: <code>xhost +local:</code></td></tr>
      <tr><td>"Authorization required" inside Docker</td><td>Ensure <code>--volume $HOME/.Xauthority:/root/.Xauthority:rw</code> is in docker run</td></tr>
      <tr><td>GUI works on host but not inside container</td><td>Switch from <code>ssh -X</code> to <code>ssh -Y</code> and restart the container</td></tr>
    </tbody>
  </table></div>

  <h3>Camera & Hardware</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>OAK-D disconnects randomly</td><td>Use a powered USB hub (Section 8)</td></tr>
      <tr><td>All-black camera feed</td><td>USB power insufficient â€” powered hub required</td></tr>
      <tr><td>VESC not responding</td><td>Check USB cable; run <code>dmesg | grep usb</code> for enumeration errors</td></tr>
      <tr><td>Wheels spin backwards</td><td>Set <code>throttle_polarity: -1</code> in YAML, then <code>build_ros2</code></td></tr>
      <tr><td>Steering direction inverted</td><td>Set <code>steering_polarity: -1</code> in YAML, then <code>build_ros2</code></td></tr>
      <tr><td>Connecting to another team's camera</td><td><strong>Set ROS_DOMAIN_ID â€” see Section 9. This is always the cause.</strong></td></tr>
    </tbody>
  </table></div>

  <h3>Build & ROS2</h3>
  <div class="tw"><table>
    <thead><tr><th>Problem</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>"Package not found" after build</td><td>Run <code>source_ros2</code> (or <code>source install/setup.bash</code>). The build succeeded but ROS2 doesn't know about it yet.</td></tr>
      <tr><td>YAML changes have no effect</td><td>Must run <code>build_ros2</code> â€” not just <code>source_ros2</code>. This is the #1 student mistake.</td></tr>
      <tr><td>Launch file not found</td><td>The launch file wasn't installed. Check <code>setup.py</code> includes <code>launch/</code> directory; re-run <code>build_ros2</code>.</td></tr>
      <tr><td>Calibration GUI closes immediately</td><td>X11 not working inside Docker. Verify <code>echo $DISPLAY</code> inside container â€” must not be empty.</td></tr>
    </tbody>
  </table></div>

  <h3>PID & Lane Following</h3>
  <div class="tw"><table>
    <thead><tr><th>Symptom</th><th>Fix</th></tr></thead>
    <tbody>
      <tr><td>Rapid left-right oscillation</td><td>Reduce Kp_steering. Increase Kd_steering to add damping.</td></tr>
      <tr><td>Consistent drift in one direction</td><td>Recalibrate camera_centerline. Add a small Ki_steering value.</td></tr>
      <tr><td>Too fast on curves, flies off track</td><td>Reduce max_throttle. Increase error_threshold so throttle scheduling kicks in earlier.</td></tr>
      <tr><td>No response to curves, goes straight</td><td>Narrow error_threshold. Increase Kp_steering.</td></tr>
      <tr><td>No lines detected in debug view</td><td>Recalibrate HSV color filter for current lab lighting. Track can appear different hour to hour.</td></tr>
    </tbody>
  </table></div>

  <div class="divider"></div>
  <p style="text-align:center; font-size:13px;">UCSD Jacobs School of Engineering â€” ECE/MAE 148 Intro to Autonomous Vehicles</p>
</section>

</div><!-- /content -->
</div><!-- /main -->
</main><!-- /layout -->

<button id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">â†‘</button>

<script>
// â”€â”€ COPY BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doCopy(btn) {
  const pre = btn.closest('.cb').querySelector('pre');
  const text = pre.innerText;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'COPIED âœ“';
    btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  }).catch(() => {
    // Fallback for older browsers
    const ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    btn.textContent = 'COPIED âœ“'; btn.classList.add('ok');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('ok'); }, 2000);
  });
}

// â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const btt = document.getElementById('btt');
window.addEventListener('scroll', () => {
  btt.classList.toggle('show', window.scrollY > 500);
});

// â”€â”€ READ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const progressFill = document.getElementById('read-progress-fill');
const npFill = document.getElementById('np-fill');
const npPct = document.getElementById('np-pct');
window.addEventListener('scroll', () => {
  const docH = document.documentElement.scrollHeight - window.innerHeight;
  const pct = Math.min(100, Math.round((window.scrollY / docH) * 100));
  progressFill.style.width = pct + '%';
  npFill.style.width = pct + '%';
  npPct.textContent = pct + '%';
});

// â”€â”€ ACTIVE NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const anchors = document.querySelectorAll('.section-anchor[id]');
const navLinks = document.querySelectorAll('.nav-link');
const io = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      navLinks.forEach(l => l.classList.remove('active'));
      const a = document.querySelector(`.nav-link[href="#${e.target.id}"]`);
      if (a) { a.classList.add('active');
    }
  });
}, { rootMargin: '-60px 0px -80% 0px' });
anchors.forEach(a => io.observe(a));

// â”€â”€ NAV SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterNav(q) {
  const term = q.toLowerCase();
  document.querySelectorAll('.nav-link').forEach(l => {
    l.style.display = l.textContent.toLowerCase().includes(term) ? '' : 'none';
  });
  document.querySelectorAll('.nav-group-label').forEach(g => {
    let next = g.nextElementSibling;
    let hasVisible = false;
    while (next && !next.classList.contains('nav-group-label')) {
      if (next.style.display !== 'none') hasVisible = true;
      next = next.nextElementSibling;
    }
    g.style.display = hasVisible ? '' : 'none';
  });
}

// â”€â”€ MOBILE MENU CLOSE ON LINK CLICK â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.nav-link').forEach(l => {
  l.addEventListener('click', () => {
    document.getElementById('sidebar').classList.remove('open');
  });
});
</script>
</body>
</html>
